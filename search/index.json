[{"categories":["Go"],"contents":"æœ¬æ–‡ä¸»è¦åˆ†æäº† Golang ä¸­çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œé˜²ç¼“å­˜å‡»ç©¿åˆ©å™¨ singleflightï¼ŒåŒ…æ‹¬åŸºæœ¬ä½¿ç”¨å’Œæºç åˆ†æã€‚\n1. ç¼“å­˜å‡»ç©¿ å¹³æ—¶å¼€å‘ä¸­ä¸ºäº†æå‡æ€§èƒ½ï¼Œå‡è½»DBå‹åŠ›ï¼Œä¸€èˆ¬ä¼šç»™çƒ­ç‚¹æ•°æ®è®¾ç½®ç¼“å­˜ï¼Œå¦‚ Redisï¼Œç”¨æˆ·è¯·æ±‚è¿‡æ¥åå…ˆæŸ¥è¯¢ Redisï¼Œæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰å°±ä¼šå»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å†™å…¥ç¼“å­˜ã€‚\nå¤§è‡´æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nä»¥ä¸Šæµç¨‹å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œcache miss åæŸ¥è¯¢DBå’Œå°†æ•°æ®å†æ¬¡å†™å…¥ç¼“å­˜è¿™ä¸¤ä¸ªæ­¥éª¤æ˜¯éœ€è¦ä¸€å®šæ—¶é—´çš„ï¼Œè¿™æ®µæ—¶é—´å†…çš„åç»­è¯·æ±‚ä¹Ÿä¼šå‡ºç° cache missï¼Œç„¶åèµ°åŒæ ·çš„é€»è¾‘ã€‚\nè¿™å°±æ˜¯ç¼“å­˜å‡»ç©¿ï¼šæŸä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜å¤±æ•ˆåï¼ŒåŒä¸€æ—¶é—´çš„å¤§é‡è¯·æ±‚ç›´æ¥è¢«æ‰“åˆ°çš„äº†DBï¼Œä¼šç»™DBé€ æˆæå¤§å‹åŠ›ï¼Œç”šè‡³ç›´æ¥æ‰“å´©DBã€‚\nå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯åŠ é”ï¼Œcache miss åè¯·æ±‚DBä¹‹å‰å¿…é¡»å…ˆè·å–åˆ†å¸ƒå¼é”ï¼Œå–é”å¤±è´¥è¯´æ˜æ˜¯æœ‰å…¶ä»–è¯·æ±‚åœ¨æŸ¥è¯¢DBäº†ï¼Œå½“å‰è¯·æ±‚åªéœ€è¦å¾ªç¯ç­‰å¾…å¹¶æŸ¥è¯¢Redisæ£€æµ‹å–é”æˆåŠŸçš„è¯·æ±‚æŠŠæ•°æ®å›å†™åˆ°Redisæ²¡æœ‰ï¼Œå¦‚æœæœ‰çš„è¯å½“å‰è¯·æ±‚å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å–æ•°æ®è¿”å›äº†ã€‚\n2. singleflight è™½ç„¶åŠ é”èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å¤ªé‡äº†ï¼Œè€Œä¸”é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œåˆæ˜¯åŠ é”åˆæ˜¯ç­‰å¾…çš„ã€‚\nç›¸æ¯”ä¹‹ä¸‹ singleflight å°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è§£å†³æ–¹æ¡ˆã€‚\nDemoå¦‚ä¸‹ï¼š\npackage main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; \u0026#34;golang.org/x/sync/singleflight\u0026#34; ) var ( g singleflight.Group ErrCacheMiss = errors.New(\u0026#34;cache miss\u0026#34;) ) func main() { var wg sync.WaitGroup wg.Add(10) // æ¨¡æ‹Ÿ10ä¸ªå¹¶å‘ for i := 0; i \u0026lt; 10; i++ { go func() { defer wg.Done() data, err := load(\u0026#34;key\u0026#34;) if err != nil { log.Print(err) return } log.Println(data) }() } wg.Wait() } // è·å–æ•°æ® func load(key string) (string, error) { data, err := loadFromCache(key) if err != nil \u0026amp;\u0026amp; err == ErrCacheMiss { // åˆ©ç”¨ singleflight æ¥å½’å¹¶è¯·æ±‚ v, err, _ := g.Do(key, func() (interface{}, error) { data, err := loadFromDB(key) if err != nil { return nil, err } setCache(key, data) return data, nil }) if err != nil { log.Println(err) return \u0026#34;\u0026#34;, err } data = v.(string) } return data, nil } // getDataFromCache æ¨¡æ‹Ÿä»cacheä¸­è·å–å€¼ cache miss func loadFromCache(key string) (string, error) { return \u0026#34;\u0026#34;, ErrCacheMiss } // setCache å†™å…¥ç¼“å­˜ func setCache(key, data string) {} // getDataFromDB æ¨¡æ‹Ÿä»æ•°æ®åº“ä¸­è·å–å€¼ func loadFromDB(key string) (string, error) { fmt.Println(\u0026#34;query db\u0026#34;) unix := strconv.Itoa(int(time.Now().UnixNano())) return unix, nil } ç»“æœå¦‚ä¸‹ï¼š\nquery db 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 2021/07/17 11:04:13 1626491053454483100 å¯ä»¥çœ‹åˆ° 10 ä¸ªè¯·æ±‚éƒ½è·å–åˆ°äº†ç»“æœï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªè¯·æ±‚å»æŸ¥è¯¢æ•°æ®åº“ï¼Œæå¤§çš„å‡è½»äº†DBå‹åŠ›ã€‚\n3. æºç åˆ†æ è¿™ä¸ªåº“çš„å®ç°å¾ˆç®€å•ï¼Œé™¤å»æ³¨é‡Šå¤§æ¦‚å°± 100 æ¥è¡Œä»£ç ï¼Œä½†æ˜¯åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå€¼å¾—å­¦ä¹ ã€‚\nGroup type Group struct { mu sync.Mutex // protects m m map[string]*call // lazily initialized } Group ç»“æ„ä½“ç”±ä¸€ä¸ªäº’æ–¥é”å’Œä¸€ä¸ª map ç»„æˆï¼Œå¯ä»¥çœ‹åˆ°æ³¨é‡Š map æ˜¯æ‡’åŠ è½½çš„ï¼Œæ‰€ä»¥ Group åªè¦å£°æ˜å°±å¯ä»¥ä½¿ç”¨ï¼Œä¸ç”¨è¿›è¡Œé¢å¤–çš„åˆå§‹åŒ–é›¶å€¼å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚\ntype call struct { wg sync.WaitGroup // å‡½æ•°è¿”å›å€¼å’Œerrä¿¡æ¯ val interface{} err error // æ˜¯å¦è°ƒç”¨äº† forget æ–¹æ³• forgotten bool // è®°å½•è¿™ä¸ª key è¢«åˆ†äº«äº†å¤šå°‘æ¬¡ dups int chans []chan\u0026lt;- Result } call ä¿å­˜äº†å½“å‰è°ƒç”¨å¯¹åº”çš„ä¿¡æ¯ï¼Œmap çš„é”®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ Do æ–¹æ³•ä¼ å…¥çš„ key\nDo func (g *Group) Do(key string, fn func() (interface{}, error)) (v interface{}, err error, shared bool) { g.mu.Lock() if g.m == nil { // æ‡’åŠ è½½ g.m = make(map[string]*call) } // å…ˆåˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨ if c, ok := g.m[key]; ok { // å­˜åœ¨åˆ™è¯´æ˜æœ‰å…¶ä»–è¯·æ±‚åœ¨åŒæ­¥æ‰§è¡Œï¼Œæœ¬æ¬¡è¯·æ±‚åªéœ€è¦ç­‰å¾…å³å¯ c.dups++ g.mu.Unlock() c.wg.Wait() // / ç­‰å¾…æœ€å…ˆè¿›æ¥çš„é‚£ä¸ªè¯·æ±‚æ‰§è¡Œå®Œæˆï¼Œå› ä¸ºéœ€è¦å®Œæˆåæ‰èƒ½è·å–åˆ°ç»“æœï¼Œè¿™é‡Œç”¨ wg æ¥é˜»å¡ï¼Œé¿å…äº†æ‰‹åŠ¨å†™ä¸€ä¸ªå¾ªç¯ç­‰å¾…çš„é€»è¾‘ // è¿™é‡ŒåŒºåˆ† panic é”™è¯¯å’Œ runtime çš„é”™è¯¯ï¼Œé¿å…å‡ºç°æ­»é”ï¼Œåé¢å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆè¿™ä¹ˆåš if e, ok := c.err.(*panicError); ok { panic(e) } else if c.err == errGoexit { runtime.Goexit() } // æœ€åç›´æ¥ä» call å¯¹è±¡ä¸­å–å‡ºæ•°æ®å¹¶è¿”å› return c.val, c.err, true } // å¦‚æœ key ä¸å­˜åœ¨åˆ™ä¼šèµ°åˆ°è¿™é‡Œ new ä¸€ä¸ª call å¹¶æ‰§è¡Œ c := new(call) c.wg.Add(1) g.m[key] = c // æ³¨æ„ è¿™é‡Œåœ¨ Unlock ä¹‹å‰å°±æŠŠ call å†™åˆ° m ä¸­äº†ï¼Œæ‰€ä»¥ è¿™éƒ¨åˆ†é€»è¾‘åªæœ‰ç¬¬ä¸€æ¬¡è¯·æ±‚ä¼šæ‰§è¡Œ g.mu.Unlock() // ç„¶åæˆ‘ä»¬è°ƒç”¨ doCall å»æ‰§è¡Œ g.doCall(c, key, fn) return c.val, c.err, c.dups \u0026gt; 0 } doCall è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒçµæ€§ï¼Œé€šè¿‡ä¸¤ä¸ª defer å·§å¦™çš„åŒºåˆ†äº†åˆ°åº•æ˜¯å‘ç”Ÿäº† panic è¿˜æ˜¯ç”¨æˆ·ä¸»åŠ¨è°ƒç”¨äº† runtime.Goexitï¼Œå…·ä½“ä¿¡æ¯è§https://golang.org/cl/134395\nfunc (g *Group) doCall(c *call, key string, fn func() (interface{}, error)) { // é¦–å…ˆè¿™ä¸¤ä¸ª bool ç”¨äºæ ‡è®°æ˜¯å¦æ­£å¸¸è¿”å›æˆ–è€…è§¦å‘äº† recover normalReturn := false recovered := false defer func() { // å¦‚æœæ—¢æ²¡æœ‰æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œåˆæ²¡æœ‰ recover é‚£å°±è¯´æ˜éœ€è¦ç›´æ¥é€€å‡ºäº† if !normalReturn \u0026amp;\u0026amp; !recovered { c.err = errGoexit } c.wg.Done() // è¿™é‡Œ done ä¹‹åå‰é¢çš„æ‰€æœ‰ wait éƒ½ä¼šè¿”å›äº† g.mu.Lock() defer g.mu.Unlock() // forgotten é»˜è®¤å€¼å°±æ˜¯ falseï¼Œæ‰€ä»¥é»˜è®¤å°±ä¼šè°ƒç”¨ delete ç§»é™¤æ‰ m ä¸­çš„ key if !c.forgotten { // ç„¶åè¿™é‡Œä¹Ÿå¾ˆå·§å¦™ï¼Œå‰é¢å…ˆè°ƒç”¨äº† doneï¼Œäºæ˜¯æ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚éƒ½è¿”å›äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªcä¹Ÿæ²¡æœ‰ç”¨äº†ï¼Œæ‰€ä»¥ç›´æ¥ delete æŠŠè¿™ä¸ª key åˆ æ‰ï¼Œè®©åç»­çš„è¯·æ±‚èƒ½å†æ¬¡è§¦å‘ doCallï¼Œè€Œä¸æ˜¯ç›´æ¥ä» m ä¸­è·å–ç»“æœè¿”å›ã€‚ delete(g.m, key) } if e, ok := c.err.(*panicError); ok { // å¦‚æœè¿”å›çš„æ˜¯ panic é”™è¯¯ï¼Œä¸ºäº†é¿å… channel æ­»é”ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿™ä¸ª panic æ— æ³•è¢«æ¢å¤ if len(c.chans) \u0026gt; 0 { go panic(e) select {} // Keep this goroutine around so that it will appear in the crash dump. } else { panic(e) } } else if c.err == errGoexit { // å¦‚æœæ˜¯exitErrorå°±ç›´æ¥é€€å‡º } else { // è¿™é‡Œå°±æ˜¯æ­£å¸¸é€»è¾‘äº†,å¾€ channel é‡Œå†™å…¥æ•°æ® for _, ch := range c.chans { ch \u0026lt;- Result{c.val, c.err, c.dups \u0026gt; 0} } } }() func() { // ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œä¿è¯ä¸‹é¢çš„ defer èƒ½åœ¨ä¸Šä¸€ä¸ªdeferä¹‹å‰æ‰§è¡Œ defer func() { // å¦‚æœä¸æ˜¯æ­£å¸¸é€€å‡ºé‚£è‚¯å®šæ˜¯ panic äº† if !normalReturn { // å¦‚æœ panic äº†æˆ‘ä»¬å°± recover æ‰ï¼Œç„¶å new ä¸€ä¸ª panic çš„é”™è¯¯åé¢åœ¨ä¸Šå±‚é‡æ–° panic if r := recover(); r != nil { c.err = newPanicError(r) } } }() c.val, c.err = fn() // å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„ fn æ­£å¸¸æ‰§è¡Œäº† normalReturn è‚¯å®šä¼šè¢«ä¿®æ”¹ä¸º true // æ‰€ä»¥ defer é‡Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è®°æ¥åˆ¤å®šæ˜¯å¦ panic äº† normalReturn = true }() // å¦‚æœ normalReturn ä¸º false å°±è¡¨ç¤ºï¼Œæˆ‘ä»¬çš„ fn panic äº† // å¦‚æœæ‰§è¡Œåˆ°äº†è¿™ä¸€æ­¥ï¼Œä¹Ÿè¯´æ˜æˆ‘ä»¬çš„ fn ä¹Ÿè¢« recover ä½äº†ï¼Œä¸æ˜¯ç›´æ¥ runtime exit if !normalReturn { recovered = true } } é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬åˆ†å¼€æ¥çœ‹ï¼Œç®€åŒ–åä»£ç å¦‚ä¸‹ï¼š\nfunc main() { defer func() { fmt.Println(\u0026#34;defer 1\u0026#34;) }() func() { defer func() { fmt.Println(\u0026#34;defer 2\u0026#34;) }() fmt.Println(\u0026#34;fn\u0026#34;) }() fmt.Println(\u0026#34;æ ¹æ® normalReturn æ ‡è®°ç»™ recover èµ‹å€¼\u0026#34;) } ç¬¬ä¸€ä¸ªç‚¹å°±æ˜¯åŒ¿åå‡½æ•°ï¼šä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œä¿è¯ defer 2 èƒ½åœ¨ä¸Šä¸€ä¸ª defer 1 ä¹‹å‰æ‰§è¡Œã€‚\nå› ä¸º defer 1é‡Œé¢éœ€è¦ç”¨åˆ° normalReturn æ ‡è®°ï¼Œè€Œè¿™ä¸ªæ ‡è®°åˆæ˜¯åœ¨ defer2 ä¸­ å¤„ç†çš„ã€‚åŒæ—¶ä¸ºäº†æ•è· fn é‡Œçš„ panic åˆå¿…é¡»ä½¿ç”¨ defer æ¥å¤„ç†ï¼Œæ‰€ä»¥ç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚\nGo ä¸­çš„ defer æ˜¯å…ˆè¿›åå‡ºçš„ï¼Œæ‰€ä»¥å¿…é¡»ç”¨ åŒ¿åå‡½æ•°ä¿è¯ defer2 å’Œ defer1 ä¸åœ¨ä¸€ä¸ª å‡½æ•°é‡Œï¼Œè¿™æ · defer 2å°±å¯ä»¥å…ˆæ‰§è¡Œäº†ã€‚\næ­£å¸¸æ‰§è¡Œé¡ºåºä¸º: fnâ€“\u0026gt;defer2â€“\u0026gt;æ ¹æ® normalReturn æ ‡è®°ç»™ recover èµ‹å€¼â€“\u0026gt;defer1\nç¬¬äºŒä¸ªå°±æ˜¯ç”¨åŒé‡ defer åŒºåˆ† panic å’Œ runtime.Goexitã€‚\nfn æ­£å¸¸æ‰§è¡Œåå°±ä¼šå°† normalReturn èµ‹å€¼ä¸º trueï¼Œç„¶å defer2 é‡Œæ ¹æ® normalReturn å€¼åˆ¤æ–­ fn æ˜¯å¦ panicï¼Œå¦‚æœ panic äº†å°±è¿›è¡Œ recover æ•è·æ‰è¿™ä¸ªpanicï¼Œç„¶åæŠŠerroræ›¿æ¢ä¸ºè‡ªå®šä¹‰çš„ panicErrorã€‚\nå¹¶ä¸”æ ¹æ® normalReturn çš„å€¼æ¥å¯¹ recovered æ ‡è®°è¿›è¡Œèµ‹å€¼ã€‚\næœ€åç¬¬ä¸€ä¸ª defer å°±å¯ä»¥æ ¹æ® normalReturn + recovered è¿™ä¸¤ä¸ªæ ‡è®°å’Œ err æ˜¯å¦ä¸º panicError æ¥åˆ¤æ–­æ˜¯ fn é‡Œå‘ç”Ÿäº† panic è¿˜æ˜¯è¯´è°ƒç”¨äº† runtime.Goexitã€‚\nç¬¬ä¸‰ä¸ªç‚¹å°±æ˜¯ map çš„ç§»é™¤ï¼š\nc.wg.Done() g.mu.Lock() defer g.mu.Unlock() if !c.forgotten { delete(g.m, key) } å…‰çœ‹è¿™é‡Œçœ‹ä¸å‡ºå…·ä½“ç»†èŠ‚ï¼Œéœ€è¦ç»“åˆå‰é¢ Do æ–¹æ³•ä¸­çš„è¿™æ®µé€»è¾‘\nif c, ok := g.m[key]; ok { c.dups++ g.mu.Unlock() c.wg.Wait() return c.val, c.err, true } é¦–å…ˆdoCall ä¸­è°ƒç”¨äº†c.wg.Done(),ç„¶å Do ä¸­çš„é˜»å¡åœ¨c.wg.Wait() è¿™é‡Œçš„å¤§é‡è¯·æ±‚å°±å…¨éƒ¨è¿”å›äº†ï¼Œç›´æ¥å°± return äº†ã€‚\nç„¶å doCall ä¸­å†è°ƒç”¨delete(g.m, key) æŠŠ key ä» m ä¸­ç§»é™¤æ‰ã€‚\né€šè¿‡è¿™ä¸ªdoneå·§å¦™çš„è®© Do ä¸­çš„waitè¿”å›åç›´æ¥æŠŠ key ç§»é™¤æ‰ï¼Œè¿™æ ·åç»­ä½¿ç”¨åŒæ · key çš„è¯·æ±‚åœ¨æ‰§è¡Œc, ok := g.m[key]åˆ¤æ–­æ—¶å°±ä¼šé‡æ–°è°ƒç”¨ doCall æ–¹æ³•ï¼Œå†æ‰§è¡Œä¸€æ¬¡ fn äº†ã€‚\nå¦‚æœä¸ç§»é™¤å°±ä¼šå¯¼è‡´åç»­è¯·æ±‚ç›´æ¥ä» m è¿™é‡Œå–åˆ°æ•°æ®è¿”å›äº†ï¼Œæ ¹æœ¬ä¸ä¼šæ‰§è¡Œ fn å»dbä¸­æŸ¥æœ€æ–°çš„æ•°æ®ï¼Œè€Œä¸” m ä¸­çš„æ•°æ®ä¹Ÿä¼šè¶Šå †ç§¯è¶Šå¤šã€‚\nDoChan å’Œ do å”¯ä¸€çš„åŒºåˆ«æ˜¯ go g.doCall(c, key, fn),ä½†å¯¹èµ·äº†ä¸€ä¸ª goroutine æ¥æ‰§è¡Œï¼Œå¹¶é€šè¿‡ channel æ¥è¿”å›æ•°æ®ï¼Œè¿™æ ·å¤–éƒ¨å¯ä»¥è‡ªå®šä¹‰è¶…æ—¶é€»è¾‘ï¼Œé˜²æ­¢å› ä¸º fn çš„é˜»å¡ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚éƒ½è¢«é˜»å¡ã€‚\nfunc (g *Group) DoChan(key string, fn func() (interface{}, error)) \u0026lt;-chan Result { ch := make(chan Result, 1) g.mu.Lock() if g.m == nil { g.m = make(map[string]*call) } if c, ok := g.m[key]; ok { c.dups++ c.chans = append(c.chans, ch) g.mu.Unlock() return ch } c := \u0026amp;call{chans: []chan\u0026lt;- Result{ch}} c.wg.Add(1) g.m[key] = c g.mu.Unlock() go g.doCall(c, key, fn) return ch } Forget æ‰‹åŠ¨ç§»é™¤æŸä¸ª keyï¼Œè®©åç»­è¯·æ±‚èƒ½èµ° doCall çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯ç›´æ¥é˜»å¡ã€‚\nfunc (g *Group) Forget(key string) { g.mu.Lock() if c, ok := g.m[key]; ok { c.forgotten = true } delete(g.m, key) g.mu.Unlock() } 4. æ³¨æ„äº‹é¡¹ 1. é˜»å¡ singleflight å†…éƒ¨ä½¿ç”¨ waitGroup æ¥è®©åŒä¸€ä¸ª key çš„é™¤äº†ç¬¬ä¸€ä¸ªè¯·æ±‚çš„åç»­æ‰€æœ‰è¯·æ±‚éƒ½é˜»å¡ã€‚ç›´åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œ fn è¿”å›åï¼Œå…¶ä»–è¯·æ±‚æ‰ä¼šè¿”å›ã€‚\nè¿™æ„å‘³ç€ï¼Œå¦‚æœ fn æ‰§è¡Œéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆåé¢çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«ä¸€ç›´é˜»å¡ã€‚\nè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DoChan ç»“åˆ ctx + select åšè¶…æ—¶æ§åˆ¶\nfunc loadChan(ctx context.Context,key string) (string, error) { data, err := loadFromCache(key) if err != nil \u0026amp;\u0026amp; err == ErrCacheMiss { // ä½¿ç”¨ DoChan ç»“åˆ select åšè¶…æ—¶æ§åˆ¶ result := g.DoChan(key, func() (interface{}, error) { data, err := loadFromDB(key) if err != nil { return nil, err } setCache(key, data) return data, nil }) select { case r := \u0026lt;-result: return r.Val.(string), r.Err case \u0026lt;-ctx.Done(): return \u0026#34;\u0026#34;, ctx.Err() } } return data, nil } 2. è¯·æ±‚å¤±è´¥ singleflight çš„å®ç°ä¸ºï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¯·æ±‚å¤±è´¥äº†ï¼Œé‚£ä¹ˆåç»­æ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚éƒ½ä¼šè¿”å›åŒä¸€ä¸ª errorã€‚\nå®é™…ä¸Šå¯ä»¥æ ¹æ®ä¸‹æ¸¸èƒ½æ”¯æ’‘çš„ rps å®šæ—¶ forget ä¸€ä¸‹ keyï¼Œè®©æ›´å¤šçš„è¯·æ±‚èƒ½æœ‰æœºä¼šèµ°åˆ°åç»­é€»è¾‘ã€‚\ngo func() { time.Sleep(100 * time.Millisecond) g.Forget(key) }() æ¯”å¦‚1ç§’å†…æœ‰100ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œæ­£å¸¸æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚èƒ½æ‰§è¡ŒqueryDBï¼Œåç»­99ä¸ªéƒ½ä¼šé˜»å¡ã€‚\nå¢åŠ è¿™ä¸ª Forget ä¹‹åï¼Œæ¯ 100ms å°±èƒ½æœ‰ä¸€ä¸ªè¯·æ±‚æ‰§è¡Œ queryDBï¼Œç›¸å½“äºæ˜¯å¤šäº†å‡ æ¬¡å°è¯•çš„æœºä¼šï¼Œç›¸å¯¹çš„ä¹Ÿç»™DBé€ æˆäº†æ›´å¤§çš„å‹åŠ›ï¼Œéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯è¿›å»å–èˆã€‚\n5. å‚è€ƒ https://www.lixueduan.com/posts/go/singleflight/\n","permalink":"https://www.iarno.cn/article/go-singleflight/","tags":[],"title":"golangé«˜å¹¶å‘singleflighté˜²ç¼“å­˜å‡»ç©¿"},{"categories":["Nginx"],"contents":"Nginxæ”¯æŒTLS1.3ï¼ŒåŠ0-RTTæµ‹è¯•ã€‚\nè½¯ä»¶ç‰ˆæœ¬ éœ€è¦å°†opensslç¼–è¯‘åˆ°nginxä¸­, nginx -Vå‘½ä»¤æŸ¥çœ‹ç¼–è¯‘ä¿¡æ¯ã€‚\nnginx/1.20.2\nopenssl-1.1.1w\nnginx.conf # ä¸ºé˜²æ­¢é‡æ”¾é™¤äº†GETã€HEADè¯·æ±‚å…¨éƒ½è¿”å›HTTPçŠ¶æ€ç 425(æµè§ˆå™¨ä¼šé»˜è®¤é‡å‘1æ¬¡è¯·æ±‚) map $ssl_early_data$request_method $early_data_non_idempotent { \u0026#34;1POST\u0026#34; 1; \u0026#34;1PUT\u0026#34; 1; \u0026#34;1DELETE\u0026#34; 1; \u0026#34;1PATCH\u0026#34; 1; \u0026#34;1OPTIONS\u0026#34; 0; \u0026#34;1GET\u0026#34; 0; \u0026#34;1HEAD\u0026#34; 0; default 0; } server { listen 443 ssl http2; server_name www.iarno.cn; server_tokens off; keepalive_timeout 5; ......çœç•¥ include /usr/local/nginx/conf/http/general/ssl.conf; ssl_certificate /usr/local/nginx/ssl/www.iarno.cn.crt; ssl_certificate_key /usr/local/nginx/ssl/www.iarno.cn.key; ......çœç•¥ access_log logs/https.log combinedio buffer=4k; error_log logs/https_error.log; location / { if ($early_data_non_idempotent) { return 425; # Non-idempotent operations return 425 Too Early } include /usr/local/nginx/conf/https_proxy.conf; ......çœç•¥ } } ssl.conf ssl_stapling on; ssl_session_tickets on; # æ˜¯å¦å¤ç”¨sesssion ticket, opensslå‘é€early dataæ•°æ®åæ¯æ¬¡ä¼šæ–°ç”Ÿæˆsession ssl_early_data on; # å¼€å‘early data (0-RTT) ssl_session_ticket_key /usr/local/nginx/conf/ssl_session_ticket.key; ssl_session_timeout 10m; # early_dataè¿‡æœŸæ—¶é—´ ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; ssl_ciphers \u0026#39;TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA\u0026#39;; ssl_prefer_server_ciphers on; https_proxy.conf proxy_set_header Connection \u0026#34;\u0026#34;; proxy_set_header Host $server_name; proxy_set_header Early-Data $ssl_early_data; # è®¾ç½®early dataæ ‡è¯† proxy_connect_timeout 5s; proxy_send_timeout 5s; proxy_read_timeout 5s; TLS1.3éªŒè¯ https://www.ssllabs.com/ssltest/analyze.html?d=www.taobao.com\u0026latest\nhttps://github.com/drwetter/testssl.sh\nâœ testssl.sh git:(3.2) âœ— ./testssl.sh -p www.taobao.com ########################################################### testssl.sh 3.2rc3 from https://testssl.sh/dev/ (1dbd9b8 2024-07-18 09:09:13) This program is free software. Distribution and modification under GPLv2 permitted. USAGE w/o ANY WARRANTY. USE IT AT YOUR OWN RISK! Please file bugs @ https://testssl.sh/bugs/ ########################################################### Using \u0026#34;OpenSSL 1.0.2-bad (1.0.2k-dev)\u0026#34; [~183 ciphers] xxxx:./bin/openssl.Darwin.x86_64 (built: \u0026#34;Sep 3 14:46:36 2022\u0026#34;, platform: \u0026#34;darwin64-x86_64-cc\u0026#34;) Testing all IPv4 addresses (port 443): 119.188.122.194 119.188.122.195 ----------------------------------------------------------------------------------------------- Start 2024-07-25 15:59:51 --\u0026gt;\u0026gt; 119.188.122.194:443 (www.taobao.com) \u0026lt;\u0026lt;-- Further IP addresses: 119.188.122.195 2408:8719:64:54:3::3da 2408:8719:64:54:3::3db rDNS (119.188.122.194): -- Service detected: HTTP Testing protocols via sockets except NPN+ALPN SSLv2 not offered (OK) SSLv3 not offered (OK) TLS 1 offered (deprecated) TLS 1.1 offered (deprecated) TLS 1.2 offered (OK) TLS 1.3 offered (OK): final NPN/SPDY h2, http/1.1 (advertised) ALPN/HTTP2 h2, http/1.1 (offered) Done 2024-07-25 15:59:59 [0014s] --\u0026gt;\u0026gt; 119.188.122.194:443 (www.taobao.com) \u0026lt;\u0026lt;-- ----------------------------------------------------------------------------------------------- Start 2024-07-25 15:59:59 --\u0026gt;\u0026gt; 119.188.122.195:443 (www.taobao.com) \u0026lt;\u0026lt;-- Further IP addresses: 119.188.122.194 2408:8719:64:54:3::3da 2408:8719:64:54:3::3db rDNS (119.188.122.195): -- Service detected: HTTP Testing protocols via sockets except NPN+ALPN SSLv2 not offered (OK) SSLv3 not offered (OK) TLS 1 offered (deprecated) TLS 1.1 offered (deprecated) TLS 1.2 offered (OK) TLS 1.3 offered (OK): final NPN/SPDY h2, http/1.1 (advertised) ALPN/HTTP2 h2, http/1.1 (offered) Done 2024-07-25 16:00:08 [0023s] --\u0026gt;\u0026gt; 119.188.122.195:443 (www.taobao.com) \u0026lt;\u0026lt;-- ----------------------------------------------------------------------------------------------- Done testing now all IP addresses (on port 443): 119.188.122.194 119.188.122.195 Early Data(0-RTT)éªŒè¯ openssléªŒè¯ # ç¬¬ä¸€æ­¥ âœ ~ openssl s_client -connect www.taobao.com:443 -tls1_3 -sess_out session.pem Connecting to 119.188.122.195 CONNECTED(00000006) depth=2 C=BE, O=GlobalSign nv-sa, OU=Root CA, CN=GlobalSign Root CA verify return:1 depth=1 C=BE, O=GlobalSign nv-sa, CN=GlobalSign Organization Validation CA - SHA256 - G3 verify return:1 depth=0 C=CN, ST=ZheJiang, L=HangZhou, O=Alibaba (China) Technology Co., Ltd., CN=*.tbcdn.cn verify return:1 --- Certificate chain 0 s:C=CN, ST=ZheJiang, L=HangZhou, O=Alibaba (China) Technology Co., Ltd., CN=*.tbcdn.cn i:C=BE, O=GlobalSign nv-sa, CN=GlobalSign Organization Validation CA - SHA256 - G3 a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256 v:NotBefore: Jun 19 09:06:02 2024 GMT; NotAfter: Jul 21 09:06:01 2025 GMT 1 s:C=BE, O=GlobalSign nv-sa, CN=GlobalSign Organization Validation CA - SHA256 - G3 i:C=BE, O=GlobalSign nv-sa, OU=Root CA, CN=GlobalSign Root CA a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256 v:NotBefore: Sep 4 00:00:00 2015 GMT; NotAfter: Sep 4 00:00:00 2025 GMT --- Server certificate -----BEGIN CERTIFICATE----- ......çœç•¥ -----END CERTIFICATE----- subject=C=CN, ST=ZheJiang, L=HangZhou, O=Alibaba (China) Technology Co., Ltd., CN=*.tbcdn.cn issuer=C=BE, O=GlobalSign nv-sa, CN=GlobalSign Organization Validation CA - SHA256 - G3 --- No client certificate CA names sent Peer signing digest: SHA256 Peer signature type: RSA-PSS Server Temp Key: X25519, 253 bits --- SSL handshake has read 4600 bytes and written 332 bytes Verification: OK --- New, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384 Server public key is 2048 bit This TLS version forbids renegotiation. Compression: NONE Expansion: NONE No ALPN negotiated Early data was not sent Verify return code: 0 (ok) --- --- Post-Handshake New Session Ticket arrived: SSL-Session: ......çœç•¥ Start Time: 1721893373 Timeout : 7200 (sec) Verify return code: 0 (ok) Extended master secret: no Max Early Data: 16384 --- read R BLOCK --- Post-Handshake New Session Ticket arrived: SSL-Session: ......çœç•¥ Start Time: 1721893373 Timeout : 7200 (sec) Verify return code: 0 (ok) Extended master secret: no Max Early Data: 16384 --- read R BLOCK closed # ç¬¬äºŒæ­¥ âœ ~ echo -e \u0026#34;GET / HTTP/1.1\\r\\nHost: www.taobao.com\\r\\n\\r\\n\u0026#34; \u0026gt; early_data.txt âœ ~ # ç¬¬ä¸‰æ­¥ âœ ~ openssl s_client -connect www.taobao.com:443 -tls1_3 -sess_in session.pem -early_data early_data.txt Connecting to 119.188.122.194 CONNECTED(00000006) --- Server certificate -----BEGIN CERTIFICATE----- ......çœç•¥ -----END CERTIFICATE----- subject=C=CN, ST=ZheJiang, L=HangZhou, O=Alibaba (China) Technology Co., Ltd., CN=*.tbcdn.cn issuer=C=BE, O=GlobalSign nv-sa, CN=GlobalSign Organization Validation CA - SHA256 - G3 --- No client certificate CA names sent Server Temp Key: X25519, 253 bits --- SSL handshake has read 249 bytes and written 728 bytes Verification: OK --- Reused, TLSv1.3, Cipher is TLS_AES_256_GCM_SHA384 Server public key is 2048 bit This TLS version forbids renegotiation. Compression: NONE Expansion: NONE No ALPN negotiated Early data was accepted Verify return code: 0 (ok) --- HTTP/1.1 200 OK Server: Tengine Content-Type: text/html; charset=utf-8 Transfer-Encoding: chunked Connection: keep-alive Date: Thu, 25 Jul 2024 07:44:31 GMT x-server-id: 28c3d6b2523ca52c32ad72931842b19a621c8cdfdfbcaabcd5562acb7211986218860f5b9ea54579 x-air-hostname: air-ual033043202123.center.na610 x-air-trace-id: 7b06169817218934709936299e Cache-Control: max-age=0, s-maxage=118 x-node: 9c0775731c8445d0bdf09cefd3e4bbf3 x-eagleeye-id: 7b06169817218934709936299e x-retmsg: ok x-content-type: text/html; charset=utf-8 streaming-parser: open x-retcode: SUCCESS x-readtime: 178 x-via: cn5026.l1, cache13.cn5026, l2nu16-1.l2, cache21.l2nu16-1, wormholesource033102016177.center.na610 x-air-source: proxy x-xss-protection: 1; mode=block Strict-Transport-Security: max-age=31536000 Ups-Target-Key: air-ual.vipserver X-protocol: HTTP/1.1 EagleEye-TraceId: 7b06169817218934709936299e s-brt: 181 Via: cache21.l2nu16-1[212,162,304-0,C], cache14.l2nu16-1[167,0], cache4.cn6806[0,0,200-0,H], cache20.cn6806[1,0] Vary: Accept-Encoding Vary: Ali-Detector-Type, X-Host, Accept-Encoding, Origin etag: W/\u0026#34;bf15d-yE/eVpg40kEzpV7XQBu+BBmxaWc\u0026#34; Age: 54 Ali-Swift-Global-Savetime: 1721893471 X-Cache: HIT TCP_MEM_HIT dirn:-2:-2 X-Swift-SaveTime: Thu, 25 Jul 2024 07:44:31 GMT X-Swift-CacheTime: 118 x-air-pt: pt0 Timing-Allow-Origin: * EagleId: 77bc7a9917218935251046825e 7a84 ......... é¡µé¢æºä»£ç  0 --- Post-Handshake New Session Ticket arrived: # å¦‚æœnginxé…ç½®ssl_session_tickets=offæ‰ä¼šæœ‰æ¬¡å†…å®¹ï¼Œæ¯æ¬¡ä¼šæ–°ç”Ÿæˆsession SSL-Session: ......çœç•¥ Start Time: 1721893527 Timeout : 7200 (sec) Verify return code: 0 (ok) Extended master secret: no Max Early Data: 16384 --- read R BLOCK C097125AF87F0000:error:0A000126:SSL routines::unexpected eof while reading:ssl/record/rec_layer_s3.c:692: Chromeæµè§ˆå™¨éªŒè¯ chrome://flags/\nå¼€å¯TLS1.3 Early Dataï¼Œé»˜è®¤ä¸ºå…³é—­çŠ¶æ€ã€‚\nä¿®æ”¹nginxæ—¥å¿—æ ¼å¼\nlog_format combinedio \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#39; \u0026#39;\u0026#34;$request\u0026#34; $status $body_bytes_sent \u0026#39; \u0026#39;\u0026#34;$http_referer\u0026#34; \u0026#34;$http_user_agent\u0026#34; $request_length $request_time $upstream_response_time $ssl_early_data\u0026#39;; # $ssl_early_data è®¿é—®æ—¥å¿—æ–°å¢early dataæ ‡è¯† å‚è€ƒ https://blog.csdn.net/SkyChaserYu/article/details/105840504\nhttps://www.cnblogs.com/wusanga/p/17386098.html\nhttps://imququ.com/post/enable-tls-1-3.html\n","permalink":"https://www.iarno.cn/article/nginx-tls1.3/","tags":[],"title":"nginxæ”¯æŒTLS1.3åè®®"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨cURLå·¥å…·è·å–è¯·æ±‚å’Œå“åº”æ—¶é—´ã€‚é¦–å…ˆï¼Œå®ƒè§£é‡Šäº†cURLè¾“å‡ºçš„å„ä¸ªæ—¶é—´å‚æ•°çš„å«ä¹‰ï¼ŒåŒ…æ‹¬DNSè§£ææ—¶é—´ã€TCPè¿æ¥å»ºç«‹æ—¶é—´ã€ä¸Šå±‚åè®®è¿æ¥æ—¶é—´ã€è¯·æ±‚å¼€å§‹åˆ°å“åº”å¼€å§‹çš„æ—¶é—´ã€è¯·æ±‚å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼ è¾“çš„æ—¶é—´ï¼Œä»¥åŠæ•´ä¸ªè¯·æ±‚çš„æ€»æ—¶é—´ã€‚ç„¶åï¼Œæ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨cURLè¿›è¡Œè¯·æ±‚ï¼ŒåŒ…æ‹¬åˆ›å»ºä¸€ä¸ªæ ¼å¼åŒ–çš„è¾“å‡ºæ–‡ä»¶ï¼Œä»¥åŠå¦‚ä½•å‘èµ·è¯·æ±‚ã€‚æœ€åï¼Œå®ƒè§£é‡Šäº†è¯·æ±‚å‘½ä»¤ä¸­çš„å„ä¸ªå‚æ•°çš„ä½œç”¨ã€‚\nä¸€ã€æ–‡æœ¬è¾“å‡ºç¤ºä¾‹ time_namelookup: 0.001s time_connect: 0.037s time_appconnect: 0.000s time_pretransfer: 0.037s time_redirect: 0.000s time_starttransfer: 0.092s ---------- time_total: 0.164s time_namelookupï¼šDNSåŸŸåè§£æçš„æ—¶é—´ï¼Œå°±æ˜¯æŠŠhttps://ianro.cnè½¬æ¢æˆipåœ°å€çš„è¿‡ç¨‹ time_connectï¼šTCP è¿æ¥å»ºç«‹çš„æ—¶é—´ï¼Œå°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶é—´ time_appconnectï¼šSSL/SSHç­‰ä¸Šå±‚åè®®å»ºç«‹è¿æ¥çš„æ—¶é—´ï¼Œæ¯”å¦‚ connect/handshake çš„æ—¶é—´ time_pretransferï¼šä»è¯·æ±‚å¼€å§‹åˆ°å“åº”å¼€å§‹ä¼ è¾“çš„æ—¶é—´ time_starttransferï¼šä»è¯·æ±‚å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å°†è¦ä¼ è¾“çš„æ—¶é—´ time_totalï¼šè¿™æ¬¡è¯·æ±‚èŠ±è´¹çš„å…¨éƒ¨æ—¶é—´ äºŒã€ä½¿ç”¨ 2.1 åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶curl-format.txtï¼Œ ç²˜è´´ä¸‹é¢å†…å®¹ time_namelookup: %{time_namelookup}s\\n time_connect: %{time_connect}s\\n time_appconnect: %{time_appconnect}s\\n time_pretransfer: %{time_pretransfer}s\\n time_redirect: %{time_redirect}s\\n time_starttransfer: %{time_starttransfer}s\\n ----------\\n time_total: %{time_total}s\\n 2.2 å‘èµ·è¯·æ±‚ curl -w \u0026#34;@curl-format.txt\u0026#34; -o /dev/null -s \u0026#34;http://iarno.cn/\u0026#34; -w \u0026quot;@curl-format.txt\u0026quot; é€šçŸ¥cURLä½¿ç”¨æ ¼å¼åŒ–çš„è¾“å‡ºæ–‡ä»¶ -o /dev/null å°†è¯·æ±‚çš„è¾“å‡ºé‡å®šå‘åˆ°/dev/null -s é€šçŸ¥cURLä¸æ˜¾ç¤ºè¿›åº¦æ¡ \u0026quot;https://iarno.cn/\u0026quot; æ˜¯æˆ‘ä»¬è¯·æ±‚çš„URLï¼Œè¯·ä½¿ç”¨å¼•å·åŒ…å›´ï¼ˆå°¤å…¶å½“ä½ çš„URLåŒ…å«\u0026amp;æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ ä¸‰ã€å‚è€ƒ https://cloud.tencent.com/developer/article/1919554\n","permalink":"https://www.iarno.cn/article/curl/","tags":[],"title":"ä½¿ç”¨cURLè·å¾—è¯·æ±‚å’Œå“åº”æ—¶é—´"},{"categories":["Mysql"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Golangæ•°æ®åº“è¿æ¥æ± çš„å››ä¸ªå‚æ•°ï¼šmaxOpenConnsã€maxIdleConnsã€maxIdleTimeã€maxLifeTimeçš„è®¾ç½®å’Œä½¿ç”¨ã€‚å…¶ä¸­ï¼ŒmaxOpenConnsæ˜¯è¿æ¥æ± æœ€å¤šåŒæ—¶æ‰“å¼€çš„è¿æ¥æ•°ï¼ŒmaxIdleConnsæ˜¯è¿æ¥æ± é‡Œæœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼ŒmaxIdleTimeæ˜¯è¿æ¥æ± é‡Œé¢çš„è¿æ¥æœ€å¤§ç©ºé—²æ—¶é•¿ï¼ŒmaxLifeTimeæ˜¯è¿æ¥æ± é‡Œé¢çš„è¿æ¥æœ€å¤§å­˜æ´»æ—¶é•¿ã€‚æ–‡ç« è¿˜è¯¦ç»†è§£é‡Šäº†è¿™äº›å‚æ•°çš„è®¾ç½®åŸåˆ™å’Œæ³¨æ„äº‹é¡¹ã€‚\nSetMaxOpenConns(maxOpenConns) è¿æ¥æ± æœ€å¤šåŒæ—¶æ‰“å¼€çš„è¿æ¥æ•°ã€‚\nè¿™ä¸ªmaxOpenConnsç†åº”è¦è®¾ç½®å¾—æ¯”mysqlæœåŠ¡å™¨çš„max_connectionså€¼è¦å°ã€‚\nä¸€èˆ¬è®¾ç½®ä¸ºï¼š æœåŠ¡å™¨cpuæ ¸å¿ƒæ•° * 2 + æœåŠ¡å™¨æœ‰æ•ˆç£ç›˜æ•°ã€‚å‚è€ƒè¿™é‡Œ\nå¯ç”¨show variables like \u0026lsquo;max_connections\u0026rsquo;; æŸ¥çœ‹æœåŠ¡å™¨å½“å‰è®¾ç½®çš„æœ€å¤§è¿æ¥æ•°ã€‚\nSetMaxIdleConns(maxIdleConns) è¿æ¥æ± é‡Œæœ€å¤§ç©ºé—²è¿æ¥æ•°ã€‚å¿…é¡»è¦æ¯”maxOpenConnså°ï¼›\nSetConnMaxIdleTime(maxIdleTime) è¿æ¥æ± é‡Œé¢çš„è¿æ¥æœ€å¤§ç©ºé—²æ—¶é•¿ã€‚\nå½“è¿æ¥æŒç»­ç©ºé—²æ—¶é•¿è¾¾åˆ°maxIdleTimeåï¼Œè¯¥è¿æ¥å°±ä¼šè¢«å…³é—­å¹¶ä»è¿æ¥æ± ç§»é™¤ï¼Œå“ªæ€•å½“å‰ç©ºé—²è¿æ¥æ•°å·²ç»å°äºSetMaxIdleConns(maxIdleConns)è®¾ç½®çš„å€¼ã€‚\nè¿æ¥æ¯æ¬¡è¢«ä½¿ç”¨åï¼ŒæŒç»­ç©ºé—²æ—¶é•¿ä¼šè¢«é‡ç½®ï¼Œä»0å¼€å§‹ä»æ–°è®¡ç®—ï¼›\nç”¨show processlist; å¯ç”¨æŸ¥çœ‹mysqlæœåŠ¡å™¨ä¸Šçš„è¿æ¥ä¿¡æ¯ï¼ŒCommandè¡¨ç¤ºè¿æ¥çš„å½“å‰çŠ¶æ€ï¼ŒCommandä¸ºSleepæ—¶è¡¨ç¤ºä¼‘çœ ã€ç©ºé—²çŠ¶æ€ï¼ŒTimeè¡¨ç¤ºæ­¤çŠ¶æ€çš„å·²æŒç»­æ—¶é•¿ï¼›\nSetConnMaxLifetime(maxLifeTime) è¿æ¥æ± é‡Œé¢çš„è¿æ¥æœ€å¤§å­˜æ´»æ—¶é•¿ã€‚\nmaxLifeTimeå¿…é¡»è¦æ¯”mysqlæœåŠ¡å™¨è®¾ç½®çš„wait_timeoutå°ï¼Œå¦åˆ™ä¼šå¯¼è‡´golangä¾§è¿æ¥æ± ä¾ç„¶ä¿ç•™å·²è¢«mysqlæœåŠ¡å™¨å…³é—­äº†çš„è¿æ¥ã€‚\nmysqlæœåŠ¡å™¨çš„wait_timeouté»˜è®¤æ˜¯8 hourï¼Œå¯é€šè¿‡show variables like \u0026lsquo;wait_timeout\u0026rsquo;æŸ¥çœ‹ã€‚\nè½¬è½½ https://www.cnblogs.com/gitfong/p/13722204.html\n","permalink":"https://www.iarno.cn/article/golang%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE/","tags":[],"title":"golangæ•°æ®åº“è¿æ¥æ± å‚æ•°è®¾ç½®"},{"categories":["å…¶ä»–"],"contents":"Stable Diffusionæ˜¯ä¸€ä¸ªæ–‡æœ¬åˆ°å›¾åƒçš„æ½œåœ¨æ‰©æ•£æ¨¡å‹ï¼Œç”±CompVisã€Stability AIå’ŒLAIONçš„ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆåˆ›å»ºã€‚å®ƒä½¿ç”¨æ¥è‡ªLAION-5Bæ•°æ®åº“å­é›†çš„512x512å›¾åƒè¿›è¡Œè®­ç»ƒã€‚ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œå¯ä»¥ç”ŸæˆåŒ…æ‹¬äººè„¸åœ¨å†…çš„ä»»ä½•å›¾åƒï¼Œå› ä¸ºæœ‰å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œå®ƒã€‚\nä¸€ã€æœ¬åœ°å®‰è£… Tip: Python ç‰ˆæœ¬ä¸º 3.10.6\ngit clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git cd stable-diffusion-webui/ # è¯·åˆ‡æ¢Python venv, é­”æ³•ä¸Šç½‘, ä¸‹è½½æ—¶é—´æ¯”è¾ƒé•¿ git config --global http.proxy http://127.0.0.1:10887 pip install --upgrade pip export http_proxy=http://127.0.0.1:10887;export https_proxy=http://127.0.0.1:10887; sh ./webui.sh äºŒã€å®‰è£…æŠ¥é”™æ±‡æ€» 2.1 å®‰è£…gfpganæŠ¥é”™ Installing gfpgan Traceback (most recent call last): File \u0026#34;/Users/iarno/Devspace/chatgpt/stable-diffusion-webui/launch.py\u0026#34;, line 355, in \u0026lt;module\u0026gt; prepare_environment() File \u0026#34;/Users/iarno/Devspace/chatgpt/stable-diffusion-webui/launch.py\u0026#34;, line 263, in prepare_environment run_pip(f\u0026#34;install {gfpgan_package}\u0026#34;, \u0026#34;gfpgan\u0026#34;) File \u0026#34;/Users/iarno/Devspace/chatgpt/stable-diffusion-webui/launch.py\u0026#34;, line 129, in run_pip return run(f\u0026#39;\u0026#34;{python}\u0026#34; -m pip {args} --prefer-binary{index_url_line}\u0026#39;, desc=f\u0026#34;Installing {desc}\u0026#34;, errdesc=f\u0026#34;Couldn\u0026#39;t install {desc}\u0026#34;) File \u0026#34;/Users/iarno/Devspace/chatgpt/stable-diffusion-webui/launch.py\u0026#34;, line 97, in run raise RuntimeError(message) RuntimeError: Couldn\u0026#39;t install gfpgan. Command: \u0026#34;/Users/iarno/Devspace/chatgpt/stable-diffusion-webui/venv/bin/python3.10\u0026#34; -m pip install git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379 --prefer-binary Error code: 2 stdout: Collecting git+https://github.com/TencentARC/GFPGAN.git@8d2447a2d918f8eba5a4a01463fd48e45126a379 Cloning https://github.com/TencentARC/GFPGAN.git (to revision 8d2447a2d918f8eba5a4a01463fd48e45126a379) to /private/var/folders/qw/4fkzpn79447fkgjgk19pq_6h0000gn/T/pip-req-build-0i1rio01 stderr: Running command git clone --filter=blob:none --quiet https://github.com/TencentARC/GFPGAN.git /private/var/folders/qw/4fkzpn79447fkgjgk19pq_6h0000gn/T/pip-req-build-0i1rio01 Running command git rev-parse -q --verify \u0026#39;sha^8d2447a2d918f8eba5a4a01463fd48e45126a379\u0026#39; Running command git fetch -q https://github.com/TencentARC/GFPGAN.git 8d2447a2d918f8eba5a4a01463fd48e45126a379 Running command git checkout -q 8d2447a2d918f8eba5a4a01463fd48e45126a379 è§£å†³æ–¹æ¡ˆ:\ngit config --global http.proxy http://127.0.0.1:10887 2.2 æœªä¸‹è½½æ¨¡å‹å¯¼è‡´æœåŠ¡æ— æ³•è¿è¡Œ No checkpoints found. When searching for checkpoints, looked at: - file /Users/liuli/Devspace/chatgpt/stable-diffusion-webui/model.ckpt - directory /Users/liuli/Devspace/chatgpt/stable-diffusion-webui/models/Stable-diffusion Can\u0026#39;t run without a checkpoint. Find and place a .ckpt or .safetensors file into any of those locations. The program will exit. è§£å†³æ–¹æ¡ˆ:\nä¸‹è½½æ¨¡å‹, å¹¶å°†ä¸‹è½½çš„æ¨¡å‹æ”¾åˆ° stable-diffusion-webui/models/Stable-diffusion ç›®å½•ä¸­ã€‚\nä¸‰ã€ä½¿ç”¨Colabæ­å»º Colab å…è´¹æ—¶é•¿ä¸º12å°æ—¶\næœ¬åœ°æ¨¡å‹ç”Ÿæˆå›¾ç‰‡ä¼šå—é™äºğŸ’»é…ç½®é—®é¢˜, æ¨èä½¿ç”¨è°·æ­Œå…è´¹ Colab æœåŠ¡æ­å»º, é¿å…å¤šæ¬¡ä¸‹è½½ Model æ¨¡å‹, å¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‚è½½è°·æ­Œäº‘ç›˜çš„æ–¹å¼(æå‰å°†ä¸‹è½½å¥½çš„Modelä¸Šä¼ è‡³è°·æ­Œäº‘ç›˜)ã€‚\n3.1 å®‰è£…æ•™ç¨‹: http://xhslink.com/6lTt8o\n3.2 ä¿®æ”¹é¡¹ æŒ‚è½½äº‘ç›˜:\næ‹·è´äº‘ç›˜æ¨¡å‹:\nå››ã€å‚è€ƒ https://github.com/AUTOMATIC1111/stable-diffusion-webui.git\nhttps://github.com/camenduru/stable-diffusion-webui-colab.git\nhttp://xhslink.com/6lTt8o\nhttps://www.bilibili.com/video/BV1vX4y1k7d4?vd_source=59a19d02212b7e9ac600f7c97d180b9d\nhttps://www.bilibili.com/video/BV1fL411U77A?vd_source=59a19d02212b7e9ac600f7c97d180b9d\n","permalink":"https://www.iarno.cn/article/stable-diffusion/","tags":["stable diffusion"],"title":"stable diffusion webui å®‰è£…"},{"categories":["Linux"],"contents":"Apache APISIX æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šä¸‹çš„äº‘åŸç”Ÿ API ç½‘å…³ï¼Œå®ƒå…¼å…·åŠ¨æ€ã€å®æ—¶ã€é«˜æ€§èƒ½ç­‰ç‰¹ç‚¹ï¼Œæä¾›äº†è´Ÿè½½å‡è¡¡ã€åŠ¨æ€ä¸Šæ¸¸ã€ç°åº¦å‘å¸ƒï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰ã€æœåŠ¡ç†”æ–­ã€èº«ä»½è®¤è¯ã€å¯è§‚æµ‹æ€§ç­‰ä¸°å¯Œçš„æµé‡ç®¡ç†åŠŸèƒ½ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Apache APISIX æ¥å¤„ç†ä¼ ç»Ÿçš„å—åŒ—å‘æµé‡ï¼Œä¹Ÿå¯ä»¥å¤„ç†æœåŠ¡é—´çš„ä¸œè¥¿å‘æµé‡ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ”¯æŒä½œä¸º K8s Ingress Controller æ¥ä½¿ç”¨ã€‚\nä¸€ã€å®‰è£… 1.1 å®‰è£…APISIX å¦‚æœå½“å‰ç³»ç»Ÿæ²¡æœ‰å®‰è£… OpenRestyï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… OpenResty å’Œ APISIX ä»“åº“ï¼š\nsudo yum install -y https://repos.apiseven.com/packages/centos/apache-apisix-repo-1.0-1.noarch.rpm å¦‚æœå·²å®‰è£… OpenResty çš„å®˜æ–¹ RPM ä»“åº“ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… APISIX çš„ RPM ä»“åº“ï¼š\nsudo yum-config-manager --add-repo https://repos.apiseven.com/packages/centos/apache-apisix.repo å®Œæˆä¸Šè¿°æ“ä½œåä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… APISIXï¼š\nsudo yum install apisix ä½ ä¹Ÿå¯ä»¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ APISIXï¼ˆæœ¬ç¤ºä¾‹ä¸º APISIX v2.13.1 LTS ç‰ˆæœ¬ï¼‰ï¼š\nsudo yum install apisix-2.13.1 1.2 å®‰è£…apisix-dashboard sudo yum install -y https://github.com/apache/apisix-dashboard/releases/download/v2.13/apisix-dashboard-2.13-0.el7.x86_64.rpm 1.3 å®‰è£…etcd https://juejin.cn/post/7217053578711040057\näºŒã€ä¿®æ”¹é…ç½® 2.1 ä¿®æ”¹APISIXé…ç½® APISIX çš„é»˜è®¤é…ç½®å¯ä»¥åœ¨ ./conf/config-default.yaml æ–‡ä»¶ä¸­çœ‹åˆ°ï¼Œè¯¥æ–‡ä»¶ä¸ APISIX æºç å¼ºç»‘å®šï¼Œè¯·ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ ./conf/config-default.yaml æ–‡ä»¶ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰ä»»ä½•é…ç½®ï¼Œéƒ½åº”åœ¨ ./conf/config.yaml æ–‡ä»¶ä¸­å®Œæˆã€‚\nè¯·ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ APISIX å®‰è£…ç›®å½•ä¸‹çš„ ./conf/nginx.conf æ–‡ä»¶ã€‚å½“ APISIX å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ® config.yaml çš„é…ç½®è‡ªåŠ¨ç”Ÿæˆæ–°çš„ nginx.conf å¹¶è‡ªåŠ¨å¯åŠ¨æœåŠ¡ã€‚\né€šè¿‡ä¿®æ”¹æœ¬åœ° /usr/local/apisix/conf/config.yaml æ–‡ä»¶ï¼Œæˆ–è€…åœ¨å¯åŠ¨ APISIX æ—¶ä½¿ç”¨ -c æˆ– --config æ·»åŠ æ–‡ä»¶è·¯å¾„å‚æ•° apisix start -c \u0026lt;path string\u0026gt;ï¼Œå®Œæˆå¯¹ APISIX æœåŠ¡æœ¬èº«çš„åŸºæœ¬é…ç½®ã€‚\næ¯”å¦‚å°† APISIX é»˜è®¤ç›‘å¬ç«¯å£ä¿®æ”¹ä¸º 8000ï¼Œå…¶ä»–é…ç½®ä¿æŒé»˜è®¤ï¼Œåœ¨ /usr/local/apisix/conf/config.yaml ä¸­åªéœ€è¿™æ ·é…ç½®ï¼š\napisix: node_listen: 8000 # APISIX listening port æ¯”å¦‚æŒ‡å®š APISIX é»˜è®¤ç›‘å¬ç«¯å£ä¸º 8000ï¼Œå¹¶ä¸”è®¾ç½® etcd åœ°å€ï¼Œå…¶ä»–é…ç½®ä¿æŒé»˜è®¤ã€‚åœ¨ /usr/local/apisix/conf/config.yaml ä¸­åªéœ€è¿™æ ·é…ç½®ï¼š\napisix: node_listen: 8000 # APISIX listening port deployment: role: traditional role_traditional: config_provider: etcd etcd: host: - \u0026#34;http://172.16.63.131:2379\u0026#34; - \u0026#34;http://172.16.63.132:2379\u0026#34; - \u0026#34;http://172.16.63.133:2379\u0026#34; 2.2 ä¿®æ”¹apisix-dashboardé…ç½® é…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º/usr/local/apisix/dashboard/conf/conf.yaml\nallow_list: # If we don\u0026#39;t set any IP list, then any IP access is allowed by default. #- 127.0.0.1 # å…è®¸æ‰€æœ‰ipè®¿é—® # It also support CIDR like 192.168.1.0/24 and 2001:0db8::/32 # é…ç½®etcd etcd: endpoints: # supports defining multiple etcd host addresses for an etcd cluster - 172.16.63.131:2379 - 172.16.63.132:2379 - 172.16.63.133:2379 ä¸‰ã€å¯åŠ¨æœåŠ¡ 3.1 å¯åŠ¨APISIXæœåŠ¡ APISIX å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ– NGINX é…ç½®æ–‡ä»¶å’Œ etcdï¼š\napisix init ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ APISIXï¼š\napisix start ä½ å¯ä»¥è¿è¡Œ apisix help å‘½ä»¤ï¼Œé€šè¿‡æŸ¥çœ‹è¿”å›ç»“æœï¼Œè·å–å…¶ä»–æ“ä½œçš„å‘½ä»¤åŠæè¿°ã€‚\nå¦‚æœä½ æ˜¯é€šè¿‡ RPM åŒ…å®‰è£… APISIXï¼Œé…ç½®æ–‡ä»¶å·²ç»è‡ªåŠ¨å®‰è£…ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\nsystemctl start apisix systemctl stop apisix å¦‚æœä½ æ˜¯é€šè¿‡å…¶ä»–æ–¹æ³•å®‰è£…çš„ APISIXï¼Œå¯ä»¥å‚è€ƒé…ç½®æ–‡ä»¶æ¨¡æ¿è¿›è¡Œä¿®æ”¹ï¼Œå¹¶å°†å…¶æ·»åŠ åœ¨ /usr/lib/systemd/system/apisix.service è·¯å¾„ä¸‹ã€‚\n3.2 å¯åŠ¨apisix-dashboardæœåŠ¡ sudo manager-api -p /usr/local/apisix/dashboard/ # æˆ–è€…ä»¥æœåŠ¡è¿è¡Œ systemctl start apisix-dashboard 3.3 supervisordç®¡ç†ç›¸å…³è¿›ç¨‹ [root@localhost supervisord]# cat /etc/supervisord.d/apisix.ini [program:apisix] command=systemctl start apisix [root@localhost supervisord]# cat /etc/supervisord.d/apisix-dashboard.ini [program:apisix-dashboard] command=systemctl start apisix-dashboard å››ã€ç½‘å…³æ–°å¢è·¯ç”± åå°ç®¡ç†ç•Œé¢api-dashboardç«¯å£é»˜è®¤ä¸º :9000ï¼Œè´¦å·å¯†ç é»˜è®¤ä¸ºadmin\näº”ã€è®¿é—®ç½‘å…³é…ç½®è·¯ç”± åå°ç®¡ç†ç•Œé¢apisixç«¯å£é»˜è®¤ä¸º :9080, å¦‚å½“å‰ç¤ºä¾‹å·²å°†ç«¯å£è®¾ç½®ä¸º:8000\nhttp://172.16.63.131:8000/anything/foo?arg=10\n{ \u0026#34;args\u0026#34;: { \u0026#34;arg\u0026#34;: \u0026#34;10\u0026#34; }, \u0026#34;data\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;files\u0026#34;: {}, \u0026#34;form\u0026#34;: {}, \u0026#34;headers\u0026#34;: { \u0026#34;Accept\u0026#34;: \u0026#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\u0026#34;, \u0026#34;Accept-Encoding\u0026#34;: \u0026#34;gzip, deflate\u0026#34;, \u0026#34;Accept-Language\u0026#34;: \u0026#34;zh-CN,zh;q=0.9,en;q=0.8\u0026#34;, \u0026#34;Host\u0026#34;: \u0026#34;172.16.63.131\u0026#34;, \u0026#34;Upgrade-Insecure-Requests\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;User-Agent\u0026#34;: \u0026#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36\u0026#34;, \u0026#34;X-Amzn-Trace-Id\u0026#34;: \u0026#34;Root=1-64297d93-27c7dc195ca76af57c83f9fb\u0026#34;, \u0026#34;X-Forwarded-Host\u0026#34;: \u0026#34;172.16.63.131\u0026#34; }, \u0026#34;json\u0026#34;: null, \u0026#34;method\u0026#34;: \u0026#34;GET\u0026#34;, \u0026#34;origin\u0026#34;: \u0026#34;172.16.63.1, 114.253.193.20\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;http://172.16.63.131/anything/foo?arg=10\u0026#34; } å…­ã€å‚è€ƒ https://apisix.apache.org/zh/docs/apisix/installation-guide/\nhttps://www.cnblogs.com/zx-admin/p/16446720.html\n","permalink":"https://www.iarno.cn/article/apisix/","tags":["APISIX"],"title":"centosæ­å»ºapisixç½‘å…³"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨CentOSç³»ç»Ÿä¸Šæ­å»ºetcdé›†ç¾¤ã€‚é¦–å…ˆï¼Œæ–‡ç« è¯¦ç»†è§£é‡Šäº†etcdçš„ç‰¹ç‚¹å’Œç›¸å…³æ¦‚å¿µã€‚ç„¶åï¼Œæ–‡ç« é€šè¿‡å®ä¾‹è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…etcdï¼ŒåŒ…æ‹¬åˆå§‹åŒ–èŠ‚ç‚¹å’Œæ–°å¢èŠ‚ç‚¹ã€‚æœ€åï¼Œæ–‡ç« è¿˜ä»‹ç»äº†å¦‚ä½•ç§»é™¤èŠ‚ç‚¹ã€‚æ–‡ç« çš„å†…å®¹è¯¦ç»†ä¸”å®ç”¨ï¼Œå¯¹äºéœ€è¦åœ¨CentOSç³»ç»Ÿä¸Šæ­å»ºetcdé›†ç¾¤çš„è¯»è€…æ¥è¯´éå¸¸æœ‰å¸®åŠ©ã€‚\netcdåŸºäºRaftä¸€è‡´æ€§ç®—æ³•å®ç°äº†æ•°æ®çš„é«˜å¯ç”¨å’Œå¼ºä¸€è‡´æ€§ï¼Œå¯ä»¥æ”¯æŒæ•°åƒå°æœºå™¨çš„é›†ç¾¤ã€‚é€šè¿‡å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­å¹¶å¼‚æ­¥æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼ŒEtcdåœ¨æ€§èƒ½å’Œæ•°æ®å¯é æ€§ä¹‹é—´å–å¾—äº†å¾ˆå¥½çš„å¹³è¡¡ã€‚\netcdè¢«å¹¿æ³›ç”¨äºKubernetesä¸­çš„æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ï¼Œä¾‹å¦‚å­˜å‚¨Podçš„çŠ¶æ€ã€æ§åˆ¶å™¨çš„é…ç½®ç­‰ã€‚\nä¸€ã€etcdçš„ç‰¹ç‚¹ åˆ†å¸ƒå¼ï¼šEtcdé‡‡ç”¨åˆ†å¸ƒå¼çš„æ¶æ„ï¼Œæ”¯æŒå¤šå°æœºå™¨æ„æˆçš„é›†ç¾¤ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è¯»å†™æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¼šå¤åˆ¶æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œä»¥ä¿è¯æ•°æ®çš„å¯é æ€§å’Œä¸€è‡´æ€§ã€‚ é«˜å¯ç”¨æ€§ï¼šEtcdé‡‡ç”¨Raftä¸€è‡´æ€§ç®—æ³•æ¥å®ç°æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œå¼ºä¸€è‡´æ€§ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šè‡ªåŠ¨æ¥ç®¡è¯¥èŠ‚ç‚¹çš„å·¥ä½œï¼Œä¿è¯æ•°æ®çš„å¯ç”¨æ€§å’ŒæœåŠ¡çš„è¿ç»­æ€§ã€‚ å¼ºä¸€è‡´æ€§ï¼šEtcdä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œå³ä»»ä½•æ—¶å€™ï¼Œä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¯»å–åˆ°çš„æ•°æ®éƒ½æ˜¯æœ€æ–°çš„ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒEtcdä¼šä¿è¯æ‰€æœ‰èŠ‚ç‚¹éƒ½æˆåŠŸå†™å…¥æ•°æ®åæ‰è¿”å›æˆåŠŸç»“æœï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ é«˜æ€§èƒ½ï¼šEtcdé‡‡ç”¨äº†å†…å­˜å­˜å‚¨å’Œå¼‚æ­¥æŒä¹…åŒ–çš„æ–¹å¼ï¼Œä»¥ä¿è¯è¯»å†™æ“ä½œçš„é«˜æ€§èƒ½ã€‚åŒæ—¶ï¼ŒEtcdè¿˜æä¾›äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„HTTP APIï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®è¯»å†™å’Œç›‘æ§ã€‚ ç®€å•æ˜“ç”¨ï¼šEtcdæä¾›äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„APIï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®è¯»å†™å’Œç›‘æ§ã€‚åŒæ—¶ï¼ŒEtcdè¿˜æä¾›äº†å‘½ä»¤è¡Œå·¥å…·å’Œå›¾å½¢åŒ–ç®¡ç†ç•Œé¢ï¼Œä»¥æ–¹ä¾¿ç”¨æˆ·è¿›è¡Œé›†ç¾¤çš„ç®¡ç†å’Œç»´æŠ¤ã€‚ å®‰å…¨æ€§ï¼šEtcdæ”¯æŒTLSåŠ å¯†å’Œèº«ä»½è®¤è¯ï¼Œä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚åŒæ—¶ï¼ŒEtcdè¿˜æä¾›äº†è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œå¯ä»¥æ§åˆ¶ä¸åŒç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯¹æ•°æ®çš„è®¿é—®æƒé™ã€‚ äºŒã€æ¦‚å¿µæœ¯è¯­ Memberï¼š ä¸€ä¸ªetcdå®ä¾‹ã€‚å®ƒç®¡ç†ç€ä¸€ä¸ªNodeï¼Œå¹¶ä¸”å¯ä»¥ä¸ºå®¢æˆ·ç«¯è¯·æ±‚æä¾›æœåŠ¡ã€‚\nPeerï¼š å¯¹åŒä¸€ä¸ªetcdé›†ç¾¤ä¸­å¦å¤–ä¸€ä¸ªMemberçš„ç§°å‘¼ã€‚\nClientï¼š å‘etcdé›†ç¾¤å‘é€HTTPè¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚\nWALï¼š é¢„å†™å¼æ—¥å¿—ï¼Œetcdç”¨äºæŒä¹…åŒ–å­˜å‚¨çš„æ—¥å¿—æ ¼å¼ã€‚\nLeaderï¼š Raftç®—æ³•ä¸­é€šè¿‡ç«é€‰è€Œäº§ç”Ÿçš„å¤„ç†æ‰€æœ‰æ•°æ®æäº¤çš„èŠ‚ç‚¹ã€‚\nFollowerï¼š ç«é€‰å¤±è´¥çš„èŠ‚ç‚¹ä½œä¸ºRaftä¸­çš„ä»å±èŠ‚ç‚¹ï¼Œä¸ºç®—æ³•æä¾›å¼ºä¸€è‡´æ€§ä¿è¯ã€‚\nCandidateï¼š å½“Followerè¶…è¿‡ä¸€å®šæ—¶é—´æ¥æ”¶ä¸åˆ°Leaderçš„å¿ƒè·³æ—¶è½¬å˜ä¸ºCandidateå¼€å§‹ç«é€‰ã€‚\nTermï¼š æŸä¸ªèŠ‚ç‚¹æˆä¸ºLeaderåˆ°ä¸‹ä¸€æ¬¡ç«é€‰æ—¶é—´ï¼Œç§°ä¸ºä¸€ä¸ªTermã€‚\nä¸‰ã€é›†ç¾¤å®‰è£…éƒ¨ç½² etcdç‰ˆæœ¬ä¸º3.5.4, æœ¬ç¤ºä¾‹ä½¿ç”¨çš„äºŒè¿›åˆ¶å®‰è£…ã€‚\netcd name IPåœ°å€ èŠ‚ç‚¹è¯´æ˜ etcdç‰ˆæœ¬ etcd-node-1 172.16.63.131 åˆå§‹åŒ–èŠ‚ç‚¹ 3.5.4 etcd-node-2 172.16.63.132 åˆå§‹åŒ–èŠ‚ç‚¹ 3.5.4 etcd-node-3 172.16.63.133 æ–°å¢èŠ‚ç‚¹ 3.5.4 3.1 é›†ç¾¤å®‰è£… 3ä¸ªèŠ‚ç‚¹å®‰è£…etcd\nETCD_VERSION=\u0026#39;3.5.4\u0026#39; wget https://github.com/etcd-io/etcd/releases/download/v${ETCD_VERSION}/etcd-v${ETCD_VERSION}-linux-amd64.tar.gz tar -xvf etcd-v${ETCD_VERSION}-linux-amd64.tar.gz \u0026amp;\u0026amp; \\ cd etcd-v${ETCD_VERSION}-linux-amd64 \u0026amp;\u0026amp; \\ sudo cp -a etcd etcdctl /usr/bin/ 3.2 å‚æ•°è¯´æ˜ etcdå¯ä»¥æŒ‡å®šconfigé…ç½®æ–‡ä»¶å¯åŠ¨æœåŠ¡, ä¹Ÿå¯ä»¥å‚æ•°å½¢å¼å¯åŠ¨, å…¶ä»–å‚æ•°å…·ä½“è¯´æ˜ç•¥ã€‚\n[root@localhost iarno]# etcd --help Usage: ...... etcd --config-file # configé…ç½®æ–‡ä»¶åœ°å€ jsonæ–‡ä»¶ Path to the server configuration file. Note that if a configuration file is provided, other command line flags and environment variables will be ignored. ......çœç•¥ Member: # æœ¬èŠ‚ç‚¹etcdä¿¡æ¯ --name \u0026#39;default\u0026#39; # åç§° Human-readable name for this member. --data-dir \u0026#39;${name}.etcd\u0026#39; # æ•°æ®å­˜æ”¾è·¯å¾„ Path to the data directory. --listen-peer-urls \u0026#39;http://localhost:2380\u0026#39; # è¯¥èŠ‚ç‚¹æ¥å—å…¶ä»–èŠ‚ç‚¹è¿æ¥çš„åœ°å€, å¯ç†è§£ä¸ºæœ¬æœºä¼šå¯åŠ¨ä¸€ä¸ª2380ç«¯å£æœåŠ¡ List of URLs to listen on for peer traffic. --listen-client-urls \u0026#39;http://localhost:2379\u0026#39; # etcdå®¢æˆ·ç«¯åœ°å€, å¯ç†è§£ä¸ºæœ¬æœºä¼šå¯åŠ¨ä¸€ä¸ª2379ç«¯å£æœåŠ¡ List of URLs to listen on for client traffic. ......çœç•¥ Clustering: # é›†ç¾¤ --initial-advertise-peer-urls \u0026#39;http://localhost:2380\u0026#39; # æŒ‡å®šè¯¥èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­ä½œä¸ºPeerèŠ‚ç‚¹æ—¶ï¼Œç”¨äºå¹¿æ’­å®£ä¼ è‡ªå·±çš„URLåœ°å€ List of this member\u0026#39;s peer URLs to advertise to the rest of the cluster. --initial-cluster \u0026#39;default=http://localhost:2380\u0026#39; # ç”¨äºæŒ‡å®šEtcdé›†ç¾¤çš„æˆå‘˜ã€‚æ¯ä¸ªæˆå‘˜ç”±ä¸€ä¸ª\u0026lt;name\u0026gt;=\u0026lt;url\u0026gt;çš„é”®å€¼å¯¹è¡¨ç¤ºï¼Œå…¶ä¸­\u0026lt;name\u0026gt;æ˜¯æˆå‘˜çš„åç§°ï¼Œ\u0026lt;url\u0026gt;æ˜¯æˆå‘˜çš„Peer URLåœ°å€ã€‚ Initial cluster configuration for bootstrapping. --initial-cluster-state \u0026#39;new\u0026#39; # åˆå§‹é›†ç¾¤çŠ¶æ€, existingåæœŸæ–°åŠ èŠ‚ç‚¹éœ€è¦ Initial cluster state (\u0026#39;new\u0026#39; or \u0026#39;existing\u0026#39;). --initial-cluster-token \u0026#39;etcd-cluster\u0026#39; # é›†ç¾¤åˆå§‹token Initial cluster token for the etcd cluster during bootstrap. Specifying this can protect you from unintended cross-cluster interaction when running multiple clusters. --advertise-client-urls \u0026#39;http://localhost:2379\u0026#39; # ç”¨äºæŒ‡å®šEtcdé›†ç¾¤çš„å®¢æˆ·ç«¯æ¥å…¥åœ°å€ List of this member\u0026#39;s client URLs to advertise to the public. The client URLs advertised should be accessible to machines that talk to etcd cluster. etcd client libraries parse these URLs to connect to the cluster. ......çœç•¥ 3.3 æœåŠ¡å¯åŠ¨ å¦‚æœå¯åŠ¨å‚æ•°listen-client-urlsæœªåŠ 127.0.0.1:2379, ä¹‹åæ‰§è¡Œetcdctlå‘½ä»¤æŸ¥çœ‹é›†ç¾¤ç›¸å…³ä¿¡æ¯å¿…é¡»æºå¸¦ --endpoints=${HOST_1}:2379,${HOST_2}:2379 å‚æ•°, å¦åˆ™å‘½ä»¤ä¼šæŠ¥é”™ã€‚\netcd-node-1\nTOKEN=my-etcd-token-1 CLUSTER_STATE=new NAME_1=etcd-node-1 NAME_2=etcd-node-2 HOST_1=172.16.63.131 HOST_2=172.16.63.132 CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380 # For node 1 THIS_NAME=${NAME_1} THIS_IP=${HOST_1} nohup etcd --data-dir=data.etcd --name ${THIS_NAME} \\ --initial-advertise-peer-urls http://${THIS_IP}:2380 \\ --listen-peer-urls http://${THIS_IP}:2380 \\ --advertise-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --listen-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --initial-cluster ${CLUSTER} \\ --initial-cluster-state ${CLUSTER_STATE} \\ --initial-cluster-token ${TOKEN}\u0026amp; etcd-node-2\nTOKEN=my-etcd-token-1 CLUSTER_STATE=new NAME_1=etcd-node-1 NAME_2=etcd-node-2 HOST_1=172.16.63.131 HOST_2=172.16.63.132 CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380 # For node 2 THIS_NAME=${NAME_2} THIS_IP=${HOST_2} nohup etcd --data-dir=data.etcd --name ${THIS_NAME} \\ --initial-advertise-peer-urls http://${THIS_IP}:2380 \\ --listen-peer-urls http://${THIS_IP}:2380 \\ --advertise-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --listen-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --initial-cluster ${CLUSTER} \\ --initial-cluster-state ${CLUSTER_STATE} \\ --initial-cluster-token ${TOKEN}\u0026amp; 3.4 æŸ¥çœ‹memberä¿¡æ¯ startedè¯´æ˜èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸ã€‚\n[root@localhost etcd-v3.5.4-linux-amd64]# etcdctl member list -w table +------------------+---------+-------------+---------------------------+-------------------------------------------------+------------+ | ID | STATUS | NAME | PEER ADDRS | CLIENT ADDRS | IS LEARNER | +------------------+---------+-------------+---------------------------+-------------------------------------------------+------------+ | 2da4f3ecb804e704 | started | etcd-node-2 | http://172.16.63.132:2380 | http://127.0.0.1:2379,http://172.16.63.132:2379 | false | | 8f3d892540699071 | started | etcd-node-1 | http://172.16.63.131:2380 | http://127.0.0.1:2379,http://172.16.63.131:2379 | false | +------------------+---------+-------------+---------------------------+-------------------------------------------------+------------+ 3.5 ç®€å•å†™å…¥æ•°æ®æµ‹è¯• æ³¨: etcdç‰ˆæœ¬ä¸å…¼å®¹, æ­¤ç‰ˆæœ¬ä½¿ç”¨putå†™å…¥æ•°æ®ã€‚\n# etcd-node-1 [root@localhost etcd-v3.5.4-linux-amd64]# etcdctl put greeting \u0026#34;Hello, etcd\u0026#34; OK # etcd-node-2 [root@localhost etcd-v3.5.4-linux-amd64]# etcdctl get greeting greeting Hello, etcd 3.6 æ–°å¢èŠ‚ç‚¹ # åœ¨ etcd-node-1 æˆ– etcd-node-2 èŠ‚ç‚¹ä¸Šæ‰§è¡Œæ­¤å‘½ä»¤ NAME_1=etcd-node-1 NAME_2=etcd-node-2 NAME_3=etcd-node-3 HOST_1=172.16.63.131 HOST_2=172.16.63.132 HOST_3=172.16.63.133 # new member etcdctl --endpoints=${HOST_1}:2379,${HOST_2}:2379 \\ member add ${NAME_4} \\ --peer-urls=http://${HOST_3}:2380 3.7 æ–°èŠ‚ç‚¹å¯åŠ¨æœåŠ¡ æ³¨æ„ï¼ŒCLUSTER_STATE ä¸º existing\netcd-node-3\nTOKEN=my-etcd-token-1 CLUSTER_STATE=existing NAME_1=etcd-node-1 NAME_2=etcd-node-2 NAME_3=etcd-node-3 HOST_1=172.16.63.131 HOST_2=172.16.63.132 HOST_3=172.16.63.133 CLUSTER=${NAME_1}=http://${HOST_1}:2380,${NAME_2}=http://${HOST_2}:2380,${NAME_3}=http://${HOST_3}:2380 THIS_NAME=${NAME_3} THIS_IP=${HOST_3} nohup etcd --data-dir=data.etcd --name ${THIS_NAME} \\ --initial-advertise-peer-urls http://${THIS_IP}:2380 \\ --listen-peer-urls http://${THIS_IP}:2380 \\ --advertise-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --listen-client-urls http://127.0.0.1:2379,http://${THIS_IP}:2379 \\ --initial-cluster ${CLUSTER} \\ --initial-cluster-state ${CLUSTER_STATE} \\ --initial-cluster-token ${TOKEN}\u0026amp; 3.8 ç§»é™¤èŠ‚ç‚¹ etcdctl member remove ${MEMBER_ID} å››ã€å‚è€ƒ https://etcd.io/docs/v3.5/tutorials/how-to-deal-with-membership/\nhttps://juejin.cn/post/6844904031186321416\n","permalink":"https://www.iarno.cn/article/etcd/","tags":["APISIX"],"title":"centosæ­å»ºetcdé›†ç¾¤"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è¿°äº†Ginæ¡†æ¶ä¸­çš„å‚æ•°ç»‘å®šåŠŸèƒ½ï¼ŒåŒ…æ‹¬Bindå’ŒShouldBindçš„åŒºåˆ«ä»¥åŠä½¿ç”¨æ–¹æ³•ã€‚Bindåœ¨å‡ºé”™æ—¶ä¼šè¿”å›400çŠ¶æ€ç ï¼Œè€ŒShouldBindåˆ™å…è®¸ç”¨æˆ·è‡ªå®šä¹‰é”™è¯¯ç ã€‚æ–‡ç« è¿˜è¯¦ç»†ä»‹ç»äº†ShouldBindå’ŒShouldBindJSONçš„ä½¿ç”¨åœºæ™¯ï¼Œå‰è€…ä¸»è¦ç”¨äºéGETè¯·æ±‚çš„jsonå‚æ•°ç»‘å®šï¼Œåè€…åˆ™ä¸“é—¨ç”¨äºjsonå‚æ•°çš„ç»‘å®šã€‚\ntype params struct { Total int `form:\u0026#34;total\u0026#34; json:\u0026#34;total\u0026#34; binding:\u0026#34;omitempty,numeric\u0026#34;` } Bindå’ŒShouldBind åŒºåˆ« åŒºåˆ«å°±æ˜¯Bindxxxä¼šçš„è¿”å›400httpçŠ¶æ€ç é”™è¯¯ï¼Œè€ŒShouldxxxä¸ä¼šç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰é”™è¯¯ç ã€‚\nShouldBind ç»‘å®šä¸æ˜¯GETè¯·æ±‚çš„ json å‚æ•°ï¼Œä½†å¯ä»¥ç»‘å®šæˆåŠŸPOSTè¯·æ±‚çš„ json å‚æ•°ã€‚\nShouldBindJSON ç»‘å®š json å‚æ•°ã€‚\n","permalink":"https://www.iarno.cn/article/gin-should-binding/","tags":null,"title":"gin Bind å‚æ•°ç»‘å®š"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†åœ¨Golangä¸­ä½¿ç”¨çš„å„ç§ç»‘å®šæ ‡ç­¾ã€‚åŒ…æ‹¬ä½†ä¸é™äºrequiredã€uniqueã€omitemptyç­‰ï¼Œæ¯ä¸ªæ ‡ç­¾éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹ã€‚è¿™äº›æ ‡ç­¾åœ¨ä½¿ç”¨Ginæ¡†æ¶è¿›è¡Œæ•°æ®éªŒè¯æ—¶éå¸¸æœ‰ç”¨ã€‚æ–‡ç« è¿˜æä¾›äº†ä¸€ä¸ªé“¾æ¥ï¼Œä¾›è¯»è€…è¿›ä¸€æ­¥äº†è§£å’Œå­¦ä¹ è¿™äº›æ ‡ç­¾çš„ä½¿ç”¨ã€‚\næ ‡è®° æ ‡è®°è¯´æ˜ ä¾‹ required å¿…å¡« Fieldæˆ–Struct validate:\u0026quot;required\u0026quot; unique ä¿è¯å”¯ä¸€æ€§,ä¸åŒç±»å‹å¤„ç†ä¸åŒ; å¯¹äºmapï¼Œuniqueçº¦æŸæ²¡æœ‰é‡å¤çš„valueå€¼ï¼› å¯¹äºæ•°ç»„å’Œåˆ‡ç‰‡ï¼Œæ²¡æœ‰é‡å¤çš„å…ƒç´ å€¼ Field validate:\u0026quot;unique\u0026quot; omitempty ç©ºæ—¶å¿½ç•¥ Fieldæˆ–Struct validate:\u0026quot;omitempty\u0026quot; len é•¿åº¦ Field validate:\u0026quot;len=0\u0026quot; eq ç­‰äº Field validate:\u0026quot;eq=0\u0026quot; gt å¤§äº Field validate:\u0026quot;gt=0\u0026quot; gte å¤§äºç­‰äº Field validate:\u0026quot;gte=0\u0026quot; lt å°äº Field validate:\u0026quot;lt=0\u0026quot; lte å°äºç­‰äº Field validate:\u0026quot;lte=0\u0026quot; eqfield åŒä¸€ç»“æ„ä½“å­—æ®µç›¸ç­‰ Field validate:\u0026quot;eqfield=Field2\u0026quot; nefield åŒä¸€ç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰ Field validate:\u0026quot;nefield=Field2\u0026quot; gtfield å¤§äºåŒä¸€ç»“æ„ä½“å­—æ®µ Field validate:\u0026quot;gtfield=Field2\u0026quot; gtefield å¤§äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ Field validate:\u0026quot;gtefield=Field2\u0026quot; ltfield å°äºåŒä¸€ç»“æ„ä½“å­—æ®µ Field validate:\u0026quot;ltfield=Field2\u0026quot; ltefield å°äºç­‰äºåŒä¸€ç»“æ„ä½“å­—æ®µ Field validate:\u0026quot;ltefield=Field2\u0026quot; eqcsfield è·¨ä¸åŒç»“æ„ä½“å­—æ®µç›¸ç­‰ Struct1.Field validate:\u0026quot;eqcsfield=Struct2.Field2\u0026quot; necsfield è·¨ä¸åŒç»“æ„ä½“å­—æ®µä¸ç›¸ç­‰ Struct1.Field validate:\u0026quot;necsfield=Struct2.Field2\u0026quot; gtcsfield å¤§äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ Struct1.Field validate:\u0026quot;gtcsfield=Struct2.Field2\u0026quot; gtecsfield å¤§äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ Struct1.Field validate:\u0026quot;gtecsfield=Struct2.Field2\u0026quot; ltcsfield å°äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ Struct1.Field validate:\u0026quot;ltcsfield=Struct2.Field2\u0026quot; ltecsfield å°äºç­‰äºè·¨ä¸åŒç»“æ„ä½“å­—æ®µ Struct1.Field validate:\u0026quot;ltecsfield=Struct2.Field2\u0026quot; min æœ€å¤§å€¼ Field validate:\u0026quot;min=1\u0026quot; max æœ€å°å€¼ Field validate:\u0026quot;max=2\u0026quot; structonly ä»…éªŒè¯ç»“æ„ä½“ï¼Œä¸éªŒè¯ä»»ä½•ç»“æ„ä½“å­—æ®µ Struct validate:\u0026quot;structonly\u0026quot; nostructlevel ä¸è¿è¡Œä»»ä½•ç»“æ„çº§åˆ«çš„éªŒè¯ Struct validate:\u0026quot;nostructlevel\u0026quot; dive å‘ä¸‹å»¶ä¼¸éªŒè¯ï¼Œå¤šå±‚å‘ä¸‹éœ€è¦å¤šä¸ªdiveæ ‡è®° string validate:\u0026quot;gt=0,dive,len=1,dive,required\u0026quot; dive Keys \u0026amp; EndKeys ä¸diveåŒæ—¶ä½¿ç”¨ï¼Œç”¨äºå¯¹mapå¯¹è±¡çš„é”®çš„å’Œå€¼çš„éªŒè¯ï¼Œkeysä¸ºé”®ï¼Œendkeysä¸ºå€¼ map[string]string `validate:â€gt=0,dive,keys,eq=1 required_with å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º Field validate:\u0026quot;required_with=Field1 Field2\u0026quot; required_with_all å…¶ä»–æ‰€æœ‰å­—æ®µä¸ä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º Field validate:\u0026quot;required_with_all=Field1 Field2\u0026quot; required_without å…¶ä»–å­—æ®µå…¶ä¸­ä¸€ä¸ªä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º Field `validate:â€required_without=Field1 Field2â€ required_without_all å…¶ä»–æ‰€æœ‰å­—æ®µä¸ºç©ºä¸”å½“å‰å­—æ®µä¸ä¸ºç©º Field validate:\u0026quot;required_without_all=Field1 Field2\u0026quot; isdefault æ˜¯é»˜è®¤å€¼ Field validate:\u0026quot;isdefault=0\u0026quot; oneof å…¶ä¸­ä¹‹ä¸€ Field validate:\u0026quot;oneof=5 7 9\u0026quot; containsfield å­—æ®µåŒ…å«å¦ä¸€ä¸ªå­—æ®µ Field validate:\u0026quot;containsfield=Field2\u0026quot; excludesfield å­—æ®µä¸åŒ…å«å¦ä¸€ä¸ªå­—æ®µ Field validate:\u0026quot;excludesfield=Field2\u0026quot; unique æ˜¯å¦å”¯ä¸€ï¼Œé€šå¸¸ç”¨äºåˆ‡ç‰‡æˆ–ç»“æ„ä½“ Field validate:\u0026quot;unique\u0026quot; alphanum å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å« ASCII å­—æ¯æ•°å­—å­—ç¬¦ Field validate:\u0026quot;alphanum\u0026quot; alphaunicode å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å« unicode å­—ç¬¦ Field validate:\u0026quot;alphaunicode\u0026quot; alphanumunicode å­—ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å« unicode å­—æ¯æ•°å­—å­—ç¬¦ Field validate:\u0026quot;alphanumunicode\u0026quot; numeric å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«åŸºæœ¬çš„æ•°å€¼ Field validate:\u0026quot;numeric\u0026quot; hexadecimal å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶ Field validate:\u0026quot;hexadecimal\u0026quot; hexcolor å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶é¢œè‰² Field validate:\u0026quot;hexcolor\u0026quot; lowercase ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å°å†™å­—ç¬¦ Field validate:\u0026quot;lowercase\u0026quot; uppercase ç¬¦ä¸²å€¼æ˜¯å¦åªåŒ…å«å¤§å†™å­—ç¬¦ Field validate:\u0026quot;uppercase\u0026quot; email å­—ç¬¦ä¸²å€¼åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ä»¶ Field validate:\u0026quot;email\u0026quot; json å­—ç¬¦ä¸²å€¼æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ JSON Field validate:\u0026quot;json\u0026quot; file ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„ï¼Œä»¥åŠè¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºè®¡ç®—æœºä¸Š Field validate:\u0026quot;file\u0026quot; url ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ url Field validate:\u0026quot;url\u0026quot; uri ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ uri Field validate:\u0026quot;uri\u0026quot; base64 å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ base64å€¼ Field validate:\u0026quot;base64\u0026quot; contains å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼ Field validate:\u0026quot;contains=@\u0026quot; containsany å­—ç¬¦ä¸²å€¼åŒ…å«å­å­—ç¬¦ä¸²å€¼ä¸­çš„ä»»ä½•å­—ç¬¦ Field validate:\u0026quot;containsany=abc\u0026quot; containsrune å­—ç¬¦ä¸²å€¼åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼ Field validate:\u0026quot;containsrune=â˜¢\u0026quot; excludes å­—ç¬¦ä¸²å€¼ä¸åŒ…å«å­å­—ç¬¦ä¸²å€¼ Field validate:\u0026quot;excludes=@\u0026quot; excludesall å­—ç¬¦ä¸²å€¼ä¸åŒ…å«ä»»ä½•å­å­—ç¬¦ä¸²å€¼ Field validate:\u0026quot;excludesall=abc\u0026quot; excludesrune å­—ç¬¦ä¸²å€¼ä¸åŒ…å«æä¾›çš„ç‰¹æ®Šç¬¦å·å€¼ Field validate:\u0026quot;containsrune=â˜¢\u0026quot; startswith å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼å¼€å§‹ Field validate:\u0026quot;startswith=abc\u0026quot; endswith å­—ç¬¦ä¸²ä»¥æä¾›çš„å­—ç¬¦ä¸²å€¼ç»“æŸ Field validate:\u0026quot;endswith=abc\u0026quot; ip å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ IP åœ°å€ Field validate:\u0026quot;ip\u0026quot; ipv4 å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ ipv4åœ°å€ Field validate:\u0026quot;ipv4\u0026quot; datetime å­—ç¬¦ä¸²å€¼æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ æ—¥æœŸ Field validate:\u0026quot;datetime\u0026quot; å‚è€ƒ https://pkg.go.dev/github.com/go-playground/validator/v10#section-readme\n","permalink":"https://www.iarno.cn/article/binding-tag/","tags":null,"title":"gin binding tag"},{"categories":["Mysql"],"contents":"è¿™ç¯‡æ–‡ç« è¯¦ç»†è§£é‡Šäº†MySQLä¸­çš„joinã€inner joinã€left joinå’Œright joinçš„ç”¨æ³•ã€‚é€šè¿‡å®ä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸¤å¼ è¡¨ä¹‹é—´è¿›è¡Œæœ‰æ•ˆè¿æ¥ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å·¦è¿æ¥å’Œå³è¿æ¥æ¥å¤„ç†ä¸å­˜åœ¨çš„æ•°æ®ã€‚æ–‡ç« è¿˜åŒ…å«äº†ä¸€äº›å®ç”¨çš„MySQLå‘½ä»¤å’ŒæŸ¥è¯¢ç»“æœï¼Œä»¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£è¿™äº›æ¦‚å¿µã€‚\njoin \u0026amp; inner join ç†è§£ä¸ºâ€œæœ‰æ•ˆè¿æ¥â€ï¼Œä¸¤å¼ è¡¨ä¸­éƒ½æœ‰çš„æ•°æ®æ‰ä¼šæ˜¾ç¤ºã€‚\nMySQL [test_join]\u0026gt; show tables; +---------------------+ | Tables_in_test_join | +---------------------+ | table_A | | table_B | +---------------------+ 2 rows in set (0.00 sec) MySQL [test_join]\u0026gt; select * from table_A; +----+--------+ | id | a_name | +----+--------+ | 1 | aaa | | 2 | bbb | | 3 | ccc | +----+--------+ 3 rows in set (0.00 sec) MySQL [test_join]\u0026gt; select * from table_B; +----+-------------------------+--------+ | id | aid (table_Aè¡¨ä¸­çš„ä¸»é”®id) | b_name | +----+-------------------------+--------+ | 1 | 1 | 111 | | 2 | 1 | 222 | | 3 | 2 | 333 | | 4 | 1 | 444 | +----+-------------------------+--------+ 4 rows in set (0.00 sec) MySQL [test_join]\u0026gt; select * from table_A A join table_B B on A.id = B.aid; +----+--------+----+------+--------+ | id | a_name | id | aid | b_name | +----+--------+----+------+--------+ | 1 | aaa | 1 | 1 | 111 | | 1 | aaa | 2 | 1 | 222 | | 2 | bbb | 3 | 2 | 333 | | 1 | aaa | 4 | 1 | 444 | +----+--------+----+------+--------+ 4 rows in set (0.01 sec) MySQL [test_join]\u0026gt; select * from table_A A inner join table_B B on A.id = B.aid; +----+--------+----+------+--------+ | id | a_name | id | aid | b_name | +----+--------+----+------+--------+ | 1 | aaa | 1 | 1 | 111 | | 1 | aaa | 2 | 1 | 222 | | 2 | bbb | 3 | 2 | 333 | | 1 | aaa | 4 | 1 | 444 | +----+--------+----+------+--------+ 4 rows in set (0.01 sec) left join ä»¥å·¦è¡¨ä¸ºä¸», å‡ºå·¦è¡¨å…¨éƒ¨æ•°æ®, å³è¡¨ä¸å­˜åœ¨æ•°æ® null è¡¥å…¨ã€‚\nMySQL [test_join]\u0026gt; select * from table_A A left join table_B B on A.id = B.aid; +----+--------+------+------+--------+ | id | a_name | id | aid | b_name | +----+--------+------+------+--------+ | 1 | aaa | 1 | 1 | 111 | | 1 | aaa | 2 | 1 | 222 | | 2 | bbb | 3 | 2 | 333 | | 1 | aaa | 4 | 1 | 444 | | 3 | ccc | NULL | NULL | NULL | +----+--------+------+------+--------+ 5 rows in set (0.00 sec) right join ä»¥å³è¡¨ä¸ºä¸», å‡ºå³è¡¨å…¨éƒ¨æ•°æ®, å·¦è¡¨ä¸å­˜åœ¨æ•°æ® null è¡¥å…¨ã€‚\nMySQL [test_join]\u0026gt; select * from table_B B right join table_A A on B.aid = A.id; +------+------+--------+----+--------+ | id | aid | b_name | id | a_name | +------+------+--------+----+--------+ | 1 | 1 | 111 | 1 | aaa | | 2 | 1 | 222 | 1 | aaa | | 3 | 2 | 333 | 2 | bbb | | 4 | 1 | 444 | 1 | aaa | | NULL | NULL | NULL | 3 | ccc | +------+------+--------+----+--------+ 5 rows in set (0.01 sec) å‚è€ƒ https://zhuanlan.zhihu.com/p/85856388\n","permalink":"https://www.iarno.cn/article/mysql-join/","tags":null,"title":"mysql joinã€inner joinã€left join ã€right join è¯¦è§£"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Goè¯­è¨€è¿æ¥MySQLæ•°æ®åº“å¹¶å¯¼å‡ºCSVæ–‡ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨sql.Openå‡½æ•°è¿æ¥åˆ°æ•°æ®åº“ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨db.Queryå‡½æ•°æŸ¥è¯¢ç”¨æˆ·æ•°æ®ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†æŸ¥è¯¢ç»“æœæ·»åŠ åˆ°ä¸€ä¸ªäºŒç»´å­—ç¬¦ä¸²æ•°ç»„ä¸­ï¼Œå‡†å¤‡å†™å…¥CSVæ–‡ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨WriteCsvå‡½æ•°å°†æ•°æ®å†™å…¥CSVæ–‡ä»¶ã€‚è¿™ä¸ªå‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨csv.NewWriteråˆ›å»ºä¸€ä¸ªæ–°çš„CSV writerï¼Œæœ€åå°†æ•°æ®å†™å…¥æ–‡ä»¶å¹¶åˆ·æ–°writerã€‚\npackage main import ( \u0026#34;database/sql\u0026#34; \u0026#34;encoding/csv\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; _ \u0026#34;github.com/go-sql-driver/mysql\u0026#34; ) func main() { // è¿æ¥æ•°æ®åº“ db, err := sql.Open(\u0026#34;mysql\u0026#34;, \u0026#34;username:password@tcp(host:3306)/æ•°æ®åº“å?charset=utf8mb4\u0026amp;parseTime=True\u0026#34;) if err != nil { log.Printf(\u0026#34;open mysql failed: %v\u0026#34;, err) return } defer db.Close() rows, err := db.Query(\u0026#34;select id, name, email from user\u0026#34;) if err != nil { log.Printf(\u0026#34;query failed: %v\u0026#34;, err) return } var csvData [][]string csvData = append(csvData, []string{\u0026#34;ç”¨æˆ·ID\u0026#34;, \u0026#34;ç”¨æˆ·å\u0026#34;, \u0026#34;é‚®ç®±\u0026#34;}) for rows.Next() { var userID string var name string var email string if err := rows.Scan(\u0026amp;userID, \u0026amp;name, \u0026amp;email); err != nil { log.Printf(\u0026#34;scan failed: %v\u0026#34;, err) return } // ä¿®æ”¹æ•°æ®åº“ // if _, err := db.Exec(\u0026#34;UPDATE user SET name=? where id=?\u0026#34;, \u0026#34;test\u0026#34;, userID); err != nil { //\tlog.Printf(\u0026#34;exec failed: %v, id=%v\u0026#34;, err, userID) //\treturn // } lineData := []string{ userID, name, email, } csvData = append(csvData, lineData) } fileName := time.Now().Format(\u0026#34;20060102150405\u0026#34;) + \u0026#34;.csv\u0026#34; filePath := \u0026#34;/tmp/\u0026#34; + fileName fileErr := WriteCsv(filePath, csvData) if fileErr != nil { log.Printf(\u0026#34;writeCsv fialed: %v\u0026#34;, fileErr) return } // æ¥å£è¯·æ±‚å¯¼å‡º // ctx.FileAttachment(filePath, fileName) } //filePath: æ–‡ä»¶å…¨è·¯å¾„ ç»å¯¹è·¯å¾„ //content: åŒ…å«è¡Œåˆ— éœ€è¦å¤´éƒ¨è¦å¢åŠ ç¬¬ä¸€åˆ— func WriteCsv(filePath string, content [][]string) error { file, err := os.Create(filePath) if err != nil { return err } defer file.Close() // å†™å…¥UTF-8 BOMï¼Œé˜²æ­¢ä¸­æ–‡ä¹±ç  file.WriteString(\u0026#34;\\xEF\\xBB\\xBF\u0026#34;) w := csv.NewWriter(file) for _, v := range content { err = w.Write(v) if err != nil { return err } } w.Flush() return nil } ","permalink":"https://www.iarno.cn/article/export-csv/","tags":null,"title":"golangè¿æ¥mysqlæ•°æ®åº“å¯¼å‡ºcsvæ–‡ä»¶"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Goè¯­è¨€çš„Ginæ¡†æ¶å’Œhttputil.NewSingleHostReverseProxyæ–¹æ³•å®ç°ä»£ç†æœåŠ¡ã€‚æ–‡ç« æä¾›äº†è¯¦ç»†çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªåå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æŒ‡å®šçš„è¿œç¨‹æœåŠ¡å™¨ã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜è§£é‡Šäº†å¦‚ä½•è®¾ç½®è¯·æ±‚çš„å¤´éƒ¨ã€ä¸»æœºã€URLæ–¹æ¡ˆå’Œè·¯å¾„ç­‰ä¿¡æ¯ã€‚\nä»£ç ç¤ºä¾‹ package main import ( \u0026#34;net/http\u0026#34; \u0026#34;net/http/httputil\u0026#34; \u0026#34;net/url\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func proxy(c *gin.Context) { remote, err := url.Parse(\u0026#34;http://www.iarno.cn\u0026#34;) if err != nil { panic(err) } proxy := httputil.NewSingleHostReverseProxy(remote) proxy.Director = func(req *http.Request) { req.Header = c.Request.Header req.Host = remote.Host req.URL.Scheme = remote.Scheme req.URL.Host = remote.Host req.URL.Path = c.Param(\u0026#34;proxyPath\u0026#34;) } proxy.ServeHTTP(c.Writer, c.Request) } func main() { r := gin.Default() //Create a catchall route r.Any(\u0026#34;/*proxyPath\u0026#34;, proxy) r.Run(\u0026#34;:8080\u0026#34;) } å‚è€ƒ https://le-gall.bzh/post/go/a-reverse-proxy-in-go-using-gin/\n","permalink":"https://www.iarno.cn/article/gin-proxy/","tags":["proxyä»£ç†"],"title":"gin proxyä»£ç†"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦è§£å†³äº†åœ¨ä½¿ç”¨Goè¯­è¨€çš„ginæ¡†æ¶è¿›è¡Œè¯·æ±‚ç»‘å®šæ—¶ï¼Œå¦‚æœè¯·æ±‚å¯¹è±¡ä¸ºæ•°ç»„ï¼Œç»‘å®šå¯èƒ½ä¸ä¼šç”Ÿæ•ˆçš„é—®é¢˜ã€‚æ–‡ç« é¦–å…ˆå±•ç¤ºäº†é—®é¢˜çš„äº§ç”Ÿï¼Œç„¶åæä¾›äº†è§£å†³æ–¹æ¡ˆï¼šåœ¨æ•°ç»„ç±»å‹çš„ç»‘å®šæ ‡ç­¾ä¸­ï¼Œå°†requiredæ”¹ä¸ºdiveã€‚è¿™æ ·ï¼Œginå°±ä¼šé€’å½’éªŒè¯æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡ã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†ç›¸å…³çš„å‚è€ƒé“¾æ¥ã€‚\nè¯·æ±‚ç»“æ„ä½“å¦‚ä¸‹ // å­¦ç”Ÿç»“æ„ type StudentParam struct { StudentID uint64 `json:\u0026#34;student_id\u0026#34; binding:\u0026#34;required\u0026#34;` // è¯·æ±‚æ—¶æ­¤å‚æ•°éªŒè¯å¹¶æœªç”Ÿæ•ˆ StudentName int `json:\u0026#34;type\u0026#34; binding:\u0026#34;required\u0026#34;` // è¯·æ±‚æ—¶æ­¤å‚æ•°éªŒè¯å¹¶æœªç”Ÿæ•ˆ } // æ‰¹é‡åˆ›å»ºå­¦ç”Ÿ type CreateStudentsParam struct { Students []StudentParam `json:\u0026#34;students\u0026#34; binding:\u0026#34;required\u0026#34;` } var param CreateStudentsParam err := c.ShouldBindJSON(\u0026amp;param) è§£å†³æ–¹æ³• type CreateStudentsParam struct { Students []StudentParam `json:\u0026#34;students\u0026#34; binding:\u0026#34;dive\u0026#34;` // å°†binding:\u0026#34;required\u0026#34;æ”¹ä¸ºbinding:\u0026#34;dive\u0026#34; } å‚è€ƒ https://www.utf8.hk/archives/go-gin-binding-error.html\n","permalink":"https://www.iarno.cn/article/gin-binding/","tags":null,"title":"ginå½“è¯·æ±‚å¯¹è±¡ä¸ºæ•°ç»„æ—¶ï¼Œbindingä¸ç”Ÿæ•ˆé—®é¢˜è§£å†³"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« æ˜¯å…³äºDjangoé¡¹ç›®å®è·µçš„æ•™ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å®‰è£…Djangoã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Djangoé¡¹ç›®ï¼Œå¹¶è¿›è¡Œäº†æ•°æ®åº“çš„åˆå§‹åŒ–ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å¯åŠ¨äº†DjangoæœåŠ¡ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹é¡¹ç›®ã€‚æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æ¨¡å‹ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å¯¹Djangoé¡¹ç›®å®è·µçš„åŸºç¡€ä»‹ç»ï¼Œé€‚åˆåˆå­¦è€…é˜…è¯»ã€‚\nå®‰è£…django sudo pip install django åˆ›å»ºé¡¹ç›® (python3.9.6) âœ django-admin startproject learning_log . (python3.9.6) âœ ll total 8 drwxr-xr-x 7 iarno staff 224B 8 24 23:15 learning_log -rwxrwxrwx 1 iarno staff 668B 8 24 23:15 manage.py åˆ›å»ºæ•°æ®åº“ (python3.9.6) âœ python manage.py migrate Operations to perform: Apply all migrations: admin, auth, contenttypes, sessions Running migrations: Applying contenttypes.0001_initial... OK Applying auth.0001_initial... OK Applying admin.0001_initial... OK Applying admin.0002_logentry_remove_auto_add... OK Applying admin.0003_logentry_add_action_flag_choices... OK Applying contenttypes.0002_remove_content_type_name... OK Applying auth.0002_alter_permission_name_max_length... OK Applying auth.0003_alter_user_email_max_length... OK Applying auth.0004_alter_user_username_opts... OK Applying auth.0005_alter_user_last_login_null... OK Applying auth.0006_require_contenttypes_0002... OK Applying auth.0007_alter_validators_add_error_messages... OK Applying auth.0008_alter_user_username_max_length... OK Applying auth.0009_alter_user_last_name_max_length... OK Applying auth.0010_alter_group_name_max_length... OK Applying auth.0011_update_proxy_permissions... OK Applying auth.0012_alter_user_first_name_max_length... OK Applying sessions.0001_initial... OK å¯åŠ¨æœåŠ¡ (python3.9.6) âœ python manage.py runserver Watching for file changes with StatReloader Performing system checks... System check identified no issues (0 silenced). August 24, 2022 - 15:17:29 Django version 3.2.7, using settings \u0026#39;learning_log.settings\u0026#39; Starting development server at http://127.0.0.1:8000/ Quit the server with CONTROL-C. åˆ›å»ºåº”ç”¨ç¨‹åº (python3.9.6) âœ python manage.py startapp learning_logs (python3.9.6) âœ ll (python3.9.6) âœ learning_log ls db.sqlite3 learning_log learning_logs ll_env manage.py (python3.9.6) âœ learning_log ls learning_logs __init__.py __pycache__ admin.py apps.py migrations models.py tests.py views.py å®šä¹‰æ¨¡å‹ # learning_logs/models.py from django.db import models # Create your models here. class Topic(models.Model): \u0026#34;\u0026#34;\u0026#34;ç”¨æˆ·å­¦ä¹ ä¸»é¢˜\u0026#34;\u0026#34;\u0026#34; text = models.CharField(max_length=200) date_added = models.DateTimeField(auto_now_add=True) def __str__(self): return self.text ","permalink":"https://www.iarno.cn/article/django-01/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜","Django"],"title":"Django é¡¹ç›®å®è·µ01"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« æ˜¯å…³äºPythonå•å…ƒæµ‹è¯•çš„æ•™ç¨‹ã€‚æ–‡ç« é¦–å…ˆä»‹ç»äº†Pythonä»£ç æµ‹è¯•çš„é‡è¦æ€§ï¼Œç„¶åè¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨Pythonçš„unittestæ¨¡å—è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚æ–‡ç« ä¸­è¿˜æä¾›äº†ä¸€ä¸ªç®€å•çš„å•å…ƒæµ‹è¯•ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¦‚ä½•åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¦‚ä½•ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨æ–­è¨€è¿›è¡Œæµ‹è¯•ã€‚è¿™ç¯‡æ–‡ç« å¯¹äºæƒ³è¦å­¦ä¹ Pythonå•å…ƒæµ‹è¯•çš„è¯»è€…æ¥è¯´æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚\nå¼‚å¸¸å¤„ç† æ–¹æ³•åtestå¼€å¤´\n\u0026#34;\u0026#34;\u0026#34; å•å…ƒæµ‹è¯• \u0026#34;\u0026#34;\u0026#34; import unittest class TestACase(unittest.TestCase): \u0026#34;\u0026#34;\u0026#34;Test Class\u0026#34;\u0026#34;\u0026#34; def test_a(self): \u0026#34;\u0026#34;\u0026#34;test func\u0026#34;\u0026#34;\u0026#34; test_list = [\u0026#34;test\u0026#34;] self.assertEqual(\u0026#34;test\u0026#34;, \u0026#34;test\u0026#34;) self.assertEqual(\u0026#34;test\u0026#34;, \u0026#34;test1\u0026#34;) self.assertIn(\u0026#34;test\u0026#34;, test_list) unittest.main() ","permalink":"https://www.iarno.cn/article/py-test/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜"],"title":"Python å•å…ƒæµ‹è¯•"},{"categories":["Linux"],"contents":"æœ¬æ–‡ä»‹ç»äº†clocä»£ç ç»Ÿè®¡å·¥å…·çš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•ã€‚clocå¯ä»¥ç»Ÿè®¡ä»£ç æ–‡ä»¶çš„æ•°é‡ã€ç©ºè¡Œã€æ³¨é‡Šå’Œä»£ç è¡Œæ•°ã€‚é€šè¿‡æ‰§è¡Œclocå‘½ä»¤ï¼Œå¯ä»¥å¾—åˆ°è¯¦ç»†çš„ç»Ÿè®¡ç»“æœï¼ŒåŒ…æ‹¬å„ç§è¯­è¨€çš„æ–‡ä»¶æ•°ã€ç©ºè¡Œæ•°ã€æ³¨é‡Šæ•°å’Œä»£ç è¡Œæ•°ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œç®¡ç†ä»£ç ã€‚\nå®‰è£… yum install -y cloc æ‰§è¡Œå‘½ä»¤ [iarno@xxxx devspace] cloc test/ 260 text files. 130 unique files. 140 files ignored. github.com/AlDanial/cloc v 1.70 T=9.69 s (12.6 files/s, 1053.1 lines/s) ------------------------------------------------------------------------------- Language files blank comment code ------------------------------------------------------------------------------- Go 107 1255 398 6461 YAML 7 215 439 973 Markdown 1 25 0 190 Bourne Shell 5 52 53 95 Protocol Buffers 1 5 4 31 HTML 1 0 0 10 ------------------------------------------------------------------------------- SUM: 122 1552 894 7760 ------------------------------------------------------------------------------- files æ–‡ä»¶æ•° blank ç©ºè¡Œ comment æ³¨é‡Š code ä»£ç è¡Œæ•° ","permalink":"https://www.iarno.cn/article/cloc/","tags":null,"title":"Cloc ä»£ç ç»Ÿè®¡"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†Pythonçš„å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œä¸»è¦è®²è§£äº†try-exceptè¯­å¥çš„ä½¿ç”¨ã€‚æ–‡ç« é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨try-exceptè¯­å¥æ¥å¤„ç†æ–‡ä»¶è¯»å–æ—¶å¯èƒ½å‡ºç°çš„FileNotFoundErrorå¼‚å¸¸ã€‚å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œç¨‹åºä¼šæ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶æ‰“å°å‡º\u0026quot;file not found\u0026quot;ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”æ— å¼‚å¸¸ï¼Œç¨‹åºä¼šè¯»å–æ–‡ä»¶å†…å®¹å¹¶æ‰“å°å‡ºæ¥ã€‚\nå¼‚å¸¸å¤„ç† \u0026#34;\u0026#34;\u0026#34; å¼‚å¸¸å¤„ç† \u0026#34;\u0026#34;\u0026#34; try: with open(\u0026#34;file/read.txt\u0026#34;, encoding = \u0026#34;UTF-8\u0026#34;) as file_obj: lines = file_obj.readlines() except FileNotFoundError: # æˆ–è€… pass å…³é”®å­—å¿½ç•¥é”™è¯¯ print(\u0026#34;file not found\u0026#34;) else: # æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ—¶æ‰§è¡Œ for line in lines: print(line) ","permalink":"https://www.iarno.cn/article/py-file/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜"],"title":"Python å¼‚å¸¸å¤„ç†"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Pythonä¸­æ–‡ä»¶çš„è¯»å–å’Œå†™å…¥æ“ä½œã€‚é¦–å…ˆï¼Œé€šè¿‡openå‡½æ•°å’Œwithå…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°æ‰“å¼€æ–‡ä»¶å¹¶åœ¨ä¸å†éœ€è¦æ—¶è‡ªåŠ¨å…³é—­ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•è¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œï¼ŒåŒ…æ‹¬å¦‚ä½•å»é™¤ç©ºè¡Œã€‚ç„¶åï¼Œæ–‡ç« å±•ç¤ºäº†å¦‚ä½•å°†æ–‡ä»¶çš„å†…å®¹è¯»å–åˆ°åˆ—è¡¨ä¸­ã€‚åœ¨æ–‡ä»¶å†™å…¥éƒ¨åˆ†ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ä¸åŒçš„æ¨¡å¼ï¼ˆå¦‚å†™å…¥æ¨¡å¼å’Œé™„åŠ æ¨¡å¼ï¼‰æ¥å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒPythonä¼šè‡ªåŠ¨åˆ›å»ºã€‚\nå…³é”®å­—withåœ¨ä¸è®¿é—®æ–‡ä»¶åå°†è‡ªåŠ¨å…³é—­ã€‚\nè¯»å–æ–‡ä»¶ \u0026#34;\u0026#34;\u0026#34; è¯»å–æ–‡ä»¶ \u0026#34;\u0026#34;\u0026#34; # å¸¦æœ‰ç©ºè¡Œ with open(\u0026#34;test.txt\u0026#34;, encoding = \u0026#34;UTF-8\u0026#34;) as file_obj: for line in file_obj: print(line) # å»é™¤ç©ºè¡Œ with open(\u0026#34;test.txt\u0026#34;, encoding = \u0026#34;UTF-8\u0026#34;) as file_obj: for line in file_obj: print(line.rstrip()) # åˆ›å»ºåˆ—è¡¨ with open(\u0026#34;test.txt\u0026#34;, encoding = \u0026#34;UTF-8\u0026#34;) as file_obj: for line in file_obj: lines = file_obj.readlines() for line in lines: print(line.rstrip()) å†™å…¥æ–‡ä»¶ # å†™å…¥æ–‡ä»¶ # æ–‡ä»¶ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»º # rè¯»æ¨¡å¼ã€wå†™æ¨¡å¼ã€aé™„åŠ æ¨¡å¼ã€r+è¯»å†™æ¨¡å¼ with open(\u0026#34;write.txt\u0026#34;, \u0026#39;a\u0026#39;, encoding = \u0026#34;UTF-8\u0026#34;) as file_obj: file_obj.write(\u0026#34;111 \\n\u0026#34;) file_obj.write(\u0026#34;222 \\n\u0026#34;) ","permalink":"https://www.iarno.cn/article/py-except/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜"],"title":"Python æ–‡ä»¶ç¯‡"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†CondaåŒ…ç®¡ç†å·¥å…·çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬å®‰è£…æ–¹æ³•ã€è®¾ç½®é•œåƒæºã€åˆ›å»ºå’Œæ¿€æ´»ç¯å¢ƒç­‰æ“ä½œã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜è§£ç­”äº†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¦‚è®¾ç½®æ¸…åæºé—®é¢˜å’Œæ¿€æ´»ååŒ…ç‰ˆæœ¬æœªå˜çš„é—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†ä¸€äº›å‚è€ƒé“¾æ¥ï¼ŒåŒ…æ‹¬Condaçš„å®˜æ–¹æ–‡æ¡£å’Œå…¶ä»–ç›¸å…³æ•™ç¨‹ã€‚\næ”¯æŒè¯­è¨€åŒ…æ‹¬ Pythonï¼ŒRï¼ŒRubyï¼ŒLuaï¼ŒScalaï¼ŒJavaï¼ŒJavaScriptï¼ŒC / C ++ï¼ŒFORTRANã€‚\nå®‰è£… https://conda.io/en/latest/miniconda.html\næŸ¥çœ‹å®˜ç½‘æˆ–ç½‘ä¸ŠğŸ„ğŸ»è‡ªè¡Œä¸‹è½½å®‰è£…ã€‚\nè®¾ç½®é•œåƒæº vim ~/.condarc\n(python3.9.6) âœ ~ cat ~/.condarc show_channel_urls: true ssl_verify: false channels: - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/osx-64/ - http://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/osx-64/ auto_activate_base: false å¯ä»¥é€šè¿‡.condareæ–‡ä»¶è®¾ç½®æºï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥è®¾ç½®ã€‚\næ¡ˆä¾‹ # åˆ›å»º python3.9.6 ç‰ˆæœ¬ âœ ~ conda create --name python3.9.6 python=3.9.6 è¾“å…¥yå³å¯åˆ›å»ºæˆåŠŸ # æ¿€æ´» python3.9.6 âœ ~ conda activate python3.9.6 (python3.9.6) âœ ~ python --version Python 3.9.6 # é€€å‡ºæ¿€æ´» âœ ~ conda deactivate é—®é¢˜ è®¾ç½®æ¸…åæºé—®é¢˜ CondaHTTPError: HTTP 000 CONNECTION FAILED\nCollecting package metadata (current_repodata.json): failed CondaHTTPError: HTTP 000 CONNECTION FAILED for url \u0026lt;https://repo.anaconda.com/pkgs/main/linux-64/current_repodata.json\u0026gt; Elapsed: - An HTTP error occurred when trying to retrieve this URL. HTTP errors are often intermittent, and a simple retry will get you on your way. If your current network has https://www.anaconda.com blocked, please file a support request with your network engineering team. \u0026#39;https://repo.anaconda.com/pkgs/main/linux-64\u0026#39; é—®é¢˜åŸå› æ˜¯ä¸èƒ½ä½¿ç”¨æ¸…åçš„httpsæºåœ°å€ï¼Œéœ€åˆ‡æ¢ä¸ºhttpåœ°å€ã€‚\næ¿€æ´»ååŒ…ç‰ˆæœ¬æ²¡å˜ å‡ºç°è¿™ç§æƒ…å†µä¸€èˆ¬æœ‰ä¸¤ç§å¯èƒ½:\nç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œéœ€è¦åœ¨pathä¸­åŠ ä¸Šanacondaçš„binç›®å½• ç¯å¢ƒå˜é‡é¡ºåºä¸å¯¹ Linuxä¸­é»˜è®¤çš„ç¯å¢ƒå˜é‡ä¸º /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin åªæœ‰åœ¨conda activateæ¿€æ´»çŠ¶æ€echo $PAHTæ‰å¯ä»¥çœ‹å‡ºå¯¹åº”çš„ç¯å¢ƒå˜é‡é…ç½®ã€‚\nå‚è€ƒ Conda å®˜æ–¹æ–‡æ¡£\nConda å®‰è£…ä½¿ç”¨è¯¦è§£ https://www.jianshu.com/p/b2b117ac5561\nLinuxå®‰è£…anacondaä¹‹åè¿è¡Œpythonç‰ˆæœ¬æœªåˆ‡æ¢é—®é¢˜\n","permalink":"https://www.iarno.cn/article/conda/","tags":null,"title":"Conda åŒ…ç®¡ç†å·¥å…·"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Linuxä¸‹çš„coreæ–‡ä»¶åˆ†ææ–¹æ³•ã€‚é¦–å…ˆï¼Œæ–‡ç« è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ulimitå‘½ä»¤è®¾ç½®ç”Ÿæˆcoreæ–‡ä»¶ï¼Œä»¥åŠå„å‚æ•°çš„å«ä¹‰ã€‚æ¥ç€ï¼Œæ–‡ç« è¯¦ç»†æè¿°äº†coreæ–‡ä»¶çš„ç”Ÿæˆè¿‡ç¨‹å’Œä½œç”¨ï¼Œä»¥åŠå¦‚ä½•è®¾ç½®core dumpçš„æ–‡ä»¶ç›®å½•å’Œå‘½åè§„åˆ™ã€‚æ–‡ç« è¿˜æä¾›äº†å¦‚ä½•ä½¿ç”¨gdbå·¥å…·åˆ†æcoreæ–‡ä»¶çš„æ–¹æ³•ï¼Œå¹¶è§£é‡Šäº†åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯èƒ½ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶ä»¥åŠå¦‚ä½•è§£å†³ã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†ç›¸å…³çš„å‚è€ƒé“¾æ¥ã€‚\nunlimitè®¾ç½® ulimit -c unlimited ç”Ÿæˆcoreæ–‡ä»¶,å°±æ˜¯ç¨‹åºè¿è¡Œå‘è¡Œæ®µé”™è¯¯æ—¶çš„æ–‡ä»¶\nå‚æ•°è¯´æ˜: -a æ˜¾ç¤ºç›®å‰èµ„æºé™åˆ¶çš„è®¾å®šã€‚\n-c \u0026lt;coreæ–‡ä»¶ä¸Šé™\u0026gt; è®¾å®šcoreæ–‡ä»¶çš„æœ€å¤§å€¼,å•ä½ä¸ºåŒºå—ã€‚\n-d \u0026lt;æ•°æ®èŠ‚åŒºå¤§å°\u0026gt; ç¨‹åºæ•°æ®èŠ‚åŒºçš„æœ€å¤§å€¼,å•ä½ä¸ºKBã€‚\n-f \u0026lt;æ–‡ä»¶å¤§å°\u0026gt; shellæ‰€èƒ½å»ºç«‹çš„æœ€å¤§æ–‡ä»¶,å•ä½ä¸ºåŒºå—ã€‚\n-H è®¾å®šèµ„æºçš„ç¡¬æ€§é™åˆ¶,ä¹Ÿå°±æ˜¯ç®¡ç†å‘˜æ‰€è®¾ä¸‹çš„é™åˆ¶ã€‚\n-m \u0026lt;å†…å­˜å¤§å°\u0026gt; æŒ‡å®šå¯ä½¿ç”¨å†…å­˜çš„ä¸Šé™,å•ä½ä¸ºKBã€‚\n-n \u0026lt;æ–‡ä»¶æ•°ç›®\u0026gt; æŒ‡å®šåŒä¸€æ—¶é—´æœ€å¤šå¯å¼€å¯çš„æ–‡ä»¶æ•°ã€‚\n-p \u0026lt;ç¼“å†²åŒºå¤§å°\u0026gt; æŒ‡å®šç®¡é“ç¼“å†²åŒºçš„å¤§å°,å•ä½512å­—èŠ‚ã€‚\n-s \u0026lt;å †å å¤§å°\u0026gt; æŒ‡å®šå †å çš„ä¸Šé™,å•ä½ä¸ºKBã€‚\n-S è®¾å®šèµ„æºçš„å¼¹æ€§é™åˆ¶ã€‚\n-t \u0026lt;CPUæ—¶é—´\u0026gt; æŒ‡å®šCPUä½¿ç”¨æ—¶é—´çš„ä¸Šé™,å•ä½ä¸ºç§’ã€‚\n-u \u0026lt;ç¨‹åºæ•°ç›®\u0026gt; ç”¨æˆ·æœ€å¤šå¯å¼€å¯çš„ç¨‹åºæ•°ç›®ã€‚\n-v \u0026lt;è™šæ‹Ÿå†…å­˜å¤§å°\u0026gt; æŒ‡å®šå¯ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸Šé™,å•ä½ä¸ºKB\ncoreæ–‡ä»¶ å¼€å‘å’Œä½¿ç”¨Unixç¨‹åºæ—¶, æœ‰æ—¶ç¨‹åºè«åå…¶å¦™çš„æ­»äº†, å´æ²¡æœ‰ä»»ä½•çš„æç¤º(æœ‰æ—¶å€™ä¼šæç¤ºcore dumped). è¿™æ—¶å€™å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å½¢å¦‚core.è¿›ç¨‹å·çš„æ–‡ä»¶ç”Ÿæˆ, è¿™ä¸ªæ–‡ä»¶ä¾¿æ˜¯æ“ä½œç³»ç»ŸæŠŠç¨‹åºdownæ‰æ—¶çš„å†…å­˜å†…å®¹æ‰”å‡ºæ¥ç”Ÿæˆçš„, å®ƒå¯ä»¥åšä¸ºè°ƒè¯•ç¨‹åºçš„å‚è€ƒã€‚ core dumpåˆå«æ ¸å¿ƒè½¬å‚¨, å½“ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸, ç¨‹åºå¼‚å¸¸é€€å‡ºæ—¶, ç”±æ“ä½œç³»ç»ŸæŠŠç¨‹åºå½“å‰çš„å†…å­˜çŠ¶å†µå­˜å‚¨åœ¨ä¸€ä¸ªcoreæ–‡ä»¶ä¸­, å«core dump.\nè®¾ç½®Core Dumpçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ç›®å½•å’Œå‘½åè§„åˆ™ åœ¨é»˜è®¤çš„æƒ…å†µä¸‹,å¾ˆå¤šç³»ç»Ÿçš„coreæ–‡ä»¶æ˜¯ç”Ÿæˆåœ¨ä½ è¿è¡Œç¨‹åºçš„ç›®å½•ä¸‹,æˆ–è€…ä½ åœ¨ç¨‹åºä¸­chdiråçš„é‚£ä¸ªç›®å½•,ç„¶ååœ¨coreæ–‡ä»¶çš„åé¢åŠ äº†ä¸€ä¸ª pidã€‚åœ¨å®é™…å·¥ä½œä¸­,è¿™æ ·å¯èƒ½ä¼šé€ æˆå¾ˆå¤šç›®å½•ä¸‹äº§ç”Ÿcoreæ–‡ä»¶,ä¸ä¾¿äºç®¡ç†,å®é™…ä¸Š,åœ¨2.6ä¸‹,coreæ–‡ä»¶çš„ç”Ÿæˆä½ç½®å’Œæ–‡ä»¶åçš„å‘½åéƒ½æ˜¯å¯ä»¥é…ç½® çš„ã€‚\n/proc/sys/kernel/core_uses_pid å¯ä»¥æ§åˆ¶äº§ç”Ÿçš„coreæ–‡ä»¶çš„æ–‡ä»¶åä¸­æ˜¯å¦æ·»åŠ pidä½œä¸ºæ‰©å±•,å¦‚æœæ·»åŠ åˆ™æ–‡ä»¶å†…å®¹ä¸º1,å¦åˆ™ä¸º0\nproc/sys/kernel/core_pattern å¯ä»¥è®¾ç½®æ ¼å¼åŒ–çš„coreæ–‡ä»¶ä¿å­˜ä½ç½®æˆ–æ–‡ä»¶å,æ¯”å¦‚åŸæ¥æ–‡ä»¶å†…å®¹æ˜¯core-%e å¯ä»¥è¿™æ ·ä¿®æ”¹:\necho \u0026#34;/tmp/core-%e-%p\u0026#34; \u0026gt; core_pattern å°†ä¼šæ§åˆ¶æ‰€äº§ç”Ÿçš„coreæ–‡ä»¶ä¼šå­˜æ”¾åˆ°/corefileç›®å½•ä¸‹,äº§ç”Ÿçš„æ–‡ä»¶åä¸ºcore-å‘½ä»¤å-pid-æ—¶é—´æˆ³ ä»¥ä¸‹æ˜¯å‚æ•°åˆ—è¡¨:\n%p - insert pid into filename æ·»åŠ pid %u - insert current uid into filename æ·»åŠ å½“å‰uid %g - insert current gid into filename æ·»åŠ å½“å‰gid %s - insert signal that caused the coredump into the filename æ·»åŠ å¯¼è‡´äº§ç”Ÿcoreçš„ä¿¡å· %t - insert UNIX time that the coredump occurred into filename æ·»åŠ coreæ–‡ä»¶ç”Ÿæˆæ—¶çš„unixæ—¶é—´ %h - insert hostname where the coredump happened into filename æ·»åŠ ä¸»æœºå %e - insert coredumping executable name into filename æ·»åŠ å‘½ä»¤å åˆ†æcoreæ–‡ä»¶ gdb -c coreæ–‡ä»¶è·¯å¾„ [åº”ç”¨ç¨‹åºçš„è·¯å¾„] # åˆ†æphp coreæ–‡ä»¶ sudo gdb -e /usr/local/php/sbin/php-fpm -c core.7569 è¿›å»åè¾“å…¥whereæˆ–btå›è½¦, å°±å¯ä»¥æ˜¾ç¤ºç¨‹åºåœ¨å“ªä¸€è¡Œå½“æ‰çš„, åœ¨å“ªä¸ªå‡½æ•°ä¸­.\nä¸ºä»€ä¹ˆæ²¡æœ‰coreæ–‡ä»¶ç”Ÿæˆ æœ‰æ—¶å€™ç¨‹åºdownäº†, ä½†æ˜¯coreæ–‡ä»¶å´æ²¡æœ‰ç”Ÿæˆ. coreæ–‡ä»¶çš„ç”Ÿæˆè·Ÿä½ å½“å‰ç³»ç»Ÿçš„ç¯å¢ƒè®¾ç½®æœ‰å…³ç³», å¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥è®¾ç½®ä¸€ä¸‹, ç„¶åå†è¿è¡Œç¨‹åºä¾¿æˆç”Ÿæˆcoreæ–‡ä»¶.\nulimit -c unlimited å‚è€ƒ https://blog.csdn.net/u013427969/article/details/83962303\nhttps://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html\n","permalink":"https://www.iarno.cn/article/core/","tags":null,"title":"Core æ–‡ä»¶åˆ†æ"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ dig å‘½ä»¤æ¥æŸ¥è¯¢ DNS ä¿¡æ¯ã€‚é¦–å…ˆï¼Œå®ƒè§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ dig å‘½ä»¤æŸ¥è¯¢å•ä¸ªä¸»æœºçš„ä¿¡æ¯ï¼Œç„¶åä»‹ç»äº†å¦‚ä½•ä»æŒ‡å®šçš„ DNS æœåŠ¡å™¨ä¸Šè¿›è¡ŒæŸ¥è¯¢ï¼Œæœ€åï¼Œæ–‡ç« è¿˜è®²è§£äº†å¦‚ä½•ä½¿ç”¨ dig çš„ -x é€‰é¡¹æ¥åå‘è§£æ IP åœ°å€å¯¹åº”çš„åŸŸåã€‚æ–‡ç« ä¸­è¿˜åŒ…å«äº†ä¸€äº›å®é™…çš„å‘½ä»¤ç¤ºä¾‹å’Œç»“æœè¾“å‡ºï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ dig å‘½ä»¤ã€‚\nLinuxä¸‹è§£æåŸŸåé™¤äº†ä½¿ç”¨nslookupä¹‹å¤–ï¼Œå¼€å¯ä»¥ä½¿ç”¨digå‘½ä»¤æ¥è§£æåŸŸåã€‚\ndigå‘½ä»¤å¯ä»¥å¾—åˆ°æ›´å¤šçš„åŸŸåä¿¡æ¯ã€‚dig å‘½ä»¤ä¸»è¦ç”¨æ¥ä» DNS åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ä¸»æœºåœ°å€ä¿¡æ¯ã€‚digçš„å…¨ç§°æ˜¯ (domain information groper)ã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æ¥çµæ´»æ¢æµ‹DNSçš„å·¥å…·ã€‚å®ƒä¼šæ‰“å°å‡º\u0026gt;DNS name serverçš„å›åº”ã€‚\næŸ¥è¯¢å•ä¸ªåŸŸåçš„DNSä¿¡æ¯ dig å‘½ä»¤æœ€å…¸å‹çš„ç”¨æ³•å°±æ˜¯æŸ¥è¯¢å•ä¸ªä¸»æœºçš„ä¿¡æ¯ã€‚\nlinuxidc@linuxidc:~$ dig www.linuxidc.com [+trace] ; \u0026lt; \u0026lt;\u0026gt;\u0026gt; DiG 9.11.3-1Ubuntu1.5-Ubuntu \u0026lt; \u0026lt;\u0026gt;\u0026gt; www.linuxidc.com ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt; \u0026lt;- opcode: QUERY, status: NOERROR, id: 17774 ;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 65494 ;; QUESTION SECTION: ;www.linuxidc.com. IN A ;; ANSWER SECTION: www.linuxidc.com. 5 IN A 122.228.238.15 www.linuxidc.com. 5 IN A 106.42.25.203 ;; Query time: 10 msec ;; SERVER: 127.0.0.53#53(127.0.0.53) ;; WHEN: Sun Mar 03 10:55:35 CST 2019 ;; MSG SIZE rcvd: 77 â€‹\tè¾“å‡ºè¯´æ˜ ç¬¬ä¸€éƒ¨åˆ†æ˜¾ç¤º dig å‘½ä»¤çš„ç‰ˆæœ¬å’Œè¾“å…¥çš„å‚æ•°ã€‚ ç¬¬äºŒéƒ¨åˆ†æ˜¾ç¤ºæœåŠ¡è¿”å›çš„ä¸€äº›æŠ€æœ¯è¯¦æƒ…ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯ statusã€‚å¦‚æœ status çš„å€¼ä¸º NOERROR åˆ™è¯´æ˜æœ¬æ¬¡æŸ¥è¯¢æˆåŠŸç»“æŸã€‚ ç¬¬ä¸‰éƒ¨åˆ†ä¸­çš„ \u0026ldquo;QUESTION SECTION\u0026rdquo; æ˜¾ç¤ºæˆ‘ä»¬è¦æŸ¥è¯¢çš„åŸŸåã€‚ ç¬¬å››éƒ¨åˆ†çš„ \u0026ldquo;ANSWER SECTION\u0026rdquo; æ˜¯æŸ¥è¯¢åˆ°çš„ç»“æœã€‚ ç¬¬äº”éƒ¨åˆ†åˆ™æ˜¯æœ¬æ¬¡æŸ¥è¯¢çš„ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨äº†å¤šé•¿æ—¶é—´ï¼ŒæŸ¥è¯¢äº†å“ªä¸ª DNS æœåŠ¡å™¨ï¼Œåœ¨ä»€ä¹ˆæ—¶é—´è¿›è¡Œçš„æŸ¥è¯¢ç­‰ç­‰ã€‚\né»˜è®¤æƒ…å†µä¸‹ dig å‘½ä»¤æŸ¥è¯¢ A è®°å½•ï¼Œä¸Šå›¾ä¸­æ˜¾ç¤ºçš„ A å³è¯´æ˜æŸ¥è¯¢çš„è®°å½•ç±»å‹ä¸º A è®°å½•ã€‚åœ¨å°è¯•æŸ¥è¯¢å…¶å®ƒç±»å‹çš„è®°å½•å‰è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å¸¸è§çš„ DNS è®°å½•ç±»å‹ã€‚\nä»æŒ‡å®šçš„ DNS æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢ ç”±äºä¸€äº›åŸå› ï¼Œå¸Œæœ›ä»æŒ‡å®šçš„ DNS æœåŠ¡å™¨ä¸Šè¿›è¡ŒæŸ¥è¯¢(ä»é»˜è®¤çš„ DNS æœåŠ¡å™¨ä¸Šè·å¾—çš„ç»“æœå¯èƒ½ä¸å‡†ç¡®)ã€‚æŒ‡å®š DNS æœåŠ¡å™¨çš„æ–¹å¼ä¸ºä½¿ç”¨ @ ç¬¦å·ï¼š\nlinuxidc@linuxidc:~$ dig @8.8.8.8 m.linuxidc.com ; \u0026lt; \u0026lt;\u0026gt;\u0026gt; DiG 9.11.3-1ubuntu1.5-Ubuntu \u0026lt; \u0026lt;\u0026gt;\u0026gt; @8.8.8.8 m.linuxidc.com ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt; \u0026lt;- opcode: QUERY, status: NOERROR, id: 38966 ;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;m.linuxidc.com. IN A ;; ANSWER SECTION: m.linuxidc.com. 199 IN A 122.228.238.71 m.linuxidc.com. 199 IN A 113.107.238.155 ;; Query time: 120 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) ;; WHEN: Sun Mar 03 11:21:48 CST 2019 ;; MSG SIZE rcvd: 75 ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æœ¬æ¬¡æŸ¥è¯¢çš„ DNS æœåŠ¡å™¨ä¸º 8.8.8.8ã€‚\nå¦‚æœä¸æŒ‡å®š DNS æœåŠ¡å™¨ï¼Œdig ä¼šä¾æ¬¡ä½¿ç”¨ /etc/resolv.conf é‡Œçš„åœ°å€ä½œä¸º DNS æœåŠ¡å™¨ï¼š\nlinuxidc@linuxidc:~$ dig m.linuxidc.com ä¸Šé¢æŸ¥è¯¢çš„ DNS æœåŠ¡å™¨å°±å˜æˆäº†ï¼š\nåå‘æŸ¥è¯¢ åœ¨å‰é¢çš„æŸ¥è¯¢ä¸­æˆ‘ä»¬æŒ‡å®šäº†æŸ¥è¯¢æœåŠ¡å™¨ä¸º 8.8.8.8ï¼Œè¿™æ˜¯è°å®¶çš„ DNS æœåŠ¡å™¨ï¼Ÿå…¶å®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ dig çš„ -x é€‰é¡¹æ¥åå‘è§£æ IP åœ°å€å¯¹åº”çš„åŸŸåï¼š\nlinuxidc@linuxidc:~$ dig -x 8.8.8.8 +short google-public-dns-a.google.com. ","permalink":"https://www.iarno.cn/article/dig/","tags":null,"title":"Dig å‘½ä»¤ä½¿ç”¨è¯¦è§£"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†Golangçš„å•å…ƒæµ‹è¯•å·¥å…·Gomonkeyã€‚Gomonkeyæ”¯æŒä¸ºå‡½æ•°ã€æˆå‘˜æ–¹æ³•ã€å‡½æ•°å˜é‡ã€æ¥å£å’Œå…¨å±€å˜é‡æ‰“æ¡©ã€‚æ–‡ç« è¯¦ç»†å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Gomonkeyè¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¹¶åˆ—å‡ºäº†å¯èƒ½å¯¼è‡´æ‰“æ¡©å¤±è´¥çš„åŸå› ã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜è§£é‡Šäº†ä»€ä¹ˆæ˜¯å†…è”ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•ç¦ç”¨å†…è”è¿›è¡Œæµ‹è¯•ã€‚\nåŠŸèƒ½åˆ—è¡¨ æ”¯æŒä¸ºä¸€ä¸ªå‡½æ•°æ‰“ä¸€ä¸ªæ¡© æ”¯æŒä¸ºä¸€ä¸ªå‡½æ•°æ‰“ä¸€ä¸ªç‰¹å®šçš„æ¡©åºåˆ— æ”¯æŒä¸ºä¸€ä¸ªæˆå‘˜æ–¹æ³•æ‰“ä¸€ä¸ªæ¡© æ”¯æŒä¸ºä¸€ä¸ªæˆå‘˜æ–¹æ³•æ‰“ä¸€ä¸ªç‰¹å®šçš„æ¡©åºåˆ— æ”¯æŒä¸ºä¸€ä¸ªå‡½æ•°å˜é‡æ‰“ä¸€ä¸ªæ¡© æ”¯æŒä¸ºä¸€ä¸ªå‡½æ•°å˜é‡æ‰“ä¸€ä¸ªç‰¹å®šçš„æ¡©åºåˆ— æ”¯æŒä¸ºä¸€ä¸ªæ¥å£æ‰“æ¡© æ”¯æŒä¸ºä¸€ä¸ªæ¥å£æ‰“ä¸€ä¸ªç‰¹å®šçš„æ¡©åºåˆ— æ”¯æŒä¸ºä¸€ä¸ªå…¨å±€å˜é‡æ‰“ä¸€ä¸ªæ¡© æ‰“æ¡©å¤±è´¥çš„å¯èƒ½åŸå›  gomonkey ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚å¦‚æœæœ‰å¤šåç¨‹å¹¶å‘å¯¹åŒä¸€ä¸ªç›®æ ‡çš„æ‰“æ¡©çš„æƒ…å†µï¼Œåˆ™éœ€è¦å°†ä¹‹å‰çš„åç¨‹å…ˆä¼˜é›…é€€å‡ºã€‚ æ‰“æ¡©ç›®æ ‡ä¸ºå†…è”çš„å‡½æ•°æˆ–æˆå‘˜æ–¹æ³•ã€‚å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°-gcflags=-lï¼ˆgo1.10 ç‰ˆæœ¬ä¹‹å‰ï¼‰æˆ– -gcflags=all=-lï¼ˆgo1.10 ç‰ˆæœ¬åŠä¹‹åï¼‰å…³é—­å†…è”ä¼˜åŒ–ã€‚ gomonkey å¯¹äºç§æœ‰æˆå‘˜æ–¹æ³•çš„æ‰“æ¡©å¤±è´¥ã€‚go1.6 ç‰ˆæœ¬çš„åå°„æœºåˆ¶æ”¯æŒç§æœ‰æˆå‘˜æ–¹æ³•çš„æŸ¥è¯¢ï¼Œè€Œ go1.7 åŠä¹‹åçš„ç‰ˆæœ¬å´ä¸æ”¯æŒï¼Œæ‰€ä»¥å½“ç”¨æˆ·ä½¿ç”¨ go1.7 åŠä¹‹åçš„ç‰ˆæœ¬æ—¶ï¼Œgomonkey å¯¹äºç§æœ‰æˆå‘˜æ–¹æ³•çš„æ‰“æ¡©ä¼šè§¦å‘å¼‚å¸¸ã€‚ ç¤ºä¾‹ package monkey import ( \u0026#34;fmt\u0026#34; \u0026#34;reflect\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;github.com/agiledragon/gomonkey\u0026#34; . \u0026#34;github.com/smartystreets/goconvey/convey\u0026#34; ) // ############################################################### // ########################## ApplyFunc ########################## // ############################################################### func logicFunc(a, b int) (int, error) { sum, err := netWorkFunc(a, b) if err != nil { return 0, err } return sum, nil } func netWorkFunc(a, b int) (int, error) { if a \u0026lt; 0 \u0026amp;\u0026amp; b \u0026lt; 0 { errmsg := \u0026#34;a\u0026lt;0 \u0026amp;\u0026amp; b\u0026lt;0\u0026#34; //gomonkeyæœ‰bugï¼Œå‡½æ•°ä¸€å®šè¦æœ‰æ ˆåˆ†é…å˜é‡ï¼Œä¸ç„¶mockä¸ä½ return 0, fmt.Errorf(\u0026#34;%v\u0026#34;, errmsg) } return a + b, nil } func TestApplyFunc(t *testing.T) { Convey(\u0026#34;Test ApplyFunc: \u0026#34;, t, func() { // ä¸ºå‡½æ•°æ‰“æ¡© var patches = gomonkey.ApplyFunc(netWorkFunc, func(a, b int) (int, error) { return 20, nil }) defer patches.Reset() sum, err := logicFunc(10, 20) // logicFuncä¸­è°ƒç”¨äº†netWorkFunc So(sum, ShouldEqual, 20) So(err, ShouldBeNil) }) } // ############################################################### // ######################### ApplyMethod ######################### // ############################################################### type myType struct { } func (m *myType) logicFunc(a, b int) (int, error) { sum, err := m.NetWorkFunc(a, b) if err != nil { return 0, err } return sum, nil } func (m *myType) NetWorkFunc(a, b int) (int, error) { if a \u0026lt; 0 \u0026amp;\u0026amp; b \u0026lt; 0 { errmsg := \u0026#34;a\u0026lt;0 \u0026amp;\u0026amp; b\u0026lt;0\u0026#34; return 0, fmt.Errorf(\u0026#34;%v\u0026#34;, errmsg) } return a + b, nil } func TestApplyMethod(t *testing.T) { Convey(\u0026#34;Test ApplyMethod: \u0026#34;, t, func() { var p *myType patches := gomonkey.ApplyMethod(reflect.TypeOf(p), \u0026#34;NetWorkFunc\u0026#34;, func(_ *myType, a, b int) (int, error) { return 20, nil }) defer patches.Reset() var m myType sum, err := m.logicFunc(10, 20) So(sum, ShouldEqual, 20) So(err, ShouldBeNil) }) } // ############################################################### // ######################### ApplyGlobalVar ###################### // ############################################################### var num = 10 func TestApplyGlobalVar(t *testing.T) { Convey(\u0026#34;Test ApplyGlobalVar: \u0026#34;, t, func() { Convey(\u0026#34;change\u0026#34;, func() { patches := gomonkey.ApplyGlobalVar(\u0026amp;num, 150) defer patches.Reset() So(num, ShouldEqual, 150) }) Convey(\u0026#34;recover\u0026#34;, func() { So(num, ShouldEqual, 10) }) }) } // ############################################################### // ########################## ApplyFuncSeq ####################### // ############################################################### func getInt() (int) { a := 100 return a } func TestMockFuncSeq(t *testing.T) { Convey(\u0026#34;Test ApplyFuncSeq: \u0026#34;, t, func() { outputs := []gomonkey.OutputCell{ {Values:gomonkey.Params{2}, Times:1}, {Values:gomonkey.Params{1}, Times:0}, {Values:gomonkey.Params{3}, Times:2}, } var p1 = gomonkey.ApplyFuncSeq(getInt, outputs) defer p1.Reset() So(getInt(), ShouldEqual, 2) So(getInt(), ShouldEqual, 1) So(getInt(), ShouldEqual, 3) So(getInt(), ShouldEqual, 3) }) Convey(\u0026#34;Test ApplyFuncSeq: \u0026#34;, t, func () { So(getInt(), ShouldEqual, 100) }) } æ‰§è¡Œå‘½ä»¤ [iarno@nd01v monkey]$ go test -v -gcflags=-l . === RUN TestApplyFunc Test ApplyFunc: âœ”âœ” 2 total assertions --- PASS: TestApplyFunc (0.00s) === RUN TestApplyMethod Test ApplyMethod: âœ”âœ” 4 total assertions --- PASS: TestApplyMethod (0.00s) === RUN TestApplyGlobalVar Test ApplyGlobalVar: change âœ” recover âœ” 6 total assertions --- PASS: TestApplyGlobalVar (0.00s) === RUN TestMockFuncSeq Test ApplyFuncSeq: âœ”âœ”âœ”âœ” 10 total assertions Test ApplyFuncSeq: âœ” 11 total assertions --- PASS: TestMockFuncSeq (0.00s) PASS ok hellogolang/monkey (cached) ä»€ä¹ˆæ˜¯å†…è” ä¸ºäº†å‡å°‘å‡½æ•°è°ƒç”¨æ—¶çš„å †æ ˆç­‰å¼€é”€ï¼Œå¯¹äºç®€çŸ­çš„å‡½æ•°ï¼Œä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œç›´æ¥å†…åµŒè°ƒç”¨çš„ä»£ç ã€‚\næˆ‘ä»¬ç¦ç”¨ä¸‹å†…è”ï¼Œç„¶åæ‰§è¡Œï¼Œ go test -v -gcflags=-l monkey_test.go\nå‚è€ƒ https://github.com/agiledragon/gomonkey\nhttps://juejin.cn/post/7111691109528502286\n","permalink":"https://www.iarno.cn/article/gomonkey/","tags":null,"title":"Gomonkeyæµ‹è¯•æ¡†æ¶"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†GoConveyæµ‹è¯•æ¡†æ¶çš„ä½¿ç”¨ã€‚GoConveyæ˜¯ä¸€æ¬¾é’ˆå¯¹Golangçš„æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥ç®¡ç†å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæä¾›ä¸°å¯Œçš„æ–­è¨€å‡½æ•°ï¼Œå¹¶æ”¯æŒWebç•Œé¢ç‰¹æ€§ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å®‰è£…GoConveyï¼Œå¦‚ä½•ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶å±•ç¤ºäº†æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œç»“æœã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜æä¾›äº†ä¸€äº›ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„å»ºè®®å’Œå‚è€ƒé“¾æ¥ã€‚\nå¯ä»¥ç®¡ç†å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„æ–­è¨€å‡½æ•°ï¼Œå¹¶æ”¯æŒå¾ˆå¤š Web ç•Œé¢ç‰¹æ€§ã€‚\nGolangè™½ç„¶è‡ªå¸¦äº†å•å…ƒæµ‹è¯•åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨GoConveyæ¡†æ¶è¯ç”Ÿä¹‹å‰ä¹Ÿå‡ºç°äº†è®¸å¤šç¬¬ä¸‰æ–¹æµ‹è¯•æ¡†æ¶ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªæµ‹è¯•æ¡†æ¶åƒGoConveyä¸€æ ·èƒ½å¤Ÿè®©ç¨‹åºå‘˜å¦‚æ­¤ç®€æ´ä¼˜é›…çš„ç¼–å†™æµ‹è¯•ä»£ç ã€‚\nå®‰è£… go get github.com/smartystreets/goconvey æ¡ˆä¾‹ package convey import ( \u0026#34;testing\u0026#34; . \u0026#34;github.com/smartystreets/goconvey/convey\u0026#34; ) func ShouldCustomize(actual interface{}, expected ...interface{}) string { if actual == \u0026#34;ok\u0026#34; \u0026amp;\u0026amp; expected[0] == \u0026#34;ok\u0026#34; { return \u0026#34;\u0026#34; } else { return \u0026#34;Fail!!!\u0026#34; } } func TestConvey(t *testing.T) { Convey(\u0026#34;test convey == convey\u0026#34;, t, func() { So(\u0026#34;convey\u0026#34;, ShouldEqual, \u0026#34;convey\u0026#34;) }) Convey(\u0026#34;test convey == convery\u0026#34;, t, func() { So(\u0026#34;convey\u0026#34;, ShouldEqual, \u0026#34;convery\u0026#34;) }) // å®šåˆ¶æ–­è¨€å‡½æ•° Convey(\u0026#34;test customize should: \u0026#34;, t, func () { So(\u0026#34;ok\u0026#34;, ShouldCustomize, \u0026#34;ok\u0026#34;) So(\u0026#34;ok\u0026#34;, ShouldCustomize, \u0026#34;no\u0026#34;) }) } æ‰§è¡Œå‘½ä»¤ [iarno@xxx convey]$ go test -v . === RUN TestConvey test convey == convey âœ” 1 total assertion test convey == convery âœ˜ Failures: * /hellogolang/convey/convey_test.go Line 24: Expected: \u0026#39;convery\u0026#39; Actual: \u0026#39;convey\u0026#39; (Should be equal) Diff: \u0026#39;convery\u0026#39; 2 total assertions test customize should: âœ”âœ˜ Failures: * /hellogolang/convey/convey_test.go Line 29: Fail!!! 4 total assertions --- FAIL: TestConvey (0.00s) FAIL FAIL å°ç»“ import goconveyåŒ…æ—¶ï¼Œå‰é¢åŠ ç‚¹å·\u0026quot;.\u0026quot;ï¼Œä»¥å‡å°‘å†—ä½™çš„ä»£ç  æµ‹è¯•å‡½æ•°çš„åå­—å¿…é¡»ä»¥Testå¼€å¤´ï¼Œè€Œä¸”å‚æ•°ç±»å‹å¿…é¡»ä¸º*testing.T æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¿…é¡»ä½¿ç”¨Conveyè¯­å¥åŒ…è£¹èµ·æ¥ï¼Œæ¨èä½¿ç”¨Conveyè¯­å¥çš„åµŒå¥—ï¼Œå³ä¸€ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµ‹è¯•å‡½æ•°ï¼Œä¸€ä¸ªæµ‹è¯•å‡½æ•°åµŒå¥—ä¸¤å±‚æˆ–ä¸‰å±‚Conveyè¯­å¥ï¼šå½“ä½¿ç”¨éBDDé£æ ¼æ¥å†™æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œä¸€ä¸ªæµ‹è¯•å‡½æ•°ç”±ä¸¤å±‚Conveyè¯­å¥ç»„æˆï¼ˆç¬¬ä¸€å±‚Conveyè¯­å¥å¯¹åº”ç›®æ ‡å‡½æ•°ï¼Œç¬¬äºŒå±‚Conveyè¯­å¥å¯¹åº”æµ‹è¯•ç”¨ä¾‹ï¼‰ å‚è€ƒ https://github.com/smartystreets/goconvey\nhttps://www.jianshu.com/p/e3b2b1194830\n","permalink":"https://www.iarno.cn/article/goconvey/","tags":null,"title":"GoConveyæµ‹è¯•æ¡†æ¶"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨tcpdumpå·¥å…·æŠ“å–å’Œåˆ†æåŸŸåDNSè§£æè¿‡ç¨‹ã€‚é¦–å…ˆï¼Œä½¿ç”¨tcpdumpå‘½ä»¤å¯åŠ¨å¯¹DNSæŠ¥æ–‡çš„æŠ“åŒ…ã€‚ç„¶åï¼Œä½¿ç”¨hostå‘½ä»¤è¿›è¡ŒDNSæŸ¥è¯¢ã€‚æœ€åï¼Œåˆ†ætcpdumpçš„è¾“å‡ºç»“æœï¼Œè§£è¯»DNSæŸ¥è¯¢å’Œåº”ç­”æŠ¥æ–‡çš„å†…å®¹ã€‚æ–‡ç« è¿˜æåˆ°äº†å¦‚ä½•ä½¿ç”¨tcpdumpçš„-Xé€‰é¡¹ä»¥16è¿›åˆ¶å’ŒASCIIæ–¹å¼æ‰“å°æŠ¥æ–‡å†…å®¹ï¼Œä»¥åŠå¦‚ä½•å°†æŠ“åˆ°çš„æ•°æ®åŒ…å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå¯¼å…¥åˆ°Wiresharkä¸­æŸ¥çœ‹ã€‚\n1 .å¯åŠ¨ tcpdump å¯¹ DNS æŠ¥æ–‡è¿›è¡ŒæŠ“åŒ… tcpdump -i eth0 -nt -s 500 port domain ä½¿ç”¨port domainæ¥è¿‡æ»¤æ•°æ®åŒ…ï¼Œè¡¨ç¤ºåªæŠ“å–ä½¿ç”¨ domainï¼ˆåŸŸåï¼‰æœåŠ¡çš„æ•°æ®åŒ…ï¼Œå³ DNS æŸ¥è¯¢å’Œåº”ç­”æŠ¥æ–‡\n-i Listen on interface. If unspecified, tcpdump searches the system interface list for the lowest numbered, configured up interface (excluding loopback). Ties are broken by choosing the earliest match. On Linux systems with 2.2 or later kernels, an interface argument of â€˜â€˜anyâ€™â€™ can be used to capture packets from all interfaces. Note that captures on the â€˜â€˜anyâ€™â€™ device will not be done in promiscuous mode. If the -D flag is supported, an interface number as printed by that flag can be used as the interface argument. -n Donâ€™t convert host addresses to names. This can be used to avoid DNS lookups. -t Donâ€™t print a timestamp on each dump line. -s Snarf snaplen bytes of data from each packet rather than the default of 65535 bytes. Packets truncated because of a limited snapshot are indicated in the output with â€˜â€˜[|proto]â€™â€™, where proto is the name of the protocol level at which the truncation has occurred. Note that taking larger snapshots both increases the amount of time it takes to process packets and, effectively, decreases the amount of packet buffering. This may cause packets to be lost. You should limit snaplen to the smallest number that will capture the protocol information youâ€™re interested in. Setting snaplen to 0 sets it to the default of 65535, for backwards compatibility with recent older versions of tcpdump. -X When parsing and printing, in addition to printing the headers of each packet, print the data of each packet (minus its link level header) in hex and ASCII. This is very handy for analysing new protocols. 2 .ä½¿ç”¨ host å‘½ä»¤è¿›è¡Œ DNS æŸ¥è¯¢ å‘½ä»¤å¦‚ä¸‹ï¼š\nhost -t A www.baidu.com 3.åˆ†æ tcpdump è¾“å‡º å½“æ‰§è¡Œå®Œç¬¬ 2 æ­¥åï¼Œtcpdump å°±ä¼šæœ‰è¾“å‡ºï¼Œå¦‚ä¸‹ï¼š\n[root@iZ25p102vo3Z ~]# tcpdump -i eth0 -nt -s 500 port domain tcpdump: verbose output suppressed, use -v or -vv for full protocol decode listening on eth0, link-type EN10MB (Ethernet), capture size 500 bytes IP 10.162.201.34.48965 \u0026gt; 10.202.72.118.domain: 18831+ A? www.qq.com. (28) IP 10.202.72.118.domain \u0026gt; 10.162.201.34.48965: 18831 1/4/9 A 101.226.103.106 (275) è¿™ä¸¤ä¸ªæ•°æ®åŒ…å¼€å§‹çš„â€œIPâ€æŒ‡å‡ºï¼Œå®ƒä»¬åé¢çš„å†…å®¹æè¿°çš„æ˜¯ IP æ•°æ®æŠ¥ã€‚ Tcpdump ä»¥ â€œIP åœ°å€.ç«¯å£å·â€ çš„å½¢å¼æ¥æè¿°é€šä¿¡çš„æŸä¸€ç«¯ï¼› ä»¥ â€œ\u0026gt;â€ è¡¨ç¤ºæ•°æ®ä¼ è¾“çš„æ–¹å‘ï¼Œâ€œ\u0026gt;â€ å‰é¢æ˜¯æºç«¯ï¼Œåé¢æ˜¯ç›®çš„ç«¯ã€‚ å¯è§ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…æ˜¯æµ‹è¯•æœºå™¨ï¼ˆIP åœ°å€æ˜¯ 10.162.201.34ï¼‰å‘å…¶é¦–é€‰ DNS æœåŠ¡å™¨ï¼ˆIP åœ°å€æ˜¯ 10.202.72.118ï¼‰ å‘é€çš„ DNS æŸ¥è¯¢æŠ¥æ–‡ï¼ˆç›®æ ‡ç«¯å£ 53 æ˜¯ DNS æœåŠ¡ä½¿ç”¨çš„ç«¯å£ï¼‰ï¼Œ ç¬¬äºŒä¸ªæ•°æ®åŒ…æ˜¯æœåŠ¡å™¨åé¦ˆçš„ DNS åº”ç­”æŠ¥æ–‡ã€‚\nç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸­ï¼Œæ•°å€¼ 18831 æ˜¯ DNS æŸ¥è¯¢æŠ¥æ–‡çš„æ ‡è¯†å€¼ï¼Œå› æ­¤è¯¥å€¼ä¹Ÿå‡ºç°åœ¨ DNS åº”ç­”æŠ¥æ–‡ä¸­ã€‚ â€œ+â€ è¡¨ç¤ºå¯ç”¨é€’å½’æŸ¥è¯¢æ ‡å¿—ã€‚ â€œA?â€ è¡¨ç¤ºä½¿ç”¨ A ç±»å‹çš„æŸ¥è¯¢æ–¹å¼ã€‚ â€œwww.qq.comâ€ åˆ™æ˜¯ DNS æŸ¥è¯¢é—®é¢˜ä¸­çš„æŸ¥è¯¢åã€‚ æ‹¬å·ä¸­çš„æ•°å€¼ 28 æ˜¯ DNS æŸ¥è¯¢æŠ¥æ–‡çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚\nç¬¬äºŒä¸ªæ•°æ®åŒ…ä¸­ï¼Œâ€œ1/4/9â€ è¡¨ç¤ºè¯¥æŠ¥æ–‡ä¸­åŒ…å« 1 ä¸ªåº”ç­”èµ„æºè®°å½•ã€4 ä¸ªæˆæƒèµ„æºè®°å½•å’Œ 9 ä¸ªé¢å¤–ä¿¡æ¯è®°å½•ã€‚ è¯¥åº”ç­”æŠ¥æ–‡çš„é•¿åº¦ä¸º 275 å­—èŠ‚ã€‚\næ³¨æ„ï¼šæˆ‘ä»¬æŠ“åŒ…çš„æ—¶å€™æ²¡æœ‰å¼€å¯ tcpdump çš„ -X é€‰é¡¹ï¼ˆæˆ–è€… -x é€‰é¡¹ï¼‰ã€‚ å¦‚æœä½¿ç”¨ -X é€‰é¡¹ï¼Œæˆ‘ä»¬å°†èƒ½çœ‹åˆ° DNS æŠ¥æ–‡çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±èƒ½æ˜ç™½ä¸Šé¢ 28 å­—èŠ‚çš„æŸ¥è¯¢æŠ¥æ–‡å’Œ 275 å­—èŠ‚çš„åº”ç­”æŠ¥æ–‡çš„å…·ä½“å«ä¹‰ã€‚\nä¸Šé¢ä½¿ç”¨ -X é€‰é¡¹ï¼Œæ˜¯ä»¥ 16 è¿›åˆ¶å’Œ ASCII æ–¹å¼æ‰“å°ï¼Œä¸å¤ªç›´è§‚åœ°çœ‹å‡ºæ¥æŠ¥æ–‡å†…å®¹ï¼Œ è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Tcpdump å°†æŠ“åˆ°çš„æ•°æ®åŒ…å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå¯¼å…¥åˆ° Wireshark ä¸­æŸ¥çœ‹ã€‚\n[root@VM_15_187_centos ~]# tcpdump -i eth0 -nt -s 500 -X port domain -w dns-dump.pcap -v tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 500 bytes ^C2 packets captured 2 packets received by filter 0 packets dropped by kernel è½¬è½½ https://jaminzhang.github.io/dns/use-tcpdump-to-analyze-dns-communication/\n","permalink":"https://www.iarno.cn/article/tcpdump-dns/","tags":["dnsæŠ“åŒ…"],"title":"ä½¿ç”¨tcpdumpæŸ¥çœ‹åŸŸåDNSè§£æè¿‡ç¨‹"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦åˆ†æäº†Goè¯­è¨€ä¸­ä¸åŒJSONåº“çš„æ€§èƒ½ã€‚ä½œè€…æµ‹è¯•äº†ffjsonã€easyjsonã€jsoniterã€codecjsonå’Œjsonparserç­‰åº“ï¼Œç»“æœæ˜¾ç¤ºeasyjsonåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹é¢è¡¨ç°æœ€ä¼˜ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ã€‚jsoniteræ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œä¸”100%å…¼å®¹åŸç”Ÿåº“ã€‚ffjsonå’Œcodecjsonçš„æ€§èƒ½æå‡ä¸æ˜æ˜¾ï¼Œè€Œjsonparserå¹¶ä¸é€‚åˆè¿™æ ·çš„åœºæ™¯ã€‚ä½œè€…å»ºè®®åœ¨è¿½æ±‚æè‡´æ€§èƒ½æ—¶è€ƒè™‘ä½¿ç”¨easyjsonï¼Œå¦åˆ™ä½¿ç”¨jsoniterã€‚\nGo è¯­è¨€é‡Œé¢åŸç”Ÿæ”¯æŒäº†è¿™ç§æ•°æ®æ ¼å¼çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–ï¼Œå†…éƒ¨ä½¿ç”¨åå°„æœºåˆ¶å®ç°ï¼Œæ€§èƒ½æœ‰ç‚¹å·®ï¼Œåœ¨é«˜åº¦ä¾èµ– json è§£æçš„åº”ç”¨é‡Œï¼Œå¾€å¾€ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¥½åœ¨å·²æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“å¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™ä¹ˆå¤šåº“ï¼Œå¯¹äºåƒæˆ‘è¿™ç§æœ‰é€‰æ‹©å›°éš¾ç—‡çš„äººæ¥è¯´ï¼Œåˆ°åº•è¦æ€ä¹ˆé€‰æ‹©å‘¢ï¼Œä¸‹é¢å°±ç»™å¤§å®¶æ¥ä¸€ä¸€åˆ†æä¸€ä¸‹\nffjson go get -u github.com/pquerna/ffjson åŸç”Ÿçš„åº“æ€§èƒ½æ¯”è¾ƒå·®çš„ä¸»è¦åŸå› æ˜¯ä½¿ç”¨äº†å¾ˆå¤šåå°„çš„æœºåˆ¶ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œffjson é€šè¿‡é¢„ç¼–è¯‘ç”Ÿæˆä»£ç ï¼Œç±»å‹çš„åˆ¤æ–­åœ¨é¢„ç¼–è¯‘é˜¶æ®µå·²ç»ç¡®å®šï¼Œé¿å…äº†åœ¨è¿è¡Œæ—¶çš„åå°„\nä½†ä¹Ÿå› æ­¤åœ¨ç¼–è¯‘å‰éœ€è¦å¤šä¸€ä¸ªæ­¥éª¤ï¼Œéœ€è¦å…ˆç”Ÿæˆ ffjson ä»£ç ï¼Œç”Ÿæˆä»£ç åªéœ€è¦æ‰§è¡Œ ffjson \u0026lt;file.go\u0026gt; å°±å¯ä»¥äº†ï¼Œå…¶ä¸­ file.go æ˜¯ä¸€ä¸ªåŒ…å« json ç»“æ„ä½“å®šä¹‰çš„ go æ–‡ä»¶ã€‚æ³¨æ„è¿™é‡Œ ffjson æ˜¯è¿™ä¸ªåº“æä¾›çš„ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼Œç›´æ¥æ‰§è¡Œä¸Šé¢çš„ go get ä¼šæŠŠè¿™ä¸ªå·¥å…·å®‰è£…åœ¨ $GOPATH/bin ç›®å½•ä¸‹ï¼ŒæŠŠ $GOPATH/bin åŠ åˆ° $PATH ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œå¯ä»¥å…¨å±€è®¿é—®\nå¦å¤–ï¼Œå¦‚æœæœ‰äº›ç»“æ„ï¼Œä¸æƒ³è®© ffjson ç”Ÿæˆä»£ç ï¼Œå¯ä»¥é€šè¿‡å¢åŠ æ³¨é‡Šçš„æ–¹å¼\n// ffjson: skip type Foo struct { Bar string } // ffjson: nodecoder type Foo struct { Bar string } easyjson go get -u github.com/mailru/easyjson/... easyjson çš„æ€æƒ³å’Œ ffjson æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å¢åŠ ä¸€ä¸ªé¢„ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œé¢„å…ˆç”Ÿæˆå¯¹åº”ç»“æ„çš„åºåˆ—åŒ–ååºåˆ—åŒ–ä»£ç ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œeasyjson è¿˜æ”¾å¼ƒäº†ä¸€äº›åŸç”Ÿåº“é‡Œé¢æ”¯æŒçš„ä¸€äº›ä¸å¿…è¦çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼škey ç±»å‹å£°æ˜ï¼Œkey å¤§å°å†™ä¸æ•æ„Ÿç­‰ç­‰ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„æ€§èƒ½\nç”Ÿæˆä»£ç æ‰§è¡Œ easyjson -all \u0026lt;file.go\u0026gt; å³å¯ï¼Œå¦‚æœä¸æŒ‡å®š -all å‚æ•°ï¼Œåªä¼šå¯¹å¸¦æœ‰ //easyjson:json çš„ç»“æ„ç”Ÿæˆä»£ç \n//easyjson:json type A struct { Bar string } jsoniter go get -u github.com/json-iterator/go è¿™æ˜¯ä¸€ä¸ªå¾ˆç¥å¥‡çš„åº“ï¼Œæ»´æ»´å¼€å‘çš„ï¼Œä¸åƒ easyjson å’Œ ffjson éƒ½ä½¿ç”¨äº†é¢„ç¼–è¯‘ï¼Œè€Œä¸” 100% å…¼å®¹åŸç”Ÿåº“ï¼Œä½†æ˜¯æ€§èƒ½è¶…çº§å¥½ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆå®ç°çš„ï¼Œå¦‚æœæœ‰äººçŸ¥é“çš„è¯ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä¸€ä¸‹å—ï¼Ÿ\nä½¿ç”¨ä¸Šé¢ï¼Œä½ åªè¦æŠŠæ‰€æœ‰çš„\nimport \u0026#34;encoding/json\u0026#34; æ›¿æ¢æˆ\nimport \u0026#34;github.com/json-iterator/go\u0026#34; var json = jsoniter.ConfigCompatibleWithStandardLibrary å°±å¯ä»¥äº†ï¼Œå…¶å®ƒéƒ½ä¸éœ€è¦åŠ¨\ncodec-json go get -u github.com/ugorji/go/codec è¿™ä¸ªåº“é‡Œé¢å…¶å®åŒ…å«å¾ˆå¤šå†…å®¹ï¼Œjson åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ¯”è¾ƒè€ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ€§èƒ½ä¹Ÿä¸æ˜¯å¾ˆå¥½\njsonparser go get -u github.com/buger/jsonparser ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ªåº“ä¸å±äº json åºåˆ—åŒ–çš„åº“ï¼Œåªæ˜¯æä¾›äº†ä¸€äº› json è§£æçš„æ¥å£ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦è‡ªå·±å»è®¾ç½®ç»“æ„é‡Œé¢çš„å€¼ï¼Œäº‹å®ä¸Šï¼Œæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦é‡æ–°è§£æ json å¯¹è±¡ï¼Œæ€§èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½\nå°±åƒåå­—æš—ç¤ºçš„é‚£æ ·ï¼Œè¿™ä¸ªåº“åªæ˜¯ä¸€ä¸ªè§£æåº“ï¼Œå¹¶æ²¡æœ‰åºåˆ—åŒ–çš„æ¥å£\næ€§èƒ½æµ‹è¯• å¯¹ä¸Šé¢è¿™äº› json åº“ï¼Œä½œäº†ä¸€äº›æ€§èƒ½æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç åœ¨ï¼šhttps://github.com/hatlonely/\u0026hellip;ï¼Œä¸‹é¢æ˜¯åœ¨æˆ‘çš„ Macbook ä¸Šæµ‹è¯•çš„ç»“æœï¼ˆå®é™…ç»“æœå’Œåº“çš„ç‰ˆæœ¬ä»¥åŠæœºå™¨ç¯å¢ƒæœ‰å…³ï¼Œå»ºè®®è‡ªå·±å†æµ‹è¯•ä¸€éï¼‰ï¼š\nBenchmarkMarshalStdJson-4 1000000 1097 ns/op BenchmarkMarshalJsonIterator-4 2000000 781 ns/op BenchmarkMarshalFfjson-4 2000000 941 ns/op BenchmarkMarshalEasyjson-4 3000000 513 ns/op BenchmarkMarshalCodecJson-4 1000000 1074 ns/op BenchmarkMarshalCodecJsonWithBufio-4 1000000 2161 ns/op BenchmarkUnMarshalStdJson-4 500000 2512 ns/op BenchmarkUnMarshalJsonIterator-4 2000000 591 ns/op BenchmarkUnMarshalFfjson-4 1000000 1127 ns/op BenchmarkUnMarshalEasyjson-4 2000000 608 ns/op BenchmarkUnMarshalCodecJson-4 20000 122694 ns/op BenchmarkUnMarshalCodecJsonWithBufio-4 500000 3417 ns/op BenchmarkUnMarshalJsonparser-4 2000000 877 ns/op ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼š\neasyjson æ— è®ºæ˜¯åºåˆ—åŒ–è¿˜æ˜¯ååºåˆ—åŒ–éƒ½æ˜¯æœ€ä¼˜çš„ï¼Œåºåˆ—åŒ–æå‡äº†1å€ï¼Œååºåˆ—åŒ–æå‡äº†3å€ jsoniter æ€§èƒ½ä¹Ÿå¾ˆå¥½ï¼Œæ¥è¿‘äºeasyjsonï¼Œå…³é”®æ˜¯æ²¡æœ‰é¢„ç¼–è¯‘è¿‡ç¨‹ï¼Œ100%å…¼å®¹åŸç”Ÿåº“ ffjson çš„åºåˆ—åŒ–æå‡å¹¶ä¸æ˜æ˜¾ï¼Œååºåˆ—åŒ–æå‡äº†1å€ codecjson å’ŒåŸç”Ÿåº“ç›¸æ¯”ï¼Œå·®ä¸å¤ªå¤šï¼Œç”šè‡³æ›´å·® jsonparser ä¸å¤ªé€‚åˆè¿™æ ·çš„åœºæ™¯ï¼Œæ€§èƒ½æå‡å¹¶ä¸æ˜æ˜¾ï¼Œè€Œä¸”æ²¡æœ‰ååºåˆ—åŒ– æ‰€ä»¥ç»¼åˆè€ƒè™‘ï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨ jsoniterï¼Œå¦‚æœè¿½æ±‚æè‡´çš„æ€§èƒ½ï¼Œè€ƒè™‘ easyjson\nå‚è€ƒé“¾æ¥ ffjson: https://github.com/pquerna/ff\u0026hellip;\neasyjson: https://github.com/mailru/eas\u0026hellip;\njsoniter: https://github.com/json-itera\u0026hellip;\njsonparser: https://github.com/buger/json\u0026hellip;\ncodecjson: http://ugorji.net/blog/go-cod\u0026hellip;\ngolang-jsonæ€§èƒ½å¯¹æ¯”:https://github.com/iarno/golang-json\nè½¬è½½ https://segmentfault.com/a/1190000013022780\n","permalink":"https://www.iarno.cn/article/golang-json/","tags":null,"title":"Golang json æ€§èƒ½åˆ†æ"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« è¯¦è¿°äº†Goè¯­è¨€çš„benchmarkæ€§èƒ½æµ‹è¯•çš„ä½¿ç”¨æ–¹æ³•å’Œè§£æã€‚å®ƒè¯¦ç»†é˜è¿°äº†go testå‘½ä»¤çš„å‚æ•°åŠå…¶ä½œç”¨ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå®ä¾‹å±•ç¤ºäº†å¦‚ä½•è¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œç»“æœåˆ†æã€‚æ–‡ç« è¿˜ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨pprofè¿›è¡Œæ€§èƒ½åˆ†æï¼Œå¹¶æä¾›äº†ç›¸å…³çš„å‚è€ƒé“¾æ¥ã€‚\nä½¿ç”¨æ–¹æ³• ä¸‹é¢å±•ç¤ºä¸€ä¸ªåŸºå‡†æµ‹è¯•çš„ç¤ºä¾‹ä»£ç æ¥å‰–æä¸‹å®ƒçš„ä½¿ç”¨æ–¹å¼ï¼š\nfunc Benchmark_test(b *testing.B) { for i := 0; i \u0026lt; b.N ; i++ { s := make([]int, 0) for i := 0; i \u0026lt; 10000; i++ { s = append(s, i) } } } è¿›è¡ŒåŸºå‡†æµ‹è¯•çš„æ–‡ä»¶å¿…é¡»ä»¥*_test.goçš„æ–‡ä»¶ä¸ºç»“å°¾ï¼Œè¿™ä¸ªå’Œæµ‹è¯•æ–‡ä»¶çš„åç§°åç¼€æ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚abc_test.go å‚ä¸BenchmarkåŸºå‡†æ€§èƒ½æµ‹è¯•çš„æ–¹æ³•å¿…é¡»ä»¥Benchmarkä¸ºå‰ç¼€ï¼Œä¾‹å¦‚BenchmarkABC() å‚ä¸åŸºå‡†æµ‹è¯•å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡å‘Benchmarkç±»å‹çš„æŒ‡é’ˆä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œ*testing.B åŸºå‡†æµ‹è¯•å‡½æ•°ä¸èƒ½æœ‰è¿”å›å€¼ b.ResetTimeræ˜¯é‡ç½®è®¡æ—¶å™¨ï¼Œè°ƒç”¨æ—¶è¡¨ç¤ºé‡æ–°å¼€å§‹è®¡æ—¶ï¼Œå¯ä»¥å¿½ç•¥æµ‹è¯•å‡½æ•°ä¸­çš„ä¸€äº›å‡†å¤‡å·¥ä½œ b.Næ˜¯åŸºå‡†æµ‹è¯•æ¡†æ¶æä¾›çš„ï¼Œè¡¨ç¤ºå¾ªç¯çš„æ¬¡æ•°ï¼Œå› ä¸ºéœ€è¦åå¤è°ƒç”¨æµ‹è¯•çš„ä»£ç ï¼Œæ‰å¯ä»¥è¯„ä¼°æ€§èƒ½ å‘½ä»¤åŠå‚æ•° æ€§èƒ½æµ‹è¯•å‘½ä»¤ä¸ºgo test [å‚æ•°]ï¼Œæ¯”å¦‚go test -bench=. -benchmemï¼Œå…·ä½“çš„å‘½ä»¤å‚æ•°åŠå«ä¹‰å¦‚ä¸‹ï¼š\nå‚æ•° å«ä¹‰ -bench regexp æ€§èƒ½æµ‹è¯•ï¼Œæ”¯æŒè¡¨è¾¾å¼å¯¹æµ‹è¯•å‡½æ•°è¿›è¡Œç­›é€‰ã€‚ -bench . åˆ™æ˜¯å¯¹æ‰€æœ‰çš„benchmarkå‡½æ•°æµ‹è¯•ï¼ŒæŒ‡å®šåç§°åˆ™åªæ‰§è¡Œå…·ä½“æµ‹è¯•æ–¹æ³•è€Œä¸æ˜¯å…¨éƒ¨ -benchmem æ€§èƒ½æµ‹è¯•çš„æ—¶å€™æ˜¾ç¤ºæµ‹è¯•å‡½æ•°çš„å†…å­˜åˆ†é…çš„ç»Ÿè®¡ä¿¡æ¯ ï¼count n è¿è¡Œæµ‹è¯•å’Œæ€§èƒ½å¤šå°‘æ­¤ï¼Œé»˜è®¤ä¸€æ¬¡ -run regexp åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•å‡½æ•°ï¼Œ æ¯”å¦‚-run ABCåªæµ‹è¯•å‡½æ•°åä¸­åŒ…å«ABCçš„æµ‹è¯•å‡½æ•° -timeout t æµ‹è¯•æ—¶é—´å¦‚æœè¶…è¿‡t, panic,é»˜è®¤10åˆ†é’Ÿ -v æ˜¾ç¤ºæµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¹Ÿä¼šæŠŠLogã€Logfæ–¹æ³•çš„æ—¥å¿—æ˜¾ç¤ºå‡ºæ¥ æµ‹è¯•ç»“æœ æ‰§è¡Œå‘½ä»¤åï¼Œæ€§èƒ½æµ‹è¯•çš„ç»“æœå±•ç¤ºå¦‚ä¸‹\n$ go test -bench=. -benchmem goos: darwin goarch: amd64 pkg: program/benchmark cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz Benchmark_test-12 7439091 152.0 ns/op 248 B/op 5 allocs/op PASS ok promgram/benchmark 1.304s å¯¹ä»¥ä¸Šç»“æœè¿›è¡Œé€ä¸€åˆ†æï¼š\nç»“æœé¡¹ å«ä¹‰ Benchmark_test-12 Benchmark_test æ˜¯æµ‹è¯•çš„å‡½æ•°å -12 è¡¨ç¤ºGOMAXPROCSï¼ˆçº¿ç¨‹æ•°ï¼‰çš„å€¼ä¸º12 7439091 è¡¨ç¤ºä¸€å…±æ‰§è¡Œäº†7439091æ¬¡ï¼Œå³b.Nçš„å€¼ 152.0 ns/op è¡¨ç¤ºå¹³å‡æ¯æ¬¡æ“ä½œèŠ±è´¹äº†152.0çº³ç§’ 248B/op è¡¨ç¤ºæ¯æ¬¡æ“ä½œç”³è¯·äº†248Byteçš„å†…å­˜ç”³è¯· 5 allocs/op è¡¨ç¤ºæ¯æ¬¡æ“ä½œç”³è¯·äº†5æ¬¡å†…å­˜ æ€§èƒ½å¯¹æ¯”å®ä¾‹ ä¸‹é¢é€šè¿‡ä¸€ä¸ªæ•°å­—è½¬æ¢å­—ç¬¦ä¸²çš„å®ä¾‹æ¥å¯¹æ¯”æ€§èƒ½æµ‹è¯•æ•ˆæœï¼Œå¹¶è¿›è¡Œåˆ†æã€‚\n//Sprintf func BenchmarkSprintf(b *testing.B) { num := 10 b.ResetTimer() for i := 0; i \u0026lt; b.N; i++ { fmt.Sprintf(\u0026#34;%d\u0026#34;, num) } } //Format func BenchmarkFormat(b *testing.B) { num := int64(10) b.ResetTimer() for i := 0; i \u0026lt; b.N; i++ { strconv.FormatInt(num, 10) } } //Itoa func BenchmarkItoa(b *testing.B) { num := 10 b.ResetTimer() for i := 0; i \u0026lt; b.N; i++ { strconv.Itoa(num) } } ä¸‹é¢æ‰§è¡Œå‘½ä»¤go test -bench=. -benchmemï¼Œæ”¶åˆ°æµ‹è¯•æŠ¥å‘Šå¦‚ä¸‹ï¼š\n% go test -bench=. -benchmem goos: darwin goarch: amd64 pkg: program/benchmark cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz BenchmarkSprintf-12 16364854 63.70 ns/op 2 B/op 1 allocs/op BenchmarkFormat-12 493325650 2.380 ns/op 0 B/op 0 allocs/op BenchmarkItoa-12 481683436 2.503 ns/op 0 B/op 0 allocs/op PASS ok program/benchmark 4.007s å¯ä»¥å‘ç°ï¼ŒBenchmarkSprintfæ–¹æ³•è€—æ—¶æœ€é•¿ï¼ŒBenchmarkFormatæœ€å¿«ï¼ŒBenchmarkItoaä¹Ÿå¾ˆå¿«ã€‚å·®åˆ«åœ¨äºfmt.Sprintf()æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œäº†ä¸€æ¬¡å†…å­˜åˆ†é…1 allocs/opã€‚\nç»“åˆpprofåˆ†æ å‚æ•° å«ä¹‰ å‘½ä»¤ç¤ºä¾‹ -cpuprofile [file] è¾“å‡ºcpuæ€§èƒ½æ–‡ä»¶ go test -bench=. -benchmem -cpuprofile=cpu.out -memprofile [file] è¾“å‡ºmemå†…å­˜æ€§èƒ½æ–‡ä»¶ go test -bench=. -benchmem -memprofile=cpu.out ç”Ÿæˆçš„CPUã€å†…å­˜æ–‡ä»¶å¯ä»¥é€šè¿‡go tool pprof [file]è¿›è¡ŒæŸ¥çœ‹ï¼Œç„¶ååœ¨pprofä¸­é€šè¿‡list [file]æ–¹æ³•æŸ¥çœ‹CPUã€å†…å­˜çš„è€—æ—¶æƒ…å†µ\n### å†…å­˜æƒ…å†µ (pprof) list BenchmarkArrayAppend Total: 36.49GB ROUTINE ======================== program/benchmark.BenchmarkArrayAppend in /Users/guanjian/workspace/go/program/benchmark/benchmark_test.go 11.98GB 11.98GB (flat, cum) 32.83% of Total . . 7://Array . . 8:func BenchmarkArrayAppend(b *testing.B) { . . 9: for i := 0; i \u0026lt; b.N; i++ { . . 10: var arr []int . . 11: for i := 0; i \u0026lt; 10000; i++ { 11.98GB 11.98GB 12: arr = append(arr, i) . . 13: } . . 14: } . . 15:} ## CPUæƒ…å†µ (pprof) list BenchmarkArrayAppend Total: 8.86s ROUTINE ======================== program/benchmark.BenchmarkArrayAppend in /Users/guanjian/workspace/go/program/benchmark/benchmark_test.go 10ms 640ms (flat, cum) 7.22% of Total . . 6: . . 7://Array . . 8:func BenchmarkArrayAppend(b *testing.B) { . . 9: for i := 0; i \u0026lt; b.N; i++ { . . 10: var arr []int 10ms 10ms 11: for i := 0; i \u0026lt; 10000; i++ { . 630ms 12: arr = append(arr, i) . . 13: } . . 14: } . . 15:} æ€»ç»“ goæä¾›äº†benchmarkæ€§èƒ½æµ‹è¯•çš„å·¥å…·ï¼Œæä¾›äº†å¯¹å‡½æ•°ä½¿ç”¨å†…å­˜ã€CPUç­‰æƒ…å†µçš„æŠ¥å‘Šåˆ†æï¼Œè¿˜å¯ä»¥å€ŸåŠ©pprofè·å¾—æ›´å¥½çš„åˆ†ææŠ¥å‘Šç­‰ï¼Œå¦‚æœæƒ³è¦æ·±å…¥åˆ†æï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¹‹å‰ä»‹ç»çš„gdbè¿›è¡Œåº•å±‚ä»£ç çš„é“¾è·¯è·Ÿè¸ªï¼Œä»¥åŠå¯¹ä»£ç è¿›è¡Œåç¼–è¯‘æŸ¥çœ‹å…·ä½“çš„æ€§èƒ½æŸè€—æƒ…å†µã€‚\nå‚è€ƒ go benchmark æ€§èƒ½æµ‹è¯• å•å…ƒæµ‹è¯• åŸºå‡†æµ‹è¯• ä½¿ç”¨æ–¹æ³•è¯¦è§£ go benchmark æ€§èƒ½æµ‹è¯• è½¬è½½ https://juejin.cn/post/6970615934255906830\n","permalink":"https://www.iarno.cn/article/benchmark/","tags":null,"title":"Golang benchmark æ€§èƒ½æµ‹è¯•"},{"categories":["BigData"],"contents":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†Mavençš„å®‰è£…å’Œä½¿ç”¨ï¼ŒåŒ…æ‹¬é¡¹ç›®æ„å»ºã€ä¾èµ–ç®¡ç†ç­‰ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å¹¶é…ç½®Mavenï¼Œç„¶åé€šè¿‡pom.xmlæ–‡ä»¶è¿›è¡Œé¡¹ç›®ç®¡ç†ã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨Mavenåˆ›å»ºJavaåº”ç”¨ï¼Œä»¥åŠå¦‚ä½•æ„å»ºå’Œæµ‹è¯•é¡¹ç›®ã€‚æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•æ‰§è¡ŒjaråŒ…ï¼ŒåŒ…æ‹¬pom.xmlæ–‡ä»¶ä¸­éœ€è¦å¼•å…¥çš„assemblyæ’ä»¶å’Œæ‰§è¡Œå‘½ä»¤ã€‚\nä¸‹è½½ https://www.runoob.com/maven/maven-setup.html\nçº¦å®šé…ç½® Maven æå€¡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ ‡å‡†ç›®å½•ç»“æ„ï¼ŒMaven ä½¿ç”¨çº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ï¼Œå¤§å®¶å°½å¯èƒ½çš„éµå®ˆè¿™æ ·çš„ç›®å½•ç»“æ„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\nç›®å½• ç›®çš„ ${basedir} å­˜æ”¾pom.xmlå’Œæ‰€æœ‰çš„å­ç›®å½• ${basedir}/src/main/java é¡¹ç›®çš„javaæºä»£ç  ${basedir}/src/main/resources é¡¹ç›®çš„èµ„æºï¼Œæ¯”å¦‚è¯´propertyæ–‡ä»¶ï¼Œspringmvc.xml ${basedir}/src/test/java é¡¹ç›®çš„æµ‹è¯•ç±»ï¼Œæ¯”å¦‚è¯´Junitä»£ç  ${basedir}/src/test/resources æµ‹è¯•ç”¨çš„èµ„æº ${basedir}/src/main/webapp/WEB-INF webåº”ç”¨æ–‡ä»¶ç›®å½•ï¼Œwebé¡¹ç›®çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å­˜æ”¾web.xmlã€æœ¬åœ°å›¾ç‰‡ã€jspè§†å›¾é¡µé¢ ${basedir}/target æ‰“åŒ…è¾“å‡ºç›®å½• ${basedir}/target/classes ç¼–è¯‘è¾“å‡ºç›®å½• ${basedir}/target/test-classes æµ‹è¯•ç¼–è¯‘è¾“å‡ºç›®å½• Test.java Mavenåªä¼šè‡ªåŠ¨è¿è¡Œç¬¦åˆè¯¥å‘½åè§„åˆ™çš„æµ‹è¯•ç±» ~/.m2/repository Mavené»˜è®¤çš„æœ¬åœ°ä»“åº“ç›®å½•ä½ç½® pom.xmlè¯´æ˜ https://www.runoob.com/maven/maven-pom.html\né…ç½®é˜¿é‡Œäº‘ä»“åº“ \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;alimaven\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;aliyun maven\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://maven.aliyun.com/nexus/content/groups/public/\u0026lt;/url\u0026gt; \u0026lt;mirrorOf\u0026gt;central\u0026lt;/mirrorOf\u0026gt; \u0026lt;/mirror\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;UK\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;UK Central\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://uk.maven.org/maven2\u0026lt;/url\u0026gt; \u0026lt;mirrorOf\u0026gt;central\u0026lt;/mirrorOf\u0026gt; \u0026lt;/mirror\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;ibiblio.org\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;ibiblio Mirror of http://repo1.maven.org/maven2/\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://mirrors.ibiblio.org/pub/mirrors/maven2\u0026lt;/url\u0026gt; \u0026lt;mirrorOf\u0026gt;central\u0026lt;/mirrorOf\u0026gt; \u0026lt;!-- United States, North Carolina --\u0026gt; \u0026lt;/mirror\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;jboss-public-repository-group\u0026lt;/id\u0026gt; \u0026lt;mirrorOf\u0026gt;central\u0026lt;/mirrorOf\u0026gt; \u0026lt;name\u0026gt;JBoss Public Repository Group\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://repository.jboss.org/nexus/content/groups/public\u0026lt;/url\u0026gt; \u0026lt;/mirror\u0026gt; Maven æ„å»º Java é¡¹ç›® Maven ä½¿ç”¨åŸå‹ archetype æ’ä»¶åˆ›å»ºé¡¹ç›®ã€‚è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ Java åº”ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ maven-archetype-quickstart æ’ä»¶ã€‚\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ C:\\MVN æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåŸºäº maven çš„ java åº”ç”¨é¡¹ç›®ã€‚\nå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š\nmvn archetype:generate \u0026#34;-DgroupId=com.companyname.bank\u0026#34; \u0026#34;-DartifactId=consumerBanking\u0026#34; \u0026#34;-DarchetypeArtifactId=maven-archetype-quickstart\u0026#34; \u0026#34;-DinteractiveMode=false\u0026#34; å‚æ•°è¯´æ˜ï¼š\n-DgroupId: ç»„ç»‡åï¼Œå…¬å¸ç½‘å€çš„åå†™ + é¡¹ç›®åç§° -DartifactId: é¡¹ç›®å-æ¨¡å—å -DarchetypeArtifactId: æŒ‡å®š ArchetypeIdï¼Œmaven-archetype-quickstartï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ Java åº”ç”¨ -DinteractiveMode: æ˜¯å¦ä½¿ç”¨äº¤äº’æ¨¡å¼ Maven æ„å»º \u0026amp; é¡¹ç›®æµ‹è¯• åœ¨ä¸Šä¸€ç« èŠ‚ä¸­æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ Maven åˆ›å»º Java åº”ç”¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦å­¦ä¹ å¦‚ä½•æ„å»ºå’Œæµ‹è¯•è¿™ä¸ªé¡¹ç›®ã€‚\nè¿›å…¥ C:/MVN æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰“å¼€ consumerBanking æ–‡ä»¶å¤¹ã€‚ä½ å°†çœ‹åˆ°æœ‰ä¸€ä¸ª pom.xml æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;groupId\u0026gt;com.companyname.bank\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;consumerBanking\u0026lt;/artifactId\u0026gt; \u0026lt;packaging\u0026gt;jar\u0026lt;/packaging\u0026gt; \u0026lt;version\u0026gt;1.0-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;consumerBanking\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://maven.apache.org\u0026lt;/url\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;junit\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.8.1\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/project\u0026gt; ä»ä»¥ä¸Š xmlä»£ç ä¸­ï¼Œå¯çŸ¥ Maven å·²ç»æ·»åŠ äº† JUnit ä½œä¸ºæµ‹è¯•æ¡†æ¶ã€‚\né»˜è®¤æƒ…å†µä¸‹ Maven æ·»åŠ äº†ä¸€ä¸ªæºç æ–‡ä»¶ C:\\MVN\\consumerBanking\\src\\main\\java\\com\\companyname\\bank\\App.javaå’Œä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ C:\\MVN\\consumerBanking\\src\\test\\java\\com\\companyname\\bank\\AppTest.javaã€‚\næ‰“å¼€å‘½ä»¤æ§åˆ¶å°ï¼Œè·³è½¬åˆ° C:\\MVN\\consumerBanking ç›®å½•ä¸‹ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹ mvn å‘½ä»¤å¼€å§‹æ„å»ºé¡¹ç›®ï¼š\nC:\\MVN\\consumerBanking\u0026gt;mvn clean package [INFO] Scanning for projects... [INFO] ------------------------------------------------------------------- [INFO] Building consumerBanking [INFO] task-segment: [clean, package] [INFO] ------------------------------------------------------------------- [INFO] [clean:clean {execution: default-clean}] [INFO] Deleting directory C:\\MVN\\consumerBanking\\target ... ... ... [INFO] [jar:jar {execution: default-jar}] [INFO] Building jar: C:\\MVN\\consumerBanking\\target\\ consumerBanking-1.0-SNAPSHOT.jar [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESSFUL [INFO] ------------------------------------------------------------------------ [INFO] Total time: 2 seconds [INFO] Finished at: Tue Jul 10 16:52:18 IST 2012 [INFO] Final Memory: 16M/89M [INFO] ------------------------------------------------------------------------ æ‰§è¡Œå®Œåï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº†è‡ªå·±çš„é¡¹ç›®å¹¶åˆ›å»ºäº†æœ€ç»ˆçš„ jar æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯è¦å­¦ä¹ çš„å…³é”®æ¦‚å¿µï¼š\næˆ‘ä»¬ç»™äº† maven ä¸¤ä¸ªç›®æ ‡ï¼Œé¦–å…ˆæ¸…ç†ç›®æ ‡ç›®å½•ï¼ˆcleanï¼‰ï¼Œç„¶åæ‰“åŒ…é¡¹ç›®æ„å»ºçš„è¾“å‡ºä¸º jarï¼ˆpackageï¼‰æ–‡ä»¶ã€‚ æ‰“åŒ…å¥½çš„ jar æ–‡ä»¶å¯ä»¥åœ¨ consumerBanking\\target ä¸­è·å¾—ï¼Œåç§°ä¸º consumerBanking-1.0-SNAPSHOT.jarã€‚ æµ‹è¯•æŠ¥å‘Šå­˜æ”¾åœ¨ consumerBanking\\target\\surefire-reports æ–‡ä»¶å¤¹ä¸­ã€‚ Maven ç¼–è¯‘æºç æ–‡ä»¶ï¼Œä»¥åŠæµ‹è¯•æºç æ–‡ä»¶ã€‚ æ¥ç€ Maven è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚ æœ€å Maven åˆ›å»ºé¡¹ç›®åŒ…ã€‚ C:\\MVN\\consumerBanking\\target\\classes\u0026gt;java com.companyname.bank.App ä½ å¯ä»¥çœ‹åˆ°ç»“æœï¼š\nHello World! æ‰§è¡ŒjaråŒ… pom.xmlæ–‡ä»¶éœ€å¼•å…¥assemblyæ’ä»¶ã€‚\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-assembly-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.3.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;descriptorRefs\u0026gt; \u0026lt;descriptorRef\u0026gt;jar-with-dependencies\u0026lt;/descriptorRef\u0026gt; \u0026lt;/descriptorRefs\u0026gt; \u0026lt;archive\u0026gt; \u0026lt;manifest\u0026gt; \u0026lt;mainClass\u0026gt;cn.iarno.www.App\u0026lt;/mainClass\u0026gt; \u0026lt;/manifest\u0026gt; \u0026lt;/archive\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;single\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; æ‰§è¡Œå‘½ä»¤:\n[root@hadoop target]# java -jar xxx.-jar-with-dependencies.jar ","permalink":"https://www.iarno.cn/article/maven/","tags":["hadoop"],"title":"Maven å®‰è£…ä½¿ç”¨"},{"categories":["BigData"],"contents":"è¿™ç¯‡æ–‡ç« æ˜¯å…³äºå¦‚ä½•åœ¨ECSå®ä¾‹ä¸Šå¿«é€Ÿæ­å»ºHadoopä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„æ•™ç¨‹ã€‚ä¸»è¦æ­¥éª¤åŒ…æ‹¬å®‰è£…JDKï¼Œå®‰è£…Hadoopï¼Œé…ç½®Hadoopï¼Œé…ç½®SSHå…å¯†ç™»å½•ï¼Œä»¥åŠå¯åŠ¨Hadoopã€‚æ¯ä¸ªæ­¥éª¤éƒ½æœ‰è¯¦ç»†çš„å‘½ä»¤å’Œæ“ä½œè¯´æ˜ï¼Œä»¥åŠç›¸å…³çš„å‚è€ƒé“¾æ¥ã€‚å®Œæˆæ‰€æœ‰æ­¥éª¤åï¼Œå¯ä»¥é€šè¿‡è®¿é—®ç‰¹å®šçš„URLæ¥éªŒè¯Hadoopç¯å¢ƒæ˜¯å¦å·²æˆåŠŸæ­å»ºã€‚\nå¤§å¤šæ•°æ•™ç¨‹éƒ½æ˜¯ä» http://s.iarno.cn/pegHbK ä¸‹è½½å®‰è£…åŒ…ï¼Œç›®å‰è¯¥ç½‘ç«™å·²æ”¶è´¹ï¼Œæ‰€ä»¥å¦å¯»é€”å¾„å®‰è£…hadoopç¯å¢ƒã€‚\nèƒŒæ™¯ä¿¡æ¯ Hadoopæ˜¯ä¸€æ¬¾ç”±ApacheåŸºé‡‘ä¼šç”¨Javaè¯­è¨€å¼€å‘çš„åˆ†å¸ƒå¼å¼€æºè½¯ä»¶æ¡†æ¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸äº†è§£åˆ†å¸ƒå¼åº•å±‚ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œå¼€å‘åˆ†å¸ƒå¼ç¨‹åºï¼Œå……åˆ†åˆ©ç”¨é›†ç¾¤çš„èƒ½åŠ›è¿›è¡Œé«˜é€Ÿè¿ç®—å’Œå­˜å‚¨ã€‚Hadoopçš„æ ¸å¿ƒéƒ¨ä»¶æ˜¯HDFSï¼ˆHadoop Distributed File Systemï¼‰å’ŒMapReduceï¼š\nHDFSï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¯å¯¹åº”ç”¨ç¨‹åºæ•°æ®è¿›è¡Œåˆ†å¸ƒå¼å‚¨å­˜å’Œè¯»å–ã€‚ MapReduceï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼ŒMapReduceçš„æ ¸å¿ƒæ€æƒ³æ˜¯æŠŠè®¡ç®—ä»»åŠ¡åˆ†é…ç»™é›†ç¾¤å†…çš„æœåŠ¡å™¨æ‰§è¡Œã€‚é€šè¿‡å¯¹è®¡ç®—ä»»åŠ¡çš„æ‹†åˆ†ï¼ˆMapè®¡ç®—å’ŒReduceè®¡ç®—ï¼‰ï¼Œå†æ ¹æ®ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆJobTrackerï¼‰å¯¹ä»»åŠ¡è¿›è¡Œåˆ†å¸ƒå¼è®¡ç®—ã€‚ æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§Hadoopå®˜ç½‘ã€‚\næ“ä½œæ­¥éª¤ åœ¨ECSå®ä¾‹ä¸Šå¿«é€Ÿæ­å»ºHadoopä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\næ­¥éª¤ä¸€ï¼šå®‰è£…JDK æ­¥éª¤äºŒï¼šå®‰è£…Hadoop æ­¥éª¤ä¸‰ï¼šé…ç½®Hadoop æ­¥éª¤å››ï¼šé…ç½®SSHå…å¯†ç™»å½• æ­¥éª¤äº”ï¼šå¯åŠ¨Hadoop æ­¥éª¤ä¸€ï¼šå®‰è£…JDK è¿œç¨‹è¿æ¥å·²åˆ›å»ºçš„ECSå®ä¾‹ã€‚ å…·ä½“æ“ä½œï¼Œè¯·å‚è§è¿æ¥æ–¹å¼æ¦‚è¿°ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½JDK 1.8å®‰è£…åŒ…ã€‚\nwget https://download.java.net/openjdk/jdk8u41/ri/openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè§£å‹ä¸‹è½½çš„JDK 1.8å®‰è£…åŒ…ã€‚\ntar -zxvf openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç§»åŠ¨å¹¶é‡å‘½åJDKå®‰è£…åŒ…ã€‚\næœ¬ç¤ºä¾‹ä¸­å°†JDKå®‰è£…åŒ…é‡å‘½åä¸ºjava8ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨å…¶ä»–åç§°ã€‚\nmv java-se-8u41-ri/ /usr/java8 æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé…ç½®Javaç¯å¢ƒå˜é‡ã€‚\nå¦‚æœæ‚¨å°†JDKå®‰è£…åŒ…é‡å‘½åä¸ºå…¶ä»–åç§°ï¼Œéœ€å°†ä»¥ä¸‹å‘½ä»¤ä¸­çš„java8æ›¿æ¢ä¸ºå®é™…çš„åç§°ã€‚\necho \u0026#39;export JAVA_HOME=/usr/java8\u0026#39; \u0026gt;\u0026gt; /etc/profile echo \u0026#39;export PATH=$PATH:$JAVA_HOME/bin\u0026#39; \u0026gt;\u0026gt; /etc/profile source /etc/profile æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹Javaæ˜¯å¦æˆåŠŸå®‰è£…ã€‚\njava -version å¦‚æœè¿”å›ä»¥ä¸‹ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºJavaå·²å®‰è£…æˆåŠŸã€‚\nopenjdk version \u0026#34;1.8.0_41\u0026#34; OpenJDK Runtime Environment (build 1.8.0_41-b04) OpenJDK 64-Bit Server VM (build 25.40-b25, mixed mode) æ­¥éª¤äºŒï¼šå®‰è£…Hadoop æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸‹è½½Hadoopå®‰è£…åŒ…ã€‚\nwget https://mirrors.bfsu.edu.cn/apache/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè§£å‹Hadoopå®‰è£…åŒ…è‡³/opt/hadoopã€‚\ntar -zxvf hadoop-2.10.1.tar.gz -C /opt/ mv /opt/hadoop-2.10.1 /opt/hadoop æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé…ç½®Hadoopç¯å¢ƒå˜é‡ã€‚\necho \u0026#39;export HADOOP_HOME=/opt/hadoop/\u0026#39; \u0026gt;\u0026gt; /etc/profile echo \u0026#39;export PATH=$PATH:$HADOOP_HOME/bin\u0026#39; \u0026gt;\u0026gt; /etc/profile echo \u0026#39;export PATH=$PATH:$HADOOP_HOME/sbin\u0026#39; \u0026gt;\u0026gt; /etc/profile source /etc/profile æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶yarn-env.shå’Œhadoop-env.shã€‚\necho \u0026#34;export JAVA_HOME=/usr/java8\u0026#34; \u0026gt;\u0026gt; /opt/hadoop/etc/hadoop/yarn-env.sh echo \u0026#34;export JAVA_HOME=/usr/java8\u0026#34; \u0026gt;\u0026gt; /opt/hadoop/etc/hadoop/hadoop-env.sh æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæµ‹è¯•Hadoopæ˜¯å¦å®‰è£…æˆåŠŸã€‚\nhadoop version å¦‚æœè¿”å›ä»¥ä¸‹ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚\nHadoop 2.10.1 Subversion https://github.com/apache/hadoop -r 1827467c9a56f133025f28557bfc2c562d78e816 Compiled by centos on 2020-09-14T13:17Z Compiled with protoc 2.5.0 From source with checksum 3114edef868f1f3824e7d0f68be03650 This command was run using /opt/hadoop/share/hadoop/common/hadoop-common-2.10.1.jar æ­¥éª¤ä¸‰ï¼šé…ç½®Hadoop ä¿®æ”¹Hadoopé…ç½®æ–‡ä»¶core-site.xmlã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›å…¥ç¼–è¾‘é¡µé¢ã€‚\nvim /opt/hadoop/etc/hadoop/core-site.xml è¾“å…¥iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ã€‚\nåœ¨\u0026lt;configuration\u0026gt;\u0026lt;/configuration\u0026gt;èŠ‚ç‚¹å†…ï¼Œæ’å…¥å¦‚ä¸‹å†…å®¹ã€‚\n\u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.tmp.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;file:/opt/hadoop/tmp\u0026lt;/value\u0026gt; \u0026lt;!-- è‡ªè¡Œä¿®æ”¹ --\u0026gt; \u0026lt;description\u0026gt;location to store temporary files\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;fs.defaultFS\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;hdfs://localhost:8020\u0026lt;/value\u0026gt; \u0026lt;!-- host+portè‡ªè¡Œä¿®æ”¹ --\u0026gt; \u0026lt;/property\u0026gt; æŒ‰Escï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œå¹¶è¾“å…¥:wqä¿å­˜å¹¶é€€å‡ºã€‚\nä¿®æ”¹Hadoopé…ç½®æ–‡ä»¶hdfs-site.xmlã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›å…¥ç¼–è¾‘é¡µé¢ã€‚\nvim /opt/hadoop/etc/hadoop/hdfs-site.xml è¾“å…¥iï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ã€‚\nåœ¨\u0026lt;configuration\u0026gt;\u0026lt;/configuration\u0026gt;èŠ‚ç‚¹å†…ï¼Œæ’å…¥å¦‚ä¸‹å†…å®¹ã€‚\n\u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.replication\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;1\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.namenode.name.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;file:/opt/hadoop/tmp/dfs/name\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;dfs.datanode.data.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;file:/opt/hadoop/tmp/dfs/data\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; æŒ‰Escï¼Œé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œå¹¶è¾“å…¥:wqåä¿å­˜å¹¶é€€å‡ºã€‚\næ­¥éª¤å››ï¼šé…ç½®SSHå…å¯†ç™»å½• æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºå…¬é’¥å’Œç§é’¥ã€‚\nssh-keygen -t rsa å›æ˜¾ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼Œè¡¨ç¤ºåˆ›å»ºå…¬é’¥å’Œç§é’¥æˆåŠŸã€‚\n[root@iZbp1chrrv37a2kts7sydsZ ~]# ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:gjWO5mgARst+O5VUaTnGs+LxVhfmCJnQwKfEBTro2oQ root@iZbp1chrrv37a2kts7s**** The key\u0026#39;s randomart image is: +---[RSA 2048]----+ | . o+Bo= | |o o .+.# o | |.= o..B = + . | |=. oO.o o o | |Eo..=o* S . | |.+.+o. + | |. +o. . | | . . | | | +----[SHA256]-----+ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å…¬é’¥æ·»åŠ åˆ°authorized_keysæ–‡ä»¶ä¸­ã€‚\ncd .ssh cat id_rsa.pub \u0026gt;\u0026gt; authorized_keys æ­¥éª¤äº”ï¼šå¯åŠ¨Hadoop æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆå§‹åŒ–namenode ã€‚\nhadoop namenode -format ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨Hadoopã€‚\nstart-dfs.sh åœ¨å¼¹å‡ºçš„æç¤ºä¸­ï¼Œä¾æ¬¡è¾“å…¥yesã€‚\nstart-yarn.sh å›æ˜¾ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚\n[root@iZbp1chrrv37a2kts7s**** .ssh]# start-yarn.sh starting yarn daemons starting resourcemanager, logging to /opt/hadoop/logs/yarn-root-resourcemanager-iZbp1chrrv37a2kts7sydsZ.out localhost: starting nodemanager, logging to /opt/hadoop/logs/yarn-root-nodemanager-iZbp1chrrv37a2kts7sydsZ.out æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯æŸ¥çœ‹æˆåŠŸå¯åŠ¨çš„è¿›ç¨‹ã€‚\njps æˆåŠŸå¯åŠ¨çš„è¿›ç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚\n[root@iZbp1chrrv37a2kts7s**** .ssh]# jps 11620 DataNode 11493 NameNode 11782 SecondaryNameNode 11942 ResourceManager 12344 Jps 12047 NodeManager æ‰“å¼€æµè§ˆå™¨è®¿é—®http://\u0026lt;ECSå…¬ç½‘IP\u0026gt;:8088å’Œhttp://\u0026lt;ECSå…¬ç½‘IP\u0026gt;:50070ã€‚\næ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼Œåˆ™è¡¨ç¤ºHadoopä¼ªåˆ†å¸ƒå¼ç¯å¢ƒå·²æ­å»ºå®Œæˆã€‚\næ³¨æ„ éœ€ç¡®ä¿åœ¨ECSå®ä¾‹æ‰€åœ¨å®‰å…¨ç»„çš„å…¥æ–¹å‘ä¸­æ”¾è¡ŒHadoopæ‰€éœ€çš„8088å’Œ50070ç«¯å£ï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚å…·ä½“æ“ä½œï¼Œè¯·å‚è§æ·»åŠ å®‰å…¨ç»„è§„åˆ™ã€‚\nå‚è€ƒé“¾æ¥ http://s.iarno.cn/fRVfE9\nhttp://s.iarno.cn/WrjzRC\n","permalink":"https://www.iarno.cn/article/hadoop%E6%90%AD%E5%BB%BA%E4%B8%80/","tags":["hadoop"],"title":"Hadoop ç¯å¢ƒæ­å»ºï¼ˆä¸€ï¼‰"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« æ˜¯å…³äºPythonåˆ—è¡¨çš„è¯¦ç»†æ•™ç¨‹ã€‚å®ƒé¦–å…ˆä»‹ç»äº†å¦‚ä½•è®¿é—®å’Œä¿®æ”¹åˆ—è¡¨å…ƒç´ ï¼Œç„¶åè®²è§£äº†å¦‚ä½•åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ å’Œåœ¨åˆ—è¡¨ä¸­æ’å…¥å…ƒç´ ã€‚æ¥ç€ï¼Œæ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨delå’Œpop()æ–¹æ³•æ ¹æ®ç´¢å¼•åˆ é™¤å…ƒç´ ï¼Œä»¥åŠå¦‚ä½•æ ¹æ®å€¼åˆ é™¤å…ƒç´ ã€‚æ–‡ç« è¿˜ä»‹ç»äº†sort()å’Œsorted()æ–¹æ³•è¿›è¡Œåˆ—è¡¨æ’åºï¼Œä»¥åŠå¦‚ä½•å€’åºæ‰“å°åˆ—è¡¨å…ƒç´ å’Œè·å–åˆ—è¡¨é•¿åº¦ã€‚æœ€åï¼Œæ–‡ç« è®²è§£äº†å¦‚ä½•éå†æ•´ä¸ªåˆ—è¡¨ï¼Œåˆ›å»ºæ•°å€¼åˆ—è¡¨å’Œæ•°å­—åˆ—è¡¨ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨åˆ—è¡¨è§£æå’Œåˆ—è¡¨åˆ‡ç‰‡ã€‚\n3.1 è®¿é—®å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, 1] print(items[0]) print(items[-1]) print(items[10]) # è¶Šç•ŒæŠ¥é”™ # output # a # 1 # Traceback (most recent call last): # File \u0026#34;xxxxx\u0026#34;, line 7, in \u0026lt;module\u0026gt; # print(items[10]) # IndexError: list index out of range 3.2 ä¿®æ”¹å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, 1] print(items) items[3] = \u0026#34;d\u0026#34; print(items) # output # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, 1] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;] åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] print(items) items.append(\u0026#34;d\u0026#34;) print(items) # output # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;] åˆ—è¡¨ä¸­æ’å…¥å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] print(items) items.insert(3, \u0026#34;f\u0026#34;) print(items) items.insert(10, \u0026#34;z\u0026#34;) # æœ€åä¸€ä½å…ƒç´ ç´¢å¼•åŠ 1ï¼Œå¹¶ä¸æ˜¯åœ¨ç¬¬10ä¸ªç´¢å¼•ä½æ–°åŠ å…¥å…ƒç´  print(items[8]) # è¶Šç•ŒæŠ¥é”™ # output # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;f\u0026#39;] # Traceback (most recent call last): # File \u0026#34;xxxxx\u0026#34;, line 43, in \u0026lt;module\u0026gt; # print(items[8]) # IndexError: list index out of range ä½¿ç”¨delåˆ é™¤å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] del items[0] #del items[10] # è¶Šç•ŒæŠ¥é”™ print(items) # output # [\u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] ä½¿ç”¨æ–¹æ³•pop()æ ¹æ®ç´¢å¼•åˆ é™¤å…ƒç´  items = [1, 2, 3] items.pop() first = items.pop(0) #items.pop(10) # è¶Šç•ŒæŠ¥é”™ print(first) print(items) # output # 1 # [2] æ ¹æ®å€¼åˆ é™¤å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;a\u0026#34;] items.remove(\u0026#34;a\u0026#34;) # removeåªåˆ é™¤ç¬¬ä¸€ä¸ªæŒ‡å®šçš„å€¼,æœ€åä¸€ä¸ªaå…ƒç´ è¿˜åœ¨ #items.remove(\u0026#34;d\u0026#34;) # æŠ¥é”™ print(items) # output # [\u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;a\u0026#39;] sort()åˆ—è¡¨æ°¸ä¹…æ’åº items = [\u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;f\u0026#34;] items.sort() print(items) # output # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;f\u0026#39;] sorted()åˆ—è¡¨ä¸´æ—¶æ’åº items = [\u0026#34;b\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;c\u0026#34;] print(sorted(items)) print(items) # output # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;] # [\u0026#39;b\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;c\u0026#39;] å€’ç€æ‰“å°åˆ—è¡¨å…ƒç´  items = [\u0026#34;a\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;f\u0026#34;] items.reverse() print(items) # output # [\u0026#39;f\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;a\u0026#39;] è·å–åˆ—è¡¨é•¿åº¦ items = [1, 2, 3, 4] print(len(items)) # output # 4 4.1 éå†æ•´ä¸ªåˆ—è¡¨ items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] for item in items: print(item) # output # a # b # c 4.3 åˆ›å»ºæ•°å€¼åˆ—è¡¨ for value in range(1, 4): print(value) # output ä¸åŒ…å«4 # 1 # 2 # 3 åˆ›å»ºæ•°å­—åˆ—è¡¨ items = *list*(range(1, 4)) print(items) # output # [1, 2, 3] æ‰“å°1åˆ°10çš„å¶æ•° for n in range(2, 11, 2): print(n) # output # 2 # 4 # 6 # 8 4.3.4 åˆ—è¡¨è§£æ items = [] for value in range(1, 10): items.append(value**2) print(items) # output # [1, 4, 9, 16, 25, 36, 49, 64, 81] items = [value**2 for value in range(1, 10)] print(items) # output # [1, 4, 9, 16, 25, 36, 49, 64, 81] 4.4 ä½¿ç”¨åˆ—è¡¨çš„ä¸€éƒ¨åˆ† items = [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] print(items[1:]) print(items[:2]) print(items[:10]) # æ²¡é—®é¢˜ï¼Œå’Œå‰é¢è¶Šç•Œåšå¯¹æ¯” print(items[-10:]) # output # [\u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] # [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;] ","permalink":"https://www.iarno.cn/article/py_list/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜"],"title":"Python åˆ—è¡¨"},{"categories":["Python"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Pythonä¸­çš„å˜é‡å’Œç®€å•æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå¸¸é‡ã€‚åœ¨å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œæ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨æ–¹æ³•ä¿®æ”¹å­—ç¬¦ä¸²ä¸­çš„å¤§å°å†™ï¼Œå¦‚ä½•åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å˜é‡ï¼Œå¦‚ä½•ä½¿ç”¨åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦æ·»åŠ ç©ºæ ¼ï¼Œä»¥åŠå¦‚ä½•åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç‰¹æ®Šå­—ç¬¦ã€‚åœ¨æ•°å­—éƒ¨åˆ†ï¼Œæ–‡ç« è®²è§£äº†æ•´æ•°å’Œæµ®ç‚¹æ•°çš„åŸºæœ¬æ“ä½œï¼Œä»¥åŠå¦‚ä½•åœ¨æ•°å­—ä¸­ä½¿ç”¨ä¸‹åˆ’çº¿ã€‚æ­¤å¤–ï¼Œæ–‡ç« è¿˜ä»‹ç»äº†å¦‚ä½•ç»™å¤šä¸ªå˜é‡èµ‹å€¼ï¼Œä»¥åŠå¦‚ä½•å®šä¹‰å¸¸é‡ã€‚\n2.3 å­—ç¬¦ä¸² ä½¿ç”¨æ–¹æ³•ä¿®æ”¹å­—ç¬¦ä¸²ä¸­å¤§å°å†™ name = \u0026#34;hello world\u0026#34; print(name) print(name.title()) print(name.upper()) ## è½¬å¤§å†™ print(name.upper().lower()) # è½¬å°å†™ # output # hello world # Hello World # HELLO WORLD # hello world å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å˜é‡ str1 = \u0026#34;zhang\u0026#34; str2 = \u0026#34;san\u0026#34; name = f\u0026#34;name: {str1} {str2}\u0026#34; print(name) # fæ˜¯formatçš„ç®€å†™(Python3.6å¼•å…¥)æŠŠèŠ±æ‹¬å·å†…çš„å˜é‡æ›¿æ¢ä¸ºå…¶å€¼ # output # name: zhang san åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦æ¥æ·»åŠ ç©ºæ ¼ print(\u0026#34;Languages:\\nPython\\nGolang\\nPhp\u0026#34;) print(\u0026#34;Languages:\\n\\tPython\\n\\tGolang\\n\\tPhp\u0026#34;) # output # Languages: # Python # Golang # Php # Languages: # Python # Golang # Php åˆ é™¤å·¦å³ä¸¤æ¡ç‰¹æ®Šå­—ç¬¦ str1 = \u0026#34;Python#\u0026#34; print(str1.rstrip(\u0026#34;#\u0026#34;)) str2 = \u0026#34;#Python\u0026#34; print(str2.lstrip(\u0026#34;#\u0026#34;)) str3 = \u0026#34;#Python#\u0026#34; print(str3.strip(\u0026#34;#\u0026#34;)) # output # Python # Python # Python 2.4 æ•° æ•´æ•° print(3**2) print(3**3) # output # 9 # 27 æµ®ç‚¹æ•° print(0.1 + 0.1) # Notice: ç»“æœä½ä¿ç•™çš„å°æ•°ä½å¯èƒ½æ˜¯ä¸ç¡®å®šçš„ print(0.2 + 0.1) print(3 * 0.1) # output # 0.2 # 0.30000000000000004 # 0.30000000000000004 æ— è®ºæ˜¯å“ªç§è¿ç®—ï¼Œåªè¦æœ‰æ“ä½œæ•°æ˜¯æµ®ç‚¹æ•°ï¼ŒPythoné»˜è®¤å¾—åˆ°çš„æ€»æ˜¯æµ®ç‚¹æ•°ï¼Œå³ä¾¿ç»“æœåŸæœ¬ä¸ºæ•´æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nprint(4/2) print(1 + 2.0) print(2 * 3.0) print(3.0 ** 2) # output # 2.0 # 3.0 # 6.0 # 9.0 æ•°ä¸­çš„ä¸‹åˆ’çº¿ m = 14_000_000 print(m) # output # 14000000 ç»™å¤šä¸ªå˜é‡èµ‹å€¼ x, y, z = 1, 0.2, \u0026#34;x\u0026#34; print(x,y,z) # output # 1 0.2 x å¸¸é‡ # å‘½åå¤§å†™ MAX_CONNECTIONS = 5000 è§†é¢‘é“¾æ¥ https://las.h5.xeknow.com/s/2dehjV\n","permalink":"https://www.iarno.cn/article/py_string/","tags":["Pythonç¼–ç¨‹ä»å…¥é—¨åˆ°å®æˆ˜"],"title":"Python å˜é‡å’Œç®€å•æ•°æ®ç±»å‹"},{"categories":["å…¶ä»–"],"contents":"æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨LVSå’ŒKeepalivedå®ç°é›†ç¾¤é«˜å¯ç”¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨LVSæœåŠ¡å™¨ä¸Šå®‰è£…ipvsadmå’ŒkeepalivedæœåŠ¡ï¼Œç„¶ååœ¨WEBæœåŠ¡å™¨ä¸Šå®‰è£…nginxæœåŠ¡å¹¶é…ç½®index.htmlæ–‡ä»¶ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åœ¨LVSæœåŠ¡å™¨ä¸Šé…ç½®keepalived.confæ–‡ä»¶å’ŒRSæœåŠ¡ï¼Œæœ€åé€šè¿‡è®¿é—®VIPæ¥éªŒè¯é…ç½®çš„æ­£ç¡®æ€§ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†è§£é‡Šäº†æ¯ä¸€æ­¥çš„æ“ä½œå’Œé…ç½®çš„å«ä¹‰ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œå®è·µã€‚\næœºå™¨è¯´æ˜ IP è¯´æ˜ 192.168.199.13 LVSæœåŠ¡å™¨ 192.168.199.11 WEBæœåŠ¡å™¨1 192.168.199.12 WEBæœåŠ¡å™¨2 192.168.199.101 VIP(è™šæ‹ŸIP) LVSæœåŠ¡å™¨ # å®‰è£…ipvsadm [root@localhost ~] yum install ipvsadm -y # å®‰è£…keepalivedæœåŠ¡ [root@localhost ~] yum install keepalived -y WEBæœåŠ¡å™¨1 # å®‰è£…nginxæœåŠ¡ [root@localhost ~] yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel [root@localhost ~] wget https://nginx.org/download/nginx-1.21.3.tar.gz \u0026amp;\u0026amp; tar -zxf nginx-1.21.3.tar.gz \u0026amp;\u0026amp; cd nginx-1.21.3/ [root@localhost ~] ./configure \u0026amp;\u0026amp; make \u0026amp;\u0026amp; make install [root@localhost ~] /usr/local/nginx/sbin/nginx # é…ç½®index.htmlæ–‡ä»¶ [root@localhost ~] cat /usr/local/nginx/html/index.html 192.168.199.11 # ä¿®æ”¹arp_ignoreå’Œarp_announceé…ç½® # æ³¨æ„ï¼ï¼ï¼æˆ‘çš„ç½‘å¡æ˜¯ens33ï¼ŒæŒ‰è‡ªå·±å®é™…ç½‘å¡æ¥æ“ä½œï¼Œæ¯”å¦‚eth0ç›®å½•ä¸‹ [root@localhost ~] echo 1 \u0026gt; /proc/sys/net/ipv4/conf/ens33/arp_ignore [root@localhost ~] echo 2 \u0026gt; /proc/sys/net/ipv4/conf/ens33/arp_announce [root@localhost ~] echo 1 \u0026gt; /proc/sys/net/ipv4/conf/all/arp_ignore [root@localhost ~] echo 2 \u0026gt; /proc/sys/net/ipv4/conf/all/arp_announce # ç¯å›æ¥å£é…ç½®VIPï¼Œå®ç°å¯¹å†…å¯è§å¯¹å¤–éšè— # åˆ‡è®°ï¼ï¼ï¼ åˆ‡è®°ï¼ï¼ï¼ æ©ç æ˜¯4ä¸ª255 [root@localhost ~] ifconfig lo:2 192.168.199.101 netmask 255.255.255.255 WEBæœåŠ¡å™¨2 æ“ä½œåŒWEBæœåŠ¡å™¨1\nLVSæœåŠ¡å™¨ # ä¿®æ”¹keepalived.confæ–‡ä»¶ [root@localhost ~] cat /etc/keepalived/keepalived.conf ! Configuration File for keepalived global_defs { # ... æ­¤å¤„çœç•¥å…³äºé‚®ä»¶çš„é…ç½® router_id LVS_01 # è¡¨ç¤ºè¿è¡ŒkeepalivedæœåŠ¡å™¨çš„ä¸€ä¸ªæ ‡è¯† } vrrp_instance VI_1 { state MASTER # æŒ‡å®škeepalivedçš„è§’è‰²ï¼ŒMASTERè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯ä¸»æœåŠ¡å™¨ï¼ŒBACKUPè¡¨ç¤ºæ­¤ä¸»æœºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ interface ens33 # æŒ‡å®šHAç›‘æµ‹çš„ç½‘å¡ æ ¹æ®è‡ªå·±å®é™…ç½‘å¡é…ç½®ï¼Œä¾‹å¦‚eth0 virtual_router_id 51 # è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼Œè¿™ä¸ªæ ‡è¯†æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒåŒä¸€ä¸ªvrrpå®ä¾‹ä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†ã€‚å³åŒä¸€vrrp_instanceä¸‹ï¼ŒMASTERå’ŒBACKUPå¿…é¡»æ˜¯ä¸€è‡´çš„ priority 100 # å®šä¹‰ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œåœ¨åŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERçš„ä¼˜å…ˆçº§å¿…é¡»å¤§äºBACKUPçš„ä¼˜å…ˆçº§ advert_int 1 # è®¾å®šMASTERä¸BACKUPè´Ÿè½½å‡è¡¡å™¨ä¹‹é—´åŒæ­¥æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ authentication { # è®¾ç½®éªŒè¯ç±»å‹å’Œå¯†ç  auth_type PASS # è®¾ç½®éªŒè¯ç±»å‹ï¼Œä¸»è¦æœ‰PASSå’ŒAHä¸¤ç§ auth_pass 1111 # è®¾ç½®éªŒè¯å¯†ç ï¼Œåœ¨åŒä¸€ä¸ªvrrp_instanceä¸‹ï¼ŒMASTERä¸BACKUPå¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç æ‰èƒ½æ­£å¸¸é€šä¿¡ } virtual_ipaddress { # è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè™šæ‹ŸIPåœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª 192.168.199.101/24 dev ens33 label ens33:2 # 192.168.199.101ä¸ºvip ens33åŒä¸Š ens33:2æ¥å£ } } # é…ç½®RSæœåŠ¡ virtual_server 192.168.199.101 80 { delay_loop 6 # è®¾ç½®è¿è¡Œæƒ…å†µæ£€æŸ¥æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ lb_algo rr # è®¾ç½®è´Ÿè½½è°ƒåº¦ç®—æ³•ï¼Œè¿™é‡Œè®¾ç½®ä¸ºrrï¼Œå³è½®è¯¢ç®—æ³• lb_kind DR # è®¾ç½®LVSå®ç°è´Ÿè½½å‡è¡¡çš„æœºåˆ¶ï¼Œæœ‰NATã€TUNã€DRä¸‰ä¸ªæ¨¡å¼å¯é€‰ persistence_timeout 50 # ä¼šè¯ä¿æŒæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚è¿™ä¸ªé€‰é¡¹å¯¹åŠ¨æ€ç½‘é¡µæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¸ºé›†ç¾¤ç³»ç»Ÿä¸­çš„sessionå…±äº«æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ # æœ‰äº†è¿™ä¸ªä¼šè¯ä¿æŒåŠŸèƒ½ï¼Œç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«ä¸€ç›´åˆ†å‘åˆ°æŸä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œç›´åˆ°è¶…è¿‡è¿™ä¸ªä¼šè¯çš„ä¿æŒæ—¶é—´ã€‚ # éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¼šè¯ä¿æŒæ—¶é—´æ˜¯æœ€å¤§æ— å“åº”è¶…æ—¶æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åœ¨æ“ä½œåŠ¨æ€é¡µé¢æ—¶ï¼Œå¦‚æœ50ç§’å†…æ²¡æœ‰æ‰§è¡Œä»»ä½•æ“ä½œ # é‚£ä¹ˆæ¥ä¸‹æ¥çš„æ“ä½œä¼šè¢«åˆ†å‘åˆ°å¦å¤–çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸€ç›´åœ¨æ“ä½œåŠ¨æ€é¡µé¢ï¼Œåˆ™ä¸å—50ç§’çš„æ—¶é—´é™åˆ¶ protocol TCP # æŒ‡å®šè½¬å‘åè®®ç±»å‹ï¼Œæœ‰TCPå’ŒUDPä¸¤ç§ # WEBæœåŠ¡å™¨1 80ç«¯å£ real_server 192.168.199.11 80 { weight 1 # é…ç½®æœåŠ¡èŠ‚ç‚¹çš„æƒå€¼ï¼Œæƒå€¼å¤§å°ç”¨æ•°å­—è¡¨ç¤ºï¼Œæ•°å­—è¶Šå¤§ï¼Œæƒå€¼è¶Šé«˜ï¼Œè®¾ç½®æƒå€¼å¤§å°å¯ä»¥ä¸ºä¸åŒæ€§èƒ½çš„æœåŠ¡å™¨ # åˆ†é…ä¸åŒçš„è´Ÿè½½ï¼Œå¯ä»¥ä¸ºæ€§èƒ½é«˜çš„æœåŠ¡å™¨è®¾ç½®è¾ƒé«˜çš„æƒå€¼ï¼Œè€Œä¸ºæ€§èƒ½è¾ƒä½çš„æœåŠ¡å™¨è®¾ç½®ç›¸å¯¹è¾ƒä½çš„æƒå€¼ï¼Œè¿™æ ·æ‰èƒ½åˆç†åœ°åˆ©ç”¨å’Œåˆ†é…ç³»ç»Ÿèµ„æº HTTP_GET { url { path / status_code 200 } connect_timeout 3 # è¡¨ç¤º3ç§’æ— å“åº”è¶…æ—¶ nb_get_retry 3 # è¡¨ç¤ºé‡è¯•æ¬¡æ•° delay_before_retry 3 # è¡¨ç¤ºé‡è¯•é—´éš” } } # WEBæœåŠ¡å™¨2 80ç«¯å£ real_server 192.168.199.12 80 { weight 1 HTTP_GET { url { path / status_code 200 } connect_timeout 3 nb_get_retry 3 delay_before_retry 3 } } } # é…ç½®å®Œæˆä¹‹åé‡å¯keepalived # centos7 [root@localhost ~] systemctl restart keepalived.service # ipvsadm æŸ¥çœ‹rsæƒ…å†µ # ipvsadm -lnc ä¼šæŸ¥çœ‹å½“å‰è¿æ¥æƒ…å†µ [root@localhost ~] ipvsadm -ln IP Virtual Server version 1.2.1 (size=4096) Prot LocalAddress:Port Scheduler Flags -\u0026gt; RemoteAddress:Port Forward Weight ActiveConn InActConn TCP 192.168.199.101:80 rr -\u0026gt; 192.168.199.11:80 Route 1 0 0 -\u0026gt; 192.168.199.12:80 Route 1 0 0 è®¿é—®VIP # è¯·æ±‚ç»“æœä¼šè½®ç€æ¥ [root@localhost ~] curl -X GET http://192.168.199.101:80 192.168.199.11 [root@localhost ~] curl -X GET http://192.168.199.101:80 192.168.199.12 ","permalink":"https://www.iarno.cn/article/lvs-2/","tags":["lvs"],"title":"LVS + Keepalivedå®ç°é›†ç¾¤é«˜å¯ç”¨"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨LVSè¿›è¡Œè´Ÿè½½å‡è¡¡çš„å®è·µæ“ä½œã€‚é¦–å…ˆï¼Œæ–‡ç« åˆ—å‡ºäº†æ‰€éœ€çš„æœåŠ¡å™¨IPå’Œè§’è‰²ï¼Œç„¶ååˆ†åˆ«ä»‹ç»äº†åœ¨LVSæœåŠ¡å™¨å’ŒWEBæœåŠ¡å™¨ä¸Šçš„é…ç½®æ­¥éª¤ã€‚åœ¨LVSæœåŠ¡å™¨ä¸Šï¼Œä¸»è¦æ˜¯å®‰è£…ipvsadmï¼Œé…ç½®VIPç½‘å¡å’Œä½¿ç”¨ipvsadmé…ç½®VIPã€‚åœ¨WEBæœåŠ¡å™¨ä¸Šï¼Œä¸»è¦æ˜¯å®‰è£…nginxæœåŠ¡ï¼Œé…ç½®index.htmlæ–‡ä»¶ï¼Œä¿®æ”¹arp_ignoreå’Œarp_announceé…ç½®ï¼Œä»¥åŠç¯å›æ¥å£é…ç½®VIPã€‚æœ€åï¼Œæ–‡ç« å±•ç¤ºäº†å¦‚ä½•åœ¨LVSæœåŠ¡å™¨ä¸Šæ·»åŠ rsï¼Œä»¥åŠå¦‚ä½•è®¿é—®VIPã€‚\næœºå™¨è¯´æ˜ 192.168.199.10lvsæœåŠ¡å™¨ã€192.168.199.11webæœåŠ¡å™¨1ã€192.168.199.12webæœåŠ¡å™¨2ã€192.168.199.100vipã€‚\nIP è¯´æ˜ 192.168.199.10 LVSæœåŠ¡å™¨ 192.168.199.11 WEBæœåŠ¡å™¨1 192.168.199.12 WEBæœåŠ¡å™¨2 192.168.199.100 VIP(è™šæ‹ŸIP) LVSæœåŠ¡å™¨ # å®‰è£…ipvsadm [root@localhost ~] yum install ipvsadm -y # é…ç½®VIPç½‘å¡ # æ³¨æ„ï¼ï¼ï¼ æˆ‘çš„ç½‘å¡æ˜¯ens33ï¼Œè¯·æ ¹æ®è‡ªå·±çš„å®é™…ç½‘å¡æ¥é…ç½®æ¯”å¦‚eth0ç½‘å¡ [root@localhost ~] ifconfig ens33:8 192.168.199.100/24 # ä½¿ç”¨ipvsadmé…ç½®VIP # -A å‚æ•°æ·»åŠ VIP # -t å‚æ•°tcpåè®® # 192.168.199.100:80 VIPç«¯å£æ˜¯80 # -s å‚æ•°è´Ÿè½½ç®—æ³•ï¼Œrrä¸ºè½®è¯¢ [root@localhost ~] ipvsadm -A -t 192.168.199.100:80 -s rr WEBæœåŠ¡å™¨1 # å®‰è£…nginxæœåŠ¡ [root@localhost ~] yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel [root@localhost ~] wget https://nginx.org/download/nginx-1.21.3.tar.gz \u0026amp;\u0026amp; tar -zxf nginx-1.21.3.tar.gz \u0026amp;\u0026amp; cd nginx-1.21.3/ [root@localhost ~] ./configure \u0026amp;\u0026amp; make \u0026amp;\u0026amp; make install [root@localhost ~] /usr/local/nginx/sbin/nginx # é…ç½®index.htmlæ–‡ä»¶ [root@localhost ~] cat /usr/local/nginx/html/index.html 192.168.199.11 # ä¿®æ”¹arp_ignoreå’Œarp_announceé…ç½® # æ³¨æ„ï¼ï¼ï¼æˆ‘çš„ç½‘å¡æ˜¯ens33ï¼ŒæŒ‰è‡ªå·±å®é™…ç½‘å¡æ¥æ“ä½œï¼Œæ¯”å¦‚eth0ç›®å½•ä¸‹ [root@localhost ~] echo 1 \u0026gt; /proc/sys/net/ipv4/conf/ens33/arp_ignore [root@localhost ~] echo 2 \u0026gt; /proc/sys/net/ipv4/conf/ens33/arp_announce [root@localhost ~] echo 1 \u0026gt; /proc/sys/net/ipv4/conf/all/arp_ignore [root@localhost ~] echo 2 \u0026gt; /proc/sys/net/ipv4/conf/all/arp_announce # ç¯å›æ¥å£é…ç½®VIPï¼Œå®ç°å¯¹å†…å¯è§å¯¹å¤–éšè— # åˆ‡è®°ï¼ï¼ï¼ åˆ‡è®°ï¼ï¼ï¼ æ©ç æ˜¯4ä¸ª255 [root@localhost ~] ifconfig lo:2 192.168.199.100 netmask 255.255.255.255 WEBæœåŠ¡å™¨2 æ“ä½œåŒWEBæœåŠ¡å™¨1\nLVSæœåŠ¡å™¨ # lvsæ·»åŠ rs # -a å‚æ•°æ·»åŠ rs # -t å‚æ•°tcpåè®® # 192.168.199.100:80 å¦‚ä¸Šç¬¬ä¸€é…ç½®çš„vipåŠç«¯å£ # -r rsæœåŠ¡å™¨ipå³WEBæœåŠ¡1æˆ–WEBæœåŠ¡å™¨2å¯¹åº”çš„IP # -g å‚æ•°lvsæ¨¡å¼ï¼Œä¸å¡«é»˜è®¤ä¸ºDRæ¨¡å¼ [root@localhost ~] ipvsadm -a -t 192.168.199.100:80 -r 192.168.199.11 -g [root@localhost ~] ipvsadm -a -t 192.168.199.100:80 -r 192.168.199.12 -g # ipvsadm æŸ¥çœ‹rsæƒ…å†µ # ipvsadm -lnc ä¼šæŸ¥çœ‹å½“å‰è¿æ¥æƒ…å†µ [root@localhost ~] ipvsadm -ln IP Virtual Server version 1.2.1 (size=4096) Prot LocalAddress:Port Scheduler Flags -\u0026gt; RemoteAddress:Port Forward Weight ActiveConn InActConn TCP 192.168.199.100:80 rr -\u0026gt; 192.168.199.11:80 Route 1 0 0 -\u0026gt; 192.168.199.12:80 Route 1 0 0 è®¿é—®VIP # è¯·æ±‚ç»“æœä¼šè½®ç€æ¥ [root@localhost ~] curl -X GET http://192.168.199.100:80 192.168.199.11 [root@localhost ~] curl -X GET http://192.168.199.100:80 192.168.199.12 ","permalink":"https://www.iarno.cn/article/lvs-1/","tags":["lvs"],"title":"LVSè´Ÿè½½å‡è¡¡å®è·µ"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨Macä¸Šå®‰è£…VMè™šæ‹Ÿæœºå’ŒCentosè™šæ‹Ÿæœºï¼Œå¹¶è¿›è¡Œç½‘ç»œé…ç½®ã€‚é¦–å…ˆï¼Œä»VMwareå®˜ç½‘ä¸‹è½½å¹¶å®‰è£…VMware Fusionã€‚ç„¶åï¼Œä»Centoså®˜ç½‘ä¸‹è½½Centosé•œåƒï¼Œå¹¶åœ¨VMware Fusionä¸­åˆ›å»ºCentosè™šæ‹Ÿæœºã€‚æœ€åï¼Œè¿›è¡Œè™šæ‹Ÿæœºç½‘ç»œé…ç½®ï¼ŒåŒ…æ‹¬é€‰æ‹©ç½‘ç»œæ¨¡å¼ï¼ŒæŸ¥çœ‹WIFIé¡¹ï¼Œé…ç½®è™šæ‹Ÿæœºçš„ifcfg-ens33æ–‡ä»¶ï¼Œè®¾ç½®GATEWAYå’ŒDNSï¼Œæœ€åé‡å¯networkæœåŠ¡ã€‚\nå®‰è£…VMware Fusion Mac å®‰è£…VMè™šæ‹Ÿæœº ã€centosè™šæ‹Ÿæœºåˆ›å»ºã€ç½‘ç»œç›¸å…³é…ç½®ã€‚\nå®˜ç½‘åœ°å€ https://www.vmware.com/cn/products/fusion/fusion-evaluation.html\nä¸‹è½½Centosé•œåƒ å®˜ç½‘åœ°å€ https://www.centos.org/download/\nåˆ›å»ºCentosè™šæ‹Ÿæœº å°†å·²ä¸‹è½½å¥½çš„centosé•œåƒæ‹–æ‹½è¿›æ¥ ä¿å­˜å®Œä¹‹åå¯åŠ¨è™šæ‹Ÿæœºå³å¯ï¼ æ³¨: é»˜è®¤ä¼šæç¤ºç½‘ç»œé—®é¢˜å¯ä»¥å…ˆå¿½ç•¥è¿›å…¥åˆ°è™šæ‹Ÿæœºï¼Œå…·ä½“ç½‘ç»œé…ç½®å¦‚ä¸‹ã€‚ Centosè™šæ‹Ÿæœºç½‘ç»œé…ç½® ï¼ï¼ï¼ ç½‘ç»œé€‰æ‹©â€œä¸æˆ‘çš„Macå…±äº«â€æˆ–â€œWI-FIâ€ é…ç½®è™šæ‹Ÿæœºç½‘ç»œ ç³»ç»Ÿåå¥½è®¾ç½®ç½‘ç»œæŸ¥çœ‹WIFIé¡¹ é…ç½®è™šæ‹Ÿæœºifcfg-ens33æ–‡ä»¶ GATEWAY å¯¹åº”å€¼ä¸º ç³»ç»Ÿåå¥½è®¾ç½®-ç½‘ç»œ-wifi-TCP/IP ä¸­çš„è·¯ç”±å™¨å€¼ DNS å¯¹åº”å€¼ä¸º ç³»ç»Ÿåå¥½è®¾ç½®-ç½‘ç»œ-DNS æœ‰å‡ ä¸ªé…ç½®å°±é…ç½®å‡ ä¸ªå³å¯ é…ç½®å®Œä¹‹åé‡å¯network /bin/systemctl restart network.service\n","permalink":"https://www.iarno.cn/article/mac-vm/","tags":["è™šæ‹Ÿæœº"],"title":"Mac å®‰è£…VMè™šæ‹ŸæœºåŠç½‘ç»œé…ç½®"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Goè¯­è¨€å¼€å‘è‡ªå®šä¹‰æ’ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å¹¶å®‰è£…go-pluginserverï¼Œç„¶ååœ¨CentOSç¯å¢ƒä¸‹å®‰è£…Cç›¸å…³çš„ç¼–è¯‘ç¯å¢ƒã€‚æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½å®˜æ–¹çš„æ’ä»¶ç¤ºä¾‹ï¼Œå¹¶é€šè¿‡Goè¯­è¨€ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ç›¸å…³çš„ç¯å¢ƒå˜é‡å¹¶å¯åŠ¨KongæœåŠ¡ã€‚æ–‡ç« è¿˜æä¾›äº†Kongaæ’ä»¶çš„ç¤ºä¾‹å›¾å’Œç›¸å…³å‚è€ƒé“¾æ¥ã€‚\nç›®å½• ä¸‹è½½å®‰è£… go-pluginserver Github: https://github.com/Kong/go-pluginserver\nä¸‹è½½å®‰è£…go-pluginserver\ngit clone https://github.com/Kong/go-pluginserver.git cd go-pluginserver # æ„å»ºç”Ÿæˆ go-pluginserver äºŒè¿›åˆ¶æ–‡ä»¶ go build å®‰è£…cç›¸å…³ç¼–è¯‘ç¯å¢ƒ Contos\nyum install make automake gcc gcc-c++ kernel-devel ä¸‹è½½å®˜æ–¹æ’ä»¶ç¤ºä¾‹ Github: https://github.com/Kong/go-plugins.git\n# git clone https://github.com/Kong/go-plugins.git cd go-plugins go build -buildmode=plugin go-hello.go Demo package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/Kong/go-pdk\u0026#34; ) // Config konga ç•Œé¢ç›¸å…³å­—æ®µ // æ³¨ï¼šå¦‚æœä¿®æ”¹Configå­—æ®µéœ€é‡å¯kongæœåŠ¡æ‰å¯ç”Ÿæ•ˆ type Config struct { Message string } func New() interface{} { return \u0026amp;Config{} } // Access é˜¶æ®µ func (conf Config) Access(kong *pdk.PDK) { // è·å–è¯·æ±‚headerä¸­çš„hostä¿¡æ¯ host, err := kong.Request.GetHeader(\u0026#34;host\u0026#34;) if err != nil { // è®°å½•erræ—¥å¿— kong.Log.Err(err.Error()) } // è·å–æ’ä»¶é…ç½®ä¿¡æ¯message message := conf.Message if message == \u0026#34;\u0026#34; { message = \u0026#34;hello\u0026#34; } // è®¾ç½®headerå¤´ kong.Response.SetHeader(\u0026#34;x-hello-from-go\u0026#34;, fmt.Sprintf(\u0026#34;Go says %s to %s\u0026#34;, message, host)) } kongæœåŠ¡å¯åŠ¨ é…ç½®ç›¸å…³ç¯å¢ƒå˜é‡\nKONG_PLUGINS=bundled,go-hello ï¼ˆgo-hello æ’ä»¶åç§°ï¼‰\nKONG_GO_PLUGINS_DIR=/home/kong/go-plugins ï¼ˆ .so æ–‡ä»¶ç›®å½•ï¼‰\nKONG_GO_PLUGINSERVER_EXE=/home/kong/go-plugins/go-pluginserver ï¼ˆgo-pluginserver æ–‡ä»¶ç›®å½•ï¼‰\nsudo docker run -d --name kong-2.2.1 \\ -e \u0026#34;KONG_DATABASE=cassandra\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_KEYSPACE=internal_gateway_dev\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_USERNAME=internal_gateway_dev\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_PASSWORD=xxxx\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_CONTACT_POINTS=xxxx\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_TIMEOUT=30000\u0026#34; \\ -e \u0026#34;KONG_PROXY_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_PROXY_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl\u0026#34; \\ -e \u0026#34;KONG_PLUGINS=bundled,go-hello\u0026#34; \\ -e \u0026#34;KONG_GO_PLUGINS_DIR=/home/kong/go-plugins\u0026#34; \\ -e \u0026#34;KONG_GO_PLUGINSERVER_EXE=/home/kong/go-plugins/go-pluginserver\u0026#34; \\ -p 8000:8000 \\ -p 8443:8443 \\ -p 0.0.0.0:8001:8001 \\ -p 127.0.0.1:8444:8444 \\ -v /home/xx/devspace/go-plugins:/home/kong/go-plugins \\ # æœ¬åœ°æŒ‚è½½ç›®å½• kong:2.2.1-centos konga æ’ä»¶ç¤ºä¾‹å›¾ å‚è€ƒ https://www.yuque.com/baxiang/ms/ggqrk7\n","permalink":"https://www.iarno.cn/article/plugin-dev4/","tags":["ç½‘å…³"],"title":"Kong - è‡ªå®šä¹‰æ’ä»¶å¼€å‘(å››)"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Dockerå¯åŠ¨Kongå¹¶åŠ è½½è‡ªå®šä¹‰æ’ä»¶ã€‚è¯¦ç»†ä»‹ç»äº†Dockerå¯åŠ¨å‘½ä»¤ä¸­çš„ç¯å¢ƒå˜é‡å’ŒæŒ‚è½½è·¯å¾„çš„é…ç½®ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœå‡ºç°ntt-auth plugin is in use but not enabledé”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥æ’ä»¶è·¯å¾„å’ŒKONG_PLUGINSç¯å¢ƒå˜é‡ã€‚\nä½¿ç”¨è‡ªå®šä¹‰æ’ä»¶ï¼ŒDockerå®¹å™¨å¯åŠ¨ç›¸å…³é…ç½®å¦‚ä¸‹ï¼š\nDocker å¯åŠ¨ sudo docker run -d --name kong-2.2.1 \\ -e \u0026#34;KONG_DATABASE=cassandra\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_KEYSPACE=xxxxxx\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_USERNAME=xxxxx\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_PASSWORD=xxxxxxx\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_CONTACT_POINTS=x.x.x.x\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_TIMEOUT=30000\u0026#34; \\ -e \u0026#34;KONG_PROXY_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_PROXY_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl\u0026#34; \\ -e \u0026#34;KONG_PLUGINS=bundled,ntt-auth\u0026#34; \\ -e \u0026#34;KONG_LUA_PACKAGE_PATH=/home/?.lua;;\u0026#34; \\ -p 8000:8000 \\ -p 8443:8443 \\ -p 0.0.0.0:8001:8001 \\ -p 127.0.0.1:8444:8444 \\ -v /home/devspace/kong-plugin:/home/kong/plugins/ntt-auth/ \\ -v /etc/localtime:/etc/localtime:ro \\ kong:2.2.1-centos æ³¨æ„ä»¥ä¸‹ç›¸å…³é…ç½®: -e \u0026quot;KONG_PLUGINS=bundled,ntt-auth\u0026quot; # ntt-auth è‡ªå®šæ’ä»¶åç§°\n-e \u0026quot;KONG_LUA_PACKAGE_PATH=/home/?.lua;;\u0026quot; # é»˜è®¤ä¼šåŠ ä¸Š/kong/plugins/ntt-auth/ è·¯å¾„\n-v /home/devspace/kong-plugin:/home/kong/plugins/ntt-auth/ # æ’ä»¶æŒ‚è½½è·¯å¾„\né—®é¢˜ å¦‚æœå‡ºç° ntt-auth plugin is in use but not enabled é”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ’ä»¶è·¯å¾„æˆ–KONG_PLUGINSç¯å¢ƒå˜é‡ã€‚\n","permalink":"https://www.iarno.cn/article/plugin-dev3/","tags":["ç½‘å…³"],"title":"Kong - è‡ªå®šä¹‰æ’ä»¶å¼€å‘(ä¸‰)"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨Kongä¸­å¼€å‘è‡ªå®šä¹‰æ’ä»¶ã€‚é¦–å…ˆï¼Œå®ƒè§£é‡Šäº†Kongæ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•åœ¨Luaä¸­å®ç°base_plugin.luaæ¥å£çš„æ–¹æ³•ã€‚ç„¶åï¼Œæ–‡ç« æä¾›äº†ä¸€ä¸ªNttAuthHandleræ’ä»¶çš„ç¤ºä¾‹ï¼ŒåŒ…æ‹¬accessã€init_workerå’Œlogé˜¶æ®µçš„å®ç°ã€‚æ¥ç€ï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•å®šä¹‰æ’ä»¶çš„schemaã€‚æœ€åï¼Œæ–‡ç« è®¨è®ºäº†åœ¨Dockerå®¹å™¨éƒ¨ç½²ä¸­å¦‚ä½•ä½¿ç”¨lua_shared_dictå…±äº«å†…å­˜ï¼Œå¹¶æä¾›äº†Kong Nginxæ¨¡æ¿çš„ç›¸å…³é…ç½®ã€‚\nç”Ÿå‘½å‘¨æœŸ Kong æ’ä»¶å…è®¸æ‚¨åœ¨è¯·æ±‚/å“åº”æˆ– tcp æµè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸçš„å¤šä¸ªå…¥å£ç‚¹æ³¨å…¥è‡ªå®šä¹‰é€»è¾‘ï¼ˆåœ¨ Lua ä¸­ï¼‰ï¼Œå› ä¸ºå®ƒç”± Kong ä»£ç†ã€‚ä¸ºæ­¤ï¼Œå¿…é¡»å®ç°base_plugin.luaæ¥å£çš„ä¸€ç§æˆ–å‡ ç§æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å°†åœ¨ä»¥ä¸‹å‘½åç©ºé—´çš„æ¨¡å—ä¸­å®ç°ï¼š kong.plugins.\u0026lt;plugin_name\u0026gt;.handler\nhandel.lua local NttAuthHandler = { PRIORITY = 1001, VERSION = \u0026#34;1.0.0\u0026#34;, } -- access é˜¶æ®µ function NttAuthHandler:access(conf) -- è‡ªå®šä¹‰æ’ä»¶é€»è¾‘å…·ä½“é€»è¾‘ -- éªŒè¯ local ok, err = nttAuth(conf) if not ok then return kong.response.error(err.status, err.message, {[\u0026#34;Content-Type\u0026#34;] = \u0026#34;application/json\u0026#34;}) end end -- init_worker é˜¶æ®µ function NttAuthHandler:init_worker(conf) ... end -- log é˜¶æ®µ function NttAuthHandler:log(conf) ... end return NttAuthHandler schema.lua local typedefs = require \u0026#34;kong.db.schema.typedefs\u0026#34; local schema = { name = \u0026#34;ntt-auth\u0026#34;, fields = { { consumer = typedefs.no_consumer }, { protocols = typedefs.protocols_http }, { config = { type = \u0026#34;record\u0026#34;, fields = { { auth_service = { type = \u0026#34;string\u0026#34; }, }, { appid_in_header = { type = \u0026#34;boolean\u0026#34;, required = true, default = false }, }, }, }, }, }, } return schema å…¶ä»– å¦‚æœDockerå®¹å™¨éƒ¨ç½²éœ€è¦ä½¿ç”¨åˆ°lua_shared_dictå…±äº«å†…å­˜ï¼ŒDockerå®¹å™¨ä¸­Kong Nginxæ¨¡æ¿ç›¸å…³é…ç½®å¦‚ä¸‹:\n# kong nginxé…ç½®æ¨¡æ¿ vi /usr/local/share/lua/5.1/kong/templates/nginx_kong.lua lua_shared_dict kong_db_cache_miss 12m; lua_shared_dict ntt_auth ${{MEM_CACHE_SIZE}}; // æ”¾åœ¨ if database == \u0026#34;off\u0026#34; å‰é¢ å‚è€ƒ https://docs.konghq.com/gateway-oss/2.2.x/plugin-development/custom-logic/\nhttps://docs.konghq.com/gateway-oss/2.2.x/plugin-development/plugin-configuration/\n","permalink":"https://www.iarno.cn/article/plugin-dev2/","tags":["ç½‘å…³"],"title":"Kong - è‡ªå®šä¹‰æ’ä»¶å¼€å‘(äºŒ)"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•å¼€å‘Kongè‡ªå®šä¹‰æ’ä»¶ã€‚é¦–å…ˆï¼Œå°†æ’ä»¶è§†ä¸ºä¸€ç»„Luaæ¨¡å—ï¼ŒKongä¼šæ£€æµ‹å¹¶åŠ è½½éµå¾ªç‰¹å®šå‘½åçº¦å®šçš„æ’ä»¶æ¨¡å—ã€‚æ’ä»¶ç”±ä¸¤ä¸ªå¼ºåˆ¶æ€§æ¨¡å—ç»„æˆï¼šhandler.luaå’Œschema.luaã€‚ä¸€äº›æ’ä»¶å¯èƒ½éœ€è¦æ›´æ·±å…¥åœ°é›†æˆåˆ°Kongä¸­ï¼Œä¾‹å¦‚åœ¨æ•°æ®åº“ä¸­æœ‰è‡ªå·±çš„è¡¨ï¼Œæˆ–åœ¨Admin APIä¸­å…¬å¼€ç«¯ç‚¹ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡å‘æ’ä»¶æ·»åŠ æ–°æ¨¡å—æ¥å®Œæˆã€‚\nä»‹ç» å°†æ‚¨çš„æ’ä»¶è§†ä¸ºä¸€ç»„Lua æ¨¡å—ã€‚æœ¬ç« ä¸­æè¿°çš„æ¯ä¸ªæ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ã€‚å¦‚æœå®ƒä»¬çš„åç§°éµå¾ªä»¥ä¸‹çº¦å®šï¼ŒKong å°†æ£€æµ‹å¹¶åŠ è½½æ‚¨çš„æ’ä»¶æ¨¡å—ï¼š\nkong.plugins.\u0026lt;plugin_name\u0026gt;.\u0026lt;module_name\u0026gt; ä½ çš„æ¨¡å—å½“ç„¶éœ€è¦é€šè¿‡ä½ çš„package.path å˜é‡è®¿é—® ï¼Œå®ƒå¯ä»¥é€šè¿‡lua_package_path é…ç½®å±æ€§è°ƒæ•´åˆ°ä½ çš„éœ€è¦ ã€‚ç„¶è€Œï¼Œå®‰è£…æ’ä»¶çš„é¦–é€‰æ–¹å¼æ˜¯é€šè¿‡ LuaRocksï¼ŒKong ä¸å®ƒæœ¬åœ°é›†æˆã€‚\nä¸ºäº†è®© Kong æ„è¯†åˆ°å®ƒå¿…é¡»å¯»æ‰¾ä½ æ’ä»¶çš„æ¨¡å—ï¼Œä½ å¿…é¡»å°†å®ƒæ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­çš„ pluginså±æ€§ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š\nplugins = bundled,my-custom-plugin # your plugin name here æˆ–è€…ï¼Œå¦‚æœæ‚¨ä¸æƒ³åŠ è½½ä»»ä½•æ†ç»‘çš„æ’ä»¶ï¼š\nplugins = my-custom-plugin # your plugin name here ç°åœ¨ï¼ŒKong å°†å°è¯•ä»ä»¥ä¸‹å‘½åç©ºé—´åŠ è½½å‡ ä¸ª Lua æ¨¡å—ï¼š\nkong.plugins.my-custom-plugin.\u0026lt;module_name\u0026gt; å…¶ä¸­ä¸€äº›æ¨¡å—æ˜¯å¼ºåˆ¶æ€§çš„ï¼ˆä¾‹å¦‚handler.luaï¼‰ï¼Œä¸€äº›æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”å…è®¸æ’ä»¶å®ç°ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚api.luaæ‰©å±•ç®¡ç† API ç«¯ç‚¹ï¼‰ã€‚\nç°åœ¨è®©æˆ‘ä»¬å‡†ç¡®æè¿°æ‚¨å¯ä»¥å®ç°çš„æ¨¡å—æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚\nåŸºæœ¬æ’ä»¶æ¨¡å— åœ¨æœ€çº¯ç²¹çš„å½¢å¼ä¸­ï¼Œæ’ä»¶ç”±ä¸¤ä¸ªå¼ºåˆ¶æ€§æ¨¡å—ç»„æˆï¼š\nsimple-plugin â”œâ”€â”€ handler.lua â””â”€â”€ schema.lua handler.luaï¼šæ’ä»¶çš„æ ¸å¿ƒã€‚å®ƒæ˜¯ä¸€ä¸ªè¦å®ç°çš„æ¥å£ï¼Œå…¶ä¸­æ¯ä¸ªå‡½æ•°éƒ½å°†åœ¨è¯·æ±‚/è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰€éœ€æ—¶åˆ»è¿è¡Œã€‚ schema.luaï¼šæ‚¨çš„æ’ä»¶å¯èƒ½å¿…é¡»ä¿ç•™ç”¨æˆ·è¾“å…¥çš„ä¸€äº›é…ç½®ã€‚è¯¥æ¨¡å—ä¿å­˜è¯¥é…ç½®çš„æ¶æ„å¹¶åœ¨å…¶ä¸Šå®šä¹‰è§„åˆ™ï¼Œä»¥ä¾¿ç”¨æˆ·åªèƒ½è¾“å…¥æœ‰æ•ˆçš„é…ç½®å€¼ã€‚ é«˜çº§æ’ä»¶æ¨¡å— ä¸€äº›æ’ä»¶å¯èƒ½éœ€è¦ä¸ Kong æ›´æ·±å…¥åœ°é›†æˆï¼šåœ¨æ•°æ®åº“ä¸­æœ‰è‡ªå·±çš„è¡¨ï¼Œåœ¨ Admin API ä¸­å…¬å¼€ç«¯ç‚¹ç­‰ã€‚æ¯ä¸€ä¸ªéƒ½å¯ä»¥é€šè¿‡å‘æ’ä»¶æ·»åŠ ä¸€ä¸ªæ–°æ¨¡å—æ¥å®Œæˆã€‚å¦‚æœæ’ä»¶å®ç°äº†æ‰€æœ‰å¯é€‰æ¨¡å—ï¼Œé‚£ä¹ˆå®ƒçš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š\ncomplete-plugin â”œâ”€â”€ api.lua â”œâ”€â”€ daos.lua â”œâ”€â”€ handler.lua â”œâ”€â”€ migrations â”‚ â”œâ”€â”€ init.lua â”‚ â””â”€â”€ 000_base_complete_plugin.lua â””â”€â”€ schema.lua è¿™æ˜¯å¯èƒ½è¦å®ç°çš„æ¨¡å—çš„å®Œæ•´åˆ—è¡¨ä»¥åŠå®ƒä»¬çš„ç”¨é€”çš„ç®€è¦è¯´æ˜ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»ï¼Œè®©æ‚¨æŒæ¡å…¶ä¸­çš„æ¯ä¸€ä¸ªã€‚\næ¨¡å—åç§° å¿…éœ€çš„ æè¿° api.lua ä¸ å®šä¹‰å¯åœ¨ Admin API ä¸­ä½¿ç”¨çš„ç«¯ç‚¹åˆ—è¡¨ï¼Œä»¥ä¸æ’ä»¶å¤„ç†çš„è‡ªå®šä¹‰å®ä½“è¿›è¡Œäº¤äº’ã€‚ daos.lua ä¸ å®šä¹‰ä¸€ä¸ª DAOï¼ˆæ•°æ®åº“è®¿é—®å¯¹è±¡ï¼‰åˆ—è¡¨ï¼Œå®ƒä»¬æ˜¯æ’ä»¶æ‰€éœ€çš„è‡ªå®šä¹‰å®ä½“çš„æŠ½è±¡ï¼Œå¹¶å­˜å‚¨åœ¨æ•°æ®å­˜å‚¨ä¸­ã€‚ handler.lua æ˜¯çš„ è¦å®ç°çš„æ¥å£ã€‚æ¯ä¸ªå‡½æ•°éƒ½å°†ç”± Kong åœ¨è¯·æ±‚/è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­çš„æ‰€éœ€æ—¶åˆ»è¿è¡Œã€‚ migrations/*.lua ä¸ æ•°æ®åº“è¿ç§»ï¼ˆä¾‹å¦‚åˆ›å»ºè¡¨ï¼‰ã€‚ä»…å½“æ‚¨çš„æ’ä»¶å¿…é¡»å°†è‡ªå®šä¹‰å®ä½“å­˜å‚¨åœ¨æ•°æ®åº“ä¸­å¹¶é€šè¿‡daos.luaå®šä¹‰çš„ DAO ä¹‹ä¸€ä¸å®ƒä»¬äº¤äº’æ—¶ï¼Œæ‰éœ€è¦è¿ç§»ã€‚ schema.lua æ˜¯çš„ ä¿å­˜æ’ä»¶é…ç½®çš„æ¶æ„ï¼Œä»¥ä¾¿ç”¨æˆ·åªèƒ½è¾“å…¥æœ‰æ•ˆçš„é…ç½®å€¼ã€‚ è¯¥å¯†é’¥çš„éªŒè¯æ’ä»¶ä¸æ­¤æ–‡ä»¶ç»“æ„æ’ä»¶çš„ä¾‹å­ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å…¶æºä»£ç ã€‚\nå‚è€ƒ https://docs.konghq.com/gateway-oss/2.2.x/plugin-development/file-structure/\n","permalink":"https://www.iarno.cn/article/plugin-dev1/","tags":["ç½‘å…³"],"title":"Kong - è‡ªå®šä¹‰æ’ä»¶å¼€å‘(ä¸€)"},{"categories":["Lua"],"contents":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å››ç§é™æµç®—æ³•ï¼šå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¹¶é€šè¿‡Luaè„šæœ¬å’ŒRediså®ç°äº†ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨Redisçš„SCRIPT LOADå’ŒEVALSHAå‘½ä»¤æ¥æ‰§è¡Œé™æµé€»è¾‘ï¼Œå¹¶é€šè¿‡è¿”å›å€¼åˆ¤æ–­æ˜¯å¦è§¦å‘é™æµè¡Œä¸ºã€‚æœ€åï¼Œæ–‡ç« å¯¹å››ç§ç®—æ³•è¿›è¡Œäº†æ¯”è¾ƒå’Œæ€»ç»“ï¼Œè®¤ä¸ºä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ä¸€ç§ç›¸å¯¹å®Œç¾çš„é™æµç®—æ³•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°é™æµåœºæ™¯ã€‚\nä¸€ã€é™æµç®€ä»‹ ä»€ä¹ˆæ˜¯é™æµ åœ¨ä¸åŒåœºæ™¯ä¸‹é™æµçš„å®šä¹‰ä¹Ÿå„ä¸ç›¸åŒï¼Œå¯ä»¥æ˜¯æ¯ç§’è¯·æ±‚æ•°ã€æ¯ç§’äº‹åŠ¡å¤„ç†æ•°ã€ç½‘ç»œæµé‡ã€‚\né€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„é™æµæŒ‡çš„æ˜¯é™åˆ¶åˆ°è¾¾ç³»ç»Ÿå¹¶å‘è¯·æ±‚æ•°ï¼Œä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸çš„å¤„ç†éƒ¨åˆ†ç”¨æˆ·çš„è¯·æ±‚ï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚\nä¸ºä»€ä¹ˆé™æµ æ¥å£æ— æ³•æ§åˆ¶è°ƒç”¨æ–¹çš„è¡Œä¸ºã€‚çƒ­ç‚¹ä¸šåŠ¡çªå‘è¯·æ±‚ã€æ¶æ„è¯·æ±‚æ”»å‡»ç­‰ä¼šå¸¦æ¥ç¬æ—¶çš„è¯·æ±‚é‡æ¿€å¢ï¼Œå¯¼è‡´æœåŠ¡å ç”¨å¤§é‡çš„ CPUã€å†…å­˜ç­‰èµ„æºï¼Œä½¿å¾—å…¶ä»–æ­£å¸¸çš„è¯·æ±‚å˜æ…¢æˆ–è¶…æ—¶ï¼Œç”šè‡³å¼•èµ·æœåŠ¡å™¨å®•æœºã€‚\næŒ‰ç…§è¯·æ±‚æ¬¡æ•°è¿›è¡Œæ”¶è´¹çš„æ¥å£éœ€è¦æ ¹æ®å®¢æˆ·æ”¯ä»˜çš„é‡‘é¢æ¥é™åˆ¶å®¢æˆ·å¯ç”¨çš„æ¬¡æ•°ã€‚\né™æµçš„è¡Œä¸º é™æµçš„è¡Œä¸ºæŒ‡çš„å°±æ˜¯åœ¨æ¥å£çš„è¯·æ±‚æ•°è¾¾åˆ°é™æµçš„æ¡ä»¶æ—¶è¦è§¦å‘çš„æ“ä½œï¼Œä¸€èˆ¬å¯è¿›è¡Œä»¥ä¸‹è¡Œä¸ºã€‚\næ‹’ç»æœåŠ¡ï¼šæŠŠå¤šå‡ºæ¥çš„è¯·æ±‚æ‹’ç»æ‰ æœåŠ¡é™çº§ï¼šå…³é—­æˆ–æ˜¯æŠŠåç«¯æœåŠ¡åšé™çº§å¤„ç†ã€‚è¿™æ ·å¯ä»¥è®©æœåŠ¡æœ‰è¶³å¤Ÿçš„èµ„æºæ¥å¤„ç†æ›´å¤šçš„è¯·æ±‚ ç‰¹æƒè¯·æ±‚ï¼šèµ„æºä¸å¤Ÿäº†ï¼Œæˆ‘åªèƒ½æŠŠæœ‰é™çš„èµ„æºåˆ†ç»™é‡è¦çš„ç”¨æˆ· å»¶æ—¶å¤„ç†ï¼šä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªé˜Ÿåˆ—æ¥ç¼“å†²å¤§é‡çš„è¯·æ±‚ï¼Œè¿™ä¸ªé˜Ÿåˆ—å¦‚æœæ»¡äº†ï¼Œé‚£ä¹ˆå°±åªèƒ½æ‹’ç»ç”¨æˆ·äº†ï¼Œå¦‚æœè¿™ä¸ªé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¶…æ—¶äº†ï¼Œä¹Ÿè¦è¿”å›ç³»ç»Ÿç¹å¿™çš„é”™è¯¯äº† å¼¹æ€§ä¼¸ç¼©ï¼šç”¨è‡ªåŠ¨åŒ–è¿ç»´çš„æ–¹å¼å¯¹ç›¸åº”çš„æœåŠ¡åšè‡ªåŠ¨åŒ–çš„ä¼¸ç¼© äºŒã€é™æµæ¶æ„ å•ç‚¹é™æµ å½“æˆ‘ä»¬çš„ç³»ç»Ÿåº”ç”¨åªéƒ¨ç½²åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ¥æä¾›æœåŠ¡æ—¶ï¼Œå°±å¯ä»¥é‡‡ç”¨å•ç‚¹é™æµçš„æ¶æ„æ¥å¯¹åº”ç”¨çš„æ¥å£è¿›è¡Œé™æµï¼Œåªè¦å•ç‚¹åº”ç”¨è¿›è¡Œäº†é™æµï¼Œé‚£ä¹ˆä»–æ‰€ä¾èµ–çš„å„ç§æœåŠ¡ä¹Ÿå¾—åˆ°äº†ä¿æŠ¤ã€‚\nåˆ†å¸ƒå¼é™æµ ä¸ºäº†æä¾›é«˜æ€§èƒ½çš„æœåŠ¡ï¼Œå¾€å¾€æˆ‘ä»¬çš„åº”ç”¨éƒ½æ˜¯ä»¥é›†ç¾¤ç»“æ„éƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„ã€‚è¿™æ—¶å€™å•ç‚¹é™æµåªèƒ½é™åˆ¶ä¼ å…¥å•ä¸ªèŠ‚ç‚¹çš„è¯·æ±‚ï¼Œä¿æŠ¤è‡ªèº«èŠ‚ç‚¹ï¼Œæ— æ³•ä¿æŠ¤åº”ç”¨ä¾èµ–çš„å„ç§æœåŠ¡èµ„æºã€‚é‚£ä¹ˆå¦‚æœåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿›è¡Œå•ç‚¹é™æµæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ\nå‡è®¾æˆ‘ä»¬çš„åº”ç”¨é›†ç¾¤ä¸­æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¸ºäº†ä¿æŠ¤åº”ç”¨ä¾èµ–çš„èµ„æºæˆ‘ä»¬é™åˆ¶èµ„æºæ¯ç§’æœ€å¤§è¯·æ±‚æ•°ä¸º300ä¸ªï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶é‚£ä¹ˆèµ„æºå°†å› è¿‡è½½å¯¼è‡´ä¸å†å¯ç”¨ã€‚è¿™æ ·åˆ†é…åˆ°é›†ç¾¤ä¸­çš„æ¯ä¸ªåº”ç”¨èŠ‚ç‚¹çš„æ¯ç§’æœ€å¤§è¯·æ±‚æ•°ä¸º100ä¸ªæ‰å¯ä»¥æ»¡è¶³ä¿æŠ¤èµ„æºçš„è¦æ±‚ï¼Œè¶…è¿‡100åˆ™æ‹’ç»æœåŠ¡æç¤ºä¸šåŠ¡ç¹å¿™ã€‚\nå‡å¦‚æŸä¸€ç§’å†…æœ‰300ä¸ªè¯·æ±‚æ‰“åˆ°åº”ç”¨é›†ç¾¤ï¼Œåº”ç”¨é›†ç¾¤å†å»è¯·æ±‚æ‰€ä¾èµ–çš„èµ„æºæœåŠ¡ï¼Œæ˜¯æ»¡è¶³èµ„æºæœåŠ¡æ¯ç§’300ä¸ªæœ€å¤§è¯·æ±‚æ•°çš„é™åˆ¶çš„ï¼Œæ‰€ä»¥è¿™äº›è¯·æ±‚éƒ½èƒ½å¤Ÿå¾—åˆ°å¤„ç†å¹¶ä¸”æ­£å¸¸è¿”å›ã€‚\nä½†æ˜¯ï¼Œå¦‚æœå› ä¸ºç§ç§åŸå› è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨æŠŠè¿™ 300 ä¸ªè¯·æ±‚ä¸­çš„ 50 ä¸ªåˆ†é…ç»™äº†èŠ‚ç‚¹1ï¼Œ50 ä¸ªåˆ†é…ç»™äº†èŠ‚ç‚¹2ï¼Œå‰©ä½™ 200 ä¸ªåˆ†é…ç»™äº†èŠ‚ç‚¹3ã€‚å› ä¸ºæˆ‘ä»¬ä¹‹å‰é™åˆ¶æ¯ä¸ªèŠ‚ç‚¹çš„æ¯ç§’æœ€å¤§è¯·æ±‚æ•°ä¸º 100ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°èŠ‚ç‚¹1çš„50ä¸ªè¯·æ±‚å…¨éƒ¨æ­£å¸¸è¿”å›ã€èŠ‚ç‚¹2ä¸Šçš„ 50 ä¸ªè¯·æ±‚å…¨éƒ¨æ­£å¸¸è¿”å›ï¼Œè€ŒèŠ‚ç‚¹ä¸‰ä¸Šçš„200ä¸ªè¯·æ±‚åªæœ‰100ä¸ªæ­£å¸¸è¿”å›ï¼Œå¦å¤–100ä¸ªè¢«æ‹’ç»æœåŠ¡ã€‚è¿™ç§é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œå•ç‚¹é™æµçš„æ–¹å¼æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€è¦ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå„ç§ä¸­é—´ä»¶çš„åˆ†å¸ƒå¼é™æµæ¥è§£å†³é›†ç¾¤ç»“æ„ä¸‹åº”ç”¨é™æµä¸å‡†ç¡®çš„é—®é¢˜ã€‚å°†é™æµçš„é…ç½®ä»¥åŠé€šè¿‡æ•´ä¸ªé›†ç¾¤çš„è¯·æ±‚æ•°éƒ½ä¿å­˜åœ¨ä¸­é—´ä»¶ä¸­ï¼Œç„¶åé€šè¿‡è®¡ç®—æ¥åˆ¤æ–­æ˜¯å¦è¾¾åˆ°é™æµè¡Œä¸ºçš„è§¦å‘æ¡ä»¶ã€‚åˆ†å¸ƒå¼é™æµå¯ä»¥ç»Ÿä¸€åœ°é™åˆ¶æ•´ä¸ªé›†ç¾¤çš„æµé‡ï¼Œæ•´ä¸ªé›†ç¾¤çš„è¯·æ±‚æ•°å¾—åˆ°äº†é™åˆ¶ï¼Œé‚£ä¹ˆé›†ç¾¤æ‰€ä¾èµ–çš„èµ„æºæœåŠ¡ä¹Ÿå°±å¾—åˆ°äº†ä¿éšœã€‚\nä¸‰ã€é™æµç®—æ³• å›ºå®šçª—å£è®¡æ•°å™¨ å°†æ—¶é—´æŒ‰ç…§è®¾å®šçš„å‘¨æœŸåˆ’åˆ†ä¸ºå¤šä¸ªçª—å£ åœ¨å½“å‰æ—¶é—´çª—å£å†…æ¯æ¥ä¸€æ¬¡è¯·æ±‚å°±å°†è®¡æ•°å™¨åŠ ä¸€ å¦‚æœè®¡æ•°å™¨è¶…è¿‡äº†é™åˆ¶æ•°é‡ï¼Œåˆ™æ‹’ç»æœåŠ¡ å½“æ—¶é—´åˆ°è¾¾ä¸‹ä¸€ä¸ªçª—å£æ—¶ï¼Œè®¡æ•°å™¨çš„å€¼é‡ç½® è¿™ç§ç®—æ³•å¾ˆå¥½å®ç°ï¼Œä½†æ˜¯ä¼šå‡ºç°é™æµä¸å‡†ç¡®çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š\nå‡è®¾é™åˆ¶æ¯ç§’é€šè¿‡5ä¸ªè¯·æ±‚ï¼Œæ—¶é—´çª—å£çš„å¤§å°ä¸º1ç§’ï¼Œå½“å‰æ—¶é—´çª—å£å‘¨æœŸå†…çš„ååŠç§’æ­£å¸¸é€šè¿‡äº†5ä¸ªè¯·æ±‚ï¼Œä¸‹ä¸€ä¸ªæ—¶é—´çª—å£å‘¨æœŸå†…çš„å‰åŠç§’æ­£å¸¸é€šè¿‡äº†5ä¸ªè¯·æ±‚ï¼Œåœ¨è¿™ä¸¤ä¸ªçª—å£å†…éƒ½æ²¡æœ‰è¶…è¿‡é™åˆ¶ã€‚ä½†æ˜¯åœ¨è¿™ä¸¤ä¸ªçª—å£çš„ä¸­é—´é‚£ä¸€ç§’å®é™…ä¸Šé€šè¿‡äº† 10 ä¸ªè¯·æ±‚ï¼Œæ˜¾ç„¶ä¸æ»¡è¶³æ¯ç§’5ä¸ªè¯·æ±‚çš„é™åˆ¶ã€‚\næ»‘åŠ¨çª—å£è®¡æ•°å™¨ å°†è®¾å®šçš„æ—¶é—´å‘¨æœŸè®¾ä¸ºæ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œè®°å½•æ¯æ¬¡è¯·æ±‚çš„æ—¶åˆ» å½“æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥æ—¶å°†çª—å£æ»‘åˆ°è¯¥è¯·æ±‚æ¥ä¸´çš„æ—¶åˆ» åˆ¤æ–­çª—å£å†…çš„è¯·æ±‚æ•°æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶åˆ™æ‹’ç»æœåŠ¡ï¼Œå¦åˆ™è¯·æ±‚é€šè¿‡ ä¸¢å¼ƒæ»‘åŠ¨çª—å£ä»¥å¤–çš„è¯·æ±‚ è¿™ç§ç®—æ³•è§£å†³äº†å›ºå®šçª—å£è®¡æ•°å™¨å‡ºç°çš„é€šè¿‡è¯·æ±‚æ•°æ˜¯é™åˆ¶æ•°ä¸¤å€çš„ç¼ºé™·ï¼Œä½†æ˜¯å®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ï¼Œå¹¶ä¸”éœ€è¦è®°å½•çª—å£å‘¨æœŸå†…çš„è¯·æ±‚ï¼Œå¦‚æœé™æµé˜ˆå€¼è®¾ç½®è¿‡å¤§ï¼Œçª—å£å‘¨æœŸå†…è®°å½•çš„è¯·æ±‚å°±ä¼šå¾ˆå¤šï¼Œå°±ä¼šæ¯”è¾ƒå ç”¨å†…å­˜\næ¼æ¡¶ç®—æ³• å°†è¿›æ¥çš„è¯·æ±‚æµé‡è§†ä¸ºæ°´æ»´å…ˆæ”¾å…¥æ¡¶å†… æ°´ä»æ¡¶çš„åº•éƒ¨ä»¥å›ºå®šçš„é€Ÿç‡åŒ€é€Ÿæµå‡ºï¼Œç›¸å½“äºåœ¨åŒ€é€Ÿå¤„ç†è¯·æ±‚ å½“æ¼æ¡¶å†…çš„æ°´æ»¡æ—¶(è¶…è¿‡äº†é™æµé˜ˆå€¼)åˆ™æ‹’ç»æœåŠ¡ è¿™ä¸ªç®—æ³•å¯ä»¥æ¯”è¾ƒå¹³æ»‘å‡åŒ€çš„é™åˆ¶è¯·æ±‚ï¼ŒNginx ä¸­çš„ limit_req æ¨¡å—çš„åº•å±‚å®ç°å°±æ˜¯ç”¨çš„è¿™ç§ç®—æ³•ï¼Œå…·ä½“å¯å‚è€ƒã€NGINXå’ŒNGINX Plusçš„é€Ÿç‡é™åˆ¶ã€‘(https://www.nginx.com/blog/rate-limiting-nginx)\nä½†æ˜¯æ¼æ¡¶ç®—æ³•ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå› ä¸ºæ°´ä»æ¡¶çš„åº•éƒ¨ä»¥å›ºå®šçš„é€Ÿç‡åŒ€é€Ÿæµå‡ºï¼Œå½“æœ‰åœ¨æœåŠ¡å™¨å¯æ‰¿å—èŒƒå›´å†…çš„ç¬æ—¶çªå‘è¯·æ±‚è¿›æ¥ï¼Œè¿™äº›è¯·æ±‚ä¼šè¢«å…ˆæ”¾å…¥æ¡¶å†…ï¼Œç„¶åå†åŒ€é€Ÿçš„è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šé€ æˆéƒ¨åˆ†è¯·æ±‚çš„å»¶è¿Ÿã€‚æ‰€ä»¥ä»–æ— æ³•åº”å¯¹åœ¨é™æµé˜ˆå€¼èŒƒå›´å†…çš„çªå‘è¯·æ±‚ã€‚\nä»¤ç‰Œæ¡¶ç®—æ³• æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡ç”Ÿäº§ä»¤ç‰Œå¹¶æ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­ å¦‚æœæ¡¶ä¸­ä»¤ç‰Œå·²æ»¡ï¼Œåˆ™ä¸¢å¼ƒä»¤ç‰Œ è¯·æ±‚è¿‡æ¥æ—¶å…ˆåˆ°æ¡¶ä¸­æ‹¿ä»¤ç‰Œï¼Œæ‹¿åˆ°ä»¤ç‰Œåˆ™æ”¾è¡Œé€šè¿‡ï¼Œå¦åˆ™æ‹’ç»è¯·æ±‚ è¿™ç§ç®—æ³•èƒ½å¤ŸæŠŠè¯·æ±‚å‡åŒ€çš„åˆ†é…åœ¨æ—¶é—´åŒºé—´å†…ï¼Œåˆèƒ½æ¥å—æœåŠ¡å¯æ‰¿å—èŒƒå›´å†…çš„çªå‘è¯·æ±‚ã€‚æ‰€ä»¥ä»¤ç‰Œæ¡¶ç®—æ³•åœ¨ä¸šå†…ä½¿ç”¨ä¹Ÿéå¸¸å¹¿æ³›ã€‚æ¥ä¸‹æ¥ä¼šè¯¦ç»†ä»‹ç»è¯¥ç®—æ³•çš„å®ç°ã€‚\nå››ã€ä»¤ç‰Œæ¡¶ç®—æ³•å®ç° æˆ‘ä»¬é‡‡ç”¨ Redis + Lua è„šæœ¬çš„æ–¹å¼æ¥å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œåœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬æœ‰è¯¸å¤šå¥½å¤„ï¼Œä¾‹å¦‚ï¼š\nå‡å°‘ç½‘ç»œå¼€é”€ï¼šæœ¬æ¥å¤šæ¬¡ç½‘ç»œè¯·æ±‚çš„æ“ä½œï¼Œå¯ä»¥ç”¨ä¸€ä¸ªè¯·æ±‚å®Œæˆï¼ŒåŸå…ˆå¤šæ¬¡è¯·æ±‚çš„é€»è¾‘æ”¾åœ¨ Redis æœåŠ¡å™¨ä¸Šå®Œæˆã€‚ä½¿ç”¨è„šæœ¬ï¼Œå‡å°‘äº†ç½‘ç»œå¾€è¿”æ—¶å»¶ã€‚ åŸå­æ“ä½œï¼šRedisä¼šå°†æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«å…¶ä»–è¿›ç¨‹æˆ–è€…è¿›ç¨‹çš„å‘½ä»¤æ’å…¥ã€‚ å¤ç”¨ï¼šå®¢æˆ·ç«¯å‘é€çš„è„šæœ¬ä¼šæ°¸ä¹…å­˜å‚¨åœ¨Redisä¸­ï¼Œæ„å‘³ç€å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥å¤ç”¨è¿™ä¸€è„šæœ¬è€Œä¸éœ€è¦ä½¿ç”¨ä»£ç å®ŒæˆåŒæ ·çš„é€»è¾‘ã€‚ å¤ç”¨ï¼šå®¢æˆ·ç«¯å‘é€çš„è„šæœ¬ä¼šæ°¸ä¹…å­˜å‚¨åœ¨Redisä¸­ï¼Œæ„å‘³ç€å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥å¤ç”¨è¿™ä¸€è„šæœ¬è€Œä¸éœ€è¦ä½¿ç”¨ä»£ç å®ŒæˆåŒæ ·çš„é€»è¾‘ã€‚ è¿™å…¶ä¸­æœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯åŸå­æ“ä½œã€‚å°† Redis çš„å¤šæ¡å‘½ä»¤å†™æˆä¸€ä¸ª Lua è„šæœ¬ï¼Œç„¶åè°ƒç”¨è„šæœ¬æ‰§è¡Œæ“ä½œï¼Œç›¸å½“äºåªæœ‰ä¸€æ¡æ‰§è¡Œè„šæœ¬çš„å‘½ä»¤ï¼Œæ‰€ä»¥æ•´ä¸ª Lua è„šæœ¬ä¸­çš„æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚\nåœ¨ Redis ä¸­ä½¿ç”¨ Lua è„šæœ¬ä¸»è¦æ¶‰åŠ Script Loadã€Evalã€Evalsha ä¸‰ä¸ªå‘½ä»¤ï¼š\nEval ${lua_script} å¯ä»¥ç›´æ¥æ‰§è¡Œ Lua è„šæœ¬ã€‚\nScript Load ${lua_script} å‘½ä»¤æ˜¯å°†è„šæœ¬è½½å…¥ Redisï¼Œè½½å…¥æˆåŠŸåä¼šè¿”å›ä¸€ä¸ªè„šæœ¬çš„sha1å€¼ï¼Œä¸€æ—¦è½½å…¥åˆ™æ°¸ä¹…å­˜å‚¨åœ¨ Redis ä¸­ï¼Œåç»­å¯ä»¥é€šè¿‡ Evalsha ${sha1} æ¥ç›´æ¥è°ƒç”¨æ­¤è„šæœ¬ã€‚æˆ‘ä»¬é‡‡ç”¨å…ˆ Load è„šæœ¬å¾—åˆ° Sha1 å€¼ï¼Œå†è°ƒç”¨è¿™ä¸ª sha1 å€¼æ¥æ‰§è¡Œè„šæœ¬çš„æ–¹å¼å¯ä»¥å‡å°‘åƒeval ${lua_script} å‘½ä»¤è¿™æ ·æ¯æ¬¡éƒ½å‘ Redis ä¸­å‘é€ä¸€é•¿ä¸² Lua è„šæœ¬å¸¦æ¥çš„ç½‘ç»œå¼€é”€ã€‚\nä½¿ç”¨ Redis ä¸­çš„ Hash æ•°æ®ç»“æ„æ¥å­˜å‚¨é™æµé…ç½®ï¼Œæ¯ä¸ª Hash è¡¨çš„ Key ä¸ºé™æµçš„ç²’åº¦ï¼Œå¯ä»¥æ˜¯æ¥å£Uriã€å®¢æˆ·ç«¯ IPã€åº”ç”¨uuidæˆ–è€…ä»–ä»¬çš„ç»„åˆå½¢å¼ã€‚æ¯ä¸ª Hash è¡¨ä¸ºä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼ŒHash è¡¨ä¸­åŒ…å«å¦‚ä¸‹å­—æ®µï¼š\nlast_time æœ€è¿‘ä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œæ¯«ç§’çº§åˆ«ã€‚ curr_permits å½“å‰æ¡¶å†…å‰©ä½™ä»¤ç‰Œæ•°é‡ï¼Œå•ä½ä¸ºï¼šä¸ªã€‚ bucket_cap æ¡¶çš„å®¹é‡ï¼Œå³æ¡¶å†…å¯å®¹çº³æœ€å¤§ä»¤ç‰Œæ•°é‡ï¼Œä»£è¡¨é™æµæ—¶é—´å‘¨æœŸå†…å…è®¸é€šè¿‡çš„æœ€å¤§è¯·æ±‚æ•°ã€‚ period é™æµçš„æ—¶é—´å‘¨æœŸï¼Œå•ä½ä¸ºï¼šç§’ã€‚ rate ä»¤ç‰Œäº§ç”Ÿçš„é€Ÿç‡ï¼Œå•ä½ï¼šä¸ª/ç§’ï¼Œrate = bucket_cap / period åœ¨ä¸Šé¢çš„ä»¤ç‰Œæ¡¶ç®—æ³•æè¿°ä¸­ç”Ÿäº§ä»¤ç‰Œçš„æ–¹å¼æ˜¯æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡ç”Ÿäº§ä»¤ç‰Œå¹¶æ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä¸€ä¸ªçº¿ç¨‹ä¸åœåœ°æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡ç”Ÿäº§ä»¤ç‰Œå¹¶æ›´æ–°ç›¸åº”çš„æ¡¶ï¼Œå¦‚æœè¢«é™æµçš„æ¥å£(æ¯ä¸ªæ¡¶)ä»¤ç‰Œç”Ÿäº§çš„é€Ÿç‡éƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼€å¤šä¸ªçº¿ç¨‹ï¼Œå¾ˆæµªè´¹èµ„æºã€‚\nä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå‡å°‘é™æµå±‚çš„èµ„æºæ¶ˆè€—ï¼Œæˆ‘ä»¬å°†ä»¤ç‰Œçš„ç”Ÿäº§æ–¹å¼æ”¹ä¸ºï¼šæ¯æ¬¡è¯·æ±‚è¿›æ¥æ—¶ä¸€æ¬¡æ€§ç”Ÿäº§ä¸Šä¸€æ¬¡è¯·æ±‚åˆ°æœ¬æ¬¡è¯·æ±‚è¿™ä¸€æ®µæ—¶é—´å†…çš„ä»¤ç‰Œã€‚éšæ„æ¯æ¬¡è¯·æ±‚ç”Ÿæˆçš„ä»¤ç‰Œæ•°å°±æ˜¯ (curr_time -last_time) / 1000 * rateï¼Œæ³¨æ„ï¼šè¿™é‡Œä¸¤æ¬¡æ—¶é—´æˆ³çš„å·®å€¼å•ä½æ˜¯æ¯«ç§’ï¼Œè€Œä»¤ç‰Œäº§ç”Ÿé€Ÿç‡çš„å•ä½æ˜¯ ä¸ª/ç§’ï¼Œæ‰€ä»¥è¦é™¤ä»¥ 1000ï¼ŒæŠŠæ—¶é—´æˆ³çš„å·®å€¼çš„å•ä½ä¹Ÿæ¢ç®—æˆç§’ã€‚\nä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°é€»è¾‘ä¸ºï¼š å‡å¦‚æˆ‘ä»¬çš„é™æµç­–ç•¥æ˜¯ä¸€åˆ†é’Ÿå†…æœ€å¤šèƒ½é€šè¿‡100ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆç›¸åº”çš„ä»¤ç‰Œäº§ç”Ÿé€Ÿç‡ä¸º 600 / 60 = 10 (ä¸ª/ç§’)ã€‚é‚£ä¹ˆå½“é™æµç­–ç•¥åˆšåˆšé…ç½®å¥½è¿™ä¸€æ—¶åˆ»å°±æœ‰çªå‘çš„10ä¸ªè¯·æ±‚è¿›æ¥ï¼Œæ­¤æ—¶ä»¤ç‰Œæ¡¶å†…è¿˜æ²¡æ¥çš„åŠç”Ÿäº§ä»¤ç‰Œï¼Œæ‰€ä»¥è¯·æ±‚æ‹¿ä¸åˆ°ä»¤ç‰Œå°±ä¼šè¢«æ‹’ç»ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬è¦æ±‚ã€‚\nä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨é™æµç­–ç•¥åˆšåˆšé…ç½®å¥½åçš„ç¬¬ä¸€ä¸ªè¯·æ±‚æ¥ä¸´æ—¶å°†å½“å‰å¯ç”¨ä»¤ç‰Œçš„å€¼è®¾ç½®ä¸ºæ¡¶çš„æœ€å¤§å®¹é‡ 100ï¼Œå°†æœ€è¿‘ä¸€æ¬¡è¯·æ±‚æ—¶é—´è®¾ç½®ä¸ºæœ¬æ¬¡è¯·æ±‚æ¥ä¸´æ—¶ä¸€åˆ†é’Ÿåçš„æ—¶é—´æˆ³ï¼Œå‡å»å‡ºæœ¬æ¬¡è¯·æ±‚éœ€è¦çš„ä»¤ç‰Œåæ›´æ–°æ¡¶ã€‚è¿™æ ·ï¼Œåœ¨è¿™ä¸€åˆ†é’Ÿä»¥å†…ï¼Œæœ‰ä¸‹ä¸€æ¬¡è¯·æ±‚è¿›æ¥æ—¶ï¼Œä» Hash è¡¨å†…å–å‡ºé…ç½®è®¡ç®—å½“å‰æ—¶é—´å°±ä¼šå°äºæœ€è¿‘ä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´ï¼Œéšåè®¡ç®—ç”Ÿæˆçš„ä»¤ç‰Œå°±ä¼šæ˜¯ä¸€ä¸ªå°äº0çš„è´Ÿæ•°ã€‚æ‰€ä»¥åœ¨æ›´æ–°æ¡¶è¿™ä¸€æ­¥ï¼Œè¦æ ¹æ®ç”Ÿæˆçš„ä»¤ç‰Œæ˜¯å¦ä¸ºè´Ÿæ•°æ¥å†³å®šæ˜¯å¦æ›´æ–°æœ€åä¸€æ¬¡è¯·æ±‚æ—¶é—´çš„å€¼ã€‚\nç”¨ Lua è„šæœ¬å®ç°ä¸Šè¿°é€»è¾‘ï¼š local key = KEYS[1] -- è¦è¿›è¡Œé™æµçš„Keyï¼Œå¯ä»¥æ˜¯ uri local consume_permits = tonumber(ARGV[1]) -- è¯·æ±‚æ¶ˆè€—çš„ä»¤ç‰Œæ•°ï¼Œæ¯ä¸ªè¯·æ±‚æ¶ˆè€—ä¸€ä¸ª local curr_time = tonumber(ARGV[2]) -- å½“å‰æ—¶é—´ local limiter_info = redis.pcall(\u0026#34;HMGET\u0026#34;, key, \u0026#34;last_time\u0026#34;, \u0026#34;curr_permits\u0026#34;, \u0026#34;bucket_cap\u0026#34;, \u0026#34;rate\u0026#34;, \u0026#34;period\u0026#34;) if not limiter_info[3] then return -1 end local last_time = tonumber(limiter_info[1]) or 0 local curr_permits = tonumber(limiter_info[2]) or 0 local bucket_cap = tonumber(limiter_info[3]) or 0 local rate = tonumber(limiter_info[4]) or 0 local period = tonumber(limiter_info[5]) or 0 local total_permits = bucket_cap local is_update_time = true if last_time \u0026gt; 0 then local new_permits = math.floor((curr_time-last_time)/1000 * rate) if new_permits \u0026lt;= 0 then new_permits = 0 is_update_time = false end total_permits = new_permits + curr_permits if total_permits \u0026gt; bucket_cap then total_permits = bucket_cap end else last_time = curr_time + period * 1000 end local res = 1 if total_permits \u0026gt;= consume_permits then total_permits = total_permits - consume_permits else res = 0 end if is_update_time then redis.pcall(\u0026#34;HMSET\u0026#34;, key, \u0026#34;curr_permits\u0026#34;, total_permits, \u0026#34;last_time\u0026#34;, curr_time) else redis.pcall(\u0026#34;HSET\u0026#34;, key, \u0026#34;curr_permits\u0026#34;, total_permits) end return res ä¸Šè¿°è„šæœ¬åœ¨è°ƒç”¨æ—¶æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºï¼šé™æµçš„keyã€è¯·æ±‚æ¶ˆè€—çš„ä»¤ç‰Œæ•°ã€ å½“å‰æ—¶é—´æˆ³(æ¯«ç§’çº§åˆ«)ã€‚\nåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œå…ˆè°ƒç”¨ Redis çš„ SCRIPT LOAD å‘½ä»¤å°†ä¸Šè¿°è„šæœ¬ Load åˆ° Redis ä¸­å¹¶å°†è¯¥å‘½ä»¤è¿”å›çš„è„šæœ¬ sha1 å€¼ä¿å­˜ã€‚\nåœ¨åç»­çš„è¯·æ±‚è¿›æ¥æ—¶ï¼Œè°ƒç”¨ Redis çš„ EVALSHA å‘½ä»¤æ‰§è¡Œé™æµé€»è¾‘ï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦å¯¹æœ¬æ¬¡è¯·æ±‚è§¦å‘é™æµè¡Œä¸ºã€‚å‡å¦‚é™æµçš„ key ä¸ºæ¯æ¬¡è¯·æ±‚çš„ uriï¼Œæ¯æ¬¡è¯·æ±‚æ¶ˆè€— 1 ä¸ªä»¤ç‰Œï¼Œé‚£ä¹ˆæ‰§è¡Œ Evalsha å‘½ä»¤è¿›è¡Œé™æµåˆ¤æ–­çš„å…·ä½“æ“ä½œä¸ºï¼šEVALSHA ${sha1} 1 ${uri} 1 ${å½“å‰æ—¶é—´æˆ³} ï¼ˆç¬¬ä¸€ä¸ªæ•°å­— 1 ä»£è¡¨è„šæœ¬å¯æ¥æ”¶çš„å‚æ•°ä¸­æœ‰ 1 ä¸ªKeyï¼Œç¬¬äºŒä¸ªæ•°å­— 1 ä»£è¡¨æœ¬æ¬¡è¯·æ±‚æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œï¼‰ï¼›æ‰§è¡Œå®Œè¿™æ¡å‘½ä»¤åå¦‚æœè¿”å›å€¼æ˜¯ 1 ä»£è¡¨æ¡¶ä¸­ä»¤ç‰Œå¤Ÿç”¨ï¼Œè¯·æ±‚é€šè¿‡ï¼›å¦‚æœè¿”å›å€¼ä¸º 0 ä»£è¡¨æ¡¶ä¸­ä»¤ç‰Œä¸å¤Ÿï¼Œè§¦å‘é™æµï¼›å¦‚æœè¿”å›å€¼ä¸º -1 ä»£è¡¨æœ¬æ¬¡è¯·æ±‚çš„ uri æœªé…ç½®é™æµç­–ç•¥ï¼Œå¯æ ¹æ®è‡ªå·±çš„å®é™…ä¸šåŠ¡åœºæ™¯åˆ¤æ–­æ˜¯é€šè¿‡è¿˜æ˜¯æ‹’ç»ã€‚\nRedisç›¸å…³æ“ä½œ # é€šè¿‡ SCRIPT LOAD ç”Ÿæˆçš„ sha1 æ ¡éªŒç  root@e2ea48309e5f:/home/lua/rate-limiting# redis-cli SCRIPT LOAD \u0026#34;$(cat /home/lua/rate-limiting/demo.lua)\u0026#34; \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; # æ‰§è¡Œå‘½ä»¤ å‚æ•°è§£é‡Šï¼š1ä¸ªkey ç¼“å­˜keyä¸ºtest æ¯æ¬¡1ä¸ªä»¤ç‰Œ å½“å‰æ—¶é—´ root@e2ea48309e5f:/home/lua/rate-limiting# redis-cli 127.0.0.1:6379\u0026gt; EVALSHA \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; 1 test 1 1619017529 (integer) 1 127.0.0.1:6379\u0026gt; EVALSHA \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; 1 test 1 1619017529 (integer) 1 127.0.0.1:6379\u0026gt; EVALSHA \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; 1 test 1 1619017529 (integer) 1 127.0.0.1:6379\u0026gt; EVALSHA \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; 1 test 1 1619017529 (integer) 0 127.0.0.1:6379\u0026gt; EVALSHA \u0026#34;f1acffb11bcfea38c1acf25ce4135f7b95233807\u0026#34; 1 test 1 1619017529 (integer) 0 äº”ã€æ€»ç»“ æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å››ç§é™æµçš„ç®—æ³•ï¼Œåˆ†åˆ«ä¸ºï¼šå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚\nå›ºå®šçª—å£è®¡æ•°ç®—æ³•ç®€å•æ˜“å®ç°ï¼Œå…¶ç¼ºé™·æ˜¯å¯èƒ½åœ¨ä¸­é—´çš„æŸä¸€ç§’å†…é€šè¿‡çš„è¯·æ±‚æ•°æ˜¯é™æµé˜ˆå€¼çš„ä¸¤å€ï¼Œè¯¥ç®—æ³•ä»…é€‚ç”¨äºå¯¹é™æµå‡†ç¡®åº¦è¦æ±‚ä¸é«˜çš„åº”ç”¨åœºæ™¯ã€‚ æ»‘åŠ¨çª—å£è®¡æ•°ç®—æ³•è§£å†³äº†å›ºå®šçª—å£è®¡æ•°ç®—æ³•çš„ç¼ºé™·ï¼Œä½†æ˜¯è¯¥ç®—æ³•è¾ƒéš¾å®ç°ï¼Œå› ä¸ºè¦è®°å½•æ¯æ¬¡è¯·æ±‚æ‰€ä»¥å¯èƒ½å‡ºç°æ¯”è¾ƒå ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„æƒ…å†µã€‚ æ¼æ¡¶ç®—æ³•å¯ä»¥åšåˆ°å‡åŒ€å¹³æ»‘çš„é™åˆ¶è¯·æ±‚ï¼ŒNgixn çƒ­ limit_req æ¨¡å—ä¹Ÿæ˜¯é‡‡ç”¨æ­¤ç§ç®—æ³•ã€‚å› ä¸ºåŒ€é€Ÿå¤„ç†è¯·æ±‚çš„ç¼˜æ•…æ‰€ä»¥è¯¥ç®—æ³•åº”å¯¹é™æµé˜ˆå€¼å†…çš„çªå‘è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†ã€‚ ä»¤ç‰Œæ¡¶ç®—æ³•è§£å†³äº†ä»¥ä¸Šä¸‰ä¸ªç®—æ³•çš„æ‰€æœ‰ç¼ºé™·ï¼Œæ˜¯ä¸€ç§ç›¸å¯¹æ¯”è¾ƒå®Œç¾çš„é™æµç®—æ³•ï¼Œä¹Ÿæ˜¯é™æµåœºæ™¯ä¸­åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ç®—æ³•ã€‚ä½¿ç”¨ Redis + Luaè„šæœ¬çš„æ–¹å¼å¯ä»¥ç®€å•çš„å®ç°ã€‚ è½¬è‡ª http://s.iarno.cn/akFmqR\n","permalink":"https://www.iarno.cn/article/rate-limiting/","tags":["é™æµ"],"title":"é™æµç®—æ³•å®è·µ"},{"categories":["Lua"],"contents":"æœ¬æ–‡ä»‹ç»äº†åœ¨ngx_luaæ¨¡å—ä¸­å¦‚ä½•ä½¿ç”¨lua_shared_dictå‘½ä»¤å®šä¹‰å…±äº«å†…å­˜å­—å…¸é¡¹å¯¹è±¡ï¼Œå¹¶é€šè¿‡ngx.shared.DICTæ¥å£è·å–è¿™äº›å¯¹è±¡ã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†ç›¸å…³è¯­æ³•å’Œç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¦‚ä½•è®¾ç½®å’Œè·å–å…±äº«å†…å­˜ä¸Šçš„å€¼ã€‚åŒæ—¶ï¼Œè¿˜è®¨è®ºäº†åœ¨Nginxé‡å¯å’Œé€€å‡ºæ—¶ï¼Œå…±äº«å†…å­˜å­—å…¸é¡¹çš„è¡Œä¸ºã€‚\nlua_shared_dict åœ¨ngx_luaæ¨¡å—ä¸­ä½¿ç”¨å…±äº«å†…å­˜å­—å…¸é¡¹ç›¸å…³APIçš„å‰ææ¡ä»¶æ˜¯å·²ç»ä½¿ç”¨lua_shared_dictå‘½ä»¤å®šä¹‰äº†ä¸€ä¸ªå­—å…¸é¡¹å¯¹è±¡ï¼Œè¯¥å‘½ä»¤çš„å…·ä½“ç”¨æ³•ä¸ºï¼š\nè¯­æ³•ï¼š lua_shared_dict \u0026lt;name\u0026gt; \u0026lt;size\u0026gt;\nè¯¥å‘½ä»¤ä¸»è¦æ˜¯å®šä¹‰ä¸€å—åä¸ºnameçš„å…±äº«å†…å­˜ç©ºé—´ï¼Œå†…å­˜å¤§å°ä¸ºsizeã€‚é€šè¿‡è¯¥å‘½ä»¤å®šä¹‰çš„å…±äº«å†…å­˜å¯¹è±¡å¯¹äºNginxä¸­æ‰€æœ‰workerè¿›ç¨‹éƒ½æ˜¯å¯è§çš„ï¼Œå½“Nginxé€šè¿‡reloadå‘½ä»¤é‡å¯æ—¶ï¼Œå…±äº«å†…å­˜å­—å…¸é¡¹ä¼šä»æ–°è·å–å®ƒçš„å†…å®¹ï¼Œå½“æ—¶å½“Nginxé€€å‡ºæ—¶ï¼Œå­—å…¸é¡¹çš„å€¼å°†ä¼šä¸¢å¤±ã€‚\nç¤ºä¾‹ï¼š http { lua_shared_dict dogs 10m; server { location /set { content_by_lua \u0026#39; local dogs = ngx.shared.dogs dogs:set(\u0026#34;Jim\u0026#34;, 8) ngx.say(\u0026#34;STORED\u0026#34;) \u0026#39;; } location /get { content_by_lua \u0026#39; local dogs = ngx.shared.dogs ngx.say(dogs:get(\u0026#34;Jim\u0026#34;)) \u0026#39;; } } } è¾“å‡ºç»“æœæ˜¯ï¼š\n$ curl localhost/set STORED $ curl localhost/get 8 $ curl localhost/get 8 ngx.shared.DICT å¯ä»¥é€šè¿‡ngx.shared.DICTæ¥å£è·å–å…±äº«å†…å­˜å­—å…¸é¡¹å¯¹è±¡ï¼š\nè¯­æ³•ï¼š dict = ngx.shared.DICT\nç¤ºä¾‹ï¼š dict = ngx.shared[name_var] å…¶ä¸­ï¼ŒDICTå’Œname_varè¡¨ç¤ºçš„åç§°æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œdogs =ngx.shared.dogs å°±æ˜¯dict = ngx.shared.DICTçš„è¡¨è¾¾å½¢å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼š\ndogs = ngx.shared[\u0026quot;dogs\u0026quot;]\né€šè¿‡ä¸Šé¢çš„APIè·å–å¾—åˆ°çš„å…±äº«å†…å­˜å­—å…¸é¡¹å¯¹è±¡ï¼Œå…·æœ‰å¦‚ä¸‹ç›¸åº”çš„æ¥å£ï¼š\nngx.shared.DICT.get\nè¯­æ³•ï¼š value, flags = ngx.shared.DICT:get(key)\nè·å–å…±äº«å†…å­˜ä¸Škeyå¯¹åº”çš„å€¼ã€‚å¦‚æœkeyä¸å­˜åœ¨ï¼Œæˆ–è€…keyå·²ç»è¿‡æœŸï¼Œå°†ä¼šè¿”å›nilï¼›å¦‚æœå‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å›nilä»¥åŠé”™è¯¯ä¿¡æ¯ã€‚\nlocal cats = ngx.shared.cats local value, flags = cats.get(cats, \u0026#34;Marry\u0026#34;) ç­‰ä»·äº\nlocal cats = ngx.shared.cats local value, flags = cats:get(\u0026#34;Marry\u0026#34;) è¿”å›åˆ—è¡¨ä¸­çš„flagsï¼Œæ˜¯åœ¨ngx.shared.DICT.setæ–¹æ³•ä¸­è®¾ç½®çš„å€¼ï¼Œé»˜è®¤å€¼ä¸º0. å¦‚æœè®¾ç½®çš„flagsä¸º0ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œflagsçš„å€¼å°†ä¸ä¼šè¢«è¿”å›ã€‚\n","permalink":"https://www.iarno.cn/article/lua-shared-dict/","tags":["lua_shared_dict"],"title":"ngx_luaæ¨¡å—ä¸­ä½¿ç”¨lua_shared_dictå…±äº«å†…å­˜å˜é‡"},{"categories":["Lua"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨OpenRestyä¸­é…ç½®å’Œä½¿ç”¨å®šæ—¶ä»»åŠ¡ã€‚é¦–å…ˆï¼Œæ–‡ç« è§£é‡Šäº†å®šæ—¶ä»»åŠ¡éœ€è¦ä¸workerç»‘å®šï¼Œé€šå¸¸é»˜è®¤ç»‘å®šåˆ°worker_id=0ï¼Œè¿™æ ·åœ¨Nginxè¿›ç¨‹ä¸­åªæ‰§è¡Œä¸€ä¸ªtimerã€‚ç„¶åï¼Œæ–‡ç« æä¾›äº†åœ¨nginx.confä¸­é…ç½®å®šæ—¶ä»»åŠ¡çš„å…·ä½“æ–¹æ³•ã€‚æ¥ç€ï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ngx.timer.everyæ¥å£ï¼Œè¿™æ˜¯ngxæä¾›çš„æœ€æ–°æ¥å£ã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†ä¸€äº›ç›¸å…³çš„æ—¥å¿—è¾“å‡ºå’Œé”™è¯¯å¤„ç†æ–¹æ³•ã€‚\nopenrestyçš„å®šæ—¶ä»»åŠ¡æ˜¯è¦è·Ÿworkerç»‘å®šçš„ã€‚å¦‚æœä¸ç»‘å®šç‰¹å®šçš„workerï¼Œé‚£ä¹ˆæ‰€æœ‰å¯åŠ¨çš„wokeréƒ½ä¼šå»æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤ç»‘å®šworker_id=0çš„ï¼Œè¿™æ ·åœ¨nginxæ•´ä¸ªè¿›ç¨‹é‡Œé¢ï¼Œå°±åªæ‰§è¡Œä¸€ä¸ªtimerã€‚\nåœ¨confä¸­å…·ä½“çš„ä½ç½®å¯ä»¥å†™è‡ªå·±çš„ä»»åŠ¡é€»è¾‘ã€‚\nå…·ä½“çš„nginx.confé…ç½®å¦‚ä¸‹ï¼š\nworker_processes 1; error_log logs/error.log; events { worker_connections 1024; } http { init_worker_by_lua_block { local delay = 2 -- in seconds local new_timer = ngx.timer.at local log = ngx.log local ERR = ngx.ERR local check check = function(premature) if not premature then -- do the health check or other routine work log(ERR, \u0026#34;mm test mm test\u0026#34;) local ok, err = new_timer(delay, check) if not ok then log(ERR, \u0026#34;failed to create timer: \u0026#34;, err) return end end end if 0 == ngx.worker.id() then local ok, err = new_timer(delay, check) if not ok then log(ERR, \u0026#34;failed to create timer: \u0026#34;, err) return end end } server { listen 8081; location / { default_type text/html; content_by_lua \u0026#39; ngx.say(\u0026#34;\u0026lt;p\u0026gt;hello, world\u0026lt;/p\u0026gt;\u0026#34;) \u0026#39;; } location = /app/test { content_by_lua_block { local res = ngx.location.capture( \u0026#34;/sum\u0026#34;, {args={a=3, b=8}} ) ngx.say(\u0026#34;status:\u0026#34;, res.status, \u0026#34; response:\u0026#34;, res.body) } } location = /sum { internal; content_by_lua_block { ngx.sleep(0.1) local args = ngx.req.get_uri_args() ngx.print(tonumber(args.a) + tonumber(args.b)) } } location = /subduction { internal; content_by_lua_block { ngx.sleep(0.1) local args = ngx.req.get_uri_args() ngx.print(tonumber(args.a) - tonumber(args.b)) } } location = /app/test_parallels { content_by_lua_block { local start_time = ngx.now() local res1, res2 = ngx.location.capture_multi( { {\u0026#34;/sum\u0026#34;, {args={a=3, b=8}}}, {\u0026#34;/subduction\u0026#34;, {args={a=3, b=8}}} }) ngx.say(\u0026#34;status:\u0026#34;, res1.status, \u0026#34; response:\u0026#34;, res1.body) ngx.say(\u0026#34;status:\u0026#34;, res2.status, \u0026#34; response:\u0026#34;, res2.body) ngx.say(\u0026#34;time used:\u0026#34;, ngx.now() - start_time) } } location = /app/test_queue { content_by_lua_block { local start_time = ngx.now() local res1 = ngx.location.capture_multi( { {\u0026#34;/sum\u0026#34;, {args={a=3, b=8}}} }) local res2 = ngx.location.capture_multi( { {\u0026#34;/subduction\u0026#34;, {args={a=3, b=8}}} }) ngx.say(\u0026#34;status:\u0026#34;, res1.status, \u0026#34; response:\u0026#34;, res1.body) ngx.say(\u0026#34;status:\u0026#34;, res2.status, \u0026#34; response:\u0026#34;, res2.body) ngx.say(\u0026#34;time used:\u0026#34;, ngx.now() - start_time) } } } } æ³¨æ„init_worker_by_lua_blockæ˜¯æ”¾åœ¨httpé‡Œé¢çš„ã€‚å› ä¸ºæ­¤å¤„åªé…ç½®äº†error.logï¼Œå› æ­¤æ˜¯æ‰“å°çš„errçº§åˆ«çš„æ—¥å¿—ï¼Œæ–¹ä¾¿è§‚å¯Ÿã€‚\næ¥ä¸‹æ¥å¯åŠ¨nginï¼šsudo nginx -p pwd/ -c conf/nginx.conf\nç„¶åtailf logs/error.log:\nè¿½æ—¥å¿—ä¼šå‘ç°ï¼Œæ¯éš”2så°±ä¼šæ‰“å°ä¸€æ¡æ—¥å¿—ã€‚\näºŒã€ä½¿ç”¨ngx.timer.everyæ¥å£ ngxæä¾›äº†æœ€æ–°çš„ngx.timer.everyæ¥å£ï¼Œå†æ¥è¯•ä¸€ä¸‹ï¼š\ninit_worker_by_lua_block { local delay = 2 -- in seconds -- local new_timer = ngx.timer.at local log = ngx.log local ERR = ngx.ERR local check check = function(premature) if not premature then -- do the health check or other routine work log(ERR, \u0026#34;mm test mm test\u0026#34;) -- local ok, err = new_timer(delay, check) -- if not ok then -- log(ERR, \u0026#34;failed to create timer: \u0026#34;, err) -- return -- end end end if 0 == ngx.worker.id() then local ok, err = ngx.timer.every(delay, check) if not ok then log(ERR, \u0026#34;failed to create timer: \u0026#34;, err) return end end } è½¬è‡ª https://www.cnblogs.com/sonofelice/p/8259712.html\n","permalink":"https://www.iarno.cn/article/lua-timer/","tags":["timer"],"title":"openresty è·‘å®šæ—¶ä»»åŠ¡é…ç½®ã€ngx.timer.everyæ¥å£ä½¿ç”¨"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦è§£å†³äº†\u0026quot;too many open files\u0026quot;é—®é¢˜çš„å®šä½ã€‚é¦–å…ˆï¼Œå®ƒåˆ—å‡ºäº†å¯èƒ½çš„é—®é¢˜åŸå› ï¼ŒåŒ…æ‹¬ç³»ç»Ÿèµ„æºé™åˆ¶å°ï¼Œæ•°æ®åº“æ‰“å¼€æ–‡ä»¶é™åˆ¶å°ï¼Œä»¥åŠç¨‹åºä»£ç é—®é¢˜ã€‚ç„¶åï¼Œæ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ulimitå‘½ä»¤æŸ¥çœ‹å’Œè°ƒæ•´èµ„æºé™åˆ¶ï¼Œç‰¹åˆ«æ˜¯æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶ã€‚æœ€åï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨lsofå‘½ä»¤æŸ¥çœ‹æ‰“å¼€æ–‡ä»¶æ•°ï¼ŒåŒ…æ‹¬æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€æ–‡ä»¶æ•°å’ŒæŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ•°ã€‚\né”™è¯¯ socketï¼štoo many open files\né—®é¢˜åŸå›  ç³»ç»Ÿèµ„æºé™åˆ¶å°ï¼ˆulimit -a æŸ¥çœ‹open filesé™åˆ¶ï¼‰ æ•°æ®åº“æ‰“å¼€æ–‡ä»¶é™åˆ¶å°ï¼ˆç™»å½•æ•°æ®åº“ show variables like '%open%';å‘½ä»¤æŸ¥çœ‹ open_files_limit é™åˆ¶ï¼‰ ç¨‹åºä»£ç é—®é¢˜ï¼Œè¿›ç¨‹æ‰“å¼€æ–‡ä»¶å¥æŸ„ä¸é‡Šæ”¾ã€‚ ulimitå‘½ä»¤æŸ¥çœ‹èµ„æºé™åˆ¶ æ˜¾ç¤ºç›®å‰èµ„æºé™åˆ¶çš„è®¾å®š\nç¤ºä¾‹ [root@ ~]# ulimit -a core file size (blocks, -c) 0 data seg size (kbytes, -d) unlimited file size (blocks, -f) unlimited pending signals (-i) 1024 max locked memory (kbytes, -l) 32 max memory size (kbytes, -m) unlimited open files (-n) 1024 # æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ pipe size (512 bytes, -p) 8 POSIX message queues (bytes, -q) 819200 stack size (kbytes, -s) 10240 cpu time (seconds, -t) unlimited max user processes (-u) 4096 virtual memory (kbytes, -v) unlimited file locks (-x) unlimited å‚æ•° -a æ˜¾ç¤ºç›®å‰èµ„æºé™åˆ¶çš„è®¾å®šã€‚ -c \u0026lt;coreæ–‡ä»¶ä¸Šé™\u0026gt; è®¾å®šcoreæ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºåŒºå—ã€‚ -d \u0026lt;æ•°æ®èŠ‚åŒºå¤§å°\u0026gt; ç¨‹åºæ•°æ®èŠ‚åŒºçš„æœ€å¤§å€¼ï¼Œå•ä½ä¸ºKBã€‚ -f \u0026lt;æ–‡ä»¶å¤§å°\u0026gt; shellæ‰€èƒ½å»ºç«‹çš„æœ€å¤§æ–‡ä»¶ï¼Œå•ä½ä¸ºåŒºå—ã€‚ -H è®¾å®šèµ„æºçš„ç¡¬æ€§é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å‘˜æ‰€è®¾ä¸‹çš„é™åˆ¶ã€‚ -m \u0026lt;å†…å­˜å¤§å°\u0026gt; æŒ‡å®šå¯ä½¿ç”¨å†…å­˜çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ -n \u0026lt;æ–‡ä»¶æ•°ç›®\u0026gt; æŒ‡å®šåŒä¸€æ—¶é—´æœ€å¤šå¯å¼€å¯çš„æ–‡ä»¶æ•°ã€‚ -p \u0026lt;ç¼“å†²åŒºå¤§å°\u0026gt; æŒ‡å®šç®¡é“ç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½512å­—èŠ‚ã€‚ -s \u0026lt;å †å å¤§å°\u0026gt; æŒ‡å®šå †å çš„ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ -S è®¾å®šèµ„æºçš„å¼¹æ€§é™åˆ¶ã€‚ -t \u0026lt;CPUæ—¶é—´\u0026gt; æŒ‡å®šCPUä½¿ç”¨æ—¶é—´çš„ä¸Šé™ï¼Œå•ä½ä¸ºç§’ã€‚ -u \u0026lt;ç¨‹åºæ•°ç›®\u0026gt; ç”¨æˆ·æœ€å¤šå¯å¼€å¯çš„ç¨‹åºæ•°ç›®ã€‚ -v \u0026lt;è™šæ‹Ÿå†…å­˜å¤§å°\u0026gt; æŒ‡å®šå¯ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸Šé™ï¼Œå•ä½ä¸ºKBã€‚ è°ƒæ•´å½“å‰ç”¨æˆ·æ‰“å¼€æ–‡ä»¶æ•° [root@ ~]# ulimit -n 1234 æ³¨ï¼šæ­¤å‘½ä»¤æ˜¯è®¾ç½®å½“å‰ç”¨æˆ·çš„é™åˆ¶å¹¶ä¸”æ˜¯ä¸´æ—¶æ€§çš„ã€‚ æ‰“å¼€æ•°ç”±å¤§åˆ°å°è®¾ç½®ï¼Œå¦åˆ™è®¾ç½®ä¸æˆåŠŸã€‚\nlsof æŸ¥çœ‹æ‰“å¼€æ–‡ä»¶æ•° æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ‰“å¼€æ–‡ä»¶æ•° [root@ ~]# lsof -p è¿›ç¨‹ID |wc -l [root@ ~]# 123 æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶æ•° [root@ ~]# lsof |wc -l [root@ ~]# 1234 å‚æ•° -a åˆ—å‡ºæ‰“å¼€æ–‡ä»¶å­˜åœ¨çš„è¿›ç¨‹ -c\u0026lt;è¿›ç¨‹å\u0026gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶ -g åˆ—å‡ºGIDå·è¿›ç¨‹è¯¦æƒ… -d\u0026lt;æ–‡ä»¶å·\u0026gt; åˆ—å‡ºå ç”¨è¯¥æ–‡ä»¶å·çš„è¿›ç¨‹ +d\u0026lt;ç›®å½•\u0026gt; åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶ +D\u0026lt;ç›®å½•\u0026gt; é€’å½’åˆ—å‡ºç›®å½•ä¸‹è¢«æ‰“å¼€çš„æ–‡ä»¶ -n\u0026lt;ç›®å½•\u0026gt; åˆ—å‡ºä½¿ç”¨NFSçš„æ–‡ä»¶ -i\u0026lt;æ¡ä»¶\u0026gt; åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„è¿›ç¨‹ã€‚ï¼ˆ4ã€6ã€åè®®ã€:ç«¯å£ã€ @ip ï¼‰ -p\u0026lt;è¿›ç¨‹å·\u0026gt; åˆ—å‡ºæŒ‡å®šè¿›ç¨‹å·æ‰€æ‰“å¼€çš„æ–‡ä»¶ -u åˆ—å‡ºUIDå·è¿›ç¨‹è¯¦æƒ… -h æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ ","permalink":"https://www.iarno.cn/article/lsof/","tags":["linux"],"title":"too many open files é—®é¢˜å®šä½"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Gin pprofè¿›è¡ŒGoè¯­è¨€çš„æ€§èƒ½åˆ†æã€‚é¦–å…ˆï¼Œé€šè¿‡å¯¼å…¥github.com/DeanThompson/ginpprofåŒ…å¹¶ä½¿ç”¨ginpprof.Wrapper(router)å°†å…¶é›†æˆåˆ°ginæ¡†æ¶ä¸­ã€‚ç„¶åï¼Œé€šè¿‡å‘½ä»¤è¡Œå·¥å…·go tool pprofè·å–å’Œåˆ†æç¨‹åºçš„æ€§èƒ½æ•°æ®ã€‚æ–‡ç« è¿˜æä¾›äº†å¦‚ä½•ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶å»ºè®®å®šæœŸä½¿ç”¨æ­¤å‘½ä»¤ä»¥æ£€æµ‹æ˜¯å¦å­˜åœ¨å†…å­˜æŒç»­å¢é•¿çš„æƒ…å†µã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†ä¸¤ä¸ªå‚è€ƒé“¾æ¥ï¼Œä¾›è¯»è€…æ·±å…¥å­¦ä¹ ã€‚\npprof // å¯¼å…¥åŒ… import ( \u0026#34;github.com/DeanThompson/ginpprof\u0026#34; ) // ginæ¡†æ¶ç›´æ¥é›†æˆ router := gin.New() ginpprof.Wrapper(router) å‘½ä»¤è¡Œåˆ†æ $ go tool pprof http://localhost:6060/debug/pprof/heap Fetching profile over HTTP from http://localhost:6060/debug/pprof/heap Saved profile in /Users/root/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.008.pb.gz Type: inuse_space Entering interactive mode (type \u0026#34;help\u0026#34; for commands, \u0026#34;o\u0026#34; for options) (pprof) top10 (pprof) topShowing nodes accounting for 837.48MB, 100% of 837.48MB total flat flat% sum% cum cum% 837.48MB 100% 100% 837.48MB 100% main.main.func1 topå‘½ä»¤æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ\néš”æ®µæ—¶é—´ç»§ç»­ä½¿ç”¨æ­¤å‘½ä»¤æŸ¥çœ‹çœ‹æ˜¯å¦æœ‰å†…å­˜æŒç»­å¢é•¿çš„æ•°æ®ã€‚\nå‚è€ƒ https://segmentfault.com/a/1190000016412013\nhttps://eddycjy.gitbook.io/golang/di-9-ke-gong-ju/go-tool-pprof#qian-yan\n","permalink":"https://www.iarno.cn/article/pprof/","tags":["å†…å­˜æ³„æ¼"],"title":"Gin pprofæ€§èƒ½åˆ†æ"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨gRPCã€‚é¦–å…ˆï¼Œå®ƒè§£é‡Šäº†å¦‚ä½•åœ¨.protoæ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡ï¼Œå¹¶ä½¿ç”¨protocol bufferç¼–è¯‘å™¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç ã€‚ç„¶åï¼Œå®ƒè¯¦ç»†ä»‹ç»äº†å¦‚ä½•å®‰è£…gRPCåŒ…ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºgRPCæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚æœ€åï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„gRPCç¤ºä¾‹ä»£ç ï¼Œå¹¶æä¾›äº†ä»£ç çš„GitHubé“¾æ¥ã€‚\nç›¸å…³å®šä¹‰ åœ¨.protoæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªæœåŠ¡ã€‚ ä½¿ç”¨protocol bufferç¼–è¯‘å™¨ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç ã€‚ ä½¿ç”¨gRPCçš„Go APIä¸ºä½ çš„æœåŠ¡å†™ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚ å®‰è£…grpcåŒ… go get google.golang.org/grpc go get -u github.com/golang/protobuf/protoc-gen-go è®¾ç½®ç¯å¢ƒå˜é‡ export PATH=$(go env GOPATH)/bin:$PATH Server ç›®å½•ç»“æ„ grpc-server/ â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â”œâ”€â”€ grpc-server.iml â”œâ”€â”€ proto â”‚ â”œâ”€â”€ demo.pb.go â”‚ â””â”€â”€ demo.proto â”œâ”€â”€ server.go â””â”€â”€ service â””â”€â”€ get_data.go å®šä¹‰protoæ–‡ä»¶ syntax = \u0026#34;proto3\u0026#34;; package proto; option go_package = \u0026#34;.;proto\u0026#34;; service Demo { rpc GetData(DemoReq) returns (DemoRsp){} } message DemoReq { string a = 1; // è¯·æ±‚å‚æ•°a } message DemoRsp{ string rel = 1; // è¿”å›å‚æ•°å€¼ } ç”Ÿæˆpb.goæ–‡ä»¶ protoc --go_out=plugins=grpc,paths=source_relative:. *.proto demo.pb.goæ–‡ä»¶ç”Ÿæˆ\nserver.go package main import ( \u0026#34;fmt\u0026#34; \u0026#34;google.golang.org/grpc\u0026#34; \u0026#34;grpc-server/proto\u0026#34; \u0026#34;grpc-server/service\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; ) const grpcPort = 6655 func main() { l, err := net.Listen(\u0026#34;tcp\u0026#34;, fmt.Sprintf(\u0026#34;:%d\u0026#34;, grpcPort)) if err != nil { log.Fatal(err) } g := grpc.NewServer() //æ³¨å†Œserver,ä½¿ç”¨service.goæ–‡ä»¶ä¸­çš„Demoæ–¹æ³• proto.RegisterDemoServer(g, \u0026amp;service.Demo{}) if err = g.Serve(l); err != nil { log.Fatal(err) } } service.go package service import ( \u0026#34;context\u0026#34; \u0026#34;grpc-server/proto\u0026#34; ) type Demo struct { } // æ–¹æ³•å®ç°ï¼Œç›´æ¥æŠŠè¯·æ±‚å‚æ•°è¿”å› func (c Demo) GetData(ctx context.Context, msg *proto.DemoReq) (*proto.DemoRsp, error) { params := msg.A return \u0026amp;proto.DemoRsp{ Rel: params, }, nil } client ç›®å½•ç»“æ„ grpc-client/ â”œâ”€â”€ client.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â””â”€â”€ proto â”œâ”€â”€ demo.pb.go â””â”€â”€ demo.proto æ–‡ä»¶æ‹·è´ å°†ServeræœåŠ¡ç”Ÿæˆçš„demo.pb.goæ–‡ä»¶æ‹·è´åˆ°Clientç›®å½•ä¸­ã€‚\nclient.go package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;google.golang.org/grpc\u0026#34; \u0026#34;grpc-client/proto\u0026#34; ) const ( grpcAddr = \u0026#34;127.0.0.1:6655\u0026#34; ) func main() { c, err := grpc.Dial(grpcAddr, grpc.WithInsecure()) if err != nil { panic(c) } // å‘é€grpcè¯·æ±‚ è¯·æ±‚å‚æ•°ä¸º123 rsp, err := proto.NewDemoClient(c). GetData(context.Background(), \u0026amp;proto.DemoReq{ A: \u0026#34;123\u0026#34;, }) // æ‰“å°è¿”å›çš„å€¼ fmt.Println(rsp) } ä»£ç åœ°å€ https://github.com/iarno/grpc-demo.git\n","permalink":"https://www.iarno.cn/article/grpc/","tags":["grpc"],"title":"Go grpcæ¡ˆä¾‹"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨Goè¯­è¨€ä¸­ä½¿ç”¨åç¨‹è¿›è¡Œå¼‚æ­¥è¯·æ±‚ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†åç¨‹æ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹å®ç°ï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†ã€‚ç„¶åï¼Œé€šè¿‡ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨sync.WaitGroupæ¥åŒæ­¥å¤šä¸ªåç¨‹ã€‚ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹éƒ½ä¼šè°ƒç”¨getData()å‡½æ•°å¹¶å°†ç»“æœå­˜å‚¨åœ¨relæ˜ å°„ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ç­‰å¾…æ‰€æœ‰åç¨‹å®Œæˆï¼Œç„¶åæ‰“å°relæ˜ å°„çš„å†…å®¹ã€‚è¿è¡Œç»“æœæ˜¾ç¤ºï¼Œä¸¤ä¸ªåç¨‹éƒ½æˆåŠŸåœ°è·å–äº†æ•°æ®å¹¶å­˜å‚¨åœ¨relæ˜ å°„ä¸­ã€‚\nDemo package main import ( \u0026#34;fmt\u0026#34; \u0026#34;sync\u0026#34; ) func main() { var gp sync.WaitGroup rel := make(map[string]interface{}) gp.Add(2) go func(g *sync.WaitGroup) { defer g.Done() rel[\u0026#34;demo1\u0026#34;] = getData() }(\u0026amp;gp) go func(g *sync.WaitGroup) { defer g.Done() rel[\u0026#34;demo2\u0026#34;] = getData() }(\u0026amp;gp) gp.Wait() fmt.Println(rel) } func getData() string { return \u0026#34;test\u0026#34; } å“åº”ç»“æœ map[demo1:test demo2:test] ","permalink":"https://www.iarno.cn/article/sync_wait_group/","tags":["å¼‚æ­¥è¯·æ±‚"],"title":"Golang åç¨‹å¼‚æ­¥è¯·æ±‚"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Goè¯­è¨€å¼€å‘è‡ªå®šä¹‰æ’ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å¹¶å®‰è£…go-pluginserverï¼Œç„¶ååœ¨CentOSç¯å¢ƒä¸‹å®‰è£…Cç›¸å…³çš„ç¼–è¯‘ç¯å¢ƒã€‚æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½å®˜æ–¹çš„æ’ä»¶ç¤ºä¾‹ï¼Œå¹¶é€šè¿‡Goè¯­è¨€ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ç›¸å…³çš„ç¯å¢ƒå˜é‡å¹¶å¯åŠ¨KongæœåŠ¡ã€‚æ–‡ç« è¿˜æä¾›äº†Kongaæ’ä»¶çš„ç¤ºä¾‹å›¾å’Œç›¸å…³å‚è€ƒé“¾æ¥ã€‚\n1ã€è¿›å…¥å®˜ç½‘ä¸‹è½½æ‰€éœ€ç‰ˆæœ¬ https://www.postgresql.org/download/linux/redhat/\n2ã€å¼€å§‹å®‰è£… yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm -y\nyum install postgresql12 -y yum install postgresql12-server -y 3ã€æ•°æ®åº“åˆå§‹åŒ–ä¸è®¾ç½®è‡ªå¯åŠ¨ /usr/pgsql-12/bin/postgresql-12-setup initdb systemctl enable postgresql-12 systemctl start postgresql-12 è¿™ä¸€æ­¥åˆå§‹åŒ–æ•°æ®åº“å‘½ä»¤ä¼šåœ¨ /var/lib/pgsql ç›®å½•ä¸‹åˆ›å»ºåç§°ä¸º12æ–‡ä»¶å¤¹ï¼Œ12ä¸ºæ•°æ®åº“ç‰ˆæœ¬ã€‚è¿™é‡Œå¦‚æœå·²ç»æœ‰å¯¹åº”ç‰ˆæœ¬çš„æ–‡ä»¶å¤¹äº†ï¼Œåˆå§‹åŒ–è¿™ä¸€æ­¥ä¼šæŠ¥é”™ï¼Œéœ€è¦ä½ è‡ªè¡Œå»åˆ é™¤å¯¹åº”çš„æ–‡ä»¶å¤¹å†å»åˆå§‹åŒ–ã€‚\n4ã€é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºpostgresçš„linuxç™»å½•ç”¨æˆ·ï¼Œè¿™é‡Œè¿›è¡Œå¯†ç ä¿®æ”¹ 5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ 5.1ä¿®æ”¹postgresql.conf ä¿®æ”¹ï¼š#listen_addresses = \u0026#39;localhost\u0026#39;ä¸º listen_addresses = \u0026#39;*\u0026#39; 5.2ä¿®æ”¹pg_hba.conf ä¿®æ”¹å‰\nä¿®æ”¹å\nå¹¶é‡æ–°å¯åŠ¨\nsystemctl restart postgresql-12\n6ã€è®¾ç½®ç™»å½•æ•°æ®åº“è´¦å¯† su postgres #ä¸èƒ½ä½¿ç”¨rootç”¨æˆ·ç™»å½•ï¼Œåˆ‡æ¢åˆ°æ™®é€šç”¨æˆ· psql -U postgres \\password #è®¾ç½®ç”¨æˆ·å¯†ç  select version(); #æŸ¥çœ‹ç‰ˆæœ¬ ","permalink":"https://www.iarno.cn/article/postgresql-centos/","tags":["ç½‘å…³"],"title":"centos7å®‰è£…Postgresql"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨CentOS 7ä¸Šå®‰è£…å’Œé…ç½®Kongç½‘å…³ã€‚é¦–å…ˆï¼Œæä¾›äº†Kongå®‰è£…åŒ…çš„ä¸‹è½½é“¾æ¥ï¼Œç„¶åè¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨YUMå‘½ä»¤è¿›è¡Œå®‰è£…ã€‚æ¥ç€ï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•å‡†å¤‡PostgreSQLæ•°æ®åº“ï¼Œå¹¶ç»™å‡ºäº†åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“çš„å‘½ä»¤ã€‚ç„¶åï¼Œæ–‡ç« æè¿°äº†å¦‚ä½•é…ç½®Kongçš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„å‘½ä»¤ã€‚æœ€åï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•å¯åŠ¨ã€æ£€æŸ¥å’Œåœæ­¢KongæœåŠ¡ã€‚\nä¸‹è½½å®‰è£…åŒ…ï¼š https://bintray.com/kong/kong-community-edition-rpm/download_file?file_path=centos/7/kong-community-edition-1.0.2.el7.noarch.rpm\nè¿è¡Œä¸‹é¢çš„ä¸¤ä¸ªå‘½ä»¤è¿›è¡Œå®‰è£… $ sudo yum install epel-release $ sudo yum install kong-community-edition-1.0.2.el7.noarch.rpm --nogpgcheck å‡†å¤‡æ•°æ®åº“ å®‰è£…PostgreSQLè¯·å‚è€ƒcentos7å®‰è£…PostgreSQL\nKONG ä½¿ç”¨PostgreSQL 9.5+ æˆ– Cassandra 3.x.x ä½œä¸ºæ•°æ®å­˜å‚¨ã€‚è¿™é‡Œä½¿ç”¨ PostgreSQLï¼Œéœ€è¦äº‹å…ˆå‡†å¤‡å¥½ã€‚åˆ›å»ºä¸€ä¸ªåä¸º kong çš„ç”¨æˆ·ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªåä¸º kong çš„æ•°æ®åº“ã€‚\n$ sudo -s -u postgres psql CREATE USER kong WITH PASSWORD \u0026#39;123456\u0026#39;; CREATE DATABASE kong OWNER kong; GRANT ALL PRIVILEGES ON DATABASE kong to kong; æ•°æ®åº“è¿æ¥é…ç½® å¤åˆ¶é…ç½®æ–‡ä»¶ï¼š cp /etc/kong/kong.conf.default /etc/kong/kong.conf\nç¼–è¾‘ /etc/kong/kong.confï¼Œ é…ç½®ä¸‹é¢å‡ é¡¹\né…ç½®å®Œåï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ $ kong migrations bootstrap -c /etc/kong/kong.conf å¯åŠ¨ KONG --vv å¯ä»¥æ‰“å°æ›´å¤šçš„å¯åŠ¨æ—¥å¿—\nkong start -c /etc/kong/kong.conf --vv æ£€æŸ¥ KONG æ˜¯å¦æ­£ç¡®è¿è¡Œ $ curl -i http://localhost:8001/ æˆ–è€… kong health åœæ­¢ KONG $ kong stop å‚è€ƒ https://docs.konghq.com/install/centos/?_ga=2.186851116.589591982.1605191133-180474188.1599576441\n","permalink":"https://www.iarno.cn/article/kong-centos/","tags":["ç½‘å…³"],"title":"centos7 å®‰è£…kongç½‘å…³"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•é€šè¿‡Goè¯­è¨€è·å–å›¾ç‰‡URLçš„å°ºå¯¸å¤§å°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥image/gifï¼Œimage/jpegï¼Œimage/pngè¿™ä¸‰ä¸ªåŒ…ï¼Œä»¥ä¾¿è§£ç ä¸åŒæ ¼å¼çš„å›¾ç‰‡ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨http.Getæ–¹æ³•è·å–å›¾ç‰‡ï¼Œä½¿ç”¨image.Decodeè§£ç å›¾ç‰‡ï¼Œæœ€åé€šè¿‡m.Bounds().Dx()ï¼Œm.Bounds().Dy()å’Œm.Bounds().Size()è·å–å›¾ç‰‡çš„å®½åº¦ã€é«˜åº¦å’Œå°ºå¯¸ã€‚\né€šè¿‡å›¾ç‰‡urlè·å–å›¾ç‰‡å°ºå¯¸å¤§å°(size)\né—®é¢˜ å½“ä½¿ç”¨image.Decodeæ—¶æŠ¥image: unknown formatÂ· è¿™æ˜¯å› ä¸ºå¿˜è®°å¼•å…¥åŒ…import _ \u0026quot;image/jpeg\u0026quot;ï¼ŒimageåŒ…ä¸çŸ¥é“æ€ä¹ˆDecodeå›¾ç‰‡ï¼Œéœ€è¦å¯¼å…¥\u0026quot;image/jpeg\u0026quot;å»è§£ç jpgå›¾ç‰‡ã€‚ gifå’Œpngå›¾ç‰‡éœ€è¦å¯¼å…¥ç›¸åº”\u0026quot;image/gif\u0026quot;ï¼Œâ€œimage/pngâ€ã€‚ å¦‚è¿™ä¸‰ç§å›¾ç‰‡ç±»å‹éƒ½ç”¨åˆ°ï¼Œéœ€è¦éƒ½å¯¼å…¥ã€‚\nDemo package main import ( _ \u0026#34;image/gif\u0026#34; // å¿…é¡»å¯¼å…¥è¯¥åŒ… _ \u0026#34;image/jpeg\u0026#34; // å¿…é¡»å¯¼å…¥è¯¥åŒ… _ \u0026#34;image/png\u0026#34; // å¿…é¡»å¯¼å…¥è¯¥åŒ… \u0026#34;fmt\u0026#34; \u0026#34;image\u0026#34; \u0026#34;net/http\u0026#34; ) func main() { res, err := http.Get(\u0026#34;https://www.iarno.cn/images/gopher.svg\u0026#34;) if err != nil || res.StatusCode != 200 { fmt.Println(err) } defer res.Body.Close() m, _, err := image.Decode(res.Body) if err != nil { fmt.Println(err) } fmt.Println(m.Bounds().Dx()) // å®½ï¼š32 fmt.Println(m.Bounds().Dy()) // é«˜ï¼š32 fmt.Println(m.Bounds().Size()) // sizeï¼š(32,32) } ","permalink":"https://www.iarno.cn/article/image-url-size/","tags":["å›¾ç‰‡å°ºå¯¸"],"title":"é€šè¿‡å›¾ç‰‡urlè·å–å›¾ç‰‡å°ºå¯¸å¤§å°"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•é…ç½®Kongç½‘å…³è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚é¦–å…ˆï¼Œæ–‡ç« æä¾›äº†ä¸¤ä¸ªå¾®æœåŠ¡æ¥å£ç”¨äºæµ‹è¯•ã€‚ç„¶åï¼Œé€šè¿‡Kongaå’ŒKong Admin APIä¸¤ç§æ–¹å¼åˆ†åˆ«è¿›è¡Œäº†è¯¦ç»†çš„é…ç½®æ­¥éª¤è¯´æ˜ã€‚åœ¨Kongaéƒ¨åˆ†ï¼ŒåŒ…æ‹¬äº†å¦‚ä½•é…ç½®upstreamã€Serviceå‘å¸ƒã€RouteåŒ¹é…è§„åˆ™ä»¥åŠéªŒè¯ç»“æœã€‚åœ¨Kong Admin APIéƒ¨åˆ†ï¼Œä¹ŸåŒ…æ‹¬äº†å¦‚ä½•é…ç½®upstreamã€serviceå’Œrouteã€‚æœ€åï¼Œæ–‡ç« æä¾›äº†é€šè¿‡æµè§ˆå™¨å’Œå‘½ä»¤è¡ŒAPIè¿›è¡Œæµ‹è¯•çš„æ–¹æ³•ã€‚\nç¯å¢ƒè¯´æ˜\næ³¨ï¼šç”±äºdocker networkåŸå› ï¼Œå®¿ä¸»æœº127.0.0.1å¯èƒ½ä¼šè®¿é—®ä¸åˆ°ï¼Œå¯ç›´æ¥ä½¿ç”¨å¤–ç½‘åŸŸå+ç«¯å£\n# å¼€æ”¾ä¸¤ä¸ªæµ‹è¯•çš„å¾®æœåŠ¡æ¥å£ http://myhost1:8881 http://myhost2:8882 é€šè¿‡kongaå®ç° 1. é…ç½®upstream æ‰“å¼€Kongaå·¦ä¾§åˆ—è¡¨èœå•ä¸­çš„UPSTREAMS, ç‚¹å‡» CREATE UPSTREAM\nè¿™é‡Œï¼Œåªéœ€è¦å†™ä¸€ä¸ªNameï¼Œä¿è¯Serviceçš„é…ç½®å¯ä»¥æ­£ç¡®åŒ¹é…åˆ°æˆ‘ä»¬å°±å¯ä»¥äº†ã€‚\næ—¢ç„¶æ˜¯è´Ÿè½½å‡è¡¡ï¼Œè‡ªç„¶å°‘ä¸äº†åç«¯æœåŠ¡ï¼Œæ¥ä¸‹æ¥é…ç½®åœ¨Upstreamsè¿›è¡Œè´Ÿè½½å‡è¡¡çš„ç»ˆç«¯â€”â€”Targetsã€‚ æ‰¾åˆ°æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„upstreamï¼Œç„¶åç‚¹å‡»DETALS\nTargets to + ADD TARGETï¼Œå¡«å†™æµ‹è¯•æ¥å£ä¿¡æ¯ï¼Œå®Œæˆå¯¹UPSTREAMçš„é…ç½®\n2. é…ç½®Serviceå‘å¸ƒ é…ç½®ä¸€ä¸ªServiceï¼Œå­—æ®µUrlå¡«å†™æˆ‘ä»¬åˆšåˆšé…ç½®çš„Upstreamçš„Name\n3. é…ç½®Routeï¼ŒåŒ¹é…è§„åˆ™ æç¤ºï¼š åœ¨è¾“å…¥ hosts,paths,methodsæ—¶ï¼Œè¦æŒ‰å›è½¦ï¼ï¼ï¼\n4. éªŒè¯ç»“æœ æµè§ˆå™¨æµ‹è¯• é€šè¿‡Shift+F5 æˆ– Ctrl+Shift+Rï¼Œä¸ä½¿ç”¨ç¼“å­˜è¿›è¡Œè¯·æ±‚æµ‹è¯•\nå‘½ä»¤è¡ŒAPI æµ‹è¯•\n$ curl -i -X GET --url http://localhost:8000 --header \u0026#39;Host: test.app.com\u0026#39; é€šè¿‡ Kong Admin APIå®ç° routeæ ¹æ®pathsè½¬å‘ç»™ç›¸åº”çš„serviceæ ¹æ®hostï¼ˆupstreamçš„nameï¼‰è½¬å‘ç»™ upstreamè´Ÿè½½å‡è¡¡è‡³targetsï¼Œè¿™å°±æ˜¯kongçš„è´Ÿè½½å‡è¡¡æ‰§è¡Œæµç¨‹ã€‚\nä¸‹é¢å†å­¦ä¹ ä¸€ä¸‹é€šè¿‡Admin APIå¦‚ä½•å®Œæˆè´Ÿè´£å‡è¡¡é…ç½®\n1. é…ç½®upstream åˆ›å»ºupstream\n$ curl -X POST localhost:8001/upstreams \\ --data \u0026#34;name=app.com\u0026#34; ä¸ºupstreamé…ç½®target\n$ curl -X POST localhost:8001/upstreams/app.com/targets \\ --data \u0026#34;target=myhost1:8881\u0026#34; \\ --data \u0026#34;weight=100\u0026#34; $ curl -X POST localhost:8001/upstreams/app.com/targets \\ --data \u0026#34;target=myhost2:8882\u0026#34; \\ --data \u0026#34;weight=100\u0026#34; ç­‰åŒäºåˆ›å»ºäº†å¦‚ä¸‹é…ç½®ï¼š\nupstream upstream.api { server myhost1:8881 weight=100; server myhost2:8882 weight=100; } 2. é…ç½®service $ curl -X POST localhost:8001/services \\ --data \u0026#34;name=my-app-service\u0026#34; \\ --data \u0026#34;host=app.com\u0026#34; 3. é…ç½®route(more) $ curl -X POST localhost:8001/services/a9b8a3e9-826b-47fa-ae78-0fcf111662a1/routes \\ --data \u0026#34;name=test-app-route\u0026#34; \\ --data \u0026#34;hosts[]=test.app.com\u0026#34; \\ --data \u0026#39;strip_path=false\u0026#39; æˆ–è€…\n$ curl -X POST localhost:8001/routes \\ --data \u0026#34;name=test-app-route\u0026#34; \\ --data \u0026#34;hosts[]=test.app.com\u0026#34; \\ --data \u0026#34;service.id=a9b8a3e9-826b-47fa-ae78-0fcf111662a1\u0026#34; \\ --data \u0026#39;strip_path=false\u0026#39; ","permalink":"https://www.iarno.cn/article/upstream/","tags":["ç½‘å…³"],"title":"Kongç½‘å…³é…ç½®è´Ÿè½½å‡è¡¡"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦è§£é‡Šäº†å®½å¸¦ã€å¸¦å®½ã€æµé‡ã€ç½‘é€Ÿã€å†…ç½‘ã€å¤–ç½‘ä¹‹é—´çš„åŒºåˆ«ã€‚å®½å¸¦æ˜¯ä¸€ç§ä¸šåŠ¡ï¼Œå¸¦å®½æ˜¯ä¼ è¾“é€Ÿåº¦ã€‚å†…ç½‘IPåªåœ¨å±€åŸŸç½‘å†…éƒ¨å…·æœ‰å”¯ä¸€æ€§ï¼Œè€Œå…¬ç½‘IPå…·æœ‰ä¸–ç•ŒèŒƒå›´çš„å”¯ä¸€æ€§ã€‚æ–‡ç« è¿˜ä»‹ç»äº†å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªIPåœ°å€æ˜¯å†…ç½‘IPè¿˜æ˜¯å…¬ç½‘IPï¼ŒåŒ…æ‹¬ç›´è§‚æ³•å’Œç»éªŒæ³•ã€‚æœ€åï¼Œæ–‡ç« æåˆ°äº†ä¸€äº›å…³äºç½‘ç»œçš„å¸¸è§è¯¯è§£å’Œå®é™…æƒ…å†µã€‚\nå¤§çº²ç»“æ„ ä¸€.å¸¦å®½ä¸å®½å¸¦çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å¸¦å®½æ˜¯é‡è¯ï¼ŒæŒ‡çš„æ˜¯ç½‘é€Ÿçš„å¤§å°ï¼Œæ¯”å¦‚1Mbpsçš„æ„æ€æ˜¯ä¸€å…†æ¯”ç‰¹æ¯ç§’ï¼Œè¿™ä¸ªæ•°å€¼å°±æ˜¯æŒ‡å¸¦å®½ã€‚\nå®½å¸¦æ˜¯åè¯ï¼Œè¯´æ˜ç½‘ç»œçš„ä¼ è¾“é€Ÿç‡å¾ˆé«˜ ã€‚å®½å¸¦çš„æ ‡å‡†å„ä¸ç›¸åŒï¼Œæœ€åˆè®¤ä¸º128kbpsä»¥ä¸Šå¸¦å®½çš„å°±æ˜¯å®½å¸¦ï¼Œè€Œä»¥ä¸‹çš„å°±æ˜¯çª„å¸¦ã€‚\nä½†ç°åœ¨å›½å†…è¿è¥å•†ä¸€èˆ¬æä¾›è‡³å°‘512kbpså¸¦å®½çš„å®½å¸¦æœåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¸¦å®½æ˜¯ä¸€ä¸ªå…·ä½“æ•°å€¼ï¼Œè€Œå®½å¸¦åˆ™æ˜¯æ»¡è¶³ä¸€å®šå¸¦å®½æ•°å€¼çš„ä¸€ç§ä¼ è¾“æ ‡å‡†(æœåŠ¡)ã€‚\nå³ï¼šå®½å¸¦æ˜¯ä¸€ç§ä¸šåŠ¡ï¼Œå¸¦å®½æ˜¯ä¼ è¾“é€Ÿåº¦ã€‚\nå®½å¸¦ï¼šåœ¨æ•°å­—é€šä¿¡ä¸­é€šå¸¸æŒ‡64kbit/sä»¥ä¸Šä¿¡å·çš„å¸¦å®½ã€‚ çª„å¸¦ï¼šåœ¨æ•°å­—é€šä¿¡ä¸­é€šå¸¸æŒ‡64kbit/sä»¥ä¸‹ä¿¡å·çš„å¸¦å®½ã€‚ 1. å®½å¸¦\né€šå¸¸åˆ«äººä¼šè¯´ä½ å®¶èƒ½ä¸èƒ½ä¸Šç½‘å‘€ï¼Ÿå…¶å®è¿™ä¸ªæ„æ€å°±æ˜¯ä½ å®¶æœ‰æ²¡æœ‰å®½å¸¦ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªåè¯ï¼Œå…ˆæœ‰äº†å®½å¸¦ä¸€è¯ï¼Œç„¶åæ‰å¯ä»¥è¯´ä½ å¸¦å®½æ˜¯å¤šå°‘ï¼Œå®½å¸¦ä¸ä¸Šç½‘çš„é€Ÿåº¦å¿«æ…¢æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚\n2. å¸¦å®½\nå½“æˆ‘ä»¬æƒ³ç”³è¯·å®½å¸¦äº†ï¼Œéœ€è¦åˆ°ä¸€äº›æœåŠ¡æä¾›å•†é‚£é‡Œæ³¨å†Œç™»è®°ï¼Œè¿™æ—¶ä¼šæ ¹æ®å¥—é¤çš„ä¸åŒï¼Œä½ å¯èƒ½ä¼šæœ‰10Mb/s ã€ 20Mb/sç­‰ï¼Œé€šè¿‡è®¡ç®—æœºå­—èŠ‚æ¢ç®—æ¯”ä¾‹å¯ä»¥è®¡ç®—å‡ºè‡ªå·±çš„å¸¦å®½å¤§å°ã€‚\næ¯”å¦‚ï¼š\n1B=8b //1å­—èŠ‚=8ä½1KB=1024B1MB=1024KB1GB=1024MB æˆ‘ä»¬ç”³è¯·çš„å¸¦å®½æ˜¯10Mb/sã€‚è¿™ä¸ªå•ä½ä¸­çš„bæ˜¯å°å†™çš„ï¼Œè€Œæˆ‘ä»¬åˆšæ‰è¯´çš„1B(å­—èŠ‚)=8b(ä½)ï¼Œè¿™é‡Œåˆšå¥½æ˜¯8å€çš„å…³ç³»ï¼Œå³ä¸‹è½½é€Ÿåº¦ï¼š10Mb / 8 = 1.25MBã€‚\næœ‰çš„äººå°±ä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦é™¤ä»¥8ï¼Ÿ\nåœ¨è®¡ç®—æœºä¸­ï¼Œä¸‹è½½é€Ÿåº¦æ˜¯ä»¥å­—èŠ‚(B)ä¸ºå•ä½çš„ï¼Œè€Œæä¾›å•†è¯´çš„æ˜¯ä»¥æ¯”ç‰¹(b)ä¸ºå•ä½çš„ã€‚\næ¯”å¦‚è¯´: åœ¨ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªè½¯ä»¶ï¼Œéƒ½ä¼šä»¥**B(å­—èŠ‚)**ä¸ºå•ä½çš„ï¼Œå†æ¯”å¦‚ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µä¸­å¯èƒ½ä¼šæœ‰å›¾ç‰‡ã€æ–‡å­—ã€è§†é¢‘ç­‰å†…å®¹ï¼Œè¿™äº›å†…å®¹æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸‹è½½åˆ°ä½ ç”µè„‘äº†ï¼Œç„¶åä½ æ‰èƒ½çœ‹åˆ°çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡å¸¦å®½æ¥è®¡ç®—å‡ºè‡ªå·±çš„ä¸‹è½½é€Ÿåº¦ï¼š\nè®¡ç®—æ–¹å¼ï¼šå¸¦å®½å¤§å° / 8\nå¸¦å®½ ä¸‹è½½é€Ÿåº¦ å…¬å¼ å¸¦å®½ä¸º2Mb ä¸‹è½½é€Ÿåº¦ä¸º256KB/s 2 / 8 = 0.25 å¸¦å®½ä¸º4Mb ä¸‹è½½é€Ÿåº¦ä¸º512KB/s 4 / 8 = 0.5 å¸¦å®½ä¸º8Mb ä¸‹è½½é€Ÿåº¦ä¸º1.00MB/s 8 / 8= 1.0 å¸¦å®½ä¸º10Mb ä¸‹è½½é€Ÿåº¦ä¸º1.25MB/s 10 / 8 = 1.25 å¸¦å®½ä¸º20Mb ä¸‹è½½é€Ÿåº¦ä¸º2.50MB/s 20 / 8 = 2.50 å¸¦å®½ä¸º100Mb ä¸‹è½½é€Ÿåº¦ä¸º12.5MB/s 100 / 8 = 12.50 æœ‰çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸€äº›è½¯ä»¶æµ‹è¯•ç½‘é€Ÿæ—¶ï¼Œå‘ç°ä¸æˆ‘ä»¬è®¡ç®—çš„ç»“æœæœ‰ç‚¹å·®è·ï¼Œè¿™ä¸ªæ˜¯æ­£å¸¸ç°è±¡ï¼Œè¿™æ˜¯ç”±äºä¸€äº›ç‰©ç†çº¿è·¯ç£¨æŸç­‰å®¢è§‚åŸå› é€ æˆçš„ã€‚\nè¿˜æœ‰çš„æ—¶å€™ï¼Œå¤§å®¶åœ¨æ·±å¤œä¸‹è½½è½¯ä»¶æ—¶ï¼Œä¼šå‘ç°ï¼Œä¸‹è½½é€Ÿåº¦è¶…è¿‡äº†æˆ‘ä»¬ç†è®ºä¸Šè®¡ç®—å‡ºæ¥çš„å€¼ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚\næˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£: æ¯”å¦‚ä½ å®¶åœ¨JåŒºï¼Œé‚£ä¹ˆæä¾›å•†æ‹‰åˆ°JåŒºçš„æ€»çº¿è·¯æ˜¯100Mb/s , è€Œä½ å®¶ç”³è¯·çš„æ˜¯10Mï¼Œç”±äºé™åˆ¶éƒ½æ˜¯ä»è·¯ç”±å™¨é‡Œè®¾ç½®çš„ï¼Œè¿™ä¸ªä¸è·¯ç”±å™¨çš„è®¾ç½®æœ‰å…³ã€‚\nç¬¬äºŒç§æƒ…å†µå°±æ˜¯ï¼Œä½ ä¸‹è½½è½¯ä»¶çš„æœåŠ¡å™¨æ¯”è¾ƒé—²ï¼Œè¿™æ ·é€Ÿåº¦ä¹Ÿæ˜¯æ¯”è¾ƒå¿«çš„ã€‚\nç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯æˆ‘ä»¬ä¸‹è½½è½¯ä»¶æ—¶ï¼Œå¯èƒ½ä¼šç”¨è¿…é›·å‘€è¿™æ–¹é¢çš„è½¯ä»¶ï¼Œä¹Ÿæ˜¯ä¼šå½±å“åˆ°ä¸‹è½½é€Ÿåº¦çš„ã€‚\né€šä¿—ç†è§£çš„è¯ï¼š\nå¸¦å®½å°±å¥½æ¯”ä½ çš„æ°´é¾™å¤´å¤§å°ï¼Œç½‘é€Ÿå°±ç›¸å¥½æ¯”ä»æ°´é¾™å¤´é‡Œå‡ºæ¥çš„æ°´æµé€Ÿæœ‰å¤šå¿«ã€‚\nä»¥ä¸Šéƒ½æ˜¯è¯´ä¸‹è½½é€Ÿåº¦ï¼Œé‚£ä¹ˆä¸Šä¼ é€Ÿåº¦æ˜¯æ€ä¹ˆè®¡ç®—çš„å‘¢ï¼Œå…¶å®ä¸Šä¼ é€Ÿåº¦è¿™ä¸ªå› åœ°åŸŸçš„ä¸åŒè€Œä¸åŒï¼Œä¸€èˆ¬ä¸Šä¼ é€Ÿåº¦éƒ½è¢«æä¾›å•†é™åˆ¶äº†ï¼Œè¿™ä¸ªè¯´ä¸å‡†ã€‚\n3.æµé‡\næµé‡æ˜¯å¯¹å¤–å‘é€æ•°æ®ä¸æ¥æ”¶æ•°æ®åŒ…çš„å¤§å°æ€»å’Œï¼Œå•ä½æ˜¯é‡‡å–1024è¿›åˆ¶çš„ï¼Œå•ä½æœ‰ B,KB,MB(M),GB(G)ã€‚\n1G=1024MB1M=1024KB1KB=1024å­—èŠ‚(Bï¼‰ ä¸€èˆ¬æˆ‘ä»¬æ‰‹æœºæœ‰ 5å…ƒ30MB,10å…ƒ70MBçš„æµé‡å¥—é¤ï¼Œå½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œéœ€è¦å¤šå°‘æµé‡å‘¢ï¼Ÿ(ä»¥å‰å“ˆ)\nå‡è®¾æŸä¸€ä¸ªç½‘é¡µä¸Šæœ‰ 100ä¸ªæ±‰å­—ä¸ä¸€å¼ 100KBçš„å›¾ç‰‡ï¼Œä¸€ä¸ªæ±‰å­—=2ä¸ªå­—èŠ‚ï¼Œ\nå³è¿™ä¸ªé¡µé¢çš„æ•°æ®å¤§å°ä¸ºï¼š100 * 2B / 1024 + 100KB = 0.2KB +100KB =100.2KBï¼›\næ¯è®¿é—®ä¸€æ¬¡è¿™ä¸ªé¡µé¢ï¼Œå°†äº§ç”Ÿ100.2KBçš„æµé‡ï¼Œå¦‚æœæ˜¯70MBçš„æµé‡ï¼Œé‚£ä¹ˆè®¿é—®å‡ ä¸ªç½‘é¡µåŸºæœ¬å¿«æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æ›´ä¸è¦è¯´çœ‹è§†é¢‘äº†ã€‚\näºŒ.å¸¦å®½ã€ç½‘é€Ÿå’Œæµé‡ä¹‹é—´çš„å…³ç³»\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´çš„ï¼š\næˆ‘å®¶çš„å¸¦å®½10Mç°åœ¨ç½‘é€Ÿï¼š200KB/sçœ‹ä¸€å¼ å›¾ç‰‡ä½¿ç”¨äº†8Mçš„æµé‡ é‚£ä¹ˆå¸¦å®½ã€ç½‘é€Ÿã€æµé‡ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä»–ä»¬åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ\n1ã€å¸¦å®½å•ä½æ˜¯ï¼šæ¯”ç‰¹/ç§’ï¼ˆbpsï¼‰ï¼š10M=10Mbpsã€‚\n2ã€ç½‘é€Ÿæ˜¯æ•°æ®ä¼ è¾“çš„é€Ÿåº¦ï¼Œå•ä½æ˜¯ï¼šå­—èŠ‚/ç§’ (B/sï¼Œ KB/sï¼Œ MB/s)ã€‚\n1MB/s=1024KB/s1KB/s=1024B/s 3ã€æµé‡æ˜¯ç”¨æˆ·ä¸Šç½‘ å‘é€å’Œæ¥æ”¶ çš„ æ•°æ®é‡æ€»å’Œ ï¼Œå•ä½æ˜¯ï¼šå­—èŠ‚ï¼ˆByteï¼‰ã€‚\næ¯”ç‰¹æ˜¯ä¿¡æ¯çš„æœ€å°å•ä½ï¼š1å­—èŠ‚=8æ¯”ç‰¹ ï¼Œä¹Ÿå°±æ˜¯1B=8bit æˆ–è€… 1B=8bã€‚\n1å­—èŠ‚/ç§’=8æ¯”ç‰¹/ç§’ (1B/s=8bps)ã€‚\n1æ¯”ç‰¹ (1b or 1ä½) æ˜¯ä¿¡æ¯æŠ€æœ¯ä¸­çš„æœ€å°å­˜å‚¨å•ä½ï¼Œ1ä½ä»£è¡¨ä¸€ä¸ªâ€œ1â€æˆ–è€…â€œ0â€ã€‚\n1Bï¼ˆ1å­—èŠ‚ï¼‰æ˜¯æ¯”è¾ƒå°çš„å­˜å‚¨å•ä½ï¼šä¸€èˆ¬æƒ…å†µä¸‹1ä¸ªè‹±æ–‡å­—æ¯å 1ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ±‰å­—å 2ä¸ªå­—èŠ‚ã€‚\n4ã€ä»–ä»¬ä¹‹é—´çš„æ¢ç®—ï¼šå¸¦å®½å¤§å° / 8\n10Må¸¦å®½(10Mb/s)=1.25MB/sç½‘é€Ÿ1Må¸¦å®½(1Mb/s)=0.125MB/s=128KB/s10Mbps = 10*1024Kbps =10*1024*1024bps =10*1024*1024/8 Byte/s =10/8 MB/s =1.25 MB/s ä¸‰.ä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå„æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\nä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½ï¼Œæˆ–è€…è¯´ä¸Šè¡Œé€Ÿåº¦å’Œä¸‹è¡Œé€Ÿåº¦æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\nåœ¨è®¾ç½®è·¯ç”±å™¨çš„é™é€Ÿï¼Œæˆ–è€…é…ç½®å…¶å®ƒä¸€äº›è½¯ä»¶æ—¶ä¼šé‡åˆ°ä¸Šè¡Œé€Ÿåº¦å’Œä¸‹è¡Œé€Ÿåº¦çš„é…ç½®ï¼Œå¾ˆå¤šç”¨æˆ·æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸¤ä¸ªæ‰€ä»£è¡¨çš„æ„æ€ï¼Œä¸‹é¢ä¼šå¯¹è¿™ä¸¤ç§è¿›è¡Œè¯¦ç»†è®²è§£ã€‚\nåœ¨è®¿é—®äº’è”ç½‘æ—¶å­˜åœ¨ä¸¤ç§è¡Œä¸ºï¼šä¸€æ˜¯ä¸Šä¼ æ•°æ®ï¼ŒäºŒæ˜¯ä¸‹è½½æ•°æ®ã€‚ä¸Šè¡Œå¸¦å®½(é€Ÿåº¦) æŒ‡çš„æ˜¯ä¸Šä¼ çš„é€Ÿåº¦ï¼Œè€Œä¸‹è¡Œå¸¦å®½(é€Ÿåº¦) æŒ‡çš„æ˜¯ä¸‹è½½æ•°æ®æ—¶çš„æ•°åº¦ã€‚\nå†è¯¦ç»†ä¸€ç‚¹å¯ä»¥ç†è§£ä¸ºï¼š\nä¸Šè¡Œå¸¦å®½å³ä¸Šè¡Œé€Ÿç‡ã€‚\nä¸€èˆ¬æ˜¯æŒ‡ä»ä½ çš„ç”µè„‘ä¸Šä¼ çš„é€Ÿåº¦ï¼Œåˆ«äººå¯¹ä½ çš„ç”µè„‘è¿›è¡Œé€šè®¯çš„é€Ÿç‡ã€‚æ¯”å¦‚ä½ å¾€QQç©ºé—´ä¸Šä¼ ä½ çš„ç›¸ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™ä¸Šä¼ ç›¸ç‰‡çš„é€Ÿåº¦å°±æ˜¯ä¸Šè¡Œé€Ÿåº¦ï¼Œå…¶ä»–è¿˜æœ‰æ¯”å¦‚ä½ å¾€ä¸€äº›äº‘ç›˜é‡Œé¢ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™çš„é€Ÿåº¦ä¹Ÿæ˜¯ä¸Šè¡Œé€Ÿç‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸Šä¼ æ–‡ä»¶çš„é€Ÿåº¦æ¯”æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ç½‘ç»œé€Ÿåº¦è¦æ…¢å¾ˆå¤šã€‚\nä¸‹è¡Œå¸¦å®½å³ä¸‹è¡Œé€Ÿç‡ã€‚\nä¸€èˆ¬æ˜¯ä½ ä»ç½‘ç»œä¸Šçš„ä¸»æœºä¸‹è½½çš„é€Ÿåº¦ï¼Œæ¯”å¦‚ä½ ä¸‹è½½æ–‡ä»¶çš„é€Ÿåº¦ï¼Œæ‰“å¼€ç½‘é¡µçš„é€Ÿåº¦ï¼Œè¿™ç§é€Ÿåº¦å°±æ˜¯ä¸‹è¡Œé€Ÿç‡ï¼Œä¸‹è¡Œé€Ÿç‡é€šå¸¸å°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç½‘é€Ÿï¼Œæ¯”å¦‚ä½ çš„å¸¦å®½æ˜¯ç”µä¿¡8Mï¼Œå…‰çº¤20Mç­‰ï¼Œè¿™ç§é€Ÿåº¦å…¶å®å°±æ˜¯æŒ‡çš„ç½‘ç»œçš„ä¸‹è¡Œé€Ÿç‡ã€‚\nä¸Šè¡Œå¸¦å®½(é€Ÿåº¦)å’Œä¸‹è¡Œå¸¦å®½(é€Ÿåº¦)æ˜¯ä¸å¯¹ç§°çš„ã€‚\nä¸€èˆ¬æ˜¯ä¸‹è¡Œé€Ÿåº¦å¤§äºä¸Šè¡Œé€Ÿåº¦ã€‚æˆ‘ä»¬å¹³æ—¶æ‰€ä½¿ç”¨çš„å®½å¸¦è¯´å¤šå°‘Mï¼Œéƒ½æ˜¯æŒ‡çš„ä¸‹è¡Œå¸¦å®½ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šç½‘ä¸»è¦æ˜¯ä»äº’è”ç½‘ä¸Šä¸‹è½½æ•°æ®ï¼Œè€Œä¸Šä¼ çš„æ•°æ®é‡è¦å°‘å¾ˆå¤šã€‚\nä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨å®½å¸¦çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ç”µè„‘ä¸‹è½½çš„é€Ÿåº¦æ ¹æœ¬å°±è¾¾ä¸åˆ°è‡ªå·±åŠç†çš„å®½å¸¦çš„æ ‡å‡†ï¼Œä¾‹å¦‚10Mb/sçš„å®½å¸¦ï¼Œä¸‹è½½é€Ÿåº¦åªæœ‰1MB/så·¦å³çš„é€Ÿåº¦ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?\nå› ä¸ºå®½å¸¦è¿è¥å•†çš„å¸¦å®½ä¸‹è¡Œé€Ÿåº¦å’ŒWindowsç”µè„‘ä¸Šçš„ä¸‹è¡Œé€Ÿåº¦çš„å•ä½ä¸ä¸€æ ·ï¼ŒWindowsç”µè„‘çš„å•ä½æ˜¯KBbs/sï¼Œè€Œå®½å¸¦è¿è¥ä¸Šçš„å•ä½æ˜¯Kbbs/sï¼Œ1B=8b(1å­—èŠ‚=8ä½)ã€‚\nå‡è®¾ä½ åŠç†äº†10Mçš„å®½å¸¦ï¼Œ10Mbps=10240Kbps/8=1280KBps,æ‰€ä»¥åœ¨ä½ ç”µè„‘çš„æœ€å¤§çš„ä¸‹è½½é€Ÿåº¦åªæœ‰1280KBpsï¼Œä¹Ÿå°±æ˜¯å¤§æ¦‚1.25MB/så·¦å³çš„æ ·å­ã€‚æ‰€ä»¥ä¸è¦å†è¯´å®½å¸¦å…¬å¸å‘äººã€åŠç†çš„å®½å¸¦æ‰£é‡äº†ï¼Œè¿™åªä¸è¿‡æ˜¯è®¡ç®—çš„å•ä½ä¸åŒå¼•èµ·çš„ã€‚\nå®½å¸¦çš„ä¸‹è½½é€Ÿç‡é™¤å®½å¸¦å¸¦å®½å¤–ï¼Œä¸è®¡ç®—æœºé…ç½®ã€ä½¿ç”¨çš„ä¸‹è½½è½¯ä»¶ï¼Œä¸‹è½½çš„å¤§å°ã€ä¸‹è½½ç½‘ç«™çš„é€Ÿç‡ç­‰å‡æœ‰å…³ç³»ï¼Œä¸€èˆ¬çš„ä¸‹è½½è½¯ä»¶éƒ½å¯ä»¥æŸ¥çœ‹åˆ°å®½å¸¦ä¸‹è½½é€Ÿç‡(å¦‚è¿…é›·)ã€‚\nç†æƒ³çš„çŠ¶æ€ä¸‹ï¼š100Må…‰çº¤å®½å¸¦çš„ä¸‹è¡Œå¸¦å®½åœ¨10M/S-11M/sä¹‹é—´ï¼›ä¸Šè¡Œå¸¦å®½ä¼šè¾¾åˆ°å¤šå°‘å‘¢ï¼Ÿè¿™ä¸ªè¦çœ‹ä½ å¼€é€šçš„å®½å¸¦æ˜¯ä¸Šä¸‹è¡Œç­‰åŒè¿˜æ˜¯ä¸ç­‰åŒäº†ï¼Œä¸çŸ¥é“çš„å¯ä»¥å’¨è¯¢ä½ çš„è¿è¥å•†ã€‚å¦‚æœæ˜¯ç­‰åŒçš„ä½ çš„ä¸Šè¡Œå¸¦å®½ä¹Ÿæ˜¯10M/S - 11M/sä¹‹é—´ï¼›ä¸æ˜¯ç­‰åŒçš„ä¸€èˆ¬ä¸Šè¡Œå¸¦å®½åªæœ‰400kbs/s-500Kbs/sã€‚\næ³¨ï¼šä¸€èˆ¬ä¼ä¸šå¼€é€šçš„æ˜¯ä¸Šä¸‹è¡Œå¸¦å®½ç­‰åŒçš„ï¼›å®¶ç”¨çš„æ˜¯ä¸ç­‰åŒï¼Œä¸€èˆ¬åªç®¡ä¸‹è¡Œå¸¦å®½ï¼Œä¸Šè¡Œçš„ä¸ç®¡çš„ã€‚\nå››.æœåŠ¡å™¨çš„ä¸Šè¡Œå’Œä¸‹è¡Œå¸¦å®½ç†è§£\nå¯¹æœåŠ¡å™¨è€Œè¨€ï¼Œ å®¢æˆ·ç«¯ä¸‹è½½èµ„æºæ¶ˆè€—çš„æ˜¯æœåŠ¡å™¨çš„ä¸Šè¡Œæµé‡ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ èµ„æºæ¶ˆè€—çš„æ˜¯æœåŠ¡å™¨çš„ä¸‹è¡Œæµé‡ã€‚\né€šå¸¸ä¹°çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ï¼Œä¸€èˆ¬ä¹°çš„å¸¦å®½æŒ‡çš„æ˜¯ä¸Šè¡Œå¸¦å®½ï¼Œä¸‹è¡Œé€šå¸¸æ˜¯ä¸é™çš„ã€‚è€Œä¸”æµé‡çš„è®¡ç®—ä¸€èˆ¬éƒ½æ˜¯ä»¥ä¸Šè¡Œçš„æ¥è®¡ç®—çš„ã€‚\næ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ èµ„æºï¼Œå¯¹æœåŠ¡å™¨çš„å¸¦å®½åŸºæœ¬æ²¡æœ‰å½±å“ï¼Œå› ä¸ºæœåŠ¡å™¨çš„ä¸‹è¡ŒåŸºæœ¬ä¸é™çš„ï¼Œè·Ÿå®¢æˆ·ç«¯æœ¬èº«ç½‘ç»œçš„å¸¦å®½æœ‰å½±å“ã€‚\nè€Œå®¢æˆ·ç«¯ä¸‹è½½èµ„æºï¼Œé™¤äº†è·ŸæœåŠ¡å™¨çš„å¸¦å®½æœ‰å½±å“ï¼Œè·Ÿå®¢æˆ·ç«¯æœ¬èº«çš„ç½‘ç»œå¸¦å®½ä¹Ÿæœ‰å½±å“çš„ã€‚\næœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½\næœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ä¸»è¦ç”¨äºæœ¬åœ°ç”¨æˆ·è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„èµ„æº(æ¯ç§’é’ŸæœåŠ¡å™¨ä¼ ç»™å®¢æˆ·ç«¯çš„æœ€å¤§æ•°æ®é‡ï¼ŒæœåŠ¡å™¨æµå‡ºçš„å¸¦å®½)ï¼ˆå³æœ¬åœ°çš„ä¸‹è½½ã€æœåŠ¡å™¨çš„ä¸Šä¼ ï¼‰ï¼Œå¦‚æœæ˜¯åœ¨å…¶ä»–æœºå™¨ä¸‹è½½æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œç”¨çš„ä¸»è¦æ˜¯æœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ã€‚\nè¿™é‡Œä¸€å®šè¦åˆ†æ¸…æ¥šä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½æ˜¯å¯¹è°è€Œè¨€çš„ï¼Œä¸ªäººPCä¸‹è½½é€Ÿåº¦çœ‹çš„æ˜¯è‡ªå·±çš„ä¸‹è¡Œå¸¦å®½å’ŒæœåŠ¡å™¨çš„ä¸Šè¡Œå¸¦å®½ã€‚\nä¸ªäººPCï¼ˆAï¼‰ä¸æœåŠ¡å™¨ï¼ˆBï¼‰è¿æ¥ï¼ŒæœåŠ¡å™¨Bçš„æœ€å¤§ä¸Šè¡Œå¸¦å®½ï¼ˆä¸Šè¡Œé€Ÿåº¦ï¼‰å†³å®šäº†PCæœ€å¤§ä¸‹è½½é€Ÿåº¦ã€‚\næœåŠ¡å™¨çš„ä¸‹è¡Œå¸¦å®½\nä¸‹è¡Œå¸¦å®½ä¸»è¦ç”¨äºæœ¬åœ°ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶è‡³æœåŠ¡å™¨(å®¢æˆ·ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨)ï¼Œå¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œä¸‹è¡Œå¸¦å®½æ˜¯ä¸é™åˆ¶çš„ï¼Œç½‘ç»œå› ç´ å–å†³äºå®¢æˆ·ç«¯å½“å‰çš„ç½‘ç»œæƒ…å†µã€‚\näº”.å†…ç½‘ipå’Œå¤–ç½‘ipåŒºåˆ«\nå¦‚å›¾ï¼Œå‡è®¾æˆ‘ä»¬çš„è®¡ç®—æœºæ˜¯è®¾å¤‡ä¸€ï¼Œæƒ³è¦è®¿é—®ç™¾åº¦ã€‚\nå¦‚æœä½¿ç”¨æ ¡å›­ç½‘ï¼Œé¦–å…ˆéœ€è¦å…ˆé€šè¿‡æ ¡å›­ç½‘çš„è·¯ç”±å™¨æŠŠæˆ‘ä»¬çš„å†…ç½‘ipè½¬ä¸ºæ ¡å›­ç½‘``å¤–ç½‘ipã€‚\nç„¶åé€šè¿‡è¿™ä¸ªå¤–ç½‘ipå…ˆè¿æ¥ä¸Šæ¹–å—ç”µä¿¡çš„ç½‘å…³ï¼Œæœ€åå†è¿æ¥ä¸Šç™¾åº¦çš„ç½‘å…³ã€‚\nç™¾åº¦æŠŠä½ è¯·æ±‚çš„ä¿¡æ¯å›ä¼ åˆ°ä½ çš„æ ¡å›­ç½‘ç½‘å…³ï¼Œæ ¡å›­ç½‘ç½‘å…³å†æŠŠä¿¡æ¯ä¼ ç»™ä½ ï¼ˆæ•´ä¸ªç½‘ç»œå‘ˆç½‘çŠ¶ç»“æ„ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰¾åˆ°ä¸€æ¡é€šå¾€ç™¾åº¦çš„è·¯å¾„â€”â€”åŸºäºæ·±åº¦ä¼˜å…ˆæœç´¢æˆ–è€…å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰ã€‚\nè¿™ä¸ªè¿‡ç¨‹å°±è·Ÿæ·˜å®è´­ç‰©å·®ä¸å¤šã€‚\nå‡è®¾åœ¨å­¦æ ¡é‡Œè®¢è´­äº†ä¸€æœ¬ä¹¦ï¼Œæ·˜å®é‚£è¾¹æ¥æ”¶åˆ°ä½ çš„è®¢å•å‡†å¤‡å¥½ç‰©å“å°±å¼€å§‹ç»™ä½ å‘è´§äº†ã€‚\nä»–å‘ç°ä½ çš„æ”¶è´§åœ°å€åœ¨æ¹–å—ï¼Œäºæ˜¯å®ƒå¯èƒ½ä»æ­å·å‡ºå‘ï¼Œå…ˆå»äº†ç¦å»ºçš„ä¸­è½¬ç«™ï¼Œç„¶åå†åˆ°æ±Ÿè¥¿çš„ä¸­è½¬ç«™ï¼Œçªç„¶å‘ç°æ±Ÿè¥¿åˆ°æ¹–å—çš„ä¸­è½¬ç«™ä¸é€šï¼Œäºæ˜¯å®ƒåªèƒ½å†ç»•åˆ°å¹¿ä¸œçš„ä¸­è½¬ç«™ï¼Œæœ€åå†åˆ°æ¹–å—ä¸­è½¬ç«™ã€‚è¿™äº›ä¸­è½¬ç«™å°±ç›¸å½“äºå…¬ç½‘ä¸Šçš„å„ä¸ªç½‘å…³ã€‚\nåˆ°äº†æ¹–å—ä¸­è½¬ç«™ï¼Œå¿«é€’å°å“¥å†æŠŠåŒ…è£¹é€åˆ°ä½ çš„æ ¡é—¨ï¼ˆè¿™å°±æ˜¯æœ€åä¸€çº§ç½‘å…³ï¼‰ã€‚\nè¿™æ—¶å¿«é€’å°å“¥å°±èµ°äº†ï¼Œæ ¡é—¨å¤„çš„ç®¡ç†äººå‘˜å†æ ¹æ®ä½ çš„å®¿èˆä¿¡æ¯æŠŠåŒ…è£¹æ‹¿ç»™ä½ ã€‚ï¼ˆå±€åŸŸç½‘å†…éƒ¨çš„ä¿¡æ¯äº¤æµç”±æ ¡å›­ç½‘è¿™ä¸ªç½‘å…³æ¥å¤„ç†ï¼‰ã€‚\nè¿™å¯¹åˆšæ¥è§¦äº’è”ç½‘çš„äººæ¥è¯´æœ‰äº›éš¾ä»¥ç†è§£å†…ç½‘ipå’Œå…¬ç½‘ipçš„åŒºåˆ«ï¼Œé‚£æˆ‘ä»¬å†ä¸¾ä¸€ä¸ªä¾‹å­ã€‚\næˆ‘ä»¬æŠŠé…’åº—çš„201æˆ¿æ¯”ä½œå†…ç½‘ipï¼Œé‚£ä¹ˆå‡¡æ˜¯é…’åº—éƒ½å¯èƒ½æœ‰201æˆ¿ï¼Œå‡å¦‚ä½ é¥¿äº†ä¼šå¯¹æœåŠ¡å‘˜è¯´ï¼šâ€œæˆ‘åœ¨201æˆ¿é—´ï¼Œéº»çƒ¦é€äº›åƒçš„è¿‡æ¥ã€‚â€è€Œå‡å¦‚ä½ è¦ç‚¹å¤–å–çš„è¯ä½ å¯¹åº—å®¶ä»…è¯´é€æ¥201æˆ¿é—´ï¼ˆå†…ç½‘ipï¼‰ï¼Œå¤–é¢çš„äººæ˜¯ä¸å¯èƒ½çŸ¥é“çš„ï¼Œè¿™æ—¶ä½ å°±è¦å¯¹åº—å®¶è¯´æŸæŸå¸‚æŸæŸåŒºæŸæŸé…’åº—ï¼ˆå…¬ç½‘ip)å†åŠ ä¸Š201æˆ¿ï¼Œåº—å®¶æ‰èƒ½æ‰¾åˆ°ä½ ã€‚\nè¿è¥å•†`æ‰€åˆ†é…å…¬ç½‘`ip`åœ°å€ï¼ˆ`æŸæŸå¸‚æŸæŸåŒºæŸæŸé…’åº—`ï¼‰ä¹Ÿå°±æ˜¯æ‰€ä½çš„é…’åº—ï¼Œè€Œ`201æˆ¿ï¼ˆå†…ç½‘ipï¼‰`åˆ™æ˜¯`é…’åº—ç®¡å®¶ï¼ˆè·¯ç”±å™¨ï¼‰æ‰€åˆ†é…çš„`ã€‚æ‰€ä»¥`ä¸€ä¸ªé…’åº—å¯ä»¥æœ‰å¾ˆå¤šçš„æˆ¿é—´ï¼ˆå†…ç½‘ipï¼‰`ï¼Œä½†æ˜¯å½“å¤–é¢çš„æœ‹å‹é—®ä½ ä½å“ªé‡Œï¼Œä½ è‚¯å®šä¸ä¼šè¯´`ä½ ä½åœ¨201æˆ¿é—´ï¼ˆå†…ç½‘ipï¼‰`ï¼Œè€Œä¼šè¯´ä½ ä½åœ¨`æŸæŸå¸‚æŸæŸåŒºæŸæŸé…’åº—ï¼ˆå…¬ç½‘ip)ã€‚ è¿™æ˜¯å†…ç½‘ipå’Œå…¬ç½‘ipçš„æœ¬è´¨åŒºåˆ«ã€‚ä¸€ä¸ªå¯¹å†…ï¼Œä¸€ä¸ªå¯¹å¤–ã€‚\næ³¨æ„ç‚¹ï¼š\n1ã€å…¬ç½‘ipå…·æœ‰ä¸–ç•ŒèŒƒå›´çš„å”¯ä¸€æ€§ï¼Œè€Œå†…ç½‘ipåªåœ¨å±€åŸŸç½‘å†…éƒ¨å…·æœ‰å”¯ä¸€æ€§ã€‚\n2ã€ä¸€ä¸ªå±€åŸŸç½‘é‡Œæ‰€æœ‰ç”µè„‘çš„**å†…ç½‘**ip****æ˜¯äº’ä¸ç›¸åŒçš„ï¼Œä½†å…±ç”¨ä¸€ä¸ªå¤–ç½‘ipã€‚\nå°±åƒå‰é¢é…’åº—çš„ä¾‹å­ä¸€æ ·ï¼šä½ æ‰€åœ¨å­¦æ ¡çš„æ ¡ååœ¨æ•´ä¸ªä¸–ç•Œä¸Šåªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯ä½ å­¦æ ¡é‡Œé¢çš„Aæ ‹å¤§æ¥¼3å±‚3å·æ•™å®¤åªæœ‰åœ¨ä½ çš„æ ¡å›­å†…éƒ¨æ‰å…·æœ‰å”¯ä¸€æ€§ï¼Œåˆ«çš„å­¦æ ¡ä¹Ÿæœ‰Aæ ‹å¤§æ¥¼3å±‚3å·æ•™å®¤ã€‚ä½ åªèƒ½è·Ÿå¿«é€’å°å“¥è¯´è¯·å¸®æˆ‘æŠŠåŒ…è£¹é€åˆ°xxå¤§å­¦ï¼Œè€Œä¸èƒ½ç›´æ¥è¯´è¯·å¸®æˆ‘æŠŠåŒ…è£¹é€åˆ°Aæ ‹å¤§æ¥¼3å±‚3å·æ•™å®¤ã€‚\n3ã€åœ¨å±€åŸŸç½‘ä¸­ï¼Œæ¯å°ç”µè„‘éƒ½å¯ä»¥è‡ªå·±åˆ†é…è‡ªå·±çš„IPï¼Œä½†æ˜¯è¿™ä¸ªIPåªåœ¨å±€åŸŸç½‘ä¸­æœ‰æ•ˆã€‚è€Œå¦‚æœä½ å°†ç”µè„‘è¿æ¥åˆ°äº’è”ç½‘ï¼Œä½ çš„ç½‘ç»œæä¾›å•†çš„æœåŠ¡å™¨ä¼šä¸ºä½ åˆ†é…ä¸€ä¸ªIPåœ°å€ï¼Œè¿™ä¸ªIPåœ°å€æ‰æ˜¯ä½ åœ¨å¤–ç½‘çš„IPã€‚ä¸¤ä¸ªIPåŒæ—¶å­˜åœ¨ï¼Œä¸€ä¸ªå¯¹å†…ï¼Œä¸€ä¸ªå¯¹å¤–ã€‚\n4ã€äº’è”ç½‘ä¸Šçš„IPï¼ˆå³å¤–ç½‘IPï¼‰åœ°å€ç»Ÿä¸€ç”±ä¸€ä¸ªå«â€œIANA(äº’è”ç½‘ç½‘ç»œå·åˆ†é…æœºæ„)â€çš„ç»„ç»‡æ¥ç®¡ç†ã€‚ç”±äºåˆ†é…ä¸åˆç†ä»¥åŠIPv4åè®®æœ¬èº«å­˜åœ¨çš„å±€é™ï¼Œç°åœ¨äº’è”ç½‘çš„IPåœ°å€èµ„æºè¶Šæ¥è¶Šç´§å¼ ã€‚IANAå°†Aã€Bã€Cç±»IPåœ°å€çš„ä¸€éƒ¨åˆ†ä¿ç•™ä¸‹æ¥ï¼Œç•™ä½œå±€åŸŸç½‘ä½¿ç”¨ã€‚å…·ä½“å¦‚ä¸‹ï¼š\nIPåœ°å€ç©ºé—´ï¼š\naç±»ç½‘10.0.0.0 ~ 10.255.255.255 bç±»ç½‘172.16.0.0 ~ 172.31.255.255 cç±»ç½‘192.168.0. 0~ 192.168.255.255 ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æŸ¥åˆ°çš„ipåœ°å€åœ¨ä»¥ä¸ŠAã€Bã€Cç±»IPåœ°å€çš„èŒƒå›´å†…ï¼Œå®ƒä¸€å®šå°±æ˜¯å±€åŸŸç½‘çš„ipåœ°å€ï¼Œå¦åˆ™å°±æ˜¯å…¬ç½‘çš„åœ°å€ã€‚\n5ã€å®é™…ç”Ÿæ´»ä¸­ä¸ä»…æœ‰ä¸€çº§NETæŠ€æœ¯ï¼Œè¿˜æœ‰äºŒçº§NETæŠ€æœ¯ã€‚ä¹Ÿå°±æ˜¯å¯èƒ½ä½ çš„æ ¡å›­ç½‘å…³ä¹Ÿåªæ˜¯ä¸ªå±€åŸŸç½‘ã€‚é€šè¿‡å¤šçº§è½¬æ¢å¯ä»¥å¾—åˆ°æ›´å¤šçš„åœ°å€ã€‚\nè¿™é‡Œä»‹ç»ä¸¤ç§åˆ¤æ–­æ˜¯å¦å†…ç½‘IPçš„æ–¹æ³•ï¼Œä¸€ç§æ˜¯ç›´è§‚æ³•ï¼Œä¸€ç§æ˜¯ç»éªŒæ³•ã€‚\nç›´è§‚æ³•ï¼š\nä»¥ä¸‹IPæ®µçš„åœ°å€éƒ½æ˜¯å†…ç½‘IPåœ°å€ï¼š\n10.0.0.0 åˆ° 10.255.255.255172.16.0.0 åˆ° 172.31.255.255192.168.0.0 åˆ° 192.168.255.255 ç»éªŒæ³•ï¼š\nï¼ˆ1ï¼‰ä¸€èˆ¬ç”µä¿¡ADSLå¸¦å®½åœ¨æœªå‡çº§å¤§å¸¦å®½å‰æ˜¯ï¼ˆåŠ¨æ€ï¼‰å…¬ç½‘IPã€‚å¦‚æœèŠ±è´¹å¾ˆå°‘çš„é’±ç»™ä½ å‡çº§ä¸º100Må…‰çº¤ä¸Šç½‘ï¼Œ99.99%æ˜¯å†…ç½‘IPï¼Œé‚£0.01%æ˜¯æˆ‘è¿˜æ²¡æœ‰å‘ç°è¿‡æ¡ˆä¾‹ã€‚\nï¼ˆ2ï¼‰ä»£ç†ç½‘ç»œè¿è¥å•†99.99%éƒ½æ˜¯å†…ç½‘IPï¼Œå¦‚é•¿åŸå¸¦å®½ã€èšå‹Eå®¶ç­‰ã€‚\nï¼ˆ3ï¼‰å…‰çº¤ä¸Šç½‘çš„99.99%éƒ½æ˜¯å†…ç½‘IPã€‚\nè½¬è½½ https://mp.weixin.qq.com/s/l-JD-ZmxzpyPBHfl7_ztQQ\n","permalink":"https://www.iarno.cn/article/network/","tags":[],"title":"å®½å¸¦ã€å¸¦å®½ã€æµé‡ã€ç½‘é€Ÿã€å†…ç½‘ã€å¤–ç½‘ä¹‹é—´çš„åŒºåˆ«"},{"categories":["Mysql"],"contents":"æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨MySQLå‘½ä»¤è¡Œå·¥å…·å¯¼å‡ºExcelè¡¨æ ¼æˆ–txtæ–‡ä»¶ã€‚ä¸»è¦é€šè¿‡mysql -h x.x.x.x -P 3306 -uç”¨æˆ·å -på¯†ç  -e \u0026ldquo;select * from test\u0026rdquo; æ•°æ®åº“ \u0026gt; /tmp/test.xlsè¿™æ¡å‘½ä»¤å®ç°ã€‚å…¶ä¸­ï¼Œ-hä»£è¡¨æ•°æ®åº“Hostï¼Œ-Pä»£è¡¨æ•°æ®åº“ç«¯å£ï¼Œ-uä»£è¡¨ç”¨æˆ·åï¼Œ-pä»£è¡¨å¯†ç ï¼Œ-eä»£è¡¨sqlè¯­å¥ï¼Œ/tmp/test.xlsä»£è¡¨æ–‡ä»¶åã€‚\nå‘½ä»¤ mysql -h x.x.x.x -P 3306 -uç”¨æˆ·å -på¯†ç  -e \u0026#34;select * from test\u0026#34; æ•°æ®åº“ \u0026gt; /tmp/test.xls è¯´æ˜\n-h ï¼šæ•°æ®åº“Host\n-Pï¼š æ•°æ®åº“ç«¯å£\n-uï¼š ç”¨æˆ·å\n-pï¼š å¯†ç \n-eï¼šsqlè¯­å¥\n/tmp/test.xlsï¼š æ–‡ä»¶å\n","permalink":"https://www.iarno.cn/article/mysql-excel/","tags":[],"title":"Mysql å¯¼å‡ºExcelè¡¨"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Kongaæ’ä»¶çš„ä½¿ç”¨æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬åˆ›å»ºæ¶ˆè´¹è€…ã€æ·»åŠ å‡­è¯ã€è·¯ç”±æ·»åŠ æ’ä»¶ä»¥åŠä½¿ç”¨Postmanå‘é€è¯·æ±‚ç­‰æ­¥éª¤ã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•æ·»åŠ Basic Authæ’ä»¶ï¼Œå¹¶é€šè¿‡å›¾æ–‡å¹¶èŒ‚çš„æ–¹å¼å±•ç¤ºäº†æ“ä½œæµç¨‹ã€‚åŒæ—¶ï¼Œæ–‡ç« è¿˜æä¾›äº†ç›¸å…³å‚è€ƒé“¾æ¥ï¼Œä¾›è¯»è€…æ·±å…¥å­¦ä¹ ã€‚\nCREATE CONSUMER Cerdentials é»˜è®¤ä¸ºæ‰€æœ‰consumer\nåˆ›å»º\nä¾‹ï¼š\nUsername: test\nPasswordï¼štest\nRoute æ·»åŠ æ’ä»¶ æ·»åŠ  Basic Auth æ’ä»¶\næ·»åŠ æˆåŠŸ\nPostman å‘é€è¯·æ±‚ æ³¨ï¼šheaderä¸­çš„ Authorizationå€¼ä¸ºä¹‹å‰consumerçš„ç”¨æˆ·å:å¯†ç base64åå€¼\nå‚è€ƒ https://www.jianshu.com/p/61761396d285\n","permalink":"https://www.iarno.cn/article/kong-plugins/","tags":["ç½‘å…³"],"title":"Konga æ’ä»¶ä½¿ç”¨æ¡ˆä¾‹"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Kongaï¼ŒåŒ…æ‹¬å®‰è£…ã€é…ç½®Dashboardã€åˆ›å»ºServiceã€é…ç½®è·¯ç”±ä»¥åŠä½¿ç”¨Postmanè¯·æ±‚ç½‘å…³ã€‚æ–‡ç« é¦–å…ˆæä¾›äº†Kongaçš„å®‰è£…é“¾æ¥ï¼Œç„¶åè¯¦ç»†è§£é‡Šäº†å¦‚ä½•é…ç½®Dashboardï¼ŒåŒ…æ‹¬å¦‚ä½•æŸ¥æ‰¾Kong Admin URLã€‚æ¥ç€ï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•åˆ›å»ºServiceå’Œé…ç½®è·¯ç”±ï¼Œç‰¹åˆ«å¼ºè°ƒäº†åœ¨é…ç½®è·¯ç”±æ—¶ï¼Œå¯¹äºhostsã€pathsã€methodsç­‰é…ç½®é¡¹éœ€è¦æŒ‰å›è½¦é”®æ¥åº”ç”¨æ¯ä¸ªè¾“å…¥çš„å€¼ã€‚æœ€åï¼Œæ–‡ç« å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Postmanè¯·æ±‚ç½‘å…³ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„ç«¯å£å’ŒHeaderså¤´çš„é…ç½®ã€‚\nkongaä½¿ç”¨ kongaå®‰è£…è¯·å‚è€ƒDockerå®‰è£…kongç½‘å…³\nUrlï¼šhttp://127.0.0.1:1337 æ³¨å†Œè´¦å·å¹¶ç™»é™†å¹³å°\né…ç½®DASHBOARD æ³¨ï¼šKong Admin URLä¸ºkongå®¹å™¨åˆ†é…çš„ip \u0026lt;è¯·è¿›å…¥kongå®¹å™¨æœåŠ¡ä½¿ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹\u0026gt;\nä¾‹ï¼šhttp://172.19.0.3:8001/\nåˆ›å»ºService é…ç½®è·¯ç”± æ³¨ï¼š For hosts, paths, methods and protocols, snis, sources, headers and destinations press enter to apply every value you type (è¿™äº›ä¸ªé…ç½®é¡¹éœ€è¦æŒ‰å›è½¦é”®)\nPostmanè¯·æ±‚ç½‘å…³ æ³¨ï¼šè¯·æ±‚8000ç«¯å£ã€é…ç½®Headerså¤´\n","permalink":"https://www.iarno.cn/article/konga/","tags":["ç½‘å…³"],"title":"Kongaä½¿ç”¨"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Dockerå®‰è£…Kongç½‘å…³ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªDockerç½‘ç»œï¼Œç„¶ååˆ›å»ºPostgreSQLæˆ–Cassandraæ•°æ®åº“ã€‚æ¥ç€ï¼Œå‡†å¤‡æ•°æ®åº“å¹¶å¯åŠ¨KongæœåŠ¡ã€‚KongæœåŠ¡é»˜è®¤ç›‘å¬8000ã€8443ã€8001å’Œ8444ç«¯å£ã€‚éªŒè¯KongæœåŠ¡åï¼Œå®‰è£…Kongaï¼Œä¸€ä¸ªKongçš„ç®¡ç†ç•Œé¢ã€‚æœ€åï¼Œæä¾›äº†å‡ ä¸ªå‚è€ƒé“¾æ¥ï¼ŒåŒ…æ‹¬Kongçš„å®˜æ–¹æ–‡æ¡£å’Œå…¶ä»–ç›¸å…³æ–‡ç« ã€‚\nåˆ›å»ºDocker network $ docker network create kong-net åˆ›å»ºæ•°æ®åº“ æœ¬æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯PostgreSQLæ•°æ®åº“\nCassandraæ•°æ®åº“\n$ docker run -d --name kong-database \\ --network=kong-net \\ -p 9042:9042 \\ cassandra:3 PostgreSQLæ•°æ®åº“\n$ docker run -d --name kong-database \\ --network=kong-net \\ -p 5432:5432 \\ -e \u0026#34;POSTGRES_USER=kong\u0026#34; \\ -e \u0026#34;POSTGRES_DB=kong\u0026#34; \\ -e \u0026#34;POSTGRES_PASSWORD=kong\u0026#34; \\ postgres:9.6 å‡†å¤‡æ•°æ®åº“ æ­¤å‘½ä»¤ä½¿ç”¨çš„æ˜¯postgresæ•°æ®åº“\n$ docker run --rm \\ --network=kong-net \\ -e \u0026#34;KONG_DATABASE=postgres\u0026#34; \\ -e \u0026#34;KONG_PG_HOST=kong-database\u0026#34; \\ -e \u0026#34;KONG_PG_USER=kong\u0026#34; \\ -e \u0026#34;KONG_PG_PASSWORD=kong\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_CONTACT_POINTS=kong-database\u0026#34; \\ kong:latest kong migrations bootstrap å¯åŠ¨KongæœåŠ¡ $ docker run -d --name kong \\ --network=kong-net \\ -e \u0026#34;KONG_DATABASE=postgres\u0026#34; \\ -e \u0026#34;KONG_PG_HOST=kong-database\u0026#34; \\ -e \u0026#34;KONG_PG_USER=kong\u0026#34; \\ -e \u0026#34;KONG_PG_PASSWORD=kong\u0026#34; \\ -e \u0026#34;KONG_CASSANDRA_CONTACT_POINTS=kong-database\u0026#34; \\ -e \u0026#34;KONG_PROXY_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ACCESS_LOG=/dev/stdout\u0026#34; \\ -e \u0026#34;KONG_PROXY_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_ERROR_LOG=/dev/stderr\u0026#34; \\ -e \u0026#34;KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl\u0026#34; \\ -p 8000:8000 \\ -p 8443:8443 \\ -p 127.0.0.1:8001:8001 \\ -p 127.0.0.1:8444:8444 \\ kong:latest Kongé»˜è®¤ç›‘å¬ä¸‹é¢ç«¯å£ï¼š\n8000ï¼Œç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„HTTPæµé‡ï¼Œè½¬å‘åˆ°ä½ çš„upstreamæœåŠ¡ä¸Šã€‚\n8443ï¼Œç›‘å¬HTTPSçš„æµé‡ï¼ŒåŠŸèƒ½è·Ÿ8000ä¸€æ ·ã€‚å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ç¦æ­¢ã€‚\n8001ï¼ŒKongçš„HTTPç›‘å¬çš„apiç®¡ç†æ¥å£ã€‚\n8444ï¼ŒKongçš„HTTPSç›‘å¬çš„APIç®¡ç†æ¥å£ã€‚\néªŒè¯KongæœåŠ¡ $ curl -i http://127.0.0.1:8001/ å®‰è£…Konga $ docker pull postgres:latest $ docker run -d -p 1337:1337 --network kong-net -e \u0026#34;TOKEN_SECRET=kongtoken\u0026#34; -e \u0026#34;DB_ADAPTER=postgres\u0026#34; -e \u0026#34;DB_HOST=kong-database\u0026#34; -e \u0026#34;DB_USER=kong\u0026#34; -e \u0026#34;DB_PASSWORD=kong\u0026#34; --name konga pantsel/konga è®¿é—®URLï¼šhttp://{konga-ip}:1337/\nå‚è€ƒ https://docs.konghq.com/install/docker/\nhttps://www.jianshu.com/p/5049b3bb4b80\nhttps://juejin.im/post/6844903951070920711\n","permalink":"https://www.iarno.cn/article/docker-kong/","tags":["ç½‘å…³"],"title":"Dockerå®‰è£…Kongç½‘å…³"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ç ´è§£ç‰ˆæœ¬çš„Burp Suiteï¼Œä¸€ä¸ªå¤šçº¿ç¨‹è¯·æ±‚å·¥å…·ã€‚é¦–å…ˆï¼Œæ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•å¯åŠ¨è½¯ä»¶ï¼ŒåŒ…æ‹¬è¿è¡Œå…³é”®çš„burp-loader-keygen.jaræ–‡ä»¶ã€‚ç„¶åï¼Œæ–‡ç« é€æ­¥æŒ‡å¯¼è¯»è€…å¦‚ä½•é…ç½®hostï¼Œè¯·æ±‚ä¿¡æ¯ï¼Œè¯·æ±‚æ•°é‡ï¼Œçº¿ç¨‹æ•°ï¼Œå¹¶æ‰§è¡Œè¯·æ±‚ã€‚æ¯ä¸ªæ­¥éª¤éƒ½é…æœ‰æ¸…æ™°çš„å›¾ç‰‡æŒ‡å¯¼ã€‚\næ­£ç‰ˆBurp Suiteæ— æ³•ä¿®æ”¹çº¿ç¨‹æ•°ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ç ´è§£ç‰ˆæœ¬çš„ä½¿ç”¨æµç¨‹ã€‚\nç ´è§£ä¹‹åä¸‹è½½çš„æ­£ç‰ˆæ— æ³•æ­£å¸¸å¯åŠ¨ ï¿£â–¡ï¿£ï½œï½œ\nå¯åŠ¨ æ³¨ï¼šå¦‚å¯¹è·¯å¾„æœ‰ç–‘é—®è¯·æŸ¥çœ‹macOSå®‰è£…BurpSuiteå¹¶ç ´è§£\ncd /Applications/Burp\\ Suite\\ Community\\ Edition.app/Contents/java/app/ open . è¿è¡Œburp-loader-keygen.jaræ–‡ä»¶\nç‚¹å‡»runè¿è¡Œè½¯ä»¶\nä½¿ç”¨ é…ç½®host\né…ç½®è¯·æ±‚ä¿¡æ¯\né…ç½®è¯·æ±‚æ•°\né…ç½®çº¿ç¨‹æ•°\næ‰§è¡Œå‘èµ·è¯·æ±‚\n","permalink":"https://www.iarno.cn/article/user-burp/","tags":["å¤šçº¿ç¨‹"],"title":"Burp Suiteä½¿ç”¨"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨MacOSä¸Šå®‰è£…å¹¶ç ´è§£BurpSuiteã€‚é¦–å…ˆï¼Œä»å®˜ç½‘ä¸‹è½½ç¤¾åŒºç‰ˆçš„BurpSuiteï¼Œç„¶åä¸‹è½½æ³¨å†Œæœºã€‚ç”±äºJDK10ç‰ˆæœ¬è¿‡é«˜æ— æ³•ç ´è§£ï¼Œéœ€è¦å¸è½½JDK10å¹¶å®‰è£…JDK1.8ã€‚è®¾ç½®å¥½JDKç¯å¢ƒå˜é‡åï¼Œå°†æ³¨å†Œæœºçš„æ–‡ä»¶æ‹·è´è¿›appç›®å½•ï¼Œä¿®æ”¹vmoptions.txtæ–‡ä»¶ï¼Œè¿è¡Œæ³¨å†Œæœºå¹¶æŒ‰ç…§æŒ‡ç¤ºè¿›è¡Œç ´è§£ã€‚\n1ã€å®˜ç½‘ä¸‹è½½ç¤¾åŒºç‰ˆBurpSuite 2ã€ä¸‹è½½æ³¨å†Œæœº 3ã€è½½å®‰è£…çš„JDK10 ï¼ˆç‰ˆæœ¬å¤ªé«˜ç ´è§£ä¸äº†ï¼‰ 4ã€å®‰è£…JDK1.8 5ã€æŒ‰å‚è€ƒé“¾æ¥ç ´è§£ 1ã€å®˜ç½‘ä¸‹è½½ç¤¾åŒºç‰ˆBurpSuite Download for Mac OSX Burp Suite Community Edition v1.7.36\n2ã€ä¸‹è½½æ³¨å†Œæœº é“¾æ¥:https://pan.baidu.com/s/1k-TTAVe-OdOIWSMvvVdSNA å¯†ç :i37h Burp_Suite_Pro_v1.7.37_Loader_Keygen æœ‰2ä¸ªæ–‡ä»¶ burp-loader-keygen.jar ã€burpsuite_community.jar\n$ md5 burp-loader-keygen.jar MD5 (burp-loader-keygen.jar) = a4a02e374695234412e2c66b0649b757 $ md5 burpsuite_community.jar MD5 (burpsuite_community.jar) = 0350199495f1d026363980b581b4aeb9 1234 3ã€å¸è½½å®‰è£…çš„JDK10 ï¼ˆç‰ˆæœ¬å¤ªé«˜ç ´è§£ä¸äº†ï¼‰ åœ¨Finderä¸­åˆ é™¤JavaAppletPlugin.pluginå’ŒJavaControlPanel.prefPaneæ–‡ä»¶ è·¯å¾„ï¼š\n/Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin /Library/PreferencesPanes/JavaControlPanel.prefpane\n4ã€å®‰è£…JDK1.8 ä¸‹è½½å®‰è£…JDKå’ŒJREï¼Œè®¾ç½®JDKç¯å¢ƒå˜é‡ã€‚\n$ java -version java version \u0026#34;1.8.0_211\u0026#34; Java(TM) SE Runtime Environment (build 1.8.0_211-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode) $ /usr/libexec/java_home -V Matching Java Virtual Machines (1): 1.8.0_211, x86_64:\t\u0026#34;Java SE 8\u0026#34;\t/Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home 12345678910 è®¾ç½®ç¯å¢ƒå˜é‡ vim ~/.bash_profile export JAVA_10_HOME=/Library/Java/JavaVirtualMachines/jdk-10.0.2.jdk/Contents/Home export JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_181.jdk/Contents/Home alias jdk10=\u0026#39;export JAVA_HOME=$JAVA_10_HOME\u0026#39; alias jdk8=\u0026#39;export JAVA_HOME=$JAVA_8_HOME\u0026#39; #default jdk8 export JAVA_HOME=$JAVA_8_HOME $ source .bash_profile $ echo ${JAVA_HOME} /Library/Java/JavaVirtualMachines/jdk1.8.0_211.jdk/Contents/Home 5ã€æŒ‰å‚è€ƒé“¾æ¥ç ´è§£ burp-loader-keygen.jar burpsuite_community.jar æ‹·è´è¿›appç›®å½•\n$ cd /Applications/Burp\\ Suite\\ Community\\ Edition.app/Contents/java/app/ vmoptions.txt æ·»åŠ  -Xbootclasspath/p:burp-loader-keygen.jar\n$ pwd /Applications/Burp Suite Community Edition.app/Contents $ vim vmoptions.txt è¿è¡Œ burp-loader-keygen.jar License å†…å®¹ï¼Œå¤åˆ¶ å¦å­˜ä¸ºä¸€ä¸ªtxtæ–‡ä»¶ BurpSuiteLocense.txtï¼ˆåç§°è‡ªå®šä¹‰ï¼‰\nç‚¹å‡» Run å¦‚ä¸‹ç•Œé¢ï¼ŒSelect license key file é€‰æ‹© BurpSuiteLocense.txt\nç‚¹å‡» Manual activation\nCopy request å¤åˆ¶åˆ° Activation Request ï¼ŒActivation Response å¤åˆ¶åˆ° Paste response å‚è€ƒï¼š\nè‹¹æœç”µè„‘macbook å®‰è£… Burp Suite pro_v1.7.37ç ´è§£ç‰ˆ ç¼–è¯‘BurpSuiteç ´è§£ç‰ˆä¸ºMac Applocation How to Uninstall Java on Mac ","permalink":"https://www.iarno.cn/article/burp/","tags":["å¤šçº¿ç¨‹"],"title":"MacOSå®‰è£…BurpSuiteå¹¶ç ´è§£"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ç ´è§£ IntelliJ IDEAï¼ŒåŒ…æ‹¬ IDEA2020.2 çš„æ¿€æ´»ç å’Œç ´è§£æ•™ç¨‹ã€‚æ–‡ç« æä¾›äº† IDEA çš„ä¸‹è½½é“¾æ¥å’Œæ¿€æ´»ç çš„ä¸‹è½½é“¾æ¥ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ jetbrains-agent.jar æ–‡ä»¶è¿›è¡Œæ¿€æ´»çš„æ­¥éª¤ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›ä¿¡æ¯ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¸å¾—ç”¨äºå•†ä¸šç”¨é€”ã€‚\nIDEA2020.2æ¿€æ´»ç ï¼ŒIDEA2020.2ç ´è§£ï¼ŒIDEA2020ç ´è§£æ•™ç¨‹ï¼Œidea2020æœ€æ–°ç ´è§£æ•™ç¨‹\nç”³æ˜ï¼šæœ¬æ•™ç¨‹ IntelliJ IDEA ç ´è§£è¡¥ä¸ã€æ¿€æ´»ç å‡æ”¶é›†äºç½‘ç»œï¼Œè¯·å‹¿å•†ç”¨ï¼Œä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚\nideaä¸‹è½½ é“¾æ¥: https://pan.baidu.com/s/1rNQq_3-TisLb255Z8JeqFQ å¯†ç : scpv\næ¿€æ´»ç ä¸‹è½½ é“¾æ¥: https://pan.baidu.com/s/1nrpM1WjriuajRyjH14b_hw å¯†ç : 3aqs\nä½¿ç”¨ å°†jetbrains-agent.jaræ–‡ä»¶æ‹–å…¥ideaç¼–è¾‘å™¨ï¼Œè¾“å…¥æ–‡ä»¶ä¸­æ¿€æ´»ç æ¿€æ´»ã€‚\n","permalink":"https://www.iarno.cn/article/idea/","tags":["ide"],"title":"idea ç ´è§£"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« æ˜¯å…³äºwrkå‹æµ‹å·¥å…·çš„ä½¿ç”¨æŒ‡å—ã€‚å®ƒé¦–å…ˆä»‹ç»äº†å¦‚ä½•å®‰è£…wrkï¼Œç„¶åè¯¦ç»†è§£é‡Šäº†wrkçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬å¦‚ä½•æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ã€ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œç®€å•çš„å‹æµ‹ã€‚æ–‡ç« è¿˜ä»‹ç»äº†å¦‚ä½•å¢åŠ headerå‚æ•°è¿›è¡Œå‹æµ‹ï¼Œä»¥åŠå¦‚ä½•å‹æµ‹POSTæ¥å£ã€‚åœ¨æ¯ä¸ªç¤ºä¾‹åï¼Œä½œè€…éƒ½å¯¹ç»“æœè¿›è¡Œäº†è¯¦ç»†çš„æ³¨é‡Šå’Œè§£é‡Šã€‚\nå®‰è£… wrkæ”¯æŒå¤§å¤šæ•°ç±»UNIXç³»ç»Ÿï¼Œä¸æ”¯æŒwindowsã€‚éœ€è¦æ“ä½œç³»ç»Ÿæ”¯æŒLuaJITå’ŒOpenSSLï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œå¤§å¤šæ•°ç±»Unixç³»ç»Ÿéƒ½æ”¯æŒã€‚å®‰è£…wrkéå¸¸ç®€å•ï¼Œåªè¦ä»githubä¸Šä¸‹è½½wrkæºç ï¼Œåœ¨é¡¹ç›®è·¯å¾„ä¸‹æ‰§è¡Œmakeå‘½ä»¤å³å¯ã€‚\ngit clone https://github.com/wg/wrk // åˆ‡æ¢åˆ°wrkç›®å½• make makeä¹‹åï¼Œä¼šåœ¨é¡¹ç›®è·¯å¾„ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶wrkï¼Œéšåå°±å¯ä»¥ç”¨å…¶è¿›è¡ŒHTTPå‹æµ‹äº†ã€‚å¯ä»¥æŠŠè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°æŸä¸ªå·²åœ¨pathä¸­çš„è·¯å¾„ï¼Œæ¯”å¦‚/usr/local/binï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ç›´æ¥ä½¿ç”¨wrkäº†ã€‚\né»˜è®¤æƒ…å†µä¸‹wrkä¼šä½¿ç”¨è‡ªå¸¦çš„LuaJITå’ŒOpenSSLï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ç³»ç»Ÿå·²å®‰è£…çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨WITH_LUAJITå’ŒWITH_OPENSSLè¿™ä¸¤ä¸ªé€‰é¡¹æ¥æŒ‡å®šå®ƒä»¬çš„è·¯å¾„ã€‚æ¯”å¦‚ï¼š\nmake WITH_LUAJIT=/usr WITH_OPENSSL=/usr åŸºæœ¬ä½¿ç”¨ å‘½ä»¤è¡Œæ•²ä¸‹wrkï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨å¸®åŠ©\nUsage: wrk \u0026lt;options\u0026gt; \u0026lt;url\u0026gt; Options: -c, --connections \u0026lt;N\u0026gt; Connections to keep open -d, --duration \u0026lt;T\u0026gt; Duration of test -t, --threads \u0026lt;N\u0026gt; Number of threads to use -s, --script \u0026lt;S\u0026gt; Load Lua script file -H, --header \u0026lt;H\u0026gt; Add header to request --latency Print latency statistics --timeout \u0026lt;T\u0026gt; Socket/request timeout -v, --version Print version details Numeric arguments may include a SI unit (1k, 1M, 1G) Time arguments may include a time unit (2s, 2m, 2h) ç®€å•ç¿»æˆä¸­æ–‡ï¼š\nä½¿ç”¨æ–¹æ³•: wrk \u0026lt;é€‰é¡¹\u0026gt; \u0026lt;è¢«æµ‹HTTPæœåŠ¡çš„URL\u0026gt; Options: -c, --connections \u0026lt;N\u0026gt; è·ŸæœåŠ¡å™¨å»ºç«‹å¹¶ä¿æŒçš„TCPè¿æ¥æ•°é‡ -d, --duration \u0026lt;T\u0026gt; å‹æµ‹æ—¶é—´ -t, --threads \u0026lt;N\u0026gt; ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹è¿›è¡Œå‹æµ‹ -s, --script \u0026lt;S\u0026gt; æŒ‡å®šLuaè„šæœ¬è·¯å¾„ -H, --header \u0026lt;H\u0026gt; ä¸ºæ¯ä¸€ä¸ªHTTPè¯·æ±‚æ·»åŠ HTTPå¤´ --latency åœ¨å‹æµ‹ç»“æŸåï¼Œæ‰“å°å»¶è¿Ÿç»Ÿè®¡ä¿¡æ¯ --timeout \u0026lt;T\u0026gt; è¶…æ—¶æ—¶é—´ -v, --version æ‰“å°æ­£åœ¨ä½¿ç”¨çš„wrkçš„è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ \u0026lt;N\u0026gt;ä»£è¡¨æ•°å­—å‚æ•°ï¼Œæ”¯æŒå›½é™…å•ä½ (1k, 1M, 1G) \u0026lt;T\u0026gt;ä»£è¡¨æ—¶é—´å‚æ•°ï¼Œæ”¯æŒæ—¶é—´å•ä½ (2s, 2m, 2h) çœ‹ä¸‹ç‰ˆæœ¬\nwrk -v è¾“å‡ºï¼š wrk 4.0.2 [epoll] Copyright (C) 2012 Will Glozer çœ‹åˆ°æ˜¯4.0.2ç‰ˆæœ¬çš„wrkï¼Œä½¿ç”¨äº†epollã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨å°‘é‡çš„çº¿ç¨‹æ¥è·Ÿè¢«æµ‹æœåŠ¡åˆ›å»ºå¤§é‡è¿æ¥ï¼Œè¿›è¡Œå‹æµ‹ã€‚\nåšä¸€æ¬¡ç®€å•å‹æµ‹ï¼Œåˆ†æä¸‹ç»“æœ\nwrk -t8 -c200 -d30s --latency \u0026#34;http://www.bing.com\u0026#34; è¾“å‡ºï¼š Running 30s test @ http://www.bing.com 8 threads and 200 connections Thread Stats Avg Stdev Max +/- Stdev Latency 46.67ms 215.38ms 1.67s 95.59% Req/Sec 7.91k 1.15k 10.26k 70.77% Latency Distribution 50% 2.93ms 75% 3.78ms 90% 4.73ms 99% 1.35s 1790465 requests in 30.01s, 684.08MB read Requests/sec: 59658.29 Transfer/sec: 22.79MB ä»¥ä¸Šä½¿ç”¨8ä¸ªçº¿ç¨‹200ä¸ªè¿æ¥ï¼Œå¯¹bingé¦–é¡µè¿›è¡Œäº†30ç§’çš„å‹æµ‹ï¼Œå¹¶è¦æ±‚åœ¨å‹æµ‹ç»“æœä¸­è¾“å‡ºå“åº”å»¶è¿Ÿä¿¡æ¯ã€‚ä»¥ä¸‹å¯¹å‹æµ‹ç»“æœè¿›è¡Œç®€å•æ³¨é‡Šï¼š\nRunning 30s test @ http://www.bing.com ï¼ˆå‹æµ‹æ—¶é—´30sï¼‰ 8 threads and 200 connections ï¼ˆå…±8ä¸ªæµ‹è¯•çº¿ç¨‹ï¼Œ200ä¸ªè¿æ¥ï¼‰ Thread Stats Avg Stdev Max +/- Stdev ï¼ˆå¹³å‡å€¼ï¼‰ ï¼ˆæ ‡å‡†å·®ï¼‰ï¼ˆæœ€å¤§å€¼ï¼‰ï¼ˆæ­£è´Ÿä¸€ä¸ªæ ‡å‡†å·®æ‰€å æ¯”ä¾‹ï¼‰ Latency 46.67ms 215.38ms 1.67s 95.59% ï¼ˆå»¶è¿Ÿï¼‰ Req/Sec 7.91k 1.15k 10.26k 70.77% ï¼ˆå¤„ç†ä¸­çš„è¯·æ±‚æ•°ï¼‰ Latency Distribution ï¼ˆå»¶è¿Ÿåˆ†å¸ƒï¼‰ 50% 2.93ms 75% 3.78ms 90% 4.73ms 99% 1.35s ï¼ˆ99åˆ†ä½çš„å»¶è¿Ÿï¼‰ 1790465 requests in 30.01s, 684.08MB read ï¼ˆ30.01ç§’å†…å…±å¤„ç†å®Œæˆäº†1790465ä¸ªè¯·æ±‚ï¼Œè¯»å–äº†684.08MBæ•°æ®ï¼‰ Requests/sec: 59658.29 ï¼ˆå¹³å‡æ¯ç§’å¤„ç†å®Œæˆ59658.29ä¸ªè¯·æ±‚åŠQPSï¼‰ Transfer/sec: 22.79MB ï¼ˆå¹³å‡æ¯ç§’è¯»å–æ•°æ®22.79MBï¼‰ å¯ä»¥çœ‹åˆ°ï¼Œwrkä½¿ç”¨æ–¹ä¾¿ï¼Œç»“æœæ¸…æ™°ã€‚å¹¶ä¸”å› ä¸ºéé˜»å¡IOçš„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨æ™®é€šçš„æµ‹è¯•æœºä¸Šåˆ›å»ºå‡ºå¤§é‡çš„è¿æ¥ï¼Œä»è€Œè¾¾åˆ°è¾ƒå¥½çš„å‹æµ‹æ•ˆæœã€‚\nå¢åŠ headerå‚æ•°å‹æµ‹\nab -c50 -n1000 -t30 -H \u0026#34;token: xxx\u0026#34; \u0026#34;http://127.0.0.1:80/test/test1?a=111\u0026#34; # æ³¨æ„Headerå¤´çš„ç©ºæ ¼ wrk -t8 -c200 -d30s --header \u0026#34;token: xxx\u0026#34; --latency \u0026#34;http://127.0.0.1:80/test/test1?a=111\u0026#34; # æ³¨æ„Headerå¤´çš„ç©ºæ ¼ å‹æµ‹POSTæ¥å£\nå¦‚æœpostè¯·æ±‚çš„bodyä¸ä¸ºç©ºåˆ™æŒ‡å®šluaæ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n./wrk -t 5 -c 300 -d 60 --script=post.lua --latency https://api.midukanshu.com/logstash/userbehavior/create // post.luaæ–‡ä»¶å†…å®¹ wrk.method = \u0026#34;POST\u0026#34; wrk.body = \u0026#34;\u0026#34; wrk.headers[\u0026#34;Content-Type\u0026#34;] = \u0026#34;application/x-www-form-urlencoded\u0026#34; ","permalink":"https://www.iarno.cn/article/wrk/","tags":["å‹æµ‹"],"title":"wrkå‹æµ‹"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨telnetå’Œncå‘½ä»¤æ¥æµ‹è¯•ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚é¦–å…ˆï¼Œä½¿ç”¨telnet ip portå‘½ä»¤æ¥åˆ¤æ–­ç«¯å£æ˜¯å¦é€šï¼Œå¦‚æœè¿æ¥è¢«æ‹’ç»åˆ™ç«¯å£ä¸é€šã€‚ç„¶åï¼Œæ–‡ç« ä»‹ç»äº†ncå‘½ä»¤çš„ä½¿ç”¨ï¼Œé€šè¿‡nc -v localhost portå‘½ä»¤æ¥æ£€æµ‹ç«¯å£ï¼Œå¦‚æœæ˜¾ç¤ºConnection refusedåˆ™ç«¯å£ä¸é€šï¼Œå¦‚æœæ˜¾ç¤ºConnection to x.x.x.x port [tcp/http] succeeded!åˆ™ç«¯å£é€šã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨telnet ip portåˆ¤æ–­ç«¯å£é€šä¸é€šï¼Œå…¶å®æµ‹è¯•æ–¹æ³•ä¸æ­¢è¿™ä¸€ç§ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»ncæ£€æµ‹å·¥å…·ã€‚\n1ã€ä½¿ç”¨telnetåˆ¤æ–­ 1ï¼‰å…ˆç”¨telnetè¿æ¥ä¸å­˜åœ¨çš„ç«¯å£\n[root@localhost ~]# telnet 10.0.250.3 80 Trying 10.0.250.3... telnet: connect to address 10.0.250.3: Connection refused #ç›´æ¥æç¤ºè¿æ¥è¢«æ‹’ç» 2ï¼‰å†è¿æ¥å­˜åœ¨çš„ç«¯å£\n[root@localhost ~]# telnet localhost 22 Trying ::1... Connected to localhost. #çœ‹åˆ°Connectedå°±è¿æ¥æˆåŠŸäº† Escape character is \u0026#39;^]\u0026#39;. SSH-2.0-OpenSSH_5.3 a Protocol mismatch. Connection closed by foreign host. 2ã€ncå‘½ä»¤ 1ï¼‰ä¸å­˜åœ¨çš„ç«¯å£\n[root@localhost] nc -v localhost 8889 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connection refused. 2ï¼‰å­˜åœ¨çš„ç«¯å£\n[root@localhost] nc -v localhost 8889 Connection to x.x.x.x 8889 port [tcp/http] succeeded! ","permalink":"https://www.iarno.cn/article/nc/","tags":[],"title":"å¦‚ä½•æµ‹è¯•ç«¯å£é€šä¸é€š"},{"categories":["Linux"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åœ¨Centosç³»ç»Ÿä¸Šå®‰è£…Nodejsã€‚é¦–å…ˆï¼Œä»Nodejså®˜ç½‘ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆçš„å®‰è£…åŒ…ã€‚ç„¶åï¼Œå°†å®‰è£…åŒ…è§£å‹å¹¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ã€‚æ¥ç€ï¼Œå»ºç«‹è½¯è¿æ¥ï¼Œä½¿å¾—Nodejså’Œnpmå‘½ä»¤å¯ä»¥åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ã€‚æœ€åï¼Œé€šè¿‡æŸ¥çœ‹ç‰ˆæœ¬å·æ¥éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸã€‚\nNodejså®˜ç½‘ä¸‹è½½ ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆhttps://nodejs.org/dist/v10.16.0/node-v10.16.0-linux-x64.tar.xz\nmkdir /opt/software/ \u0026amp;\u0026amp; cd /opt/software/ tar -xvf node-v10.16.0-linux-x64.tar.xz mv node-v10.16.0-linux-x64 nodejs å»ºç«‹è½¯è¿æ¥ï¼Œå˜ä¸ºå…¨å±€\nln -s /opt/software/nodejs/bin/npm /usr/local/bin/ ln -s /opt/software/nodejs/bin/node /usr/local/bin/ æŸ¥çœ‹å®‰è£…çš„ç‰ˆæœ¬\n[root@localhost]# node -v v10.16.0 [root@localhost]# npm -v 6.2.0 ","permalink":"https://www.iarno.cn/article/%E5%AE%89%E8%A3%85nodejs/","tags":["node"],"title":"Centoså®‰è£…Nodejs"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Golangè¿›è¡ŒExcelæ–‡ä»¶çš„å¯¼å‡ºã€‚å®ƒè¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨excelizeåº“åˆ›å»ºä¸€ä¸ªæ–°çš„Excelæ–‡ä»¶ï¼Œå¹¶è®¾ç½®å•å…ƒæ ¼çš„å€¼ã€‚ç„¶åï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•å°†è¿™ä¸ªExcelæ–‡ä»¶ä½œä¸ºä¸€ä¸ªä¸‹è½½å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚æ–‡ç« è¿˜æä¾›äº†ç›¸å…³çš„Githubå’Œæ–‡æ¡£é“¾æ¥ï¼Œä¾›è¯»è€…è¿›ä¸€æ­¥å­¦ä¹ å’Œæ¢ç´¢ã€‚\nExcel å¯¼å‡º Github åœ°å€ https://github.com/360EntSecGroup-Skylar/excelize\nDemo package excel import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/360EntSecGroup-Skylar/excelize\u0026#34; ) func Download(ctx *gin.Context) { xlsx := excelize.NewFile() xlsx.SetCellValue(\u0026#34;Sheet1\u0026#34;, \u0026#34;A2\u0026#34;, \u0026#34;æˆ‘è¦ä¸‹è½½ä¸€ä¸ªexcelæ–‡ä»¶\u0026#34;) xlsx.SetCellValue(\u0026#34;Sheet1\u0026#34;, \u0026#34;B1\u0026#34;, \u0026#34;b1\u0026#34;) xlsx.SetCellValue(\u0026#34;Sheet1\u0026#34;, \u0026#34;A1\u0026#34;, \u0026#34;æœ‰æ²¡æœ‰çœ‹åˆ°æˆ‘å¸…æ°”çš„è„¸åº\u0026#34;) //ä¿å­˜æ–‡ä»¶æ–¹å¼ //_ = xlsx.SaveAs(\u0026#34;./aaa.xlsx\u0026#34;) ctx.Header(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/octet-stream\u0026#34;) ctx.Header(\u0026#34;Content-Disposition\u0026#34;, \u0026#34;attachment; filename=\u0026#34;+\u0026#34;Workbook.xlsx\u0026#34;) ctx.Header(\u0026#34;Content-Transfer-Encoding\u0026#34;, \u0026#34;binary\u0026#34;) //å›å†™åˆ°web æµåª’ä½“ å½¢æˆä¸‹è½½ _ = xlsx.Write(ctx.Writer) } ç›¸å…³æ–‡æ¡£ https://xuri.me/excelize/zh-hans/\n","permalink":"https://www.iarno.cn/article/golang-excel%E5%AF%BC%E5%87%BA/","tags":["excel"],"title":"Golang excelå¯¼å‡º"},{"categories":["Go"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨Goè¯­è¨€ä¸­å®ç°è“„æ°´æ± æŠ½æ ·æ³•ã€‚è“„æ°´æ± æŠ½æ ·æ³•æ˜¯ä¸€ç§ç­‰æ¦‚ç‡éšæœºæŠ½å–çš„æ–¹æ³•ï¼Œé€‚ç”¨äºä»å¤§é‡æ•°æ®ä¸­æŠ½å–æ ·æœ¬ã€‚æ–‡ç« é¦–å…ˆæ„å»ºäº†ä¸€ä¸ªå¯ä»¥æ”¾ç½®mä¸ªå…ƒç´ çš„è“„æ°´æ± ï¼Œç„¶åå°†å‰mä¸ªæ•°ä¾æ¬¡æ”¾å…¥ã€‚ä»ç¬¬m+1ä¸ªå…ƒç´ å¼€å§‹ï¼Œä»¥m/nçš„æ¦‚ç‡å†³å®šå…ƒç´ æ˜¯å¦è¢«æ›¿æ¢åˆ°æ± å­ä¸­ã€‚å½“éå†å®Œæ‰€æœ‰å…ƒç´ åï¼Œå°±å¯ä»¥å¾—å‡ºéšæœºæŒ‘é€‰çš„kä¸ªå…ƒç´ ã€‚è¯¥æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚\nç›¸å…³æ–‡ç«  https://www.cnblogs.com/snowInPluto/p/5996269.html\nä»£ç ç¤ºä¾‹ const Num = 10 /** * è“„æ°´æ± æŠ½æ ·æ³• * å…ˆæ„å»ºä¸€ä¸ªå¯ä»¥æ”¾mä¸ªå…ƒç´ çš„è“„æ°´æ±  * å°†å‰mä¸ªæ•°ä¾æ¬¡æ”¾å…¥ï¼Œä»ç¬¬m+1ä¸ªå…ƒç´ å¼€å§‹ï¼Œä»¥m/nçš„æ¦‚ç‡å†³å®šå…ƒç´ æ˜¯å¦è¢«æ›¿æ¢åˆ°æ± å­ä¸­ * å½“éå†å®Œæ‰€æœ‰çš„çš„å…ƒç´ åï¼ŒåŠå¾—å‡ºéšæœºæŒ‘é€‰çš„kä¸ªå…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n) */ func sampling(ids []string) []string { reservoir := make([]string, 10) for i := 0; i \u0026lt; Num; i++{ reservoir[i] = ids[i]; } for i := Num; i \u0026lt; len(ids); i++ { /*éšæœºè·å¾—ä¸€ä¸ª[0, i]å†…çš„éšæœºæ•´æ•°*/ d := rand.Intn(i + 1) /*å¦‚æœéšæœºæ•´æ•°è½åœ¨[0, m-1]èŒƒå›´å†…ï¼Œåˆ™æ›¿æ¢è“„æ°´æ± ä¸­çš„å…ƒç´ */ if d \u0026lt; Num { reservoir[d] = ids[i] } } return reservoir } ","permalink":"https://www.iarno.cn/article/golang-%E8%93%84%E6%B0%B4%E6%B1%A0%E6%8A%BD%E6%A0%B7%E6%B3%95/","tags":["æŠ½æ ·"],"title":"Golang è“„æ°´æ± æŠ½æ ·æ³•"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•è¿ç§»Hexoåšå®¢ã€‚é¦–å…ˆï¼Œå°†åŸç”µè„‘ä¸Šé…ç½®å¥½çš„Hexoç›®å½•æ‹·è´åˆ°æ–°ç”µè„‘ï¼ŒåŒ…æ‹¬_config.ymlã€package.jsonã€scaffolds/ã€source/å’Œthemes/ç­‰æ–‡ä»¶å’Œç›®å½•ã€‚ç„¶ååœ¨æ–°ç”µè„‘ä¸Šé…ç½®Hexoç¯å¢ƒï¼ŒåŒ…æ‹¬å®‰è£…Node.jså’ŒHexoã€‚æ¥ç€ï¼Œå°†åšå®¢ä¸­çš„node_modulesè®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚æœ€åï¼Œè¿›å…¥Hexoç›®å½•ï¼Œå®‰è£…æ¨¡å—å¹¶éƒ¨ç½²ã€‚\n1.å°†ä½ åŸæ¥ç”µè„‘ä¸Šå·²ç»é…ç½®å¥½å¹¶ç”Ÿæˆçš„hexoç›®å½•æ‹·åˆ°ä½ çš„æ–°ç”µè„‘ä¸Šï¼Œæ³¨æ„æ— éœ€æ‹·å…¨éƒ¨ï¼Œåªæ‹·å¦‚ä¸‹å‡ ä¸ªç›®å½•ï¼š _config.yml package.json scaffolds/ source/ themes/ å°†è¿™äº›ç›®å½•æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¦‚ï¼šhexoï¼\n2.åœ¨ä½ çš„æ–°ç”µè„‘ä¸Šé¦–å…ˆé…ç½®hexoç¯å¢ƒï¼š å®‰è£…Node.js\n3.å®‰è£…hexoï¼Œæ‰§è¡Œå‘½ä»¤ï¼š npm install -g hexo æ³¨:è‹¥æç¤ºhexoå‘½ä»¤é—®é¢˜éœ€è¦å°†åšå®¢ä¸­çš„node_modulesè®¾ç½®ä¸ºç¯å¢ƒå˜é‡\nexport PATH=$PATH:/home/iarno.github.io/node_modules/.bin/ 4.å®‰è£…å¥½ä¹‹åï¼Œè¿›å…¥hexoï¼ç›®å½• 5.æ¨¡å—å®‰è£…ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š npm install npm install hexo-deployer-git --save npm install hexo-generator-feed --save npm install hexo-generator-sitemap --save 6.éƒ¨ç½²ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š hexo g hexo d ","permalink":"https://www.iarno.cn/article/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/","tags":["hexo"],"title":"hexoåšå®¢è¿ç§»"},{"categories":["Mysql"],"contents":"æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨MySQLä¸­æŸ¥è¯¢å¤šä¸ªå­—æ®µé‡å¤çš„å€¼ã€‚æ–‡ç« æä¾›äº†ä¸€æ®µSQLæŸ¥è¯¢è¯­å¥ï¼Œè¯¥è¯­å¥å¯ä»¥ä»æŒ‡å®šçš„è¡¨ä¸­æ‰¾å‡ºåœ¨ç‰¹å®šå­—æ®µï¼ˆå­—æ®µ1å’Œå­—æ®µ2ï¼‰ä¸Šæœ‰é‡å¤å€¼çš„è®°å½•ã€‚è¿™ä¸ªæŸ¥è¯¢è¯­å¥é¦–å…ˆé€šè¿‡å­æŸ¥è¯¢æ‰¾å‡ºæ‰€æœ‰åœ¨å­—æ®µ1å’Œå­—æ®µ2ä¸Šæœ‰é‡å¤å€¼çš„è®°å½•ï¼Œç„¶ååœ¨ä¸»æŸ¥è¯¢ä¸­è¿”å›è¿™äº›è®°å½•ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ‰¾å‡ºæ•°æ®åº“ä¸­çš„é‡å¤è®°å½•ï¼Œå¯¹äºæ•°æ®æ¸…ç†å’Œåˆ†æéå¸¸æœ‰ç”¨ã€‚\nä»£ç ç¤ºä¾‹ SELECT * FROM è¡¨å (å­—æ®µ1,å­—æ®µ2) IN (SELECT å­—æ®µ1,å­—æ®µ2 FROM è¡¨å GROUP BY å­—æ®µ1,å­—æ®µ2 HAVING COUNT(*)\u0026gt;1) ORDER BY å­—æ®µ1; ","permalink":"https://www.iarno.cn/article/mysql%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E9%87%8D%E5%A4%8D%E7%9A%84%E5%80%BC/","tags":[],"title":"MysqlæŸ¥è¯¢å¤šä¸ªå­—æ®µé‡å¤çš„å€¼"},{"categories":["PHP"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†PHPçš„pcntl_forkå‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå­è¿›ç¨‹çš„å‡½æ•°ã€‚æ–‡ç« è¯¦ç»†è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å…¶ç”¨æ³•ã€‚æ–‡ç« è¿˜è¿›è¡Œäº†ä¸€ä¸ªå®éªŒï¼Œæµ‹è¯•äº†åœ¨åˆ›å»ºå­è¿›ç¨‹åï¼Œæ˜¯çˆ¶è¿›ç¨‹å…ˆæ‰§è¡Œè¿˜æ˜¯å­è¿›ç¨‹å…ˆæ‰§è¡Œã€‚å®éªŒç»“æœæ˜¾ç¤ºï¼Œpcntl_forkä¼šé¦–å…ˆæ‰§è¡Œçˆ¶è¿›ç¨‹çš„é€»è¾‘ï¼Œç„¶åå†æ‰§è¡Œå­è¿›ç¨‹çš„é€»è¾‘ã€‚\npcntl ç®€ä»‹ PHPçš„è¿›ç¨‹æ§åˆ¶æ”¯æŒå®ç°äº†Unixæ–¹å¼çš„è¿›ç¨‹åˆ›å»º, ç¨‹åºæ‰§è¡Œ, ä¿¡å·å¤„ç†ä»¥åŠè¿›ç¨‹çš„ä¸­æ–­ã€‚ è¿›ç¨‹æ§åˆ¶ä¸èƒ½è¢«åº”ç”¨åœ¨WebæœåŠ¡å™¨ç¯å¢ƒï¼Œå½“å…¶è¢«ç”¨äºWebæœåŠ¡ç¯å¢ƒæ—¶å¯èƒ½ä¼šå¸¦æ¥æ„å¤–çš„ç»“æœã€‚\nè¿™ä»½æ–‡æ¡£ç”¨äºé˜è¿°æ¯ä¸ªè¿›ç¨‹æ§åˆ¶å‡½æ•°çš„é€šå¸¸ç”¨æ³•ã€‚å…³äºUnixè¿›ç¨‹æ§åˆ¶çš„æ›´å¤šä¿¡æ¯å»ºè®®æ‚¨æŸ¥é˜… ç³»ç»Ÿæ–‡æ¡£ä¸­å…³äºforkï¼ˆ2ï¼‰,waitpidï¼ˆ2ï¼‰ï¼Œsignalï¼ˆ2ï¼‰ç­‰çš„éƒ¨åˆ†æˆ–æ›´å…¨é¢çš„å‚è€ƒèµ„æ–™æ¯”å¦‚ ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ï¼ˆä½œè€…ï¼šW. Richard Stevensï¼ŒAddison-Wesleyå‡ºç‰ˆï¼‰ã€‚\nPCNTLç°åœ¨ä½¿ç”¨äº†ticksä½œä¸ºä¿¡å·å¤„ç†çš„å›è°ƒæœºåˆ¶ï¼Œticksåœ¨é€Ÿåº¦ä¸Šè¿œè¿œè¶…è¿‡äº†ä¹‹å‰çš„å¤„ç†æœºåˆ¶ã€‚ è¿™ä¸ªå˜åŒ–ä¸â€œç”¨æˆ·ticksâ€éµå¾ªäº†ç›¸åŒçš„è¯­ä¹‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨declare() è¯­å¥åœ¨ç¨‹åºä¸­æŒ‡å®šå…è®¸å‘ç”Ÿå›è°ƒçš„ä½ç½®ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯¹å¼‚æ­¥äº‹ä»¶å¤„ç†çš„å¼€é”€æœ€å°åŒ–ã€‚åœ¨ç¼–è¯‘PHPæ—¶ å¯ç”¨pcntlå°†å§‹ç»ˆæ‰¿æ‹…è¿™ç§å¼€é”€ï¼Œä¸è®ºæ‚¨çš„è„šæœ¬ä¸­æ˜¯å¦çœŸæ­£ä½¿ç”¨äº†pcntlã€‚\næœ‰ä¸€ä¸ªè°ƒæ•´æ˜¯PHP 4.3.0ä¹‹å‰çš„æ‰€æœ‰pcntlè„šæœ¬è¦ä½¿å…¶å·¥ä½œï¼Œè¦ä¹ˆåœ¨æœŸæœ›å…è®¸å›è°ƒçš„ï¼ˆä»£ç ï¼‰éƒ¨åˆ†ä½¿ç”¨ declare() ï¼Œè¦ä¹ˆä½¿ç”¨declare()æ–°çš„å…¨å±€è¯­æ³• ä½¿å…¶åœ¨æ•´ä¸ªè„šæœ¬èŒƒå›´æœ‰æ•ˆã€‚\nNote: æ­¤æ‰©å±•åœ¨ Windows å¹³å°ä¸Šä¸å¯ç”¨ã€‚\npcntl_fork PHP 4 \u0026gt;= 4.1.0, PHP 5, PHP 7)\npcntl_fork â€” åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚è¯‘æ³¨ï¼šforkæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ éƒ½ä»forkçš„ä½ç½®å¼€å§‹å‘ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¸åŒçš„æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„forkè¿”å›å€¼ä¸ºå­è¿›ç¨‹ å·ï¼Œè€Œå­è¿›ç¨‹å¾—åˆ°çš„æ˜¯0ã€‚\nè¯´æ˜ int pcntl_fork ( void ) pcntl_fork()å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹ä»…PIDï¼ˆè¿›ç¨‹å·ï¼‰ å’ŒPPIDï¼ˆçˆ¶è¿›ç¨‹å·ï¼‰ä¸å…¶çˆ¶è¿›ç¨‹ä¸åŒã€‚forkæ€æ ·åœ¨æ‚¨çš„ç³»ç»Ÿå·¥ä½œçš„è¯¦ç»†ä¿¡æ¯è¯·æŸ¥é˜…æ‚¨çš„ç³»ç»Ÿ çš„forkï¼ˆ2ï¼‰æ‰‹å†Œã€‚\nè¿”å›å€¼ æˆåŠŸæ—¶ï¼Œåœ¨çˆ¶è¿›ç¨‹æ‰§è¡Œçº¿ç¨‹å†…è¿”å›äº§ç”Ÿçš„å­è¿›ç¨‹çš„PIDï¼Œåœ¨å­è¿›ç¨‹æ‰§è¡Œçº¿ç¨‹å†…è¿”å›0ã€‚å¤±è´¥æ—¶ï¼Œåœ¨ çˆ¶è¿›ç¨‹ä¸Šä¸‹æ–‡è¿”å›-1ï¼Œä¸ä¼šåˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶ä¸”ä¼šå¼•å‘ä¸€ä¸ªPHPé”™è¯¯ã€‚\nä»£ç  \u0026lt;?php /** * Created by PhpStorm. * User: Object * Date: 2018/6/11 * Time: 10:12 */ const NEWLINE = \u0026#34;\\n\\n\u0026#34;; if (strtolower(php_sapi_name()) != \u0026#39;cli\u0026#39;) { die(\u0026#34;è¯·åœ¨cliæ¨¡å¼ä¸‹è¿è¡Œ\u0026#34;); } echo \u0026#34;å½“å‰è¿›ç¨‹ï¼š\u0026#34; . getmypid() . NEWLINE; $pid = pcntl_fork(); //forkå‡ºå­è¿›ç¨‹ //forkåçˆ¶è¿›ç¨‹ä¼šèµ°è‡ªå·±çš„é€»è¾‘ï¼Œå­è¿›ç¨‹ä»å¤„å¼€å§‹èµ°è‡ªå·±çš„é€»è¾‘ï¼Œå †æ ˆä¿¡æ¯ä¼šå®Œå…¨å¤åˆ¶ç»™å­è¿›ç¨‹å†…å­˜ç©ºé—´ï¼Œçˆ¶å­è¿›ç¨‹ç›¸äº’ç‹¬ç«‹ if ($pid == -1) { // åˆ›å»ºé”™è¯¯ï¼Œè¿”å›-1 die(\u0026#39;è¿›ç¨‹forkå¤±è´¥\u0026#39;); } else if ($pid) { // $pid \u0026gt; 0, å¦‚æœforkæˆåŠŸï¼Œè¿”å›å­è¿›ç¨‹id // çˆ¶è¿›ç¨‹é€»è¾‘ $time = microtime(true); echo \u0026#34;æˆ‘æ˜¯çˆ¶è¿›ç¨‹:{$time}\u0026#34;.NEWLINE; } else { // $pid = 0 // å­è¿›ç¨‹é€»è¾‘ $time = microtime(true); echo \u0026#34;æˆ‘æ˜¯å­è¿›ç¨‹:{$time}\u0026#34;.NEWLINE; } æ‰§è¡Œç»“æœ å½“å‰è¿›ç¨‹ï¼š17472\næˆ‘æ˜¯çˆ¶è¿›ç¨‹:1528697500.2961\næˆ‘æ˜¯å­è¿›ç¨‹:1528697500.2961\nforkåä¼šå­è¿›ç¨‹å…ˆæ‰§è¡Œè¿˜æ˜¯çˆ¶è¿›ç¨‹å…ˆæ‰§è¡Œé€»è¾‘å‘¢ï¼Ÿ\næµ‹è¯•ä»£ç  æ­¤å¤„æˆ‘ä»¬è°ƒæ¢ä¸Šé¢ä»£ç çš„çˆ¶å­è¿›ç¨‹çš„ifé¡ºåº\nif ($pid == -1) { // åˆ›å»ºé”™è¯¯ï¼Œè¿”å›-1 die(\u0026#39;è¿›ç¨‹forkå¤±è´¥\u0026#39;); } else if (!$pid) { // $pid = 0 // å­è¿›ç¨‹é€»è¾‘ $time = microtime(true); echo \u0026#34;æˆ‘æ˜¯å­è¿›ç¨‹:{$time}\u0026#34;.NEWLINE; } else if ($pid) { // $pid \u0026gt; 0, å¦‚æœforkæˆåŠŸï¼Œè¿”å›å­è¿›ç¨‹id // çˆ¶è¿›ç¨‹é€»è¾‘ $time = microtime(true); echo \u0026#34;æˆ‘æ˜¯çˆ¶è¿›ç¨‹:{$time}\u0026#34;.NEWLINE; } æ‰§è¡Œç»“æœ å½“å‰è¿›ç¨‹ï¼š17472\næˆ‘æ˜¯çˆ¶è¿›ç¨‹:1528697500.2961\næˆ‘æ˜¯å­è¿›ç¨‹:1528697500.2961\næµ‹è¯•æ€»ç»“ forké¦–å…ˆä¼šæ‰§è¡Œçˆ¶è¿›ç¨‹é€»è¾‘å†æ‰§è¡Œå­è¿›ç¨‹é€»è¾‘\n","permalink":"https://www.iarno.cn/article/pcntl-fork-%E5%A4%9A%E8%BF%9B%E7%A8%8B/","tags":["pcntl_fork"],"title":"pcntl_fork å¤šè¿›ç¨‹"},{"categories":["PHP"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†PHPå†…å®¹ç¼“å­˜Yacçš„åŸºæœ¬ä½¿ç”¨å’Œå®‰è£…æ–¹æ³•ã€‚Yacæ˜¯ä¸€ä¸ªåŸºäºå…±äº«å†…å­˜ï¼Œæ— é”çš„å†…å®¹ç¼“å­˜ï¼Œä¸»è¦åº”ç”¨äºè®©PHPè¿›ç¨‹ä¹‹é—´å…±äº«ä¸€äº›ç®€å•çš„æ•°æ®å’Œé«˜æ•ˆåœ°ç¼“å­˜ä¸€äº›é¡µé¢ç»“æœã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä¸‹è½½å’Œå®‰è£…Yacï¼Œä»¥åŠå¦‚ä½•åœ¨php.iniä¸­è¿›è¡Œé…ç½®ã€‚åŒæ—¶ï¼Œæ–‡ç« ä¹Ÿåˆ—å‡ºäº†ä½¿ç”¨Yacçš„ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ç¼“å­˜çš„é”®é•¿åº¦ä¸è¶…è¿‡48å­—èŠ‚ï¼Œç¼“å­˜å€¼ä¸èƒ½è¶…è¿‡60å…†å­—èŠ‚ç­‰ã€‚æœ€åï¼Œæ–‡ç« é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨PHPä¸­ä½¿ç”¨Yacè¿›è¡Œæ•°æ®çš„å­˜å–ã€‚\nYac æ˜¯ä¸ºPHPå®ç°çš„ä¸€ä¸ªåŸºäºå…±äº«å†…å­˜, æ— é”çš„å†…å®¹Cache\nYacçš„ä¸¤ä¸ªåº”ç”¨åœºæ™¯: è®©PHPè¿›ç¨‹ä¹‹é—´å…±äº«ä¸€äº›ç®€å•çš„æ•°æ® é«˜æ•ˆåœ°ç¼“å­˜ä¸€äº›é¡µé¢ç»“æœ å®‰è£…ï¼š wget https://github.com/laruence/yac/archive/master.zip unzip master.zip cd yac-master/ phpize ./configure --prefix=/usr/local/yac --with-php-config=/usr/local/php/bin/php-config sudo make \u0026amp;\u0026amp; make install é…ç½®php.ini,æ·»åŠ å¦‚ä¸‹ä»£ç : extension=yac.so yac.enable = 1 yac.keys_memory_size = 4M yac.values_memory_size = 64M yac.compress_threshold = -1 yac.enable_cli = 0 é™åˆ¶ï¼š ç¼“å­˜çš„é”®é•¿åº¦ä¸è¶…è¿‡ 48 å­—èŠ‚\nç¼“å­˜å€¼ä¸èƒ½è¶…è¿‡ 60 å…†å­—èŠ‚\nå‹ç¼©åçš„ç¼“å­˜å€¼ä¸èƒ½è¶…è¿‡ 1M\næŸ¥çœ‹phpé…ç½®php -m\né‡å¯phpservice php-fpm restart\näº‹ä¾‹: \u0026lt;?php $set = $yac = new Yac(); $yac-\u0026gt;set(\u0026#39;key\u0026#39;,\u0026#39;123\u0026#39;); $key = $yac-\u0026gt;get(\u0026#39;key\u0026#39;); var_dump($key); ","permalink":"https://www.iarno.cn/article/php%E5%86%85%E5%AE%B9%E7%BC%93%E5%AD%98yac/","tags":["yac","æœ¬åœ°ç¼“å­˜"],"title":"PHPå†…å®¹ç¼“å­˜Yac"},{"categories":["Go"],"contents":"æœ€è¿‘åœ¨é¼“æ£golangå®ˆæŠ¤è¿›ç¨‹çš„å®ç°ï¼Œæ— æ„å‘ç°äº†supervisorè¿™ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿ã€‚supervisoræ˜¯ä¸€ä¸ªunixçš„ç³»ç»Ÿè¿›ç¨‹ç®¡ç†è½¯ä»¶ï¼Œå¯ä»¥ç”¨å®ƒæ¥ç®¡ç†apacheã€nginxç­‰æœåŠ¡ï¼Œè‹¥æœåŠ¡æŒ‚äº†å¯ä»¥è®©å®ƒä»¬è‡ªåŠ¨é‡å¯ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°golangçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä¸‹é¢æè¿°ä¸‹å…·ä½“å®ç°ã€‚\nå®‰è£…supervisor åŸºäºcentos 6.4ã€‚\nsupervisorä½¿ç”¨pythonç¼–å†™çš„ï¼Œå¯ä»¥ç”¨easy_installå®‰è£…ã€‚centosä¸Šé»˜è®¤æœ‰pythonçš„è¿è¡Œç¯å¢ƒï¼Œå®‰è£…èµ·æ¥å°±éå¸¸ç®€å•äº†ã€‚\n$ sudo yum install python-setuptools $ sudo easy_install supervisor å¦‚æœæ²¡æœ‰çœ‹åˆ°ä»€ä¹ˆæŠ¥é”™ï¼Œé‚£ä¹ˆå°±å®‰è£…æˆåŠŸäº†ï¼Œå¯ä»¥ä½¿ç”¨echo_supervisord_confæŸ¥çœ‹é…ç½®è¯¦æƒ…ï¼Œè€Œåç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚\n$ sudo echo_supervisord_conf \u0026gt; /etc/supervisord.conf golang httpæœåŠ¡ å…ˆæ•´ä¸€ä¸ªç®€å•çš„golang httpæœåŠ¡\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; ) func main() { http.HandleFunc(\u0026#34;/\u0026#34;, func(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, \u0026#34;Hello world\u0026#34;) }) err := http.ListenAndServe(\u0026#34;:9090\u0026#34;, nil) if err != nil { log.Fatal(\u0026#34;ListenAndServe: \u0026#34;, err) } } ç›´æ¥è¿è¡Œè¿™ä¸ªç¨‹åºä¼šå ç”¨ä½ç»ˆç«¯ï¼Œä¸‹é¢çœ‹çœ‹å¦‚ä½•ç”¨supervisoræ¥è·‘è¿™ä¸ªç¨‹åºã€‚\nsupervisoré…ç½®golang ç¼–è¾‘/etc/supervisord.confï¼Œåœ¨æœ€åå¢åŠ è¿è¡Œç¨‹åºè®¾ç½®\n[program:golang-http-server] command=/home/golang/simple_http_server //å¿…é¡»æŒ‡åˆ°binæ–‡ä»¶ autostart=true autorestart=true startsecs=10 stdout_logfile=/var/log/simple_http_server.log stdout_logfile_maxbytes=1MB stdout_logfile_backups=10 stdout_capture_maxbytes=1MB stderr_logfile=/var/log/simple_http_server.log stderr_logfile_maxbytes=1MB stderr_logfile_backups=10 stderr_capture_maxbytes=1MB å‡ ä¸ªé…ç½®è¯´æ˜ï¼š\ncommandï¼šè¡¨ç¤ºè¿è¡Œçš„å‘½ä»¤ï¼Œå¡«å…¥å®Œæ•´çš„è·¯å¾„å³å¯ã€‚\nautostartï¼šè¡¨ç¤ºæ˜¯å¦è·Ÿéšsupervisorä¸€èµ·å¯åŠ¨ã€‚\nautorestartï¼šå¦‚æœè¯¥ç¨‹åºæŒ‚äº†ï¼Œæ˜¯å¦é‡æ–°å¯åŠ¨ã€‚\nstdout_logfileï¼šç»ˆç«¯æ ‡å‡†è¾“å‡ºé‡å®šå‘æ–‡ä»¶ã€‚\nstderr_logfileï¼šç»ˆç«¯é”™è¯¯è¾“å‡ºé‡å®šå‘æ–‡ä»¶ã€‚\nå…¶ä½™é…ç½®è¯´æ˜å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚\nå¯åŠ¨supervisor $ sudo /usr/bin/supervisord -c /etc/supervisord.conf å¦‚æœå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—è¿›è¡Œåˆ†æï¼Œæ—¥å¿—æ–‡ä»¶è·¯å¾„/tmp/supervisord.log\ntipsï¼šå¦‚æœä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”¨kill -HUPé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶\n$ cat /tmp/supervisord.pid | xargs sudo kill -HUP è¡¥å……ï¼š\n#æ ¹æ®æœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨æ–°é…ç½®æˆ–æœ‰æ”¹åŠ¨çš„è¿›ç¨‹ï¼Œé…ç½®æ²¡æœ‰æ”¹åŠ¨çš„è¿›ç¨‹ä¸ä¼šå—å½±å“è€Œé‡å¯ã€‚ supervisorctl update #å¯åŠ¨è¿›ç¨‹ supervisorctl start test #é‡å¯è¿›ç¨‹ supervisorctl restart test #åœæ­¢è¿›ç¨‹ supervisorctl stop test æŸ¥çœ‹supervisorè¿è¡ŒçŠ¶æ€ $ supervisorctl golang-http-server RUNNING pid 23307, uptime 0:02:55 supervisor\u0026gt; è¾“å…¥helpå¯ä»¥æŸ¥çœ‹å¸®åŠ© supervisor\u0026gt; help default commands (type help ): ===================================== add clear fg open quit remove restart start stop update avail exit maintail pid reload reread shutdown status tail version supervisorè¿è¡ŒåŸç† supervisorè¿è¡Œåæœ¬èº«æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Œé€šè¿‡è‡ªèº«æ¥ç®¡ç†ç›¸åº”çš„å­è¿›ç¨‹ï¼Œé€šè¿‡è§‚å¯Ÿç›¸åº”çš„è¿›ç¨‹çŠ¶æ€å°±å¾ˆæ˜äº†äº†ã€‚\n$ ps -ef | grep supervisord root 23306 1 0 07:30 ? 00:00:00 /usr/bin/python /usr/bin/supervisord -c /etc/supervisord.conf root 23331 23222 0 07:41 pts/0 00:00:00 grep supervisord $ ps -ef | grep simple_http_server root 23307 23306 0 07:30 ? 00:00:00 /home/golang/simple_http_server root 23333 23222 0 07:41 pts/0 00:00:00 grep simple_http_server å¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºgolang simple_http_serverè¿›ç¨‹æ˜¯supervisordçš„å­è¿›ç¨‹ã€‚\nsupervisoræ˜¯å¦é è°± supervisorçš„è¯ç”Ÿå·²ç»10å¹´äº†ï¼Œç°åœ¨æ˜¯3+ç‰ˆæœ¬ï¼Œæ‰€ä»¥æ”¾å¿ƒä½¿ç”¨å§ã€‚\nå‚è€ƒ supervisorå®˜ç½‘ï¼šhttp://supervisord.org/\nè½¬è‡ª supervisorè¿è¡Œgolangå®ˆæŠ¤è¿›ç¨‹\nsupervisorç®¡ç†golangç¨‹åº\n","permalink":"https://www.iarno.cn/article/supervisor%E7%AE%A1%E7%90%86golang%E7%A8%8B%E5%BA%8F/","tags":["è¿›ç¨‹ç®¡ç†"],"title":"supervisorç®¡ç†golangç¨‹åº"},{"categories":["Mysql"],"contents":"æœ¬æ–‡ä¸»è¦ä»‹ç»äº†MySQLä¸­utf8_binå’Œutf8_general_ciä¸¤ç§ç¼–ç æ ¼å¼çš„åŒºåˆ«ã€‚utf8_binç¼–ç å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ç”¨äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚è€Œutf8_general_ciç¼–ç åˆ™ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ˜¯utf8çš„é»˜è®¤ç¼–ç ã€‚é€šè¿‡å®ä¾‹æ¼”ç¤ºäº†åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¸¤ç§ç¼–ç æ–¹å¼å¯¹å¤§å°å†™çš„å¤„ç†å·®å¼‚ã€‚å› æ­¤ï¼Œåœ¨é€‰æ‹©ç¼–ç æ—¶ï¼Œåº”æ³¨æ„è¿™ç§åŒºåˆ«ã€‚\nMySQLä¸­å­˜åœ¨å¤šç§æ ¼å¼çš„utf8ç¼–ç ï¼Œå…¶ä¸­æœ€å¸¸è§çš„ä¸¤ç§ä¸ºï¼š\nutf8_bin å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ç”¨äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ï¼ŒåŒºåˆ†å¤§å°å†™; utf8_genera_ci ä¸åŒºåˆ†å¤§å°å†™ï¼Œciä¸ºcase insensitiveçš„ç¼©å†™ï¼Œå³å¤§å°å†™ä¸æ•æ„Ÿï¼Œä¸ºutf8é»˜è®¤ç¼–ç ã€‚\nç¤ºä¾‹ï¼š CREATE TABLE `t_bin` ( `id` int(11) DEFAULT NULL, `name` varchar(20) DEFAULT NULL, UNIQUE KEY `uk_name` (`name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_binï¼› CREATE TABLE `t_ci` ( `id` int(11) DEFAULT NULL, `name` varchar(20) DEFAULT NULL, UNIQUE KEY `uk_name` (`name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci; CREATE TABLE `t_default` ( `id` int(11) DEFAULT NULL, `name` varchar(20) DEFAULT NULL, UNIQUE KEY `uk_name` (`name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼š insert into t_bin values (1, \u0026#39;Alex\u0026#39;); insert into t_bin values (2, \u0026#39;alex\u0026#39;); insert into t_ci values (1, \u0026#39;Alex\u0026#39;); insert into t_ci values (2, \u0026#39;alex\u0026#39;); insert into t_default values (1, \u0026#39;Alex\u0026#39;); insert into t_default values (2, \u0026#39;alex\u0026#39;); ç»“æœå¦‚ä¸‹ï¼š root@zow 11:13:44\u0026gt;insert into t_bin values (1, \u0026#39;Alex\u0026#39;); Query OK, 1 row affected (0.01 sec) root@zow 11:14:14\u0026gt;insert into t_bin values (2, \u0026#39;alex\u0026#39;); Query OK, 1 row affected (0.01 sec) root@zow 11:14:17\u0026gt;insert into t_ci values (1, \u0026#39;Alex\u0026#39;); Query OK, 1 row affected (0.00 sec) root@zow 11:14:32\u0026gt;insert into t_ci values (2, \u0026#39;alex\u0026#39;); ERROR 1062 (23000): Duplicate entry \u0026#39;alex\u0026#39; for key \u0026#39;uk_name\u0026#39; root@zow 11:14:36\u0026gt;insert into t_default values (1, \u0026#39;Alex\u0026#39;); Query OK, 1 row affected (0.01 sec) root@zow 11:14:50\u0026gt;insert into t_default values (2, \u0026#39;alex\u0026#39;); ERROR 1062 (23000): Duplicate entry \u0026#39;alex\u0026#39; for key \u0026#39;uk_name\u0026#39; åˆ†æï¼š ç¼–ç ä¸ºutf8_binæ—¶ï¼ŒAlexå’Œalexè¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„å€¼ï¼ŒåŒºåˆ†å¤§å°å†™ï¼›\nç¼–ç ä¸ºutf8_general_ciæ—¶ï¼Œå³é»˜è®¤çš„ç¼–ç æ—¶ï¼ŒAlexå’Œalexè¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„å€¼ï¼Œä¸åŒºåˆ†å¤§å°å†™ã€‚\næ‰€ä»¥åœ¨é€‰æ‹©ç¼–ç çš„æ—¶å€™åº”è¯¥æ³¨æ„åŒºåˆ†ã€‚\n","permalink":"https://www.iarno.cn/article/utf8-bin%E5%92%8Cutf8-general-ci%E7%BC%96%E7%A0%81%E7%9A%84%E5%8C%BA%E5%88%AB/","tags":["ç¼–ç "],"title":"utf8_binå’Œutf8_general_ciç¼–ç çš„åŒºåˆ«"},{"categories":["Mysql"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•åˆ†æMySQLçš„Binlogæ—¥å¿—ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤mysqlbinlogå‘½ä»¤æ˜¯å¦å­˜åœ¨ã€‚ç„¶åï¼Œæ–‡ç« æä¾›äº†å‡ ç§ä¸åŒçš„å‘½ä»¤æ¥è§£æBinlogæ—¥å¿—ï¼ŒåŒ…æ‹¬å…¨é‡è§£æã€æŒ‰æ—¶é—´èŒƒå›´è§£æã€åªè§£ææŸä¸ªæ•°æ®åº“å’Œåªè§£ææŸä¸ªbinlogæ–‡ä»¶ã€‚æœ€åï¼Œæ–‡ç« è§£é‡Šäº†åœ¨è§£æè¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å¯èƒ½æ˜¯ç”±äºMySQLç‰ˆæœ¬é—®é¢˜é€ æˆçš„ï¼Œå»ºè®®ä½¿ç”¨é«˜äº5.6ç‰ˆæœ¬çš„MySQLè¿›è¡Œåˆ†æã€‚\nç›¸å…³å‘½ä»¤ åˆ†æMysqlçš„Binlogæ—¥å¿—ï¼ŒæŒ‰æ—¶é—´ç»´åº¦æŸ¥è¯¢mysqlæ“ä½œè®°å½•ã€‚\n#æŸ¥çœ‹mysqlbinlogå‘½ä»¤æ˜¯å¦å­˜åœ¨ \u0026gt;mysqlbinlog mysqlbinlog Ver 3.3 for Linux at x86_64 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Dumps a MySQL binary log in a format usable for viewing or for piping to the mysql command line client. #å…¨é‡è§£æ ./mysqlbinlog --base64-output=\u0026#39;DECODE-ROWS\u0026#39; --verbose *-binlog.000* \u0026gt;\u0026gt; xxxx.sql #æŒ‰æ—¶é—´èŒƒå›´è§£æ ./mysqlbinlog --base64-output=\u0026#39;DECODE-ROWS\u0026#39; --verbose --start-datetime=\u0026#39;2016-05-20 10:00:00\u0026#39; --stop-datetime=\u0026#39;2016-05-20 12:00:00\u0026#39; *-binlog.0008* \u0026gt;\u0026gt; xxxx.sql #åªè§£ææŸä¸ªæ•°æ®åº“ ./mysqlbinlog --base64-output=\u0026#39;DECODE-ROWS\u0026#39; --verbose --database=databasename *-binlog.000* \u0026gt;\u0026gt; xxxx.sql #åªè§£ææŸä¸ªbinlogæ–‡ä»¶ ./mysqlbinlog --base64-output=\u0026#39;DECODE-ROWS\u0026#39; --verbose 3306-binlog.000001 \u0026gt;\u0026gt; xxxx.sql é—®é¢˜ æŠ¥é”™å†…å®¹ ERROR: Error in Log_event::read_log_event(): \u0026#39;Found invalid event in binary log\u0026#39;, data_len: 31, event_type: 35 ERROR: Could not read entry at offset 120: Error in log format or read error. åŸå›  è¿™æ˜¯å› ä¸ºMysqlç‰ˆæœ¬é—®é¢˜é€ æˆçš„ï¼Œè¯·é€‰æ‹©é«˜äº5.6ç‰ˆæœ¬çš„Mysqlè¿›è¡Œåˆ†æã€‚\n","permalink":"https://www.iarno.cn/article/%E5%88%86%E6%9E%90mysql-binlog-%E6%97%A5%E5%BF%97/","tags":["binlog"],"title":"åˆ†æMysql Binlog æ—¥å¿—"},{"categories":["å…¶ä»–"],"contents":"è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•å°†åšå®¢å¯¼æµåˆ°å¾®ä¿¡å…¬ä¼—å·ã€‚ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€æ­¥æ˜¯åœ¨å¾®ä¿¡å…¬ä¼—å·è®¾ç½®å…³é”®è¯å›å¤ï¼Œç¬¬äºŒæ­¥æ˜¯åœ¨åšå®¢æ–‡ç« é¡µé¢æœ«å°¾å¢åŠ ç‰¹å®šçš„jsä»£ç ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©åšå®¢è‡ªç„¶å¢é•¿ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æé«˜å¾®ä¿¡å…¬ä¼—å·çš„ç²‰ä¸æ•°é‡ã€‚\nä½¿ç”¨æŒ‡å— ä¸‹é¢æ‚¨åªéœ€è¦åœ¨å…¬ä¼—å·å’Œåšå®¢ä¸­åšå¦‚ä¸‹è®¾ç½®ï¼Œç„¶åå°±ç­‰ç€æ¥è‡ªåšå®¢çš„è‡ªç„¶å¢é•¿å§ï¼\nç¬¬ä¸€æ­¥ï¼šå…¬ä¼—å·è®¾ç½® ç™»å½•è¦å¢ç²‰çš„å¾®ä¿¡å…¬ä¼—å·ï¼ŒæŒ‰å¦‚ä¸‹è§„åˆ™è®¾ç½®å…³é”®è¯å›å¤\nå…³é”®è¯ï¼Œè®¾ç½®ä¸ºï¼švip å›å¤å†…å®¹ï¼Œè®¾ç½®ä¸ºå¦‚ä¸‹æ–‡æœ¬å†…å®¹ï¼š \u0026lt;a href=\u0026#34;https://my.openwrite.cn/code/generate?blogId=21839-1591198660133-778\u0026#34;\u0026gt;ç‚¹å‡»è¯¥é“¾æ¥ï¼Œè·å–åšå®¢è§£é”éªŒè¯ç \u0026lt;/a\u0026gt; ç¬¬äºŒæ­¥ï¼šåšå®¢è®¾ç½® åœ¨æ‚¨åšå®¢çš„æ–‡ç« é¡µé¢çš„æœ«å°¾ï¼Œå¢åŠ å¦‚ä¸‹jsä»£ç ã€‚\n\u0026lt;script src=\u0026#34;https://my.openwrite.cn/js/readmore.js\u0026#34; type=\u0026#34;text/javascript\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; document.getElementsByClassName(\u0026#39;article-container\u0026#39;)[0].setAttribute(\u0026#34;id\u0026#34;,\u0026#34;container\u0026#34;) const btw = new BTWPlugin(); btw.init({ id: \u0026#39;container\u0026#39;, blogId: \u0026#39;21839-1603629348090-282\u0026#39;, name: \u0026#39;åŠªåŠ›å‡çº§ä¸­\u0026#39;, qrcode: \u0026#39;https://i.loli.net/2020/10/25/fVQpdYESFXjGBmo.png\u0026#39;, keyword: \u0026#39;éªŒè¯ç \u0026#39;, }); \u0026lt;/script\u0026gt; å…¶ä¸­idä¸­è®¾ç½®çš„containeréœ€è¦ç”¨æˆ·æ ¹æ®æ–‡ç« é¡µé¢ä¸­çš„æ–‡ç« å®¹å™¨æ¥è°ƒæ•´ï¼Œæˆ–è€…ç›´æ¥å°†æ–‡ç« æœ€å¤–é¢çš„å®¹å™¨è®¾ç½®ä¸ºè¯¥idã€‚\nOpenWrite æœ¬ç¯‡æ–‡ç« å·²ä½¿ç”¨\nåšå®¢ç¾¤å‘åŠ©æ‰‹(https://openwrite.cn/)\nReadMore(https://openwrite.cn/openwrite/openwrite-readmore/)\nå‚è€ƒåœ°å€ https://my.openwrite.cn/user/blog2weixin/list\n","permalink":"https://www.iarno.cn/article/%E5%8D%9A%E5%AE%A2%E5%AF%BC%E6%B5%81%E5%85%AC%E4%BC%97%E5%8F%B7/","tags":[],"title":"åšå®¢å¯¼æµå…¬ä¼—å·"},{"categories":["PHP"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦è®¨è®ºäº†è·¨åŸŸçš„æ¦‚å¿µã€åŒæºç­–ç•¥åŠå…¶é™åˆ¶ï¼Œä»¥åŠå¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Œç„¶åä»‹ç»äº†åŒæºç­–ç•¥åŠå…¶å¯¹Cookieã€LocalStorageã€IndexedDBç­‰å­˜å‚¨æ€§å†…å®¹ã€DOMèŠ‚ç‚¹å’ŒAJAXè¯·æ±‚çš„é™åˆ¶ã€‚æœ€åï¼Œæ–‡ç« è¯¦ç»†ä»‹ç»äº†CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰çš„åŸç†å’Œä¼˜ç¼ºç‚¹ï¼Œå¹¶æä¾›äº†PHPä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ CORSå¤´éƒ¨å’ŒéªŒè¯Refererä»¥é˜²æ­¢CSRFæ”»å‡»ã€‚\nä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸ urlçš„ç»„æˆ JavaScriptå‡ºäºå®‰å…¨æ–¹é¢çš„è€ƒè™‘ï¼Œä¸å…è®¸è·¨åŸŸè°ƒç”¨å…¶ä»–é¡µé¢çš„å¯¹è±¡ã€‚é‚£ä»€ä¹ˆæ˜¯è·¨åŸŸå‘¢ï¼Œç®€å•åœ°ç†è§£å°±æ˜¯å› ä¸ºJavaScriptåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œa.comåŸŸåä¸‹çš„jsæ— æ³•æ“ä½œb.comæˆ–æ˜¯c.a.comåŸŸåä¸‹çš„å¯¹è±¡ã€‚\nå½“åè®®ã€å­åŸŸåã€ä¸»åŸŸåã€ç«¯å£å·ä¸­ä»»æ„ä¸€ä¸ªä¸ç›¸åŒæ—¶ï¼Œéƒ½ç®—ä½œä¸åŒåŸŸã€‚ä¸åŒåŸŸä¹‹é—´ç›¸äº’è¯·æ±‚èµ„æºï¼Œå°±ç®—ä½œâ€œè·¨åŸŸâ€ã€‚ ä¾‹å¦‚ï¼šhttp://www.abc.com/index.html è¯·æ±‚ http://www.efg.com/service.phpã€‚\næœ‰ä¸€ç‚¹å¿…é¡»è¦æ³¨æ„ï¼šè·¨åŸŸå¹¶ä¸æ˜¯è¯·æ±‚å‘ä¸å‡ºå»ï¼Œè¯·æ±‚èƒ½å‘å‡ºå»ï¼ŒæœåŠ¡ç«¯èƒ½æ”¶åˆ°è¯·æ±‚å¹¶æ­£å¸¸è¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº†ã€‚ä¹‹æ‰€ä»¥ä¼šè·¨åŸŸï¼Œæ˜¯å› ä¸ºå—åˆ°äº†åŒæºç­–ç•¥çš„é™åˆ¶ï¼ŒåŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œå³åè®®ã€åŸŸåã€ç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ã€‚\nå¤§å®¶å¯ä»¥å‚ç…§ä¸‹å›¾ï¼Œæœ‰åŠ©äºæ·±å…¥ç†è§£è·¨åŸŸã€‚ ç‰¹åˆ«è¯´æ˜ä¸¤ç‚¹ï¼š ç¬¬ä¸€ï¼šå¦‚æœæ˜¯åè®®å’Œç«¯å£é€ æˆçš„è·¨åŸŸé—®é¢˜â€œå‰å°â€æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚\nç¬¬äºŒï¼šåœ¨è·¨åŸŸé—®é¢˜ä¸Šï¼ŒåŸŸä»…ä»…æ˜¯é€šè¿‡â€œURLçš„é¦–éƒ¨â€æ¥è¯†åˆ«è€Œä¸ä¼šæ ¹æ®åŸŸåå¯¹åº”çš„IPåœ°å€æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­ã€‚â€œURLçš„é¦–éƒ¨â€å¯ä»¥ç†è§£ä¸ºâ€œåè®®, åŸŸåå’Œç«¯å£å¿…é¡»åŒ¹é…â€ã€‚\näºŒã€ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥åŠå…¶é™åˆ¶ åŒæºç­–ç•¥é™åˆ¶ä»ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å…³é”®çš„å®‰å…¨æœºåˆ¶ã€‚å®ƒçš„å­˜åœ¨å¯ä»¥ä¿æŠ¤ç”¨æˆ·éšç§ä¿¡æ¯ï¼Œé˜²æ­¢èº«ä»½ä¼ªé€ ç­‰(è¯»å–Cookie)ã€‚\nåŒæºç­–ç•¥é™åˆ¶å†…å®¹æœ‰ï¼š Cookieã€LocalStorageã€IndexedDB ç­‰å­˜å‚¨æ€§å†…å®¹\nDOM èŠ‚ç‚¹\nAJAX è¯·æ±‚ä¸èƒ½å‘é€\nä½†æ˜¯æœ‰ä¸‰ä¸ªæ ‡ç­¾æ˜¯å…è®¸è·¨åŸŸåŠ è½½èµ„æºï¼š 1.\u0026lt;img src=XXX\u0026gt; 2.\u0026lt;link href=XXX\u0026gt; 3.\u0026lt;script src=XXX\u0026gt; æ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºä¸‹æœ‰å“ªäº›å¤„ç†è·¨åŸŸçš„æ–¹æ³•ã€‚ä½†æ‰€æœ‰çš„è·¨åŸŸéƒ½å¿…é¡»ç»è¿‡ä¿¡æ¯æä¾›æ–¹çš„å…è®¸ã€‚å¦‚æœæœªç»å…è®¸å³å¯è·å–ï¼Œé‚£æ˜¯æµè§ˆå™¨åŒæºç­–ç•¥å‡ºç°æ¼æ´ã€‚\nå¤„ç†è·¨åŸŸæ–¹æ³•â€”â€”CORS 1.CORSåŸç† æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚\n2.CORSä¼˜ç¼ºç‚¹ CORSè¦æ±‚æµè§ˆå™¨(\u0026gt;IE10)å’ŒæœåŠ¡å™¨çš„åŒæ—¶æ”¯æŒï¼Œæ˜¯è·¨åŸŸçš„æ ¹æœ¬è§£å†³æ–¹æ³•ï¼Œç”±æµè§ˆå™¨è‡ªåŠ¨å®Œæˆã€‚ ä¼˜ç‚¹åœ¨äºåŠŸèƒ½æ›´åŠ å¼ºå¤§æ”¯æŒå„ç§HTTP Methodï¼Œç¼ºç‚¹æ˜¯å…¼å®¹æ€§ä¸å¦‚JSONPã€‚ åªéœ€è¦åœ¨æœåŠ¡å™¨ç«¯åšä¸€äº›å°å°çš„æ”¹é€ å³å¯ï¼š\n/** * éªŒè¯Referï¼Œå…è®¸è·¨åŸŸè®¿é—® * @param mixed $whiteHostList ç™½åå•åŸŸåæˆ–ip */ public static function addCrosHeader($whiteHostList = array()) { if (!isset($_SERVER[\u0026#39;HTTP_REFERER\u0026#39;])) { return; } $origin = parse_url($_SERVER[\u0026#39;HTTP_REFERER\u0026#39;], PHP_URL_HOST); if (in_array($origin, $whiteHostList)) { header(\u0026#34;Access-Control-Allow-Origin: \u0026#34;.\u0026#34;https://\u0026#34;.$origin); // header(\u0026#34;Access-Control-Allow-Origin: \u0026#34;.\u0026#34;http://\u0026#34;.$origin.\u0026#34;:8081\u0026#34;); header(\u0026#39;Access-Control-Allow-Credentials: true\u0026#39;); // è·¨åŸŸcookieç”Ÿæ•ˆå¿…å¤‡ header(\u0026#39;Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS\u0026#39;); header(\u0026#39;Access-Control-Allow-Headers: X-Requested-With,X_Requested_With,Content-Type\u0026#39;); header(\u0026#39;P3P: CP=\u0026#34;CAO PSA OUR\u0026#34;\u0026#39;); } return; } éªŒè¯Referé˜²æ­¢Referæ”»å‡» /** * éªŒè¯Referï¼Œé˜²èŒƒcsrfæ”»å‡» * @param mixed $whiteHostList ç™½åå•åŸŸåæˆ–ip * @return boolean true/false */ public static function checkReferer($whiteHostList = array()) { $referer = isset($_SERVER[\u0026#39;HTTP_REFERER\u0026#39;]) ? $_SERVER[\u0026#39;HTTP_REFERER\u0026#39;] : false; if (empty($referer)) { return false; } // referer å¿…é¡»ä»¥ http æˆ– https å¼€å¤´ if (strpos($referer, \u0026#39;http://\u0026#39;) !== 0 \u0026amp;\u0026amp; strpos($referer, \u0026#39;https://\u0026#39;) !== 0) { return false; } // è®¾ç½®é»˜è®¤åŸŸå if (empty($whiteHostList)) { $whiteHostList = array( $_SERVER[\u0026#39;HTTP_HOST\u0026#39;] ); } elseif (is_string($whiteHostList)) { $whiteHostList = array( $whiteHostList ); } // refer ä¸»æœºåœ°å€åˆ¤æ–­ $refererHost = parse_url($referer, PHP_URL_HOST); if (is_array($whiteHostList) \u0026amp;\u0026amp; in_array($refererHost, $whiteHostList)) { return true; } else { return false; } } ","permalink":"https://www.iarno.cn/article/%E8%B7%A8%E5%9F%9F/","tags":["è·¨åŸŸ"],"title":"è·¨åŸŸ"},{"categories":["å…¶ä»–"],"contents":"æœ¬æ–‡æä¾›äº†åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šè®¾ç½®VPNæœåŠ¡å™¨çš„å…¨é¢æŒ‡å—ã€‚å®ƒæ¶µç›–äº†LinuxæœåŠ¡å™¨çš„åˆå§‹è®¾ç½®ï¼ŒIPsec VPNçš„å®‰è£…ï¼Œä»¥åŠä»iOSå’ŒMacè®¾å¤‡è¿æ¥åˆ°VPNçš„è¯¦ç»†è¯´æ˜ã€‚æ–‡ç« è¿˜æä¾›äº†æ•…éšœæ’é™¤é“¾æ¥å’Œè¿›ä¸€æ­¥é˜…è¯»çš„å‚è€ƒã€‚\nwget https://git.io/vpnsetup -O vpnsetup.sh \u0026amp;\u0026amp; sudo sh vpnsetup.sh å¦‚æœä½¿ç”¨ CentOSï¼Œè¯·å°†ä¸Šé¢çš„åœ°å€æ¢æˆ https://git.io/vpnsetup-centosã€‚\nä½ çš„ VPN ç™»å½•å‡­è¯å°†ä¼šè¢«è‡ªåŠ¨éšæœºç”Ÿæˆï¼Œå¹¶åœ¨å®‰è£…å®Œæˆåæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\nå¦‚éœ€äº†è§£å…¶å®ƒå®‰è£…é€‰é¡¹ï¼Œä»¥åŠå¦‚ä½•é…ç½® VPN å®¢æˆ·ç«¯ï¼Œè¯·ç»§ç»­é˜…è¯»ä»¥ä¸‹éƒ¨åˆ†ã€‚\nä¸€ä¸ªä¸“ç”¨æœåŠ¡å™¨æˆ–è€…è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ (VPS)ã€‚OpenVZ VPS ä¸å—æ”¯æŒã€‚\næ³¨ï¼šéœ€å¼€å¯udp 500å’Œ4500ç«¯å£\niosè¿æ¥ è¿›å…¥è®¾ç½® -\u0026gt; é€šç”¨ -\u0026gt; VPNã€‚ å•å‡» æ·»åŠ VPNé…ç½®\u0026hellip;ã€‚ å•å‡» ç±»å‹ ã€‚é€‰æ‹© L2TP å¹¶è¿”å›ã€‚ åœ¨ æè¿° å­—æ®µä¸­è¾“å…¥ä»»æ„å†…å®¹ã€‚ åœ¨ æœåŠ¡å™¨ å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN æœåŠ¡å™¨ IPã€‚ åœ¨ å¸æˆ· å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN ç”¨æˆ·åã€‚ åœ¨ å¯†ç  å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN å¯†ç ã€‚ åœ¨ å¯†é’¥ å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN IPsec PSKã€‚ å¯ç”¨ å‘é€æ‰€æœ‰æµé‡ é€‰é¡¹ã€‚ å•å‡»å³ä¸Šè§’çš„ å®Œæˆã€‚ å¯ç”¨ VPN è¿æ¥ã€‚ VPN è¿æ¥æˆåŠŸåï¼Œä¼šåœ¨é€šçŸ¥æ æ˜¾ç¤ºå›¾æ ‡ã€‚æœ€åä½ å¯ä»¥åˆ° è¿™é‡Œ æ£€æµ‹ä½ çš„ IP åœ°å€ï¼Œåº”è¯¥æ˜¾ç¤ºä¸ºä½ çš„ VPN æœåŠ¡å™¨ IPã€‚ å¦‚æœåœ¨è¿æ¥è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œè¯·å‚è§ æ•…éšœæ’é™¤ã€‚\nMacè¿æ¥ æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®å¹¶è½¬åˆ°ç½‘ç»œéƒ¨åˆ†ã€‚ åœ¨çª—å£å·¦ä¸‹è§’å•å‡» + æŒ‰é’®ã€‚ ä» æ¥å£ ä¸‹æ‹‰èœå•é€‰æ‹© VPNã€‚ ä» VPNç±»å‹ ä¸‹æ‹‰èœå•é€‰æ‹© IPSec ä¸Šçš„ L2TPã€‚ åœ¨ æœåŠ¡åç§° å­—æ®µä¸­è¾“å…¥ä»»æ„å†…å®¹ã€‚ å•å‡» åˆ›å»ºã€‚ åœ¨ æœåŠ¡å™¨åœ°å€ å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN æœåŠ¡å™¨ IPã€‚ åœ¨ å¸æˆ·åç§° å­—æ®µä¸­è¾“å…¥ä½ çš„ VPN ç”¨æˆ·åã€‚ å•å‡» é‰´å®šè®¾ç½® æŒ‰é’®ã€‚ åœ¨ ç”¨æˆ·é‰´å®š éƒ¨åˆ†ï¼Œé€‰æ‹© å¯†ç  å•é€‰æŒ‰é’®ï¼Œç„¶åè¾“å…¥ä½ çš„ VPN å¯†ç ã€‚ åœ¨ æœºå™¨é‰´å®š éƒ¨åˆ†ï¼Œé€‰æ‹© å…±äº«çš„å¯†é’¥ å•é€‰æŒ‰é’®ï¼Œç„¶åè¾“å…¥ä½ çš„ VPN IPsec PSKã€‚ å•å‡» å¥½ã€‚ é€‰ä¸­ åœ¨èœå•æ ä¸­æ˜¾ç¤º VPN çŠ¶æ€ å¤é€‰æ¡†ã€‚ ï¼ˆé‡è¦ï¼‰ å•å‡» é«˜çº§ æŒ‰é’®ï¼Œå¹¶é€‰ä¸­ é€šè¿‡VPNè¿æ¥å‘é€æ‰€æœ‰é€šä¿¡ å¤é€‰æ¡†ã€‚ å•å‡» TCP/IP é€‰é¡¹å¡ï¼Œå¹¶åœ¨ é…ç½®IPv6 éƒ¨åˆ†ä¸­é€‰æ‹© ä»…æœ¬åœ°é“¾æ¥ã€‚ å•å‡» å¥½ å…³é—­é«˜çº§è®¾ç½®ï¼Œç„¶åå•å‡» åº”ç”¨ ä¿å­˜VPNè¿æ¥ä¿¡æ¯ã€‚ è¦è¿æ¥åˆ° VPNï¼š ä½¿ç”¨èœå•æ ä¸­çš„å›¾æ ‡ï¼Œæˆ–è€…æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®çš„ç½‘ç»œéƒ¨åˆ†ï¼Œé€‰æ‹© VPN å¹¶å•å‡» è¿æ¥ã€‚æœ€åä½ å¯ä»¥åˆ° è¿™é‡Œ æ£€æµ‹ä½ çš„ IP åœ°å€ï¼Œåº”è¯¥æ˜¾ç¤ºä¸ºä½ çš„ VPN æœåŠ¡å™¨ IPã€‚ å¦‚æœåœ¨è¿æ¥è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯ï¼Œè¯·å‚è§ æ•…éšœæ’é™¤ã€‚\næœåŠ¡å™¨å®‰è£… https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/README-zh.md\nè®¾å¤‡è¿æ¥ https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients-zh.md\n","permalink":"https://www.iarno.cn/article/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAvpn/","tags":["vpn"],"title":"é˜¿é‡Œäº‘æœåŠ¡å™¨æ­å»ºvpn"},{"categories":null,"contents":"","permalink":"https://www.iarno.cn/search/","tags":null,"title":"Search Results"}]